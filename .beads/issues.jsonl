{"id":"bd-41v","title":"F01: Config System - Read/write .chorus/config.json","description":"## What\nRead/write .chorus/config.json for persistent settings.\n\n## Acceptance Criteria\n- [ ] Can load config from .chorus/config.json\n- [ ] Returns default config if file doesn't exist\n- [ ] Can save config to file\n- [ ] Creates .chorus/ directory if needed\n- [ ] Validates config structure\n- [ ] 8 tests pass\n\n## Files\n- src/types/config.ts (NEW)\n- src/services/ConfigService.ts (NEW)\n- tests/services/ConfigService.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F01-config-system.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:23:49.453114+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m1-infrastructure"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-47p","title":"F08: Signal Parser - Parse \u003cchorus\u003e signals from agent output","description":"## What\nParse \u003cchorus\u003e signals from agent output.\n\n## Acceptance Criteria\n- [ ] Parses COMPLETE, BLOCKED, PROGRESS signals\n- [ ] Returns null for no signal\n- [ ] isComplete(), isBlocked() helpers\n- [ ] getProgress() returns number\n- [ ] getReason() extracts reason text\n- [ ] 10 tests pass\n\n## Files\n- src/types/signal.ts (NEW)\n- src/services/SignalParser.ts (NEW)\n- tests/services/SignalParser.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F08-signal-parser.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:24:46.721297+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m2-agent-prep"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-bin","title":"F02: State System - Runtime state in .chorus/state.json","description":"## What\nManage runtime state in .chorus/state.json (transient, gitignored).\n\n## Acceptance Criteria\n- [ ] Can initialize new session state\n- [ ] Can load existing state for recovery\n- [ ] Can add/update/remove agents from state\n- [ ] Can manage merge queue\n- [ ] Persists changes with debounce (100ms)\n- [ ] clear() removes state file\n- [ ] 8 tests pass\n\n## Files\n- src/types/state.ts (NEW)\n- src/services/StateService.ts (NEW)\n- tests/services/StateService.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F02-state-system.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:23:57.385137+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m1-infrastructure"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-bxq","title":"F09: Agent-Task Linking - Associate agent with task ID","description":"## What\nAssociate spawned agents with task IDs, track in store and state.\n\n## Acceptance Criteria\n- [ ] Agent type includes taskId, agentType, worktree, branch\n- [ ] getAgentByTaskId() finds correct agent\n- [ ] getAgentsByType() filters correctly\n- [ ] incrementIteration() updates count\n- [ ] 5 tests pass\n\n## Files\n- src/types/agent.ts (extend)\n- src/stores/agentStore.ts (extend)\n- tests/stores/agentStore.test.ts (extend)\n\n## Plan\nSee: thoughts/shared/plans/features/F09-agent-task-linking.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:24:54.82499+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m2-agent-prep"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-d7v","title":"F07: Prompt Builder - Build agent prompts with task context","description":"## What\nBuild agent prompts with task context, acceptance criteria, signal protocol.\n\n## Acceptance Criteria\n- [ ] Generates prompt with task description\n- [ ] Includes acceptance criteria (or default)\n- [ ] Includes completion protocol with signal\n- [ ] Claude: no extra injection\n- [ ] Codex/OpenCode: includes AGENTS.md + learnings\n- [ ] 8 tests pass\n\n## Files\n- src/services/PromptBuilder.ts (NEW)\n- tests/services/PromptBuilder.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F07-prompt-builder.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:24:46.64524+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m2-agent-prep"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-hix","title":"F06: Worktree Service Complete - Full lifecycle management","description":"## What\nComplete worktree lifecycle: create, list, query, remove.\n\n## Acceptance Criteria\n- [ ] All F04 create tests pass\n- [ ] All F05 cleanup tests pass\n- [ ] list() returns all agent worktrees\n- [ ] getInfo() returns complete info\n- [ ] removeAll() cleans up everything\n- [ ] 4 additional tests (14 total)\n\n## Files\n- src/services/WorktreeService.ts (finalize)\n- tests/services/WorktreeService.test.ts (complete)\n\n## Plan\nSee: thoughts/shared/plans/features/F06-worktree-service.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:24:27.012325+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m1-infrastructure"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-jez","title":"F05: Worktree Cleanup - git worktree remove after merge","description":"## What\nRemove git worktrees after merge.\n\n## Acceptance Criteria\n- [ ] Removes worktree directory\n- [ ] Deletes branch if merged to main\n- [ ] Keeps branch if not merged (warning)\n- [ ] Force option for uncommitted changes\n- [ ] Throws if worktree doesn't exist\n- [ ] 5 tests pass\n\n## Files\n- src/services/WorktreeService.ts (extend)\n- tests/services/WorktreeService.test.ts (extend)\n\n## Plan\nSee: thoughts/shared/plans/features/F05-worktree-cleanup.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:24:18.998566+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m1-infrastructure"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-mdv","title":"F04: Worktree Create - git worktree add for agent isolation","description":"## What\nCreate git worktrees for agent isolation.\n\n## Acceptance Criteria\n- [ ] Creates worktree at .worktrees/{agent}-{task}\n- [ ] Creates branch agent/{agent}/{task} from main\n- [ ] Creates .worktrees/ directory if needed\n- [ ] Throws if worktree already exists\n- [ ] Returns correct WorktreeInfo\n- [ ] 5 tests pass\n\n## Files\n- src/services/WorktreeService.ts (NEW - partial)\n- tests/services/WorktreeService.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F04-worktree-create.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:24:04.989699+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m1-infrastructure"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-uvl","title":"F05: Worktree Remove - Cleanup after merge","description":"## What\nRemove git worktrees after task completion.\n\n## Acceptance Criteria\n- [ ] remove() runs: git worktree remove {path}\n- [ ] Deletes branch if merged to main\n- [ ] Keeps branch if not merged (logs warning)\n- [ ] force option for uncommitted changes\n- [ ] 5 tests pass\n\n## Files\n- src/services/WorktreeService.ts (extend)\n- tests/services/WorktreeService.test.ts (extend)\n\n## Test Cases\n1. remove() deletes worktree dir\n2. remove() deletes merged branch\n3. remove() keeps unmerged branch\n4. remove() with force works\n5. remove() throws if not exists","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:31:03.293979+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:31:30.582217+03:00","labels":["critical-path","feature","m1-infrastructure"],"deleted_at":"2026-01-10T01:31:30.582217+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"ch-001","title":"Write hello to test.txt","description":"Create test.txt and write 'Hello from Chorus!'","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:23:14.777764+03:00","updated_at":"2026-01-10T01:47:09.417655+03:00","deleted_at":"2026-01-10T01:47:09.417655+03:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"ch-002","title":"Count to 10","description":"Print numbers 1 to 10","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-10T01:23:14.777764+03:00","updated_at":"2026-01-10T01:47:09.485954+03:00","deleted_at":"2026-01-10T01:47:09.485954+03:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"ch-003","title":"Show current date","status":"tombstone","priority":3,"issue_type":"task","assignee":"agent-1","created_at":"2026-01-10T01:23:14.777764+03:00","updated_at":"2026-01-10T01:47:09.553706+03:00","deleted_at":"2026-01-10T01:47:09.553706+03:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"ch-0e7","title":"F15: Orchestrator Core - Central coordinator for task assignment","description":"## What\nCentral coordinator: task selection â†’ worktree creation â†’ prompt building â†’ agent spawning â†’ tracking.\n\n## Acceptance Criteria\n\n### Types (src/types/orchestration.ts)\n- [ ] AssignmentResult: success, agentId, taskId, worktree, error?\n- [ ] OrchestratorConfig: projectDir, config, agentManager, beadsService\n- [ ] TaskAssignment: taskId, agentType, modelOverride?\n\n### assignTask()\n- [ ] Creates worktree for task\n- [ ] Claims task via `bd update --status=in_progress`\n- [ ] Builds prompt with task context\n- [ ] Spawns agent in worktree directory\n- [ ] Returns AssignmentResult on success\n- [ ] Emits \"assigned\" event\n- [ ] Returns error if task not found\n- [ ] Returns error if task already assigned\n- [ ] Returns error if dependencies not met\n\n### canAssign()\n- [ ] Returns `{ can: true }` for ready open task\n- [ ] Returns `{ can: false }` for in_progress task\n- [ ] Returns `{ can: false }` for closed task\n- [ ] Returns `{ can: false }` if max agents reached\n- [ ] Checks dependencies are closed\n\n### getAgentType()\n- [ ] Uses task custom.agent if specified\n- [ ] Falls back to config default\n\n### Helper Methods\n- [ ] `getTask(id)` returns task or undefined\n- [ ] `getReadyTasks()` returns open tasks with satisfied deps\n- [ ] `getAgentConfig(type)` returns config for agent type\n- [ ] Passes CHORUS_TASK_ID, CHORUS_BRANCH env vars\n- [ ] Applies model override if allowed\n\n### Summary\n- [ ] 18 tests pass\n\n## Files\n- src/services/Orchestrator.ts (NEW)\n- src/types/orchestration.ts (NEW)\n- tests/services/Orchestrator.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F15-orchestrator-core.md\n\n## Notes\n- Core service - everything flows through here\n- Extends EventEmitter for 'assigned', 'error' events\n- Agent spawn in worktree cwd\n- Completion handling is F16 (not here)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:47:53.010882+03:00","created_by":"deligoez","updated_at":"2026-01-10T02:56:32.333509+03:00","labels":["critical-path","feature","m4-orchestration"],"dependencies":[{"issue_id":"ch-0e7","depends_on_id":"ch-iel","type":"blocks","created_at":"2026-01-10T01:47:53.01358+03:00","created_by":"deligoez"},{"issue_id":"ch-0e7","depends_on_id":"ch-wk8","type":"blocks","created_at":"2026-01-10T01:47:53.015317+03:00","created_by":"deligoez"},{"issue_id":"ch-0e7","depends_on_id":"ch-3y0","type":"blocks","created_at":"2026-01-10T01:47:53.016714+03:00","created_by":"deligoez"},{"issue_id":"ch-0e7","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-10T01:47:53.01801+03:00","created_by":"deligoez"}]}
{"id":"ch-112","title":"F05: Worktree Remove - Cleanup after merge","description":"## What\nRemove git worktrees after task completion.\n\n## Acceptance Criteria\n- [ ] remove() runs: git worktree remove {path}\n- [ ] Deletes branch if merged to main\n- [ ] Keeps branch if not merged (logs warning)\n- [ ] force option for uncommitted changes\n- [ ] isBranchMerged() checks if branch is merged into main\n- [ ] prune() cleans up stale worktree entries\n- [ ] 6 tests pass\n\n## Files\n- src/services/WorktreeService.ts (extend)\n- tests/services/WorktreeService.test.ts (extend)\n\n## API\n```typescript\nasync remove(agentType: string, taskId: string, options?: {\n  deleteBranch?: boolean;  // default true if merged\n  force?: boolean;         // git worktree remove --force\n}): Promise\u003cvoid\u003e;\n\nasync isBranchMerged(branch: string): Promise\u003cboolean\u003e;\n\nasync prune(): Promise\u003cvoid\u003e;\n```\n\n## Test Cases\n1. remove() deletes worktree dir\n2. remove() deletes merged branch\n3. remove() keeps unmerged branch\n4. remove() with force works\n5. remove() throws if not exists\n6. isBranchMerged() returns correct boolean","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:31:10.574386+03:00","created_by":"deligoez","updated_at":"2026-01-10T02:30:32.215624+03:00","labels":["critical-path","feature","m1-infrastructure"],"dependencies":[{"issue_id":"ch-112","depends_on_id":"ch-glq","type":"blocks","created_at":"2026-01-10T01:31:10.576808+03:00","created_by":"deligoez"}]}
{"id":"ch-2n6","title":"F01a: Config Types - ChorusConfig interface and defaults","description":"## What\nDefine TypeScript types for Chorus configuration.\n\n## Acceptance Criteria\n- [ ] ChorusConfig interface with all fields\n- [ ] AgentConfig interface\n- [ ] getDefaults() returns complete default config\n- [ ] 3 tests pass\n\n## Files\n- src/types/config.ts (NEW)\n\n## Implementation\n```typescript\nexport interface ChorusConfig {\n  version: string;\n  mode: 'semi-auto' | 'autopilot';\n  agents: { default: string; maxParallel: number; available: Record\u003cstring, AgentConfig\u003e };\n  project: { testCommand: string; buildCommand?: string };\n  completion: { signal: string; requireTests: boolean; maxIterations: number; taskTimeout: number };\n  merge: { autoResolve: boolean; agentResolve: boolean; requireApproval: boolean };\n  tui: { agentGrid: 'auto' | string };\n}\n\nexport function getDefaultConfig(): ChorusConfig { ... }\n```\n\n## Test Cases\n1. getDefaultConfig returns valid ChorusConfig\n2. Default mode is 'semi-auto'\n3. Default agent is 'claude'","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:30:10.093924+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:46:57.281088+03:00","labels":["critical-path","feature","m1-infrastructure"]}
{"id":"ch-3y0","title":"F09: Agent-Task Linking - Track agent-task association","description":"## What\nAssociate spawned agents with task IDs and track in agentStore.\n\n## Acceptance Criteria\n- [ ] Agent type includes taskId, agentType, worktree, branch\n- [ ] Agent type includes iteration, startedAt\n- [ ] getAgentByTaskId() finds correct agent\n- [ ] getAgentsByType() filters correctly\n- [ ] incrementIteration() updates count\n- [ ] 5 tests pass\n\n## Files\n- src/types/agent.ts (UPDATE - add fields)\n- src/stores/agentStore.ts (UPDATE - add actions)\n- tests/stores/agentStore.test.ts (UPDATE - add tests)\n\n## Plan\nSee: thoughts/shared/plans/features/F09-agent-task-linking.md","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:38:24.319933+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:46:57.274064+03:00","labels":["critical-path","feature","m2-agent-prep"]}
{"id":"ch-7gx","title":"F17: Semi-Auto Mode - User-initiated single task execution","description":"## What\nSemi-auto mode: user selects task â†’ one agent runs â†’ completes â†’ STOP (wait for next selection).\n\n## Acceptance Criteria\n\n### Types\n- [ ] SemiAutoConfig: orchestrator, completionHandler, config\n- [ ] SemiAutoStatus: active, currentTaskId, currentAgentId, iteration\n\n### startTask()\n- [ ] Assigns task via orchestrator\n- [ ] Emits \"taskStarted\" event\n- [ ] Updates status to active\n- [ ] Rejects if already running a task\n\n### cancelTask()\n- [ ] Kills running agent\n- [ ] Resets status to idle\n- [ ] Emits \"idle\" event\n\n### Completion Handling\n- [ ] Emits \"taskCompleted\" on success\n- [ ] Respawns agent on retry (under maxIterations)\n- [ ] Emits \"taskFailed\" on max iterations\n- [ ] Emits \"idle\" after completion or failure\n\n### Helper Methods\n- [ ] `getStatus()` returns current SemiAutoStatus\n- [ ] `isIdle()` returns true when no task running\n\n### Summary\n- [ ] 11 tests pass\n\n## Files\n- src/services/SemiAutoController.ts (NEW)\n- tests/services/SemiAutoController.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F17-semi-auto-mode.md\n\n## Notes\n- DEFAULT mode (config.mode === 'semi-auto')\n- Only ONE task at a time\n- Retry is automatic up to maxIterations\n- Enter key on task triggers startTask()","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T02:07:06.427237+03:00","created_by":"deligoez","updated_at":"2026-01-10T03:00:25.068926+03:00","labels":["critical-path","feature","m4-orchestration"],"dependencies":[{"issue_id":"ch-7gx","depends_on_id":"ch-0e7","type":"blocks","created_at":"2026-01-10T02:07:06.429867+03:00","created_by":"deligoez"},{"issue_id":"ch-7gx","depends_on_id":"ch-lhm","type":"blocks","created_at":"2026-01-10T02:07:06.431531+03:00","created_by":"deligoez"}]}
{"id":"ch-7ju","title":"F14: Dependency Resolver - Check task dependencies","description":"## What\nCheck if task dependencies are satisfied before assignment.\n\n## Acceptance Criteria\n\n### check()\n- [ ] `check(id)` returns `satisfied: true` when no dependencies\n- [ ] `check(id)` returns `satisfied: true` when all deps closed\n- [ ] `check(id)` returns `pending[]` for open deps\n- [ ] `check(id)` returns `inProgress[]` for in_progress deps\n- [ ] `check(id)` returns `failed[]` for missing deps\n\n### getDependencies()\n- [ ] `getDependencies(id)` returns empty array for no deps\n- [ ] `getDependencies(id)` returns list of dependency IDs\n\n### isDependencySatisfied()\n- [ ] `isDependencySatisfied(depId)` returns true if dep is closed\n- [ ] `isDependencySatisfied(depId)` returns false if dep is open/in_progress\n\n### getDependents()\n- [ ] `getDependents(id)` returns tasks blocked by this task\n- [ ] `getDependents(id)` returns empty array if nothing blocked\n\n### hasCircularDependency()\n- [ ] `hasCircularDependency(id)` returns false for linear deps\n- [ ] `hasCircularDependency(id)` returns true for circular deps\n\n### Summary\n- [ ] DependencyStatus interface: satisfied, pending[], inProgress[], failed[]\n- [ ] 13 tests pass\n\n## Files\n- src/services/DependencyResolver.ts (NEW)\n- tests/services/DependencyResolver.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F14-dependency-resolver.md\n\n## Notes\n- Uses BeadsCLI to query task status\n- Deps stored in task.dependencies array\n- Circular dependency check uses visited set","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T02:06:33.869228+03:00","created_by":"deligoez","updated_at":"2026-01-10T02:54:32.593334+03:00","labels":["critical-path","feature","m4-orchestration"],"dependencies":[{"issue_id":"ch-7ju","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-10T02:06:33.87357+03:00","created_by":"deligoez"}]}
{"id":"ch-7jw","title":"F16a: Completion Handler - Success path handling","description":"## What\nHandle successful task completion: detect signal + tests pass â†’ close task â†’ emit events.\n\n## Acceptance Criteria\n\n### Types\n- [ ] CompletionHandlerConfig: completionChecker, beadsCLI, worktreeService, config\n- [ ] TaskCompletionResult: taskId, agentId, success, iteration, reason, testOutput?\n\n### handleAgentExit() - Success Path\n- [ ] Returns success when signal + tests pass\n- [ ] Closes task via `beadsCLI.closeTask()`\n- [ ] Emits \"completed\" event with taskId, agentId\n- [ ] Emits \"readyForMerge\" event with taskId, branch, worktreePath\n- [ ] Returns TaskCompletionResult with success=true\n\n### handleSuccess()\n- [ ] Closes task with agent comment\n- [ ] Emits \"readyForMerge\" for merge queue\n\n### Summary\n- [ ] 5 tests pass\n\n## Files\n- src/services/CompletionHandler.ts (NEW)\n- tests/services/CompletionHandler.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F16-single-task-completion.md\n\n## Notes\n- Extends EventEmitter for events\n- Does NOT respawn agent (Orchestrator's job)\n- Merge queue handled by MergeService (M5)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T02:06:42.739971+03:00","created_by":"deligoez","updated_at":"2026-01-10T02:58:41.532944+03:00","labels":["critical-path","feature","m4-orchestration"],"dependencies":[{"issue_id":"ch-7jw","depends_on_id":"ch-uoa","type":"blocks","created_at":"2026-01-10T02:06:42.742454+03:00","created_by":"deligoez"},{"issue_id":"ch-7jw","depends_on_id":"ch-dzz","type":"blocks","created_at":"2026-01-10T02:06:42.744143+03:00","created_by":"deligoez"}]}
{"id":"ch-81x","title":"F02b: State Init/Load - Initialize or recover session state","description":"## What\nInitialize new state or load existing for recovery.\n\n## Acceptance Criteria\n- [ ] init() creates fresh state with UUID sessionId\n- [ ] init() sets startedAt timestamp and empty agents/mergeQueue\n- [ ] load() returns existing state or null\n- [ ] load() validates state structure (rejects malformed)\n- [ ] get() returns current state\n- [ ] 5 tests pass\n\n## Files\n- src/services/StateService.ts (NEW - partial)\n- tests/services/StateService.test.ts (NEW)\n\n## Implementation\n```typescript\nexport class StateService {\n  private statePath: string;\n  private state: ChorusState | null = null;\n\n  constructor(projectDir: string) {\n    this.statePath = path.join(projectDir, '.chorus', 'state.json');\n  }\n\n  init(): ChorusState {\n    this.state = {\n      version: '1.0',\n      sessionId: crypto.randomUUID(),\n      startedAt: Date.now(),\n      mode: 'semi-auto',\n      paused: false,\n      agents: {},\n      mergeQueue: [],\n      checkpoint: null,\n      stats: { tasksCompleted: 0, tasksFailed: 0, mergesAuto: 0, mergesManual: 0, totalIterations: 0, totalRuntime: 0 }\n    };\n    return this.state;\n  }\n\n  load(): ChorusState | null {\n    if (!fs.existsSync(this.statePath)) return null;\n    const data = JSON.parse(fs.readFileSync(this.statePath, 'utf-8'));\n    if (!this.isValidState(data)) throw new Error('Invalid state structure');\n    this.state = data;\n    return this.state;\n  }\n\n  get(): ChorusState {\n    if (!this.state) throw new Error('State not initialized');\n    return this.state;\n  }\n\n  private isValidState(data: unknown): data is ChorusState {\n    if (!data || typeof data !== 'object') return false;\n    const s = data as Record\u003cstring, unknown\u003e;\n    return !!(s.sessionId \u0026\u0026 s.startedAt \u0026\u0026 s.agents \u0026\u0026 s.stats);\n  }\n}\n```\n\n## Test Cases\n1. init() generates unique sessionId (UUID format)\n2. init() sets startedAt timestamp\n3. load() returns null if no file\n4. load() parses existing state\n5. load() throws on invalid/malformed state","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:30:50.906489+03:00","created_by":"deligoez","updated_at":"2026-01-10T02:26:31.486755+03:00","labels":["critical-path","feature","m1-infrastructure"],"dependencies":[{"issue_id":"ch-81x","depends_on_id":"ch-ah6","type":"blocks","created_at":"2026-01-10T01:30:50.908184+03:00","created_by":"deligoez"}]}
{"id":"ch-8j3","title":"F19: Orchestration Store - Zustand state management","description":"## What\nZustand store for orchestration state: mode, status, current task, stats.\n\n## Acceptance Criteria\n\n### Types\n- [ ] OperatingMode: 'semi-auto' | 'autopilot'\n- [ ] OrchestrationStatus: 'idle' | 'assigning' | 'running' | 'completing' | 'error'\n- [ ] OrchestrationState interface (12 properties)\n- [ ] OrchestrationActions interface (12 actions)\n\n### Mode\n- [ ] Defaults to 'semi-auto'\n- [ ] `setMode(mode)` changes mode\n\n### Status\n- [ ] `setStatus(status, error?)` sets status and optional error\n- [ ] `setIdle()` clears error and sets idle\n- [ ] `setError(error)` sets error status\n\n### Current Task\n- [ ] `setCurrentTask(taskId, agentId, agentType)` sets task details\n- [ ] `clearCurrentTask()` resets to null\n- [ ] `incrementIteration()` increments count\n\n### Stats\n- [ ] `recordCompletion(true)` increments tasksCompleted\n- [ ] `recordCompletion(false)` increments tasksFailed\n- [ ] `resetStats()` clears all stats\n\n### Autopilot\n- [ ] `setPaused(bool)` sets pause state\n- [ ] `setActiveAgentCount(n)` tracks running agents\n\n### Reset\n- [ ] `reset()` returns to initialState\n\n### Summary\n- [ ] 12 tests pass\n\n## Files\n- src/stores/orchestrationStore.ts (NEW)\n- tests/stores/orchestrationStore.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F19-orchestration-store.md\n\n## Notes\n- No dependencies (independent state store)\n- Similar pattern to agentStore, beadsStore\n- Services update store, components read","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T02:07:35.161308+03:00","created_by":"deligoez","updated_at":"2026-01-10T03:03:35.366181+03:00","labels":["feature","m4-orchestration"]}
{"id":"ch-9fq","title":"F18a: useTaskSelection Hook - Task navigation and selection","description":"## What\nReact hook for task selection: up/down navigation, selection state, assign action.\n\n## Acceptance Criteria\n\n### Interface\n- [ ] UseTaskSelectionResult: selectedTaskId, selectTask, selectNext, selectPrevious, assignSelected, canAssign\n\n### Selection\n- [ ] `selectTask(id)` sets selected task ID\n- [ ] `selectNext()` cycles through ready tasks (wraps at end)\n- [ ] `selectPrevious()` cycles backwards (wraps at start)\n- [ ] Navigation skips blocked tasks (only ready tasks)\n\n### Assignment\n- [ ] `canAssign` returns true when idle AND task selected\n- [ ] `canAssign` returns false when agent is running\n- [ ] `assignSelected()` calls semiAutoController.startTask()\n\n### Summary\n- [ ] 6 tests pass\n\n## Files\n- src/hooks/useTaskSelection.ts (NEW)\n- tests/hooks/useTaskSelection.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F18-task-selection-ui.md\n\n## Notes\n- Uses useMemo to filter ready tasks\n- Works with SemiAutoController for assignment","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T02:07:14.369577+03:00","created_by":"deligoez","updated_at":"2026-01-10T03:01:57.738763+03:00","labels":["feature","m4-orchestration"],"dependencies":[{"issue_id":"ch-9fq","depends_on_id":"ch-7gx","type":"blocks","created_at":"2026-01-10T02:07:14.372007+03:00","created_by":"deligoez"}]}
{"id":"ch-ah6","title":"F02a: State Types - ChorusState interface and SessionStats","description":"## What\nDefine TypeScript types for runtime state.\n\n## Acceptance Criteria\n- [ ] ChorusState interface\n- [ ] AgentState interface  \n- [ ] MergeQueueItem interface\n- [ ] SessionStats interface\n- [ ] 2 tests pass\n\n## Files\n- src/types/state.ts (NEW)\n\n## Interfaces\n- ChorusState: version, sessionId, mode, paused, agents, mergeQueue, checkpoint, stats\n- AgentState: id, type, pid, taskId, worktree, branch, iteration, startedAt, status\n- MergeQueueItem: taskId, branch, worktree, priority, status, retries, enqueuedAt\n- SessionStats: tasksCompleted, tasksFailed, mergesAuto, mergesManual, totalIterations\n\n## Test Cases\n1. Types compile without errors\n2. Example state object is valid","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:30:38.527356+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:46:57.279318+03:00","labels":["critical-path","feature","m1-infrastructure"]}
{"id":"ch-cg0","title":"F02c: State Agent Ops - Add/update/remove agents","description":"## What\nManage agents in state.\n\n## Acceptance Criteria\n- [ ] addAgent() adds to state.agents\n- [ ] updateAgent() modifies existing\n- [ ] removeAgent() deletes from state\n- [ ] getAgent() retrieves by id\n- [ ] 4 tests pass\n\n## Test Cases\n1. addAgent stores agent\n2. updateAgent modifies fields\n3. removeAgent deletes agent\n4. getAgent returns undefined for missing","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:30:50.982849+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:46:57.278139+03:00","labels":["critical-path","feature","m1-infrastructure"],"dependencies":[{"issue_id":"ch-cg0","depends_on_id":"ch-ah6","type":"blocks","created_at":"2026-01-10T01:30:50.984583+03:00","created_by":"deligoez"},{"issue_id":"ch-cg0","depends_on_id":"ch-81x","type":"blocks","created_at":"2026-01-10T01:37:13.386589+03:00","created_by":"deligoez"}]}
{"id":"ch-dzz","title":"F13: Task Closer - Mark tasks as closed via bd CLI","description":"## What\nClose completed tasks and manage task status via bd CLI (extends BeadsCLI from F12).\n\n## Acceptance Criteria\n- [ ] `closeTask(id, comment?)` runs `bd close \u003cid\u003e`\n- [ ] `closeTask()` supports optional comment via `--comment`\n- [ ] `closeTask()` throws on bd error\n- [ ] `reopenTask(id)` changes status back to open\n- [ ] `getTaskStatus(id)` returns current status string\n- [ ] `getTaskStatus(id)` returns null for invalid task\n- [ ] `getInProgressTasks()` returns array of in_progress tasks\n- [ ] `getClosedTasks()` returns array of closed tasks\n- [ ] 8 tests pass\n\n## Files\n- src/services/BeadsCLI.ts (UPDATE - add methods)\n- tests/services/BeadsCLI.test.ts (UPDATE - add tests)\n\n## Plan\nSee: thoughts/shared/plans/features/F13-task-closer.md\n\n## Notes\n- Extends BeadsCLI from F12\n- Use `bd close` (not `bd update --status=closed`)\n- reopenTask for false completion recovery\n- Use --json flag for structured output","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:39:07.662362+03:00","created_by":"deligoez","updated_at":"2026-01-10T02:52:17.529067+03:00","labels":["critical-path","feature","m3-task-mgmt"],"dependencies":[{"issue_id":"ch-dzz","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-10T01:39:40.054514+03:00","created_by":"deligoez"}]}
{"id":"ch-e7f","title":"F18b: TaskPanel Selection UI - Visual selection in TUI","description":"## What\nUpdate TaskPanel to show selection highlight, Enter key assignment, status icons.\n\n## Acceptance Criteria\n\n### Visual Selection\n- [ ] Selected task has blue background highlight\n- [ ] Arrow indicator (â—€) shown on selected task\n- [ ] Shows \"Press Enter to assign\" when canAssign is true\n\n### Keyboard Handling\n- [ ] Up arrow calls selectPrevious\n- [ ] Down arrow calls selectNext\n- [ ] Enter key triggers assignSelected when canAssign\n\n### Status Display\n- [ ] Shows status icons per task (ðŸ”„ for in_progress)\n- [ ] Shows blocker count for blocked tasks\n- [ ] Shows ready/blocked counts in footer\n\n### Components\n- [ ] TaskRow component with highlight + status\n- [ ] getStatusColor() helper function\n- [ ] getStatusIcon() helper function\n\n### Summary\n- [ ] 4 tests pass\n\n## Files\n- src/components/TaskPanel.tsx (UPDATE)\n- src/components/TaskRow.tsx (NEW)\n- tests/components/TaskPanel.test.tsx (UPDATE)\n\n## Plan\nSee: thoughts/shared/plans/features/F18-task-selection-ui.md\n\n## Notes\n- Uses useInput from Ink for keyboard\n- Selection state from useTaskSelection hook","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T02:07:21.76659+03:00","created_by":"deligoez","updated_at":"2026-01-10T03:02:09.43101+03:00","labels":["feature","m4-orchestration"],"dependencies":[{"issue_id":"ch-e7f","depends_on_id":"ch-9fq","type":"blocks","created_at":"2026-01-10T02:07:21.768899+03:00","created_by":"deligoez"}]}
{"id":"ch-g6z","title":"F20: useOrchestration Hook - TUI orchestration integration","description":"## What\nReact hook connecting TUI components to orchestration services and store.\n\n## Acceptance Criteria\n\n### Interface\n- [ ] UseOrchestrationResult: state + derived + actions\n- [ ] Returns 9 state properties from store\n- [ ] Returns 3 derived properties (isIdle, isRunning, canStartTask)\n- [ ] Returns 7 action functions\n\n### Initialization\n- [ ] Initializes with idle state\n- [ ] Creates services once via useMemo\n- [ ] Wires event handlers via useEffect\n- [ ] Cleans up event handlers on unmount\n\n### Actions\n- [ ] `startTask(taskId, agentType?)` starts via controller\n- [ ] `startTask` updates store status to 'assigning'\n- [ ] `startTask` sets error on failure\n- [ ] `cancelTask()` cancels and clears store\n\n### Event Handling\n- [ ] Updates store on 'taskCompleted'\n- [ ] Updates store on 'taskFailed'\n- [ ] Increments iteration on 'retry'\n\n### Derived State\n- [ ] `isIdle` = status === 'idle'\n- [ ] `canStartTask` = isIdle \u0026\u0026 mode === 'semi-auto'\n\n### Summary\n- [ ] 10 tests pass\n\n## Files\n- src/hooks/useOrchestration.ts (NEW)\n- tests/hooks/useOrchestration.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F20-use-orchestration.md\n\n## Notes\n- Similar pattern to useAgentManager\n- Autopilot actions are placeholders for M7\n- Services created once, events wired with cleanup","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T02:07:43.468053+03:00","created_by":"deligoez","updated_at":"2026-01-10T03:04:41.974004+03:00","labels":["feature","m4-orchestration"],"dependencies":[{"issue_id":"ch-g6z","depends_on_id":"ch-0e7","type":"blocks","created_at":"2026-01-10T02:07:43.470457+03:00","created_by":"deligoez"},{"issue_id":"ch-g6z","depends_on_id":"ch-lhm","type":"blocks","created_at":"2026-01-10T02:07:43.47217+03:00","created_by":"deligoez"},{"issue_id":"ch-g6z","depends_on_id":"ch-7gx","type":"blocks","created_at":"2026-01-10T02:07:43.47353+03:00","created_by":"deligoez"},{"issue_id":"ch-g6z","depends_on_id":"ch-8j3","type":"blocks","created_at":"2026-01-10T02:07:43.474872+03:00","created_by":"deligoez"}]}
{"id":"ch-glq","title":"F04: Worktree Create - git worktree add for isolation","description":"## What\nCreate git worktrees for agent isolation.\n\n## Acceptance Criteria\n- [ ] create() runs: git worktree add .worktrees/{agent}-{task} -b agent/{agent}/{task} main\n- [ ] Creates .worktrees/ directory if needed\n- [ ] Returns WorktreeInfo with path, branch, agentType, taskId\n- [ ] Throws if worktree already exists\n- [ ] exists() checks if worktree directory exists\n- [ ] getPath() returns worktree path\n- [ ] getBranch() returns branch name\n- [ ] list() returns all worktrees (via git worktree list --porcelain)\n- [ ] 7 tests pass\n\n## Files\n- src/services/WorktreeService.ts (NEW)\n- tests/services/WorktreeService.test.ts (NEW)\n\n## Interface\n```typescript\ninterface WorktreeInfo {\n  path: string;      // .worktrees/claude-bd-a1b2\n  branch: string;    // agent/claude/bd-a1b2\n  agentType: string;\n  taskId: string;\n}\n\nclass WorktreeService {\n  constructor(projectDir: string);\n  \n  async create(agentType: string, taskId: string): Promise\u003cWorktreeInfo\u003e;\n  exists(agentType: string, taskId: string): boolean;\n  getPath(agentType: string, taskId: string): string;\n  getBranch(agentType: string, taskId: string): string;\n  list(): WorktreeInfo[];\n}\n```\n\n## Test Cases\n1. create() makes worktree directory\n2. create() creates branch from main\n3. create() returns correct WorktreeInfo\n4. create() throws if exists\n5. Creates .worktrees/ if missing\n6. exists() returns true/false correctly\n7. list() returns all agent worktrees","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:31:03.217127+03:00","created_by":"deligoez","updated_at":"2026-01-10T02:29:42.506656+03:00","labels":["critical-path","feature","m1-infrastructure"]}
{"id":"ch-iel","title":"F06: Worktree Query - List and get worktree info","description":"## What\nQuery worktrees and bulk operations.\n\n## Acceptance Criteria\n- [ ] getInfo() returns WorktreeInfo with head commit SHA\n- [ ] removeAll() removes all agent worktrees\n- [ ] 4 tests pass\n\n## Files\n- src/services/WorktreeService.ts (extend)\n- tests/services/WorktreeService.test.ts (extend)\n\n## API\n```typescript\nasync getInfo(agentType: string, taskId: string): Promise\u003cWorktreeInfo\u003e;\n\nasync removeAll(options?: { force?: boolean }): Promise\u003cvoid\u003e;\n```\n\n## Test Cases\n1. getInfo() returns correct WorktreeInfo with head SHA\n2. getInfo() throws if worktree not found\n3. removeAll() removes all worktrees\n4. removeAll() with force removes even dirty worktrees\n\n## Note\nThis task completes WorktreeService. Methods from F04 (create, exists, getPath, getBranch, list) and F05 (remove, isBranchMerged, prune) should already be implemented.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:31:17.922621+03:00","created_by":"deligoez","updated_at":"2026-01-10T02:31:20.706257+03:00","labels":["critical-path","feature","m1-infrastructure"],"dependencies":[{"issue_id":"ch-iel","depends_on_id":"ch-112","type":"blocks","created_at":"2026-01-10T01:31:17.924367+03:00","created_by":"deligoez"},{"issue_id":"ch-iel","depends_on_id":"ch-glq","type":"blocks","created_at":"2026-01-10T01:47:33.787562+03:00","created_by":"deligoez"}]}
{"id":"ch-k3d","title":"F10: Test Runner - Run project test command","description":"## What\nRun a test command and capture result (passed/failed, output, duration).\n\n## Acceptance Criteria\n- [ ] Constructor takes projectDir and testCommand\n- [ ] `run(cwd?)` executes command via shell\n- [ ] Returns `passed: true` for exit code 0\n- [ ] Returns `passed: false` for non-zero exit code\n- [ ] Captures stdout and stderr in output\n- [ ] Tracks execution duration (ms)\n- [ ] `runWithTimeout(cwd?, timeout?)` supports timeout\n- [ ] Returns exit code 124 on timeout\n- [ ] `getCommand()` returns test command\n- [ ] 6 tests pass\n\n## Files\n- src/services/TestRunner.ts (NEW)\n- tests/services/TestRunner.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F10-test-runner.md\n\n## Notes\n- TestRunner is generic - receives testCommand as constructor arg\n- Caller (F15 Orchestrator) reads config and passes testCommand\n- Uses `sh -c` to run command (supports pipes)\n- Default timeout: 5 minutes (300000ms)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:38:49.692278+03:00","created_by":"deligoez","updated_at":"2026-01-10T02:46:50.822793+03:00","labels":["critical-path","feature","m3-task-mgmt"]}
{"id":"ch-lhm","title":"F16b: Completion Handler - Retry and failure logic","description":"## What\nHandle retry logic when agent doesn't complete: detect failure, track iterations, emit retry/failed events.\n\n## Acceptance Criteria\n\n### handleAgentExit() - Failure Path\n- [ ] Returns failure when no completion signal\n- [ ] Returns failure when tests fail\n- [ ] Detects blocked state from signal\n\n### handleFailure()\n- [ ] Allows retry if iteration \u003c maxIterations\n- [ ] Emits \"retry\" event when retrying\n- [ ] Returns `{ maxReached: true }` when at limit\n- [ ] Emits \"failed\" event when max reached\n- [ ] Increments iteration count in agentStore\n\n### Integration\n- [ ] Respects `config.completion.maxIterations`\n- [ ] Updates agent iteration via `agentStore.incrementIteration()`\n\n### Summary\n- [ ] 6 tests pass\n\n## Files\n- src/services/CompletionHandler.ts (UPDATE)\n- tests/services/CompletionHandler.test.ts (UPDATE)\n\n## Plan\nSee: thoughts/shared/plans/features/F16-single-task-completion.md\n\n## Notes\n- Does NOT respawn agent (Orchestrator handles retry)\n- Events allow loose coupling with Orchestrator","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T02:06:51.093896+03:00","created_by":"deligoez","updated_at":"2026-01-10T02:58:52.476086+03:00","labels":["critical-path","feature","m4-orchestration"],"dependencies":[{"issue_id":"ch-lhm","depends_on_id":"ch-7jw","type":"blocks","created_at":"2026-01-10T02:06:51.096495+03:00","created_by":"deligoez"}]}
{"id":"ch-mpl","title":"F08: Signal Parser - Parse \u003cchorus\u003e signals from output","description":"## What\nParse \u003cchorus\u003e signals from agent output to detect completion, blocking, and other states.\n\n## Acceptance Criteria\n- [ ] parse() returns ParseResult with first signal found\n- [ ] parseAll() returns array of all signals in output\n- [ ] hasSignal() checks for specific signal type\n- [ ] isComplete() returns true for COMPLETE signal\n- [ ] isBlocked() returns true for BLOCKED signal\n- [ ] getProgress() returns number (0-100) or null\n- [ ] getReason() extracts reason from BLOCKED/NEEDS_HELP\n- [ ] Finds signal anywhere in output (not just end)\n- [ ] 10 tests pass\n\n## Files\n- src/types/signal.ts (NEW)\n- src/services/SignalParser.ts (NEW)\n- tests/services/SignalParser.test.ts (NEW)\n\n## API\n```typescript\ntype SignalType = 'COMPLETE' | 'BLOCKED' | 'NEEDS_HELP' | 'PROGRESS' | 'RESOLVED' | 'NEEDS_HUMAN';\n\ninterface Signal {\n  type: SignalType;\n  payload: string | null;\n  raw: string;\n}\n\ninterface ParseResult {\n  signal: Signal | null;\n  hasSignal: boolean;\n}\n\nclass SignalParser {\n  parse(output: string): ParseResult;\n  parseAll(output: string): Signal[];\n  hasSignal(output: string, type: SignalType): boolean;\n  isComplete(output: string): boolean;\n  isBlocked(output: string): boolean;\n  getProgress(output: string): number | null;\n  getReason(output: string): string | null;\n}\n```\n\n## Test Cases\n1. parse() returns COMPLETE signal\n2. parse() returns BLOCKED with reason\n3. parse() returns NEEDS_HELP with question\n4. parse() returns PROGRESS with percentage\n5. parse() returns null for no signal\n6. parse() finds signal in middle of output\n7. parseAll() finds multiple signals\n8. parseAll() returns empty for no signals\n9. isComplete() returns true for COMPLETE\n10. getProgress() clamps value to 0-100","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:38:13.856983+03:00","created_by":"deligoez","updated_at":"2026-01-10T02:34:33.427675+03:00","labels":["critical-path","feature","m2-agent-prep"]}
{"id":"ch-r12","title":"F02d: State Persistence - Debounced save and clear","description":"## What\nPersist state to disk with debouncing.\n\n## Acceptance Criteria\n- [ ] save() writes to .chorus/state.json\n- [ ] Debounces rapid saves (100ms)\n- [ ] clear() removes state file\n- [ ] 3 tests pass\n\n## Test Cases\n1. save() creates file\n2. Multiple rapid updates debounced\n3. clear() deletes file","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:30:51.05887+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:46:57.277562+03:00","labels":["critical-path","feature","m1-infrastructure"],"dependencies":[{"issue_id":"ch-r12","depends_on_id":"ch-ah6","type":"blocks","created_at":"2026-01-10T01:30:51.060628+03:00","created_by":"deligoez"},{"issue_id":"ch-r12","depends_on_id":"ch-81x","type":"blocks","created_at":"2026-01-10T01:37:14.840129+03:00","created_by":"deligoez"}]}
{"id":"ch-sro","title":"F01b: Config Load - Read config from .chorus/config.json","description":"## What\nLoad configuration from .chorus/config.json file.\n\n## Acceptance Criteria\n- [ ] load() reads and parses JSON file\n- [ ] Returns default config if file doesn't exist\n- [ ] Throws on invalid JSON\n- [ ] Caches loaded config\n- [ ] get() returns cached config (calls load if not cached)\n- [ ] exists() checks if config file exists\n- [ ] 5 tests pass\n\n## Files\n- src/services/ConfigService.ts (NEW - partial)\n- tests/services/ConfigService.test.ts (NEW)\n\n## Implementation\n```typescript\nexport class ConfigService {\n  private configPath: string;\n  private config: ChorusConfig | null = null;\n  \n  constructor(projectDir: string) {\n    this.configPath = path.join(projectDir, '.chorus', 'config.json');\n  }\n  \n  load(): ChorusConfig {\n    if (!fs.existsSync(this.configPath)) {\n      this.config = getDefaultConfig();\n      return this.config;\n    }\n    this.config = JSON.parse(fs.readFileSync(this.configPath, 'utf-8'));\n    return this.config;\n  }\n  \n  get(): ChorusConfig {\n    if (!this.config) return this.load();\n    return this.config;\n  }\n  \n  exists(): boolean {\n    return fs.existsSync(this.configPath);\n  }\n}\n```\n\n## Test Cases\n1. load() returns defaults when file missing\n2. load() parses existing config file\n3. load() throws on malformed JSON\n4. get() returns cached config\n5. exists() returns false when no file","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:30:22.3151+03:00","created_by":"deligoez","updated_at":"2026-01-10T02:23:37.380881+03:00","labels":["critical-path","feature","m1-infrastructure"],"dependencies":[{"issue_id":"ch-sro","depends_on_id":"ch-2n6","type":"blocks","created_at":"2026-01-10T01:30:22.316939+03:00","created_by":"deligoez"}]}
{"id":"ch-tpj","title":"F02e: State Merge Queue - Manage merge queue operations","description":"## What\nManage merge queue in state for tracking branches ready to merge.\n\n## Acceptance Criteria\n- [ ] enqueueMerge(item) adds to mergeQueue array\n- [ ] dequeueMerge() returns highest priority item and removes it\n- [ ] updateMergeItem(taskId, partial) modifies existing item\n- [ ] incrementStat(key) increments SessionStats field\n- [ ] update(partial) merges partial state and triggers save\n- [ ] 5 tests pass\n\n## Files\n- src/services/StateService.ts (extend)\n- tests/services/StateService.test.ts (extend)\n\n## Implementation\n```typescript\nenqueueMerge(item: MergeQueueItem): void {\n  this.state.mergeQueue.push(item);\n  this.state.mergeQueue.sort((a, b) =\u003e b.priority - a.priority);\n  this.saveDebounced();\n}\n\ndequeueMerge(): MergeQueueItem | undefined {\n  const item = this.state.mergeQueue.shift();\n  if (item) this.saveDebounced();\n  return item;\n}\n\nupdateMergeItem(taskId: string, partial: Partial\u003cMergeQueueItem\u003e): void {\n  const item = this.state.mergeQueue.find(i =\u003e i.taskId === taskId);\n  if (item) Object.assign(item, partial);\n  this.saveDebounced();\n}\n\nincrementStat(key: keyof SessionStats): void {\n  (this.state.stats[key] as number)++;\n  this.saveDebounced();\n}\n\nupdate(partial: Partial\u003cChorusState\u003e): void {\n  Object.assign(this.state, partial);\n  this.saveDebounced();\n}\n```\n\n## Test Cases\n1. enqueueMerge adds item sorted by priority\n2. dequeueMerge returns and removes highest priority\n3. updateMergeItem modifies existing item\n4. incrementStat increases counter\n5. update merges partial state","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T02:26:18.79708+03:00","created_by":"deligoez","updated_at":"2026-01-10T02:26:18.79708+03:00","labels":["critical-path","feature","m1-infrastructure"],"dependencies":[{"issue_id":"ch-tpj","depends_on_id":"ch-81x","type":"blocks","created_at":"2026-01-10T02:26:18.802044+03:00","created_by":"deligoez"},{"issue_id":"ch-tpj","depends_on_id":"ch-ah6","type":"blocks","created_at":"2026-01-10T02:26:40.031341+03:00","created_by":"deligoez"}]}
{"id":"ch-uoa","title":"F11: Completion Checker - Detect task completion (signal + tests)","description":"## What\nCheck if agent has completed task using signal detection AND test verification.\n\n## Acceptance Criteria\n- [ ] `check()` returns `complete: false` if no signal\n- [ ] `check()` returns `complete: true` if signal + tests pass\n- [ ] `check()` returns `complete: false` if signal + tests fail\n- [ ] `check()` respects `requireTests` config option (true = skip tests)\n- [ ] `check()` runs tests in worktree path\n- [ ] `hasCompletionSignal()` quick check without running tests\n- [ ] `isBlocked()` detects BLOCKED signal and extracts reason\n- [ ] `needsHelp()` detects NEEDS_HELP signal and extracts question\n- [ ] CompletionResult includes: complete, hasSignal, testsPassed, reason, testOutput\n- [ ] 9 tests pass\n\n## Files\n- src/services/CompletionChecker.ts (NEW)\n- tests/services/CompletionChecker.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F11-completion-checker.md\n\n## Notes\n- AND logic: signal + tests = complete\n- requireTests: false bypasses test check\n- isBlocked/needsHelp are helpers for Orchestrator (F15)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:38:59.126542+03:00","created_by":"deligoez","updated_at":"2026-01-10T02:49:29.586107+03:00","labels":["critical-path","feature","m3-task-mgmt"],"dependencies":[{"issue_id":"ch-uoa","depends_on_id":"ch-mpl","type":"blocks","created_at":"2026-01-10T01:38:59.129353+03:00","created_by":"deligoez"},{"issue_id":"ch-uoa","depends_on_id":"ch-k3d","type":"blocks","created_at":"2026-01-10T01:38:59.130889+03:00","created_by":"deligoez"}]}
{"id":"ch-wk8","title":"F07: Prompt Builder - Build task prompts with context","description":"## What\nBuild agent prompts with task context, acceptance criteria, and Chorus signal protocol.\n\n## Acceptance Criteria\n- [ ] build() generates complete prompt for agent\n- [ ] buildTaskSection() generates task description section\n- [ ] buildCompletionSection() generates signal protocol section\n- [ ] loadAgentsMd() reads AGENTS.md if exists\n- [ ] loadLearnings() reads .agent/learnings.md if exists\n- [ ] needsContextInjection() returns false for claude, true for others\n- [ ] Claude: no extra injection\n- [ ] Codex/OpenCode: includes AGENTS.md + learnings\n- [ ] 8 tests pass\n\n## Files\n- src/services/PromptBuilder.ts (NEW)\n- tests/services/PromptBuilder.test.ts (NEW)\n\n## API\n```typescript\ninterface PromptContext {\n  task: Bead;\n  agentType: 'claude' | 'codex' | 'opencode';\n  branch: string;\n  config: ChorusConfig;\n  learnings?: string;\n}\n\nclass PromptBuilder {\n  build(context: PromptContext): string;\n  buildTaskSection(task: Bead): string;\n  buildCompletionSection(config: ChorusConfig): string;\n  loadAgentsMd(projectDir: string): string | null;\n  loadLearnings(projectDir: string): string | null;\n  needsContextInjection(agentType: string): boolean;\n}\n```\n\n## Test Cases\n1. build() includes task description\n2. build() includes acceptance criteria from task\n3. build() uses default criteria if none specified\n4. build() includes completion protocol with signal\n5. build() includes branch name\n6. needsContextInjection() returns false for claude\n7. build() injects AGENTS.md for codex\n8. build() injects learnings for non-claude\n\n## Plan\nSee: thoughts/shared/plans/features/F07-prompt-builder.md","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:38:04.926365+03:00","created_by":"deligoez","updated_at":"2026-01-10T02:32:41.610137+03:00","labels":["critical-path","feature","m2-agent-prep"]}
{"id":"ch-y43","title":"F01c: Config Save - Write config to file with validation","description":"## What\nSave configuration to .chorus/config.json with validation.\n\n## Acceptance Criteria\n- [ ] save() writes config to file with 2-space indent\n- [ ] Creates .chorus/ directory if needed\n- [ ] update(partial) merges and saves partial config\n- [ ] validate() checks required fields\n- [ ] validate() rejects invalid mode\n- [ ] validate() rejects invalid agent config\n- [ ] validate() rejects missing required fields\n- [ ] 6 tests pass\n\n## Files\n- src/services/ConfigService.ts (extend)\n- tests/services/ConfigService.test.ts (extend)\n\n## Implementation\n```typescript\nsave(config: ChorusConfig): void {\n  const dir = path.dirname(this.configPath);\n  if (!fs.existsSync(dir)) {\n    fs.mkdirSync(dir, { recursive: true });\n  }\n  fs.writeFileSync(this.configPath, JSON.stringify(config, null, 2));\n  this.config = config;\n}\n\nupdate(partial: Partial\u003cChorusConfig\u003e): void {\n  const current = this.get();\n  const merged = { ...current, ...partial };\n  this.save(merged);\n}\n\nvalidate(config: unknown): config is ChorusConfig {\n  if (!config || typeof config !== 'object') return false;\n  const c = config as Record\u003cstring, unknown\u003e;\n  if (!c.version || !c.mode || !c.agents || !c.project || !c.completion) return false;\n  if (c.mode !== 'semi-auto' \u0026\u0026 c.mode !== 'autopilot') return false;\n  // Agent config validation...\n  return true;\n}\n```\n\n## Test Cases\n1. save() creates directory if missing\n2. save() writes formatted JSON (2-space indent)\n3. update() merges partial config\n4. validate() accepts valid config\n5. validate() rejects invalid mode\n6. validate() rejects missing required fields","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:30:30.340211+03:00","created_by":"deligoez","updated_at":"2026-01-10T02:23:38.261452+03:00","labels":["critical-path","feature","m1-infrastructure"],"dependencies":[{"issue_id":"ch-y43","depends_on_id":"ch-sro","type":"blocks","created_at":"2026-01-10T01:30:30.342251+03:00","created_by":"deligoez"}]}
{"id":"ch-zqi","title":"F12: Task Claimer - Claim tasks via bd CLI","description":"## What\nMark tasks as in_progress and assign to agent via bd CLI wrapper.\n\n## Acceptance Criteria\n- [ ] `claimTask(id, assignee)` runs `bd update \u003cid\u003e --status=in_progress --assignee=\u003cagent\u003e`\n- [ ] `claimTask()` throws on bd error\n- [ ] `getTask(id)` returns parsed task for valid ID\n- [ ] `getTask(id)` returns null for invalid ID\n- [ ] `getReadyTasks()` returns array of ready tasks\n- [ ] `getReadyTasks()` returns empty array on error\n- [ ] `isAvailable()` returns true if bd installed\n- [ ] `isInitialized()` returns true if bd initialized in project\n- [ ] 8 tests pass\n\n## Files\n- src/services/BeadsCLI.ts (NEW)\n- tests/services/BeadsCLI.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F12-task-claimer.md\n\n## Notes\n- Use execa for CLI calls\n- Parse JSON output (bd show --json, bd ready --json)\n- projectDir is cwd for all bd commands","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:39:31.364679+03:00","created_by":"deligoez","updated_at":"2026-01-10T02:50:59.423081+03:00","labels":["critical-path","feature","m3-task-mgmt"]}
