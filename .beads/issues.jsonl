{"id":"bd-41v","title":"F01: Config System - Read/write .chorus/config.json","description":"## What\nRead/write .chorus/config.json for persistent settings.\n\n## Acceptance Criteria\n- [ ] Can load config from .chorus/config.json\n- [ ] Returns default config if file doesn't exist\n- [ ] Can save config to file\n- [ ] Creates .chorus/ directory if needed\n- [ ] Validates config structure\n- [ ] 8 tests pass\n\n## Files\n- src/types/config.ts (NEW)\n- src/services/ConfigService.ts (NEW)\n- tests/services/ConfigService.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F01-config-system.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:23:49.453114+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m1-infrastructure"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-47p","title":"F08: Signal Parser - Parse \u003cchorus\u003e signals from agent output","description":"## What\nParse \u003cchorus\u003e signals from agent output.\n\n## Acceptance Criteria\n- [ ] Parses COMPLETE, BLOCKED, PROGRESS signals\n- [ ] Returns null for no signal\n- [ ] isComplete(), isBlocked() helpers\n- [ ] getProgress() returns number\n- [ ] getReason() extracts reason text\n- [ ] 10 tests pass\n\n## Files\n- src/types/signal.ts (NEW)\n- src/services/SignalParser.ts (NEW)\n- tests/services/SignalParser.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F08-signal-parser.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:24:46.721297+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m2-agent-prep"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-bin","title":"F02: State System - Runtime state in .chorus/state.json","description":"## What\nManage runtime state in .chorus/state.json (transient, gitignored).\n\n## Acceptance Criteria\n- [ ] Can initialize new session state\n- [ ] Can load existing state for recovery\n- [ ] Can add/update/remove agents from state\n- [ ] Can manage merge queue\n- [ ] Persists changes with debounce (100ms)\n- [ ] clear() removes state file\n- [ ] 8 tests pass\n\n## Files\n- src/types/state.ts (NEW)\n- src/services/StateService.ts (NEW)\n- tests/services/StateService.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F02-state-system.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:23:57.385137+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m1-infrastructure"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-bxq","title":"F09: Agent-Task Linking - Associate agent with task ID","description":"## What\nAssociate spawned agents with task IDs, track in store and state.\n\n## Acceptance Criteria\n- [ ] Agent type includes taskId, agentType, worktree, branch\n- [ ] getAgentByTaskId() finds correct agent\n- [ ] getAgentsByType() filters correctly\n- [ ] incrementIteration() updates count\n- [ ] 5 tests pass\n\n## Files\n- src/types/agent.ts (extend)\n- src/stores/agentStore.ts (extend)\n- tests/stores/agentStore.test.ts (extend)\n\n## Plan\nSee: thoughts/shared/plans/features/F09-agent-task-linking.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:24:54.82499+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m2-agent-prep"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-d7v","title":"F07: Prompt Builder - Build agent prompts with task context","description":"## What\nBuild agent prompts with task context, acceptance criteria, signal protocol.\n\n## Acceptance Criteria\n- [ ] Generates prompt with task description\n- [ ] Includes acceptance criteria (or default)\n- [ ] Includes completion protocol with signal\n- [ ] Claude: no extra injection\n- [ ] Codex/OpenCode: includes AGENTS.md + learnings\n- [ ] 8 tests pass\n\n## Files\n- src/services/PromptBuilder.ts (NEW)\n- tests/services/PromptBuilder.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F07-prompt-builder.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:24:46.64524+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m2-agent-prep"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-hix","title":"F06: Worktree Service Complete - Full lifecycle management","description":"## What\nComplete worktree lifecycle: create, list, query, remove.\n\n## Acceptance Criteria\n- [ ] All F04 create tests pass\n- [ ] All F05 cleanup tests pass\n- [ ] list() returns all agent worktrees\n- [ ] getInfo() returns complete info\n- [ ] removeAll() cleans up everything\n- [ ] 4 additional tests (14 total)\n\n## Files\n- src/services/WorktreeService.ts (finalize)\n- tests/services/WorktreeService.test.ts (complete)\n\n## Plan\nSee: thoughts/shared/plans/features/F06-worktree-service.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:24:27.012325+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m1-infrastructure"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-jez","title":"F05: Worktree Cleanup - git worktree remove after merge","description":"## What\nRemove git worktrees after merge.\n\n## Acceptance Criteria\n- [ ] Removes worktree directory\n- [ ] Deletes branch if merged to main\n- [ ] Keeps branch if not merged (warning)\n- [ ] Force option for uncommitted changes\n- [ ] Throws if worktree doesn't exist\n- [ ] 5 tests pass\n\n## Files\n- src/services/WorktreeService.ts (extend)\n- tests/services/WorktreeService.test.ts (extend)\n\n## Plan\nSee: thoughts/shared/plans/features/F05-worktree-cleanup.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:24:18.998566+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m1-infrastructure"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-mdv","title":"F04: Worktree Create - git worktree add for agent isolation","description":"## What\nCreate git worktrees for agent isolation.\n\n## Acceptance Criteria\n- [ ] Creates worktree at .worktrees/{agent}-{task}\n- [ ] Creates branch agent/{agent}/{task} from main\n- [ ] Creates .worktrees/ directory if needed\n- [ ] Throws if worktree already exists\n- [ ] Returns correct WorktreeInfo\n- [ ] 5 tests pass\n\n## Files\n- src/services/WorktreeService.ts (NEW - partial)\n- tests/services/WorktreeService.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F04-worktree-create.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:24:04.989699+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m1-infrastructure"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-uvl","title":"F05: Worktree Remove - Cleanup after merge","description":"## What\nRemove git worktrees after task completion.\n\n## Acceptance Criteria\n- [ ] remove() runs: git worktree remove {path}\n- [ ] Deletes branch if merged to main\n- [ ] Keeps branch if not merged (logs warning)\n- [ ] force option for uncommitted changes\n- [ ] 5 tests pass\n\n## Files\n- src/services/WorktreeService.ts (extend)\n- tests/services/WorktreeService.test.ts (extend)\n\n## Test Cases\n1. remove() deletes worktree dir\n2. remove() deletes merged branch\n3. remove() keeps unmerged branch\n4. remove() with force works\n5. remove() throws if not exists","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:31:03.293979+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:31:30.582217+03:00","labels":["critical-path","feature","m1-infrastructure"],"deleted_at":"2026-01-10T01:31:30.582217+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"ch-001","title":"Write hello to test.txt","description":"Create test.txt and write 'Hello from Chorus!'","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:23:14.777764+03:00","updated_at":"2026-01-10T01:47:09.417655+03:00","deleted_at":"2026-01-10T01:47:09.417655+03:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"ch-002","title":"Count to 10","description":"Print numbers 1 to 10","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-10T01:23:14.777764+03:00","updated_at":"2026-01-10T01:47:09.485954+03:00","deleted_at":"2026-01-10T01:47:09.485954+03:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"ch-003","title":"Show current date","status":"tombstone","priority":3,"issue_type":"task","assignee":"agent-1","created_at":"2026-01-10T01:23:14.777764+03:00","updated_at":"2026-01-10T01:47:09.553706+03:00","deleted_at":"2026-01-10T01:47:09.553706+03:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"ch-02h","title":"F63e: Manual Done (d) - Mark selected task as done","description":"## What\nKeyboard handler for 'd' key to manually mark the selected task as done.\n\n## Shortcut\n- **d** - Mark selected task as done (manual completion)\n\n## API\n```typescript\n// Update src/hooks/useKeyboard.ts\n\ninterface UseKeyboardOptions {\n  // ... existing options\n  onMarkDone?: () =\u003e void;\n}\n```\n\n## Behavior\n- Pressing 'd' marks currently selected task as done\n- Shows confirmation if task has running agent\n- Closes task via TaskCloser (bd close)\n- Updates task status in TaskPanel\n- Releases slot if agent was running\n\n## Files\n- src/hooks/useKeyboard.ts (UPDATE)\n- src/hooks/useKeyboard.test.ts (UPDATE)\n\n## Acceptance Criteria\n- [ ] 'd' key triggers mark done callback\n- [ ] Only works when task is selected\n- [ ] Shows confirmation if agent running\n- [ ] Closes task via bd close\n- [ ] Task status updates to closed\n- [ ] Agent stopped and slot released if running\n- [ ] 6 tests pass\n\n## Tests\n1. 'd' key calls onMarkDone\n2. Requires task selection\n3. Shows confirmation for running tasks\n4. Closes task via TaskCloser\n5. Updates task status display\n6. Releases slot on completion","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T21:53:51.670465+03:00","created_by":"deligoez","updated_at":"2026-01-10T21:53:51.670465+03:00","labels":["m3-task-mgmt"],"dependencies":[{"issue_id":"ch-02h","depends_on_id":"ch-dzz","type":"blocks","created_at":"2026-01-10T21:53:57.175208+03:00","created_by":"deligoez"}]}
{"id":"ch-0e7","title":"F15: Orchestrator Core - Central coordinator for task assignment","description":"## What\nCentral coordinator: task selection → worktree creation → prompt building → agent spawning → tracking → timeout handling.\n\n**IMPORTANT:** All Beads access MUST go through BeadsCLI (F12). No direct `bd` CLI calls.\n\n## Acceptance Criteria\n\n### Types (src/types/orchestration.ts)\n- [ ] AssignmentResult: success, agentId, taskId, worktree, error?\n- [ ] OrchestratorConfig: projectDir, config, agentManager, beadsCLI\n- [ ] TaskAssignment: taskId, agentType, modelOverride?\n\n### Constructor\n- [ ] Receives BeadsCLI instance via dependency injection\n- [ ] Stores beadsCLI as private field\n\n### assignTask()\n- [ ] Creates worktree for task\n- [ ] Claims task via `beadsCLI.claimTask()`\n- [ ] Builds prompt with task context\n- [ ] Spawns agent in worktree directory\n- [ ] Returns AssignmentResult on success\n- [ ] Emits \"assigned\" event\n- [ ] Returns error if task not found\n- [ ] Returns error if task already assigned\n- [ ] Returns error if dependencies not met\n\n### canAssign()\n- [ ] Returns `{ can: true }` for ready open task\n- [ ] Returns `{ can: false }` for in_progress task\n- [ ] Returns `{ can: false }` for closed task\n- [ ] Returns `{ can: false }` if max agents reached\n- [ ] Checks dependencies are closed\n\n### Timeout Handling (from master plan)\n- [ ] Sets timeout timer when agent spawns (config.completion.taskTimeout, default 30min)\n- [ ] Kills agent process on timeout\n- [ ] Returns task to pending status on timeout via `beadsCLI.releaseTask()`\n- [ ] Emits \"timeout\" event with agentId, taskId\n- [ ] Clears timeout timer when agent exits normally\n\n### getAgentType()\n- [ ] Uses task custom.agent if specified\n- [ ] Falls back to config default\n\n### Helper Methods\n- [ ] `getTask(id)` delegates to `beadsCLI.getTask()`\n- [ ] `getReadyTasks()` delegates to `beadsCLI.getReadyTasks({ excludeLabels: ['deferred'] })`\n- [ ] `getAgentConfig(type)` returns config for agent type\n- [ ] Passes CHORUS_TASK_ID, CHORUS_BRANCH env vars\n- [ ] Applies model override if allowed\n\n### Summary\n- [ ] 23 tests pass\n\n## Files\n- src/services/Orchestrator.ts (NEW)\n- src/types/orchestration.ts (NEW)\n- src/services/Orchestrator.test.ts (NEW)\n\n## Notes\n- Core service - everything flows through here\n- Extends EventEmitter for 'assigned', 'timeout', 'error' events\n- Agent spawn in worktree cwd\n- Completion handling is F16 (not here)\n- Timeout: Prevents runaway agents, returns task for retry\n- **All Beads access via BeadsCLI - never direct bd calls**\n- **getReadyTasks excludes deferred tasks by default**","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:47:53.010882+03:00","created_by":"deligoez","updated_at":"2026-01-10T22:36:19.82933+03:00","labels":["m4-orchestration"],"dependencies":[{"issue_id":"ch-0e7","depends_on_id":"ch-iel","type":"blocks","created_at":"2026-01-10T01:47:53.01358+03:00","created_by":"deligoez"},{"issue_id":"ch-0e7","depends_on_id":"ch-wk8","type":"blocks","created_at":"2026-01-10T01:47:53.015317+03:00","created_by":"deligoez"},{"issue_id":"ch-0e7","depends_on_id":"ch-3y0","type":"blocks","created_at":"2026-01-10T01:47:53.016714+03:00","created_by":"deligoez"},{"issue_id":"ch-0e7","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-10T01:47:53.01801+03:00","created_by":"deligoez"}]}
{"id":"ch-0ok","title":"F61b: ShortcutCategory Component - Grouped keyboard shortcuts","description":"## What\nComponent to display a category of keyboard shortcuts with title and key-description pairs.\n\n## Context from Master Plan\n```\n│  NAVIGATION                     │\n│  j/↓  Move down                 │\n│  k/↑  Move up                   │\n│  Tab  Switch panels             │\n│  1-9  Quick select              │\n```\n\n## API\n```typescript\n// src/components/ShortcutCategory.tsx\n\ninterface Shortcut {\n  key: string;           // e.g., \"j/↓\"\n  description: string;   // e.g., \"Move down\"\n}\n\ninterface ShortcutCategoryProps {\n  title: string;\n  shortcuts: Shortcut[];\n}\n\nfunction ShortcutCategory({ title, shortcuts }: ShortcutCategoryProps): JSX.Element\n```\n\n## Files\n- src/components/ShortcutCategory.tsx\n- src/components/ShortcutCategory.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows category title in bold\n- [ ] Lists all shortcuts with key and description\n- [ ] Key is left-aligned, fixed width\n- [ ] Description uses dim styling (Ink: dimColor prop on Text)\n- [ ] Handles empty shortcuts array\n- [ ] 5 tests pass\n\n## Tests\n1. Shows category title in bold\n2. Lists all shortcuts with key and description\n3. Key has fixed width alignment\n4. Description uses dim styling\n5. Handles empty shortcuts array","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T12:51:16.471906+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:29:44.039874+03:00","labels":["m12-tui"]}
{"id":"ch-0vb","title":"F63f: Fullscreen Agent (f) - Expand agent tile to fullscreen","description":"## What\nKeyboard handler for 'f' key to expand the selected agent tile to fullscreen view.\n\n## Shortcut\n- **f** - Toggle fullscreen for selected agent\n\n## Implementation\n```typescript\n// src/hooks/useKeyboard.ts\nimport { useInput } from 'ink';\n\nexport function useKeyboard(options: UseKeyboardOptions) {\n  useInput((input, key) =\u003e {\n    if (input === 'f') {\n      options.onToggleFullscreen?.();\n    }\n    if (key.escape \u0026\u0026 options.isFullscreen) {\n      options.onToggleFullscreen?.();  // Exit fullscreen\n    }\n  });\n}\n\ninterface UseKeyboardOptions {\n  onToggleFullscreen?: () =\u003e void;\n  isFullscreen?: boolean;\n}\n```\n\n```typescript\n// AgentFullscreen.tsx\ninterface AgentFullscreenProps {\n  agent: AgentState;\n  onExit: () =\u003e void;\n}\n\nexport function AgentFullscreen({ agent, onExit }: AgentFullscreenProps) {\n  useInput((input, key) =\u003e {\n    if (key.escape || input === 'f') onExit();\n  });\n  // Render full output with ScrollArea\n}\n```\n\n## Behavior\n- Pressing 'f' expands selected agent to fullscreen\n- Pressing 'f' again or Escape exits fullscreen\n- Fullscreen shows full agent output with scroll\n- Other agents hidden in fullscreen mode\n\n## Files\n- src/hooks/useKeyboard.ts (UPDATE)\n- src/hooks/useKeyboard.test.ts (UPDATE)\n- src/components/AgentFullscreen.tsx (NEW)\n- src/components/AgentFullscreen.test.tsx (NEW)\n\n## Acceptance Criteria\n- [ ] `useInput` detects 'f' and calls `onToggleFullscreen()`\n- [ ] AgentFullscreen renders agent output at full terminal size\n- [ ] 'f' key in fullscreen calls `onExit()`\n- [ ] Escape key in fullscreen calls `onExit()`\n- [ ] Output is scrollable (up/down or j/k)\n- [ ] 5 tests pass\n\n## Tests\n1. 'f' key calls onToggleFullscreen callback\n2. AgentFullscreen renders with full agent output\n3. 'f' key in fullscreen calls onExit\n4. Escape in fullscreen calls onExit\n5. j/k scrolls output in fullscreen","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T21:54:06.420171+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:30:09.516482+03:00","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-0vb","depends_on_id":"ch-c2p","type":"blocks","created_at":"2026-01-10T21:54:11.46721+03:00","created_by":"deligoez"}]}
{"id":"ch-0z7","title":"F03a: Init Prerequisites - Check system requirements","description":"## What\nCheck system prerequisites before initialization: git repo, Node.js version, Beads CLI, and Claude agent CLI.\n\n**Note:** This task covers Claude agent only. Non-Claude CLI detection is in F03c (deferred).\n\n## Acceptance Criteria\n\n### checkGitRepo() - 2 tests\n- [ ] Returns true if current directory is a git repository (`.git/` exists)\n- [ ] Returns false if `.git/` directory does not exist\n\n### checkNodeVersion() - 3 tests\n- [ ] Returns `{valid: true, version: \"22.1.0\"}` when Node.js \u003e= 20\n- [ ] Returns `{valid: false, version: \"18.0.0\"}` when Node.js \u003c 20\n- [ ] Returns `{valid: false, version: null}` when Node.js not installed (command fails)\n\n### checkBeadsCLI() - 2 tests\n- [ ] Returns true if `bd --version` exits with code 0\n- [ ] Returns false if `bd` command not found (exits non-zero)\n\n### checkClaudeCLI() - 2 tests\n- [ ] Returns true if `claude --version` exits with code 0\n- [ ] Returns false if `claude` command not found (exits non-zero)\n\n### checkAll() - 2 tests\n- [ ] Returns PrerequisiteResult with all check results populated\n- [ ] Returns `missing` array with install instructions for each failed check\n\n### Summary\n- [ ] 11 tests pass\n\n## Types\n```typescript\ninterface NodeVersionResult {\n  valid: boolean;\n  version: string | null;\n}\n\ninterface PrerequisiteResult {\n  gitRepo: boolean;\n  nodeVersion: boolean;\n  nodeVersionFound: string | null;  // e.g., \"22.1.0\" or null if not installed\n  beadsCLI: boolean;\n  claudeCLI: boolean;\n  missing: MissingPrerequisite[];\n  allPassed: boolean;\n}\n\ninterface MissingPrerequisite {\n  name: string;\n  instruction: string;\n}\n```\n\n## Install Instructions (for missing array)\n| Check | Instruction |\n|-------|-------------|\n| gitRepo | \"Run `git init` to initialize a git repository\" |\n| nodeVersion | \"Install Node.js 20+ from https://nodejs.org\" |\n| beadsCLI | \"Install Beads: `brew install beads-ai/tap/beads`\" |\n| claudeCLI | \"Install Claude Code: `npm install -g @anthropic-ai/claude-code`\" |\n\n## Files\n- src/services/InitPrerequisites.ts (NEW)\n- tests/services/InitPrerequisites.test.ts (NEW)\n\n## Notes\n- Non-Claude agent CLI detection (codex, opencode) → F03c (deferred)\n- Version parsing: extract from `node --version` output (e.g., \"v22.1.0\" → \"22.1.0\")","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T11:20:00.706785+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:22:55.896057+03:00","labels":["m1-infrastructure"]}
{"id":"ch-105","title":"F58b: MergeQueueIndicator Component - Show merge queue status","description":"## What\nDisplay merge queue status showing items pending merge.\n\n## Context from Master Plan\n```\n│ Tasks: 1 done, 3 running, 1 pending, 1 blocked | Merge: 1 queued | ? help   │\n```\n\n## API\n```typescript\n// src/components/MergeQueueIndicator.tsx\n\ninterface MergeQueueIndicatorProps {\n  queued: number;\n  merging?: boolean;     // Currently merging\n  conflict?: boolean;    // Has conflict\n}\n\nfunction MergeQueueIndicator({ queued, merging, conflict }: MergeQueueIndicatorProps): JSX.Element\n```\n\n## Visual Output\n- Empty queue: `Merge: 0 queued`\n- Items queued: `Merge: 3 queued`\n- Merging: `Merge: ● merging...`\n- Conflict: `Merge: ⚠ conflict`\n\n## Files\n- src/components/MergeQueueIndicator.tsx\n- src/components/MergeQueueIndicator.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows \"Merge:\" prefix\n- [ ] Shows queued count when no activity\n- [ ] Shows \"merging...\" with spinner (●) when merging=true\n- [ ] Shows \"conflict\" with warning icon (⚠) when conflict=true\n- [ ] Uses Ink `\u003cText color=\"yellow\"\u003e` for merging state\n- [ ] Uses Ink `\u003cText color=\"red\"\u003e` for conflict state\n- [ ] Conflict takes priority over merging (if both true, show conflict)\n- [ ] 7 tests pass\n\n## Tests\n1. Shows \"Merge: 0 queued\" for empty queue\n2. Shows \"Merge: 3 queued\" for items in queue\n3. Shows merging state with ● indicator\n4. Shows conflict state with ⚠ warning\n5. Uses `\u003cText color=\"yellow\"\u003e` for merging\n6. Uses `\u003cText color=\"red\"\u003e` for conflict\n7. Conflict state takes priority over merging state","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T12:49:02.012057+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:30:08.558501+03:00","labels":["m12-tui"]}
{"id":"ch-112","title":"F05: Worktree Remove - Cleanup after merge","description":"## What\nRemove git worktrees after task completion.\n\n## Acceptance Criteria\n\n### remove() - 5 tests\n- [ ] Runs: `git worktree remove {path}` for the specified agent+task\n- [ ] Throws `WorktreeNotFoundError` if worktree doesn't exist\n- [ ] Deletes branch after worktree removal if `deleteBranch: true` and branch is merged\n- [ ] Keeps branch if not merged (does NOT throw, just skips branch deletion)\n- [ ] With `force: true`, runs `git worktree remove --force` (handles uncommitted changes)\n\n### isBranchMerged() - 2 tests\n- [ ] Returns `true` if branch is merged into main (via `git branch --merged main`)\n- [ ] Returns `false` if branch is NOT merged into main\n\n### prune() - 1 test\n- [ ] Runs: `git worktree prune` to clean stale entries\n\n### Edge Cases - 1 test\n- [ ] remove() throws `BranchNotFoundError` if branch doesn't exist (already deleted)\n\n### Summary\n- [ ] 9 tests pass\n\n## Files\n- src/services/WorktreeService.ts (extend)\n- tests/services/WorktreeService.test.ts (extend)\n\n## Interface\n```typescript\nclass WorktreeNotFoundError extends Error {}\nclass BranchNotFoundError extends Error {}\n\n// Add to WorktreeService class:\n\nasync remove(agentType: string, taskId: string, options?: {\n  deleteBranch?: boolean;  // default: true\n  force?: boolean;         // default: false\n}): Promise\u003cvoid\u003e;\n\nasync isBranchMerged(branch: string): Promise\u003cboolean\u003e;\n\nasync prune(): Promise\u003cvoid\u003e;\n```\n\n## Removal Flow\n1. Check worktree exists (throw WorktreeNotFoundError if not)\n2. Run `git worktree remove {path}` (or with --force)\n3. If deleteBranch option (default true):\n   - Check if branch exists (throw BranchNotFoundError if not)\n   - Check if branch merged via isBranchMerged()\n   - If merged: `git branch -d {branch}`\n   - If not merged: skip (do nothing, branch preserved)\n\n## Test Cases (9 total)\n1. remove() runs git worktree remove command\n2. remove() throws WorktreeNotFoundError if worktree doesn't exist\n3. remove() deletes branch when merged and deleteBranch: true\n4. remove() keeps branch when not merged (no error)\n5. remove() with force: true uses --force flag\n6. isBranchMerged() returns true for merged branch\n7. isBranchMerged() returns false for unmerged branch\n8. prune() runs git worktree prune\n9. remove() throws BranchNotFoundError if branch already deleted","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:31:10.574386+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:23:09.51174+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-112","depends_on_id":"ch-glq","type":"blocks","created_at":"2026-01-10T01:31:10.576808+03:00","created_by":"deligoez"}]}
{"id":"ch-1gi","title":"F39b: Scratchpad Manager - Read and clear agent scratchpad","description":"## What\nManage agent scratchpads - read content and clear after extraction.\n\n## Scratchpad Path Format\nThe scratchpad file is located at a fixed path within each agent's worktree:\n```\n{worktreePath}/.chorus/scratchpad.md\n```\n\nExample: `/Users/dev/project/.chorus/worktrees/task-ch-abc/.chorus/scratchpad.md`\n\n## API\n```typescript\n// src/services/ScratchpadManager.ts\n\ninterface Scratchpad {\n  content: string;       // Full file content\n  path: string;          // Absolute path to scratchpad file\n  modifiedAt: Date;      // File modification time\n}\n\nclass ScratchpadManager {\n  constructor(private worktreePath: string) {}\n\n  // Computed property\n  get scratchpadPath(): string {\n    return path.join(this.worktreePath, '.chorus', 'scratchpad.md');\n  }\n\n  /**\n   * Read scratchpad content from agent's worktree\n   * @returns Scratchpad object or null if file doesn't exist\n   */\n  async read(): Promise\u003cScratchpad | null\u003e\n\n  /**\n   * Extract learnings section from scratchpad content\n   * Looks for \"## Learnings\" heading, extracts until next ## heading or EOF\n   * @returns Raw markdown of learnings section (without the heading) or null\n   */\n  extractLearningsSection(content: string): string | null\n\n  /**\n   * Clear scratchpad by deleting the file\n   */\n  async clear(): Promise\u003cvoid\u003e\n\n  /**\n   * Check if scratchpad file exists\n   */\n  async exists(): Promise\u003cboolean\u003e\n}\n```\n\n## Files\n- src/services/ScratchpadManager.ts\n- tests/services/ScratchpadManager.test.ts\n\n## Acceptance Criteria\n- [ ] `scratchpadPath` returns `{worktreePath}/.chorus/scratchpad.md`\n- [ ] `read()` returns Scratchpad with content, path, and modifiedAt when file exists\n- [ ] `read()` returns null when file doesn't exist (not throws)\n- [ ] `extractLearningsSection()` returns content after \"## Learnings\" until next \"##\" heading\n- [ ] `extractLearningsSection()` returns content after \"## Learnings\" until EOF if no next heading\n- [ ] `extractLearningsSection()` returns null if no \"## Learnings\" heading found\n- [ ] `extractLearningsSection()` is case-insensitive for heading match\n- [ ] `clear()` deletes the scratchpad file\n- [ ] `clear()` succeeds silently if file doesn't exist (idempotent)\n- [ ] `exists()` returns true when file exists\n- [ ] `exists()` returns false when file missing\n- [ ] 11 tests pass\n\n## Tests\n1. scratchpadPath returns correct path\n2. read() returns Scratchpad when file exists\n3. read() includes modifiedAt from file stats\n4. read() returns null when file missing\n5. extractLearningsSection() extracts until next heading\n6. extractLearningsSection() extracts until EOF\n7. extractLearningsSection() returns null without heading\n8. extractLearningsSection() is case-insensitive\n9. clear() removes scratchpad file\n10. clear() succeeds when file missing\n11. exists() returns correct boolean\n\n## Scratchpad Format Example\n```markdown\n# Task ch-abc Scratchpad\n\n## Notes\nSome random notes here\n\n## Learnings\n\n### Performance\n- mb_str_split() \u003e preg_split() for Unicode\n\n### Testing  \n- Use Pest's dataset() for parameterized tests\n\n## Open Questions\n- Should we cache results?\n```\n\nFor above, `extractLearningsSection()` returns:\n```markdown\n\n### Performance\n- mb_str_split() \u003e preg_split() for Unicode\n\n### Testing  \n- Use Pest's dataset() for parameterized tests\n```","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T10:42:31.99359+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:27:55.299467+03:00","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-1gi","depends_on_id":"ch-uxk","type":"blocks","created_at":"2026-01-10T10:42:31.99564+03:00","created_by":"deligoez"}]}
{"id":"ch-26c","title":"F30: Human Escalation","description":"## What\nFinal fallback when all automated resolution fails. Pauses autopilot for human intervention.\n\n## Acceptance Criteria\n\n### escalate() - 3 tests\n- [ ] Emits 'escalated' event with request details\n- [ ] Returns Promise that waits for human action\n- [ ] Sets `pending` state with request\n\n### markResolved() - 1 test\n- [ ] Clears pending, emits 'resolved', resolves with `action: 'merged'`\n\n### markSkipped() - 1 test\n- [ ] Clears pending, emits 'skipped', resolves with `action: 'skipped'` (autopilot continues)\n\n### markCancelled() - 1 test\n- [ ] Clears pending, emits 'cancelled', resolves with `action: 'cancelled'` (autopilot stops)\n\n### hasPending() / getPending() - 1 test\n- [ ] `hasPending()` returns true when pending\n- [ ] `getPending()` returns request or null\n\n## Files\n- src/services/HumanEscalation.ts\n- tests/services/HumanEscalation.test.ts\n\n## Plan\nSee: thoughts/shared/plans/features/F30-human-escalation.md\n\n**Total: 7 tests**","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T03:17:01.402172+03:00","created_by":"deligoez","updated_at":"2026-01-10T08:27:34.282514+03:00","labels":["m5-merge"],"dependencies":[{"issue_id":"ch-26c","depends_on_id":"ch-9sj","type":"blocks","created_at":"2026-01-10T03:17:10.806465+03:00","created_by":"deligoez"}]}
{"id":"ch-2n6","title":"F01a: Config Types - ChorusConfig interface and defaults","description":"## What\nDefine TypeScript types for Chorus configuration.\n\n**MVP Note:** While AgentType includes 'codex' | 'opencode' for future expansion,\nMVP implementation only supports 'claude'. Default config uses Claude only.\n\n## Acceptance Criteria\n- [ ] AgentType is union: 'claude' | 'codex' | 'opencode'\n- [ ] AgentConfig.command is required string\n- [ ] AgentConfig.args is required string[]\n- [ ] AgentConfig.model is optional string\n- [ ] AgentConfig.allowModelOverride is optional boolean\n- [ ] ChorusConfig.version is required string\n- [ ] ChorusConfig.mode is 'semi-auto' | 'autopilot'\n- [ ] ChorusConfig.agents.default is AgentType\n- [ ] ChorusConfig.agents.maxParallel is number\n- [ ] ChorusConfig.agents.available is Partial\u003cRecord\u003cAgentType, AgentConfig\u003e\u003e\n- [ ] ChorusConfig.project.testCommand is required string\n- [ ] ChorusConfig.completion has signal, requireTests, maxIterations, taskTimeout\n- [ ] ChorusConfig.merge has autoResolve, agentResolve, requireApproval\n- [ ] ChorusConfig.tui.agentGrid is 'auto' | string\n- [ ] getDefaultConfig() returns ChorusConfig with mode='semi-auto'\n- [ ] getDefaultConfig() returns agents.default='claude'\n- [ ] getDefaultConfig() returns agents.maxParallel=2\n- [ ] getDefaultConfig() returns completion.maxIterations=3\n- [ ] 5 tests pass\n\n## Files\n- src/types/config.ts (NEW)\n\n## Implementation\n```typescript\nexport type AgentType = 'claude' | 'codex' | 'opencode';\n\nexport interface AgentConfig {\n  command: string;\n  args: string[];\n  model?: string;\n  allowModelOverride?: boolean;\n}\n\nexport interface ChorusConfig {\n  version: string;\n  mode: 'semi-auto' | 'autopilot';\n  agents: {\n    default: AgentType;\n    maxParallel: number;\n    available: Partial\u003cRecord\u003cAgentType, AgentConfig\u003e\u003e;\n  };\n  project: { testCommand: string; buildCommand?: string };\n  completion: { signal: string; requireTests: boolean; maxIterations: number; taskTimeout: number };\n  merge: { autoResolve: boolean; agentResolve: boolean; requireApproval: boolean };\n  tui: { agentGrid: 'auto' | string };\n}\n\nexport function getDefaultConfig(): ChorusConfig { /* ... */ }\n```\n\n## Test Cases\n1. AgentConfig accepts object with command and args only (optional fields omitted)\n2. AgentConfig accepts object with all fields including model and allowModelOverride\n3. ChorusConfig requires all top-level sections (version, mode, agents, project, completion, merge, tui)\n4. getDefaultConfig() returns valid ChorusConfig with expected defaults\n5. getDefaultConfig() returns Claude-only agent configuration\n\n## Notes\n- MVP supports Claude only\n- AgentType union kept for type compatibility\n- Non-Claude configs added via deferred tasks (F07b, F03c)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:30:10.093924+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:23:15.261509+03:00","labels":["m1-infrastructure"]}
{"id":"ch-2po","title":"F61c: HelpPanel Enhanced - All shortcuts grouped by category","description":"## What\nEnhanced HelpPanel showing all keyboard shortcuts from Section 14, grouped by category.\n\n## Context from Master Plan\n```\n┌─────────────────────────────────────────────────────────────────┐\n│                        KEYBOARD SHORTCUTS                        │\n├─────────────────────────────────────────────────────────────────┤\n│                                                                  │\n│  NAVIGATION                     AGENT CONTROL                    │\n│  j/↓  Move down                 s      Spawn agent for task      │\n│  k/↑  Move up                   x      Stop selected agent       │\n│  Tab  Switch panels             r      Redirect agent            │\n│  1-9  Quick select              Enter  Assign task to agent      │\n│                                                                  │\n│  MODE CONTROL                   TASK MANAGEMENT                  │\n│  m    Toggle mode               n      New task                  │\n│  Space Pause/resume             e      Edit task                 │\n│  a    Start autopilot           b      Block task                │\n│                                 d      Mark done (manual)        │\n│                                                                  │\n│  VIEW                           RECOVERY                         │\n│  f    Fullscreen agent          R      Rollback menu             │\n│  g    Grid settings             c      Create checkpoint         │\n│  l    View logs                 u      Undo last action          │\n│  L    View learnings                                             │\n│                                                                  │\n│  GENERAL                                                         │\n│  ?    Toggle help               i      Intervention menu         │\n│  q    Quit (confirm if agents)  M      Merge queue view          │\n│                                                                  │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n## API\n```typescript\n// src/components/HelpPanel.tsx (UPDATE)\n\ninterface HelpPanelProps {\n  visible: boolean;\n}\n\n// Categories:\n// NAVIGATION: j/↓, k/↑, Tab, 1-9\n// AGENT CONTROL: s, x, r, Enter\n// MODE CONTROL: m, Space, a\n// TASK MANAGEMENT: n, e, b, d\n// VIEW: f, g, l, L\n// RECOVERY: R, c, u\n// GENERAL: ?, q, i, M\n```\n\n## Files\n- src/components/HelpPanel.tsx (UPDATE existing)\n- src/components/HelpPanel.test.tsx (UPDATE existing)\n\n## Acceptance Criteria\n- [ ] Shows all 7 categories\n- [ ] Navigation: j/↓, k/↑, Tab, 1-9\n- [ ] Agent Control: s, x, r, Enter\n- [ ] Mode Control: m, Space, a\n- [ ] Task Management: n, e, b, d\n- [ ] View: f, g, l, L\n- [ ] Recovery: R, c, u\n- [ ] General: ?, q, i, M\n- [ ] Categories arranged in two columns\n- [ ] Returns null when visible=false\n- [ ] 10 tests pass\n\n## Tests\n1. Returns null when visible=false\n2. Shows NAVIGATION category shortcuts\n3. Shows AGENT CONTROL category shortcuts\n4. Shows MODE CONTROL category shortcuts\n5. Shows TASK MANAGEMENT category shortcuts\n6. Shows VIEW category shortcuts\n7. Shows RECOVERY category shortcuts\n8. Shows GENERAL category shortcuts\n9. Categories in two-column layout\n10. Shows close hint","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T12:51:17.970137+03:00","created_by":"deligoez","updated_at":"2026-01-10T13:03:30.122994+03:00","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-2po","depends_on_id":"ch-0ok","type":"blocks","created_at":"2026-01-10T12:51:30.181324+03:00","created_by":"deligoez"}]}
{"id":"ch-2r5","title":"F47: Rollback Types - Rollback and checkpoint interfaces","description":"## What\nDefine TypeScript interfaces for rollback and checkpoint system.\n\n## API\n```typescript\n// src/types/rollback.ts\n\ntype RollbackLevel = \n  | 'iteration'     // Level 1: Undo last N iterations\n  | 'task'          // Level 2: Undo all commits for task\n  | 'task_chain'    // Level 3: Task + dependents\n  | 'session';      // Level 4: Reset to checkpoint\n\ninterface Checkpoint {\n  id: string;\n  tag: string;        // git tag name\n  timestamp: Date;\n  type: 'autopilot_start' | 'pre_merge' | 'periodic';\n  taskId?: string;    // For pre_merge checkpoints\n}\n\ninterface CheckpointConfig {\n  enabled: boolean;\n  beforeAutopilot: boolean;\n  beforeMerge: boolean;\n  periodic: number;   // Every N completed tasks (0 = disabled)\n}\n\ninterface RollbackResult {\n  success: boolean;\n  level: RollbackLevel;\n  revertedCommits: string[];\n  affectedTasks: string[];\n  message: string;\n}\n```\n\n## Files\n- src/types/rollback.ts\n\n## Acceptance Criteria\n- [ ] `RollbackLevel` is union of 4 levels\n- [ ] `Checkpoint` has id, tag, timestamp, type fields\n- [ ] `CheckpointConfig` has enabled, beforeAutopilot, beforeMerge, periodic\n- [ ] `RollbackResult` has success, level, revertedCommits, affectedTasks\n- [ ] 5 tests pass\n\n## Tests\n1. RollbackLevel union includes all levels\n2. Checkpoint has required fields\n3. CheckpointConfig has required fields\n4. RollbackResult has required fields\n5. Types are exported correctly","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T10:44:16.592124+03:00","created_by":"deligoez","updated_at":"2026-01-10T10:44:16.592124+03:00","labels":["m10-rollback"]}
{"id":"ch-3ji","title":"F63c: Mode Toggle (m) - Toggle between semi-auto and autopilot","description":"## What\nKeyboard handler for 'm' key to toggle between semi-auto and autopilot modes.\n\n## Shortcut\n- **m** - Toggle operating mode\n\n## API\n```typescript\n// Update src/hooks/useKeyboard.ts\n\ninterface UseKeyboardOptions {\n  // ... existing options\n  onModeToggle?: () =\u003e void;\n}\n\n// Or in useOrchestration:\ninterface UseOrchestrationReturn {\n  // ... existing\n  toggleMode: () =\u003e void;\n  currentMode: 'semi-auto' | 'autopilot';\n}\n```\n\n## Behavior\n- Pressing 'm' toggles between semi-auto ↔ autopilot\n- Shows confirmation if agents are running\n- Updates ModeIndicator immediately\n- Autopilot starts RalphLoop, semi-auto pauses it\n\n## Files\n- src/hooks/useKeyboard.ts (UPDATE)\n- src/hooks/useKeyboard.test.ts (UPDATE)\n- src/hooks/useOrchestration.ts (UPDATE for toggleMode)\n\n## Acceptance Criteria\n- [ ] 'm' key triggers mode toggle callback\n- [ ] Toggle changes mode state\n- [ ] Shows confirmation dialog if agents running\n- [ ] ModeIndicator updates on toggle\n- [ ] Autopilot → RalphLoop starts\n- [ ] Semi-auto → RalphLoop pauses\n- [ ] 6 tests pass\n\n## Tests\n1. 'm' key calls onModeToggle\n2. Mode toggles from semi-auto to autopilot\n3. Mode toggles from autopilot to semi-auto\n4. Shows confirmation when agents running\n5. RalphLoop starts on autopilot\n6. RalphLoop pauses on semi-auto","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T21:53:13.192068+03:00","created_by":"deligoez","updated_at":"2026-01-10T21:53:13.192068+03:00","labels":["m4-orchestration"],"dependencies":[{"issue_id":"ch-3ji","depends_on_id":"ch-7gx","type":"blocks","created_at":"2026-01-10T21:53:18.928455+03:00","created_by":"deligoez"},{"issue_id":"ch-3ji","depends_on_id":"ch-5tj","type":"blocks","created_at":"2026-01-10T21:53:19.017709+03:00","created_by":"deligoez"}]}
{"id":"ch-3na","title":"F55b: AgentSlotsCounter Component - Display running/max agent slots","description":"## What\nDisplay agent slot usage as \"X/Y\" format with color coding based on utilization.\n\n## Context from Master Plan\n```\nCHORUS v2.0                      semi-auto ● 3/50              ? for help\n```\n\n## API\n```typescript\n// src/components/AgentSlotsCounter.tsx\n\ninterface AgentSlotsCounterProps {\n  running: number;\n  max: number;\n}\n\nfunction AgentSlotsCounter({ running, max }: AgentSlotsCounterProps): JSX.Element\n```\n\n## Visual Output\n- \"● 0/3\" - green dot via `\u003cText color=\"green\"\u003e`, no agents running\n- \"● 2/3\" - yellow dot via `\u003cText color=\"yellow\"\u003e`, some slots used\n- \"● 3/3\" - red dot via `\u003cText color=\"red\"\u003e`, all slots full\n\n## Files\n- src/components/AgentSlotsCounter.tsx\n- src/components/AgentSlotsCounter.test.tsx\n\n## Acceptance Criteria\n- [ ] Renders \"X/Y\" format correctly (e.g., \"2/3\")\n- [ ] Shows green dot via `\u003cText color=\"green\"\u003e` when running === 0\n- [ ] Shows yellow dot via `\u003cText color=\"yellow\"\u003e` when running \u003e 0 and running \u003c max\n- [ ] Shows red dot via `\u003cText color=\"red\"\u003e` when running === max (full)\n- [ ] Handles undefined running (defaults to 0)\n- [ ] Handles undefined max (defaults to 0)\n- [ ] Handles max=0 (shows \"0/0\" with gray dot via `\u003cText color=\"gray\"\u003e`)\n- [ ] Handles negative values (treats as 0)\n- [ ] 8 tests pass\n\n## Tests\n1. Renders \"0/3\" format correctly\n2. Renders \"3/3\" format correctly\n3. Shows green dot when no agents running\n4. Shows yellow dot when partially full\n5. Shows red dot when full\n6. Handles undefined running (defaults to 0)\n7. Handles undefined max (defaults to 0)\n8. Handles negative values (treats as 0)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T12:48:31.76657+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:30:28.734082+03:00","labels":["m12-tui"]}
{"id":"ch-3pa","title":"F32b: RalphLoop Processing","description":"## What\nRalphLoop task processing logic: assignment loop, completion handling, error handling, safeguards.\n\n**IMPORTANT:** All Beads access MUST go through BeadsCLI (via Orchestrator). No direct `bd` CLI calls.\n\n## Acceptance Criteria\n\n### Task Processing - 6 tests\n- [ ] `processLoop()` assigns tasks to available slots from SlotManager\n- [ ] `processLoop()` respects maxParallel limit (never exceeds configured value)\n- [ ] `processLoop()` picks tasks by priority order: P1 first, P2 second, P3 third, P4 last\n- [ ] `processLoop()` picks FIFO within same priority (oldest ready task first)\n- [ ] `processLoop()` handles \"taskCompleted\" event from Orchestrator\n- [ ] `processLoop()` closes task via Orchestrator → BeadsCLI on completion event\n\n### Merge Queueing - 1 test\n- [ ] `onTaskCompleted()` queues merge via MergeService with worktreePath and taskId\n\n### Dependency Chain - 2 tests\n- [ ] `processLoop()` only assigns tasks from Orchestrator.getReadyTasks() (blocked tasks never assigned)\n- [ ] `processLoop()` never assigns tasks with `deferred` label (filtered by BeadsCLI.readyTasks)\n\n### Loop Termination - 2 tests\n- [ ] `processLoop()` emits \"allDone\" event when readyTasks=0 AND activeSlots=0\n- [ ] `processLoop()` stops automatically after emitting \"allDone\" (sets isRunning=false)\n\n### Error Handling - 2 tests\n- [ ] `processLoop()` emits \"error\" event with Error object on assignment failure\n- [ ] `processLoop()` continues loop after error (catches, emits, continues)\n\n### Safeguards - 6 tests\n- [ ] `processLoop()` stops after maxTotalTasks processed (configurable, default 100)\n- [ ] `processLoop()` emits \"maxTasksReached\" event when limit hit\n- [ ] `processLoop()` stops if no progress for idleTimeout ms (default 60000, deadlock detection)\n- [ ] `processLoop()` emits \"stuckAgent\" event after 5 iterations with 0 git commits across all agents\n- [ ] `processLoop()` pauses and emits \"errorThreshold\" event after 3 consecutive errors\n- [ ] `processLoop()` waits for human review before continuing after \"errorThreshold\"\n\n### Summary\n- [ ] 19 tests pass\n\n## Event Specifications\n```typescript\ninterface RalphLoopEvents {\n  \"allDone\": () =\u003e void;\n  \"error\": (error: Error) =\u003e void;\n  \"maxTasksReached\": (count: number) =\u003e void;\n  \"stuckAgent\": (agentId: string, iterationsWithoutCommit: number) =\u003e void;\n  \"errorThreshold\": (consecutiveErrors: number, lastError: Error) =\u003e void;\n  \"taskCompleted\": (taskId: string, worktreePath: string) =\u003e void;\n}\n```\n\n## Safeguards (from plan)\n1. MAX ITERATIONS CAP: 50 iterations (per-task, in F16b)\n2. TIMEOUT PER TASK: 30 minutes (per-task, in F16b)\n3. MAX TOTAL TASKS: 100 tasks per session (here)\n4. PROGRESS DETECTION: 5 iterations no commits → alert\n5. ERROR THRESHOLD: 3 consecutive errors → pause\n\n## Dependencies\n- F32a RalphLoop Control (ch-5tj)\n\n## Files\n- src/services/RalphLoop.ts\n- src/services/RalphLoop.test.ts\n\n## Notes\n- **All task queries via Orchestrator.getReadyTasks() (never direct bd)**\n- **Deferred tasks automatically excluded by BeadsCLI**\n- **FIFO within priority ensures deterministic test behavior**","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T08:40:25.033038+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:27:54.994165+03:00","labels":["m7-autopilot"],"dependencies":[{"issue_id":"ch-3pa","depends_on_id":"ch-5tj","type":"blocks","created_at":"2026-01-10T08:40:25.03556+03:00","created_by":"deligoez"}]}
{"id":"ch-3y0","title":"F09: Agent-Task Linking - Track agent-task association","description":"## What\nAssociate spawned agents with task IDs and track in agentStore.\n\n## Acceptance Criteria\n\n### Agent Type (2 tests)\n- [ ] `Agent` interface has fields: `taskId: string`, `agentType: AgentType`, `worktree: string`, `branch: string`\n- [ ] `Agent` interface has fields: `iteration: number`, `startedAt: Date`\n\n### getAgentByTaskId() - 2 tests\n- [ ] `getAgentByTaskId(\"ch-abc\")` returns `Agent` object when agent with taskId \"ch-abc\" exists\n- [ ] `getAgentByTaskId(\"ch-xyz\")` returns `null` when no agent has that taskId\n\n### getAgentsByType() - 2 tests\n- [ ] `getAgentsByType(\"claude\")` returns array of agents where `agentType === \"claude\"`\n- [ ] `getAgentsByType(\"aider\")` returns empty array `[]` when no agents of that type exist\n\n### incrementIteration() - 1 test\n- [ ] `incrementIteration(\"ch-abc\")` increments `agent.iteration` from 1 to 2 for agent with taskId \"ch-abc\"\n\n### Summary\n- [ ] 7 tests pass\n\n## Files\n- src/types/agent.ts (UPDATE - add fields)\n- src/stores/agentStore.ts (UPDATE - add actions)\n- tests/stores/agentStore.test.ts (UPDATE - add tests)\n\n## API\n```typescript\n// In src/types/agent.ts\ntype AgentType = 'claude' | 'aider' | 'codex';\n\ninterface Agent {\n  taskId: string;\n  agentType: AgentType;\n  worktree: string;\n  branch: string;\n  iteration: number;\n  startedAt: Date;\n}\n\n// In src/stores/agentStore.ts (actions)\ninterface AgentStoreActions {\n  getAgentByTaskId(taskId: string): Agent | null;\n  getAgentsByType(type: AgentType): Agent[];\n  incrementIteration(taskId: string): void;\n}\n```\n\n## Tests (7 total)\n1. Agent interface has taskId, agentType, worktree, branch fields\n2. Agent interface has iteration, startedAt fields\n3. getAgentByTaskId() returns Agent when exists\n4. getAgentByTaskId() returns null when not found\n5. getAgentsByType() returns matching agents\n6. getAgentsByType() returns empty array when none match\n7. incrementIteration() increments iteration count\n\n## Plan\nSee: thoughts/shared/plans/features/F09-agent-task-linking.md","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:38:24.319933+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:24:21.420507+03:00","labels":["m2-agent-prep"]}
{"id":"ch-49w","title":"F59d: AgentTileOutput - Status text and test results","description":"## What\nOutput section of AgentTile showing status text and test results.\n\n## Context from Master Plan\n```\n│ Reading auth...   │\n│ $ npm test        │\n│ ✓ 47 tests passed │\n```\n\n## API\n```typescript\n// src/components/AgentTileOutput.tsx\n\ninterface AgentTileOutputProps {\n  statusText?: string;      // e.g., \"Reading auth...\"\n  lastCommand?: string;     // e.g., \"npm test\"\n  testResult?: {\n    passed: number;\n    failed: number;\n  };\n}\n\nfunction AgentTileOutput({ statusText, lastCommand, testResult }: AgentTileOutputProps): JSX.Element\n```\n\n## Visual Output\n```\nReading auth...\n$ npm test\n✓ 47 tests passed\n```\n\n## Color Specs (Ink)\n- statusText: dimColor (uses Ink's dimColor prop)\n- command \"$\" prefix: color=\"gray\"\n- checkmark \"✓\": color=\"green\" (all tests pass)\n- X mark \"✗\": color=\"red\" (any test fails)\n- passed count: color=\"green\"\n- failed count: color=\"red\"\n\n## Files\n- src/components/AgentTileOutput.tsx\n- src/components/AgentTileOutput.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows status text with dimColor when provided\n- [ ] Shows last command with gray \"$\" prefix\n- [ ] Shows green \"✓\" checkmark when all tests pass (failed=0)\n- [ ] Shows red \"✗\" when any tests fail (failed\u003e0)\n- [ ] Shows \"X passed, Y failed\" format when failures exist\n- [ ] Shows \"X tests passed\" format when no failures\n- [ ] Handles missing optional props (renders nothing for missing)\n- [ ] 7 tests pass\n\n## Tests\n1. Shows status text with dimColor\n2. Shows command with gray $ prefix\n3. Shows green checkmark for all pass\n4. Shows red X for failures\n5. Shows \"X passed, Y failed\" format\n6. Shows \"X tests passed\" format\n7. Handles missing optional props","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T12:49:57.208382+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:30:22.102663+03:00","labels":["m12-tui"]}
{"id":"ch-4ow","title":"F63b: Quick Select (1-9) - Select task by number key","description":"## What\nKeyboard handler for number keys 1-9 to quickly select a task by its visible position.\n\n## Shortcut\n- **1-9** - Select task at position N in the visible list\n\n## Implementation\n```typescript\n// src/hooks/useKeyboard.ts\nimport { useInput } from 'ink';\n\nexport function useKeyboard(options: UseKeyboardOptions) {\n  useInput((input, key) =\u003e {\n    // input is the character pressed (e.g., '1', '2', etc.)\n    const num = parseInt(input, 10);\n    if (num \u003e= 1 \u0026\u0026 num \u003c= 9) {\n      options.onQuickSelect?.(num - 1);  // Convert to 0-indexed\n    }\n  });\n}\n\ninterface UseKeyboardOptions {\n  onQuickSelect?: (index: number) =\u003e void;\n  panelFocus?: 'left' | 'right';  // Only fires when 'left'\n}\n```\n\n## Behavior\n- Keys 1-9 select task at that position (1-indexed display, 0-indexed callback)\n- Only works when TaskPanel is focused (panelFocus === 'left')\n- Ignores if position \u003e visible task count (handled by consumer)\n\n## Files\n- src/hooks/useKeyboard.ts (UPDATE)\n- src/hooks/useKeyboard.test.ts (UPDATE)\n\n## Acceptance Criteria\n- [ ] `useInput` detects keys '1'-'9' and calls `onQuickSelect(index)`\n- [ ] Key '1' calls `onQuickSelect(0)`, key '9' calls `onQuickSelect(8)`\n- [ ] Key '0' does not trigger callback\n- [ ] Non-numeric keys do not trigger callback\n- [ ] 4 tests pass\n\n## Tests\n1. Key '1' calls onQuickSelect(0)\n2. Key '9' calls onQuickSelect(8)\n3. Key '0' is ignored (no callback)\n4. Letter key 'a' is ignored (no callback)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T21:52:56.472068+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:30:08.218403+03:00","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-4ow","depends_on_id":"ch-e7f","type":"blocks","created_at":"2026-01-10T21:52:56.660713+03:00","created_by":"deligoez"}]}
{"id":"ch-4oz","title":"F63i: Merge Queue View (M) - Show merge queue panel","description":"## What\nKeyboard handler for 'M' (shift+m) key to show merge queue status panel.\n\n## Shortcut\n- **M** (Shift+M) - Open merge queue panel\n\n## API\n```typescript\n// Update src/hooks/useKeyboard.ts\n\ninterface UseKeyboardOptions {\n  // ... existing options\n  onMergeQueue?: () =\u003e void;\n}\n```\n\n## Behavior\n- Pressing 'M' opens merge queue panel\n- Shows queued items with status\n- Shows current merge progress\n- Shows conflict status if any\n- Escape closes panel\n\n## Visual Layout\n```\n┌─────────────────────────────────────┐\n│         MERGE QUEUE (3)             │\n├─────────────────────────────────────┤\n│ ● ch-001 Merging... (50%)           │\n│ ○ ch-003 Queued (waiting)           │\n│ ○ ch-005 Queued (waiting)           │\n├─────────────────────────────────────┤\n│ Conflicts: 0 | Merged today: 5      │\n└─────────────────────────────────────┘\n```\n\n## Files\n- src/hooks/useKeyboard.ts (UPDATE)\n- src/hooks/useKeyboard.test.ts (UPDATE)\n- src/components/MergeQueuePanel.tsx (NEW)\n- src/components/MergeQueuePanel.test.tsx (NEW)\n\n## Acceptance Criteria\n- [ ] 'M' key triggers merge queue callback\n- [ ] Opens panel with queue items\n- [ ] Shows merge progress for active item\n- [ ] Shows waiting status for queued items\n- [ ] Shows conflict count\n- [ ] Escape closes panel\n- [ ] 6 tests pass\n\n## Tests\n1. 'M' key calls onMergeQueue\n2. Panel shows queued items\n3. Shows merge progress\n4. Shows waiting status\n5. Shows conflict count\n6. Escape closes panel","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T21:55:02.425593+03:00","created_by":"deligoez","updated_at":"2026-01-10T21:55:02.425593+03:00","labels":["m5-merge"],"dependencies":[{"issue_id":"ch-4oz","depends_on_id":"ch-glf","type":"blocks","created_at":"2026-01-10T21:55:07.323462+03:00","created_by":"deligoez"}]}
{"id":"ch-555","title":"F63h: View Logs (l) - Show agent logs panel","description":"## What\nKeyboard handler for 'l' key to show agent logs in a scrollable panel.\n\n## Shortcut\n- **l** - Open logs panel for selected agent\n\n## Implementation\n```typescript\n// src/hooks/useKeyboard.ts\nimport { useInput } from 'ink';\n\nexport function useKeyboard(options: UseKeyboardOptions) {\n  useInput((input, key) =\u003e {\n    if (input === 'l') {\n      options.onViewLogs?.();\n    }\n  });\n}\n\ninterface UseKeyboardOptions {\n  onViewLogs?: () =\u003e void;\n}\n```\n\n```typescript\n// LogsPanel.tsx\ninterface LogEntry {\n  timestamp: Date;\n  content: string;\n}\n\ninterface LogsPanelProps {\n  isOpen: boolean;\n  logs: LogEntry[];\n  onClose: () =\u003e void;\n}\n\nexport function LogsPanel({ isOpen, logs, onClose }: LogsPanelProps) {\n  const [scrollOffset, setScrollOffset] = useState(0);\n  \n  useInput((input, key) =\u003e {\n    if (key.escape) onClose();\n    if (input === 'j' || key.downArrow) setScrollOffset(o =\u003e o + 1);\n    if (input === 'k' || key.upArrow) setScrollOffset(o =\u003e Math.max(0, o - 1));\n  });\n  \n  if (!isOpen) return null;\n  // Render logs with timestamps\n}\n```\n\n## Behavior\n- Pressing 'l' opens logs panel for selected agent\n- Shows full command output history with timestamps\n- Scrollable with j/k or arrow keys\n- Escape closes panel\n\n## Files\n- src/hooks/useKeyboard.ts (UPDATE)\n- src/hooks/useKeyboard.test.ts (UPDATE)\n- src/components/LogsPanel.tsx (NEW)\n- src/components/LogsPanel.test.tsx (NEW)\n\n## Acceptance Criteria\n- [ ] `useInput` detects 'l' and calls `onViewLogs()`\n- [ ] LogsPanel renders when isOpen=true\n- [ ] Each log entry shows timestamp and content\n- [ ] j/downArrow increases scroll offset\n- [ ] k/upArrow decreases scroll offset (min 0)\n- [ ] Escape calls `onClose()`\n- [ ] 6 tests pass\n\n## Tests\n1. 'l' key calls onViewLogs callback\n2. LogsPanel renders logs when isOpen=true\n3. Each log entry displays timestamp\n4. j key scrolls down (increases offset)\n5. k key scrolls up (decreases offset, min 0)\n6. Escape calls onClose","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T21:54:41.165172+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:30:12.147907+03:00","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-555","depends_on_id":"ch-c2p","type":"blocks","created_at":"2026-01-10T21:54:46.072101+03:00","created_by":"deligoez"}]}
{"id":"ch-5tj","title":"F32a: RalphLoop Control","description":"## What\nRalphLoop types, constructor, and control methods (start/stop/pause/resume). Foundation for autopilot loop.\n\n## Acceptance Criteria\n\n### start() - 3 tests\n- [ ] `start()` emits \"started\" event\n- [ ] `start()` begins processing task queue (sets up loop)\n- [ ] `start()` is idempotent (calling twice doesn't restart)\n\n### stop() - 3 tests\n- [ ] `stop()` stops accepting new tasks\n- [ ] `stop()` waits for active agents to complete before returning\n- [ ] `stop()` emits \"stopped\" event\n\n### pause() / resume() - 2 tests\n- [ ] `pause()` stops new task assignment without killing agents\n- [ ] `resume()` continues task assignment\n\n### Status Methods (implicit - tested via control tests)\n- `getStatus()` returns LoopStatus object\n- `isRunning()` returns boolean\n- `isPaused()` returns boolean\n\n## Dependencies\n- F15 Orchestrator Core (ch-0e7) - for task assignment\n- F16b Completion Handler Retry (ch-lhm) - for completion detection\n- F22 Slot Manager (ch-i9i) - for slot availability\n- F31 Merge Service (ch-8ee) - for merge queueing\n\n## Files\n- src/services/RalphLoop.ts (types, constructor, control methods)\n- tests/services/RalphLoop.test.ts\n\n## Plan\nSee: thoughts/shared/plans/features/F32-ralph-loop.md (F32a section)\n\n**Total: 8 tests**","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T03:17:43.652411+03:00","created_by":"deligoez","updated_at":"2026-01-10T08:40:11.885317+03:00","labels":["m7-autopilot"],"dependencies":[{"issue_id":"ch-5tj","depends_on_id":"ch-lhm","type":"blocks","created_at":"2026-01-10T03:17:43.655134+03:00","created_by":"deligoez"},{"issue_id":"ch-5tj","depends_on_id":"ch-i9i","type":"blocks","created_at":"2026-01-10T03:17:43.656848+03:00","created_by":"deligoez"},{"issue_id":"ch-5tj","depends_on_id":"ch-8ee","type":"blocks","created_at":"2026-01-10T03:17:43.658246+03:00","created_by":"deligoez"},{"issue_id":"ch-5tj","depends_on_id":"ch-0e7","type":"blocks","created_at":"2026-01-10T08:30:36.673504+03:00","created_by":"deligoez"}]}
{"id":"ch-70p","title":"F60b: useAgentGrid Hook - Grid calculation logic","description":"## What\nReact hook that calculates grid configuration based on terminal width and settings.\n\n## Context from Master Plan\n```json\n{\n  \"tui\": {\n    \"agentGrid\": \"auto\"  // or \"2x2\", \"2x3\", \"1x4\", etc.\n  }\n}\n\n// Auto-fit logic:\n// terminalWidth \u003c 120: 1 column\n// terminalWidth \u003c 180: 2 columns\n// else: 3+ columns\n```\n\n## API\n```typescript\n// src/hooks/useAgentGrid.ts\n\ninterface GridConfig {\n  columns: number;\n  rows: number;\n  tileWidth: number;\n}\n\nfunction useAgentGrid(\n  terminalWidth: number,\n  agentCount: number,\n  maxAgents: number,\n  configOverride?: 'auto' | '1x1' | '2x2' | '2x3' | '1x4'\n): GridConfig\n```\n\n## Files\n- src/hooks/useAgentGrid.ts\n- src/hooks/useAgentGrid.test.ts\n\n## Acceptance Criteria\n- [ ] Returns 1 column for width \u003c 120\n- [ ] Returns 2 columns for width 120-179\n- [ ] Returns 3 columns for width \u003e= 180\n- [ ] Respects \"2x2\" override (2 cols, min 2 rows)\n- [ ] Respects \"1x4\" override (1 col, min 4 rows)\n- [ ] Calculates rows: Math.ceil(maxAgents / columns)\n- [ ] Calculates tileWidth based on terminal width and columns\n- [ ] Handles undefined terminalWidth (defaults to 1 column)\n- [ ] Returns stable reference with useMemo\n- [ ] Handles zero agentCount\n- [ ] 10 tests pass\n\n## Tests\n1. Returns 1 column for width \u003c 120\n2. Returns 2 columns for width 120-179\n3. Returns 3 columns for width \u003e= 180\n4. Respects \"2x2\" config override\n5. Respects \"1x4\" config override\n6. Calculates rows correctly\n7. Calculates tileWidth correctly\n8. Handles undefined terminalWidth\n9. Returns stable reference\n10. Handles zero agentCount","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T12:50:50.731402+03:00","created_by":"deligoez","updated_at":"2026-01-10T13:03:12.026876+03:00","labels":["m12-tui"]}
{"id":"ch-73t","title":"F61a: TwoColumnLayout Component - Split pane for Tasks/Agents","description":"## What\nSplit pane layout component with configurable left/right ratio for Tasks and Agents panels.\n\n## Architecture Note\n**TwoColumnLayout is used INSIDE Layout, not as a replacement**\n\nComponent hierarchy:\n```\nLayout (outer shell)\n├── HeaderBar (top)\n├── TwoColumnLayout (content area) ← THIS COMPONENT\n│   ├── TaskPanel (left 30%)\n│   └── AgentGrid (right 70%)\n└── FooterBar (bottom)\n```\n\n- Layout = app shell (border, header, footer, content area)\n- TwoColumnLayout = content area split (Tasks/Agents)\n- Update Layout.tsx to use TwoColumnLayout as its children wrapper\n\n## State Ownership\n**TwoColumnLayout is stateless** - it is a pure layout component.\n- Focus management: Owned by parent (App.tsx via useInput)\n- Panel selection: Owned by parent (App.tsx or orchestration store)\n- This component just renders left/right children, no state\n\n## Context from Master Plan\n```\n│ TASKS (4)                      │ AGENTS (Tiling View)                        │\n│─────────────────────────────── │──────────────────────────────────────────── │\n│ → bd-001 [P1] Implement auth   │ ┌───────────────────┬───────────────────┐  │\n```\n\n## API\n```typescript\n// src/components/TwoColumnLayout.tsx\n\ninterface TwoColumnLayoutProps {\n  left: React.ReactNode;\n  right: React.ReactNode;\n  leftWidth?: number;      // Percentage, default 30\n  rightWidth?: number;     // Percentage, default 70\n  separator?: boolean;     // Show vertical separator, default true\n}\n\nfunction TwoColumnLayout({ left, right, leftWidth = 30, rightWidth = 70, separator = true }: TwoColumnLayoutProps): JSX.Element\n```\n\n## Visual Layout\n```\n│ [LEFT PANE 30%]  │ [RIGHT PANE 70%]                    │\n│                  │                                      │\n│ TaskPanel        │ AgentGrid                           │\n│                  │                                      │\n```\n\n## Files\n- src/components/TwoColumnLayout.tsx\n- src/components/TwoColumnLayout.test.tsx\n\n## Acceptance Criteria\n- [ ] Renders left pane content\n- [ ] Renders right pane content\n- [ ] Applies default 30/70 width ratio\n- [ ] Respects custom ratio (e.g., 50/50)\n- [ ] Shows vertical separator when separator=true\n- [ ] Hides separator when separator=false\n- [ ] Fills available height\n- [ ] Handles missing left (shows empty pane)\n- [ ] 8 tests pass\n\n## Tests\n1. Renders left pane content\n2. Renders right pane content\n3. Applies default 30/70 ratio\n4. Respects custom ratio\n5. Shows vertical separator by default\n6. Hides separator when separator=false\n7. Fills available height\n8. Handles missing left/right gracefully","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T12:50:52.281328+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:29:42.520637+03:00","labels":["m12-tui"]}
{"id":"ch-7gx","title":"F17: Semi-Auto Mode - User-initiated single task execution","description":"## What\nSemi-auto mode: user selects task → agent runs → completes → STOP. User can start multiple tasks in parallel (up to maxParallel slots).\n\n## Acceptance Criteria\n\n### Types\n- [ ] SemiAutoConfig: orchestrator, completionHandler, slotManager, config\n- [ ] SemiAutoStatus: activeTaskIds[], activeAgentIds[], iteration\n\n### startTask(taskId)\n- [ ] Claims slot from SlotManager before assignment\n- [ ] Assigns task via orchestrator\n- [ ] Emits \"taskStarted\" event with taskId\n- [ ] Tracks task in activeTaskIds\n- [ ] Returns error if no slots available (not reject)\n\n### cancelTask(taskId)\n- [ ] Kills specific running agent by taskId\n- [ ] Releases slot back to SlotManager\n- [ ] Removes from activeTaskIds\n- [ ] Emits \"taskCancelled\" event\n\n### cancelAll()\n- [ ] Kills all running agents\n- [ ] Releases all slots\n- [ ] Clears activeTaskIds\n- [ ] Emits \"idle\" event\n\n### Event Handling (NOT direct respawn)\n- [ ] Listens to CompletionHandler's \"success\" event → emits \"taskCompleted\", releases slot\n- [ ] Listens to CompletionHandler's \"retry\" event → calls orchestrator.assignTask() again\n- [ ] Listens to CompletionHandler's \"failed\" event → emits \"taskFailed\", releases slot\n- [ ] Emits \"idle\" only when ALL tasks complete (activeTaskIds empty)\n\n### Helper Methods\n- [ ] `getStatus()` returns current SemiAutoStatus\n- [ ] `isIdle()` returns true when activeTaskIds is empty\n- [ ] `getActiveTaskCount()` returns number of running tasks\n\n### Summary\n- [ ] 15 tests pass\n\n## Files\n- src/services/SemiAutoController.ts (NEW)\n- tests/services/SemiAutoController.test.ts (NEW)\n\n## Notes\n- DEFAULT mode (config.mode === 'semi-auto')\n- Supports MULTIPLE parallel tasks (up to maxParallel)\n- Uses SlotManager to track available slots\n- Each task runs independently\n- Enter key on task triggers startTask(selectedTaskId)\n- **IMPORTANT: Retry is event-driven, not direct respawn**\n  - CompletionHandler (F16b) emits \"retry\" event\n  - SemiAutoController listens and calls orchestrator.assignTask()\n  - Iteration tracking is in F16b, not here","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T02:07:06.427237+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:20:12.131916+03:00","labels":["m4-orchestration"],"dependencies":[{"issue_id":"ch-7gx","depends_on_id":"ch-0e7","type":"blocks","created_at":"2026-01-10T02:07:06.429867+03:00","created_by":"deligoez"},{"issue_id":"ch-7gx","depends_on_id":"ch-lhm","type":"blocks","created_at":"2026-01-10T02:07:06.431531+03:00","created_by":"deligoez"},{"issue_id":"ch-7gx","depends_on_id":"ch-i9i","type":"blocks","created_at":"2026-01-10T11:17:05.604847+03:00","created_by":"deligoez"}]}
{"id":"ch-7ju","title":"F14: Dependency Resolver - Check task dependencies","description":"## What\nCheck if task dependencies are satisfied before assignment.\n\n## Acceptance Criteria\n\n### check()\n- [ ] `check(id)` returns `satisfied: true` when no dependencies\n- [ ] `check(id)` returns `satisfied: true` when all deps closed\n- [ ] `check(id)` returns `pending[]` for open deps\n- [ ] `check(id)` returns `inProgress[]` for in_progress deps\n- [ ] `check(id)` returns `failed[]` for missing deps\n\n### getDependencies()\n- [ ] `getDependencies(id)` returns empty array for no deps\n- [ ] `getDependencies(id)` returns list of dependency IDs\n\n### isDependencySatisfied()\n- [ ] `isDependencySatisfied(depId)` returns true if dep is closed\n- [ ] `isDependencySatisfied(depId)` returns false if dep is open/in_progress\n\n### getDependents()\n- [ ] `getDependents(id)` returns tasks blocked by this task\n- [ ] `getDependents(id)` returns empty array if nothing blocked\n\n### hasCircularDependency()\n- [ ] `hasCircularDependency(id)` returns false for linear deps\n- [ ] `hasCircularDependency(id)` returns true for circular deps\n\n### Summary\n- [ ] DependencyStatus interface: satisfied, pending[], inProgress[], failed[]\n- [ ] 13 tests pass\n\n## Files\n- src/services/DependencyResolver.ts (NEW)\n- tests/services/DependencyResolver.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F14-dependency-resolver.md\n\n## Notes\n- Uses BeadsCLI to query task status\n- Deps stored in task.dependencies array\n- Circular dependency check uses visited set","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T02:06:33.869228+03:00","created_by":"deligoez","updated_at":"2026-01-10T02:54:32.593334+03:00","labels":["m4-orchestration"],"dependencies":[{"issue_id":"ch-7ju","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-10T02:06:33.87357+03:00","created_by":"deligoez"}]}
{"id":"ch-7jw","title":"F16a: Completion Handler - Success path handling","description":"## What\nHandle successful task completion: detect signal + tests pass → extract learnings → close task → emit events.\n\n## Acceptance Criteria\n\n### Types\n- [ ] CompletionHandlerConfig: completionChecker, beadsCLI, worktreeService, config, scratchpadManager, learningExtractor, learningStore\n- [ ] TaskCompletionResult: taskId, agentId, success, iteration, reason, testOutput?\n\n### handleAgentExit() - Success Path\n- [ ] Returns success when signal + tests pass\n- [ ] Closes task via `beadsCLI.closeTask()`\n- [ ] Emits \"completed\" event with taskId, agentId\n- [ ] Emits \"readyForMerge\" event with taskId, branch, worktreePath\n- [ ] Returns TaskCompletionResult with success=true\n\n### handleSuccess() - Core\n- [ ] Closes task with agent comment\n- [ ] Emits \"readyForMerge\" for merge queue\n\n### handleSuccess() - Learning Extraction\n- [ ] Reads scratchpad from agent's worktree via ScratchpadManager.read()\n- [ ] Extracts learnings if learningsSection present via LearningExtractor.parse()\n- [ ] Skips extraction gracefully when no learnings section\n- [ ] Appends learnings to shared store via LearningStore.append()\n- [ ] Commits learnings with attribution via LearningStore.commit()\n- [ ] Clears scratchpad after successful extraction via ScratchpadManager.clear()\n\n### Summary\n- [ ] 9 tests pass\n\n## Files\n- src/services/CompletionHandler.ts (NEW)\n- tests/services/CompletionHandler.test.ts (NEW)\n\n## Tests\n1. handleAgentExit() returns success when signal + tests pass\n2. handleAgentExit() closes task via beadsCLI\n3. handleAgentExit() emits \"completed\" event\n4. handleAgentExit() emits \"readyForMerge\" event\n5. handleSuccess() extracts and stores learnings when present\n6. handleSuccess() skips extraction when no learnings section\n7. handleSuccess() commits learnings with attribution\n8. handleSuccess() clears scratchpad after extraction\n9. handleSuccess() handles missing scratchpad gracefully\n\n## Notes\n- Extends EventEmitter for events\n- Does NOT respawn agent (Orchestrator's job)\n- Merge queue handled by MergeService (M5)\n- Learning extraction uses F39b, F40, F41 building blocks","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T02:06:42.739971+03:00","created_by":"deligoez","updated_at":"2026-01-10T11:46:10.003503+03:00","labels":["m4-orchestration"],"dependencies":[{"issue_id":"ch-7jw","depends_on_id":"ch-uoa","type":"blocks","created_at":"2026-01-10T02:06:42.742454+03:00","created_by":"deligoez"},{"issue_id":"ch-7jw","depends_on_id":"ch-dzz","type":"blocks","created_at":"2026-01-10T02:06:42.744143+03:00","created_by":"deligoez"},{"issue_id":"ch-7jw","depends_on_id":"ch-1gi","type":"blocks","created_at":"2026-01-10T11:45:49.206763+03:00","created_by":"deligoez"},{"issue_id":"ch-7jw","depends_on_id":"ch-a6h","type":"blocks","created_at":"2026-01-10T11:45:49.335553+03:00","created_by":"deligoez"}]}
{"id":"ch-7ki","title":"F59c: AgentTileProgress - Progress bar, iteration, duration","description":"## What\nMiddle section of AgentTile showing progress bar, iteration count, and elapsed time.\n\n## Context from Master Plan\n```\n│ iter 7/50 | 12m   │\n│ ▓▓▓▓░░░░░░ 35%    │\n```\n\n## API\n```typescript\n// src/components/AgentTileProgress.tsx\n\ninterface AgentTileProgressProps {\n  iteration: number;\n  maxIterations: number;\n  startTime: number;      // Unix timestamp (ms)\n  progressPercent?: number; // If not provided, calculate from iteration/max\n}\n\nfunction AgentTileProgress({ iteration, maxIterations, startTime, progressPercent }: AgentTileProgressProps): JSX.Element\n```\n\n## Visual Output\n```\niter 7/50 | 12m\n▓▓▓▓░░░░░░ 35%\n```\n\n## Color Specs (Ink)\n- \"iter X/Y\": default color\n- Pipe separator \"|\": color=\"gray\"\n- Duration: passed to DurationDisplay (uses its colors)\n- Progress bar: passed to ProgressBar (uses its colors)\n\n## Files\n- src/components/AgentTileProgress.tsx\n- src/components/AgentTileProgress.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows iteration as \"iter X/Y\" format\n- [ ] Renders DurationDisplay with startTime prop\n- [ ] Renders ProgressBar with calculated or explicit percent\n- [ ] Uses gray pipe \"|\" separator between iter and duration\n- [ ] Calculates progress as (iteration/maxIterations)*100 if progressPercent not provided\n- [ ] Uses explicit progressPercent when provided\n- [ ] Passes correct props to child components\n- [ ] 7 tests pass\n\n## Tests\n1. Shows \"iter 7/50\" format\n2. Renders DurationDisplay with correct startTime\n3. Renders ProgressBar with calculated percentage\n4. Uses gray pipe separator\n5. Calculates progress from iteration/max\n6. Uses explicit progressPercent when provided\n7. Passes correct props to ProgressBar","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T12:49:56.14468+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:30:47.891267+03:00","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-7ki","depends_on_id":"ch-8vk","type":"blocks","created_at":"2026-01-10T12:49:56.146891+03:00","created_by":"deligoez"},{"issue_id":"ch-7ki","depends_on_id":"ch-aap","type":"blocks","created_at":"2026-01-10T12:49:56.148801+03:00","created_by":"deligoez"}]}
{"id":"ch-7pb","title":"F26: Conflict Classifier","description":"## What\nAnalyzes merge conflicts and classifies by complexity (trivial, simple, complex, semantic).\n\n## Acceptance Criteria\n\n### classifyFile() - 5 tests\n- [ ] Whitespace-only conflicts classified as `trivial`\n- [ ] Import reordering classified as `trivial`\n- [ ] Single-region, small conflict classified as `simple`\n- [ ] Multi-region conflicts classified as `complex`\n- [ ] Breaking changes classified as `semantic`\n\n### analyze() - 2 tests\n- [ ] Analyzes all given conflict files\n- [ ] Returns overall type as worst-case (semantic \u003e complex \u003e simple \u003e trivial)\n\n### getSuggestedStrategy() - 4 tests\n- [ ] Returns 'auto' for trivial with high confidence\n- [ ] Returns 'rebase' for simple\n- [ ] Returns 'agent' for complex\n- [ ] Returns 'human' for semantic\n\n### Implicit (no dedicated tests)\n- `getOverallType()` - tested via analyze() worst-case test\n- `isAutoResolvable()` - returns true when type=trivial \u0026\u0026 confidence\u003e0.8\n\n## Files\n- src/services/ConflictClassifier.ts\n- tests/services/ConflictClassifier.test.ts\n\n## Plan\nSee: thoughts/shared/plans/features/F26-conflict-classifier.md\n\n**Total: 11 tests**","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T03:16:29.152626+03:00","created_by":"deligoez","updated_at":"2026-01-10T08:21:49.20015+03:00","labels":["m5-merge"],"dependencies":[{"issue_id":"ch-7pb","depends_on_id":"ch-fe5","type":"blocks","created_at":"2026-01-10T03:16:29.155521+03:00","created_by":"deligoez"}]}
{"id":"ch-81x","title":"F02b: State Init/Load - Initialize or recover session state","description":"## What\nInitialize new state or load existing for recovery.\n\n## Acceptance Criteria\n- [ ] `init()` creates fresh state with UUID sessionId (valid UUID format)\n- [ ] `init()` sets startedAt to current timestamp\n- [ ] `init()` sets empty agents object and empty mergeQueue array\n- [ ] `load()` returns `null` if state file does not exist\n- [ ] `load()` returns parsed `ChorusState` if file exists and valid\n- [ ] `load()` throws `Error('Invalid state structure')` if file is malformed\n- [ ] `get()` returns current state after init/load\n- [ ] `get()` throws `Error('State not initialized')` if called before init/load\n- [ ] 8 tests pass\n\n## Files\n- src/services/StateService.ts (NEW - partial)\n- tests/services/StateService.test.ts (NEW)\n\n## Implementation\n```typescript\nexport class StateService {\n  private statePath: string;\n  private state: ChorusState | null = null;\n\n  constructor(projectDir: string) {\n    this.statePath = path.join(projectDir, '.chorus', 'state.json');\n  }\n\n  init(): ChorusState {\n    this.state = {\n      version: '1.0',\n      sessionId: crypto.randomUUID(),\n      startedAt: Date.now(),\n      mode: 'semi-auto',\n      paused: false,\n      agents: {},\n      mergeQueue: [],\n      checkpoint: null,\n      stats: { tasksCompleted: 0, tasksFailed: 0, mergesAuto: 0, mergesManual: 0, totalIterations: 0, totalRuntime: 0 }\n    };\n    return this.state;\n  }\n\n  load(): ChorusState | null {\n    if (!fs.existsSync(this.statePath)) return null;\n    const data = JSON.parse(fs.readFileSync(this.statePath, 'utf-8'));\n    if (!this.isValidState(data)) throw new Error('Invalid state structure');\n    this.state = data;\n    return this.state;\n  }\n\n  get(): ChorusState {\n    if (!this.state) throw new Error('State not initialized');\n    return this.state;\n  }\n\n  private isValidState(data: unknown): data is ChorusState {\n    if (!data || typeof data !== 'object') return false;\n    const s = data as Record\u003cstring, unknown\u003e;\n    return !!(s.sessionId \u0026\u0026 s.startedAt \u0026\u0026 s.agents \u0026\u0026 s.stats);\n  }\n}\n```\n\n## Test Cases\n1. `init()` generates sessionId in UUID format (matches regex)\n2. `init()` sets startedAt to timestamp close to Date.now()\n3. `init()` creates empty agents object `{}`\n4. `init()` creates empty mergeQueue array `[]`\n5. `load()` returns `null` when state file does not exist\n6. `load()` returns parsed ChorusState when file exists and valid\n7. `load()` throws `Error('Invalid state structure')` on malformed JSON\n8. `get()` throws `Error('State not initialized')` before init/load","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:30:50.906489+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:22:56.503628+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-81x","depends_on_id":"ch-ah6","type":"blocks","created_at":"2026-01-10T01:30:50.908184+03:00","created_by":"deligoez"}]}
{"id":"ch-8ee","title":"F31: Merge Service","description":"## What\nTop-level facade that orchestrates the entire merge pipeline. Simple API for RalphLoop. Also handles worktree cleanup after successful merges.\n\n## Dependency Injection Pattern\n```typescript\ninterface MergeServiceDeps {\n  mergeQueue: MergeQueue;\n  mergeWorker: MergeWorker;\n  worktreeService: WorktreeService;\n  eventEmitter: EventEmitter;\n}\n\nclass MergeService {\n  constructor(private deps: MergeServiceDeps) {}\n}\n```\n\n## Mocking Strategy\nAll dependencies are injected interfaces - create mocks for each:\n```typescript\nconst mockQueue = {\n  enqueue: vi.fn(),\n  dequeue: vi.fn(),\n  getStats: vi.fn(),\n} as unknown as MergeQueue;\n\nconst mockWorker = {\n  process: vi.fn(),\n} as unknown as MergeWorker;\n\nconst mockWorktree = {\n  remove: vi.fn(),\n} as unknown as WorktreeService;\n\nconst mockEmitter = {\n  emit: vi.fn(),\n  on: vi.fn(),\n} as unknown as EventEmitter;\n```\n\n## Acceptance Criteria\n\n### enqueue() - 1 test\n- [ ] Calls `deps.mergeQueue.enqueue()` with the provided MergeItem\n\n### start() / stop() - 2 tests\n- [ ] `start()` sets `isRunning=true` and begins polling queue via `deps.mergeQueue.dequeue()`\n- [ ] `stop()` sets `isRunning=false` after current `deps.mergeWorker.process()` completes\n\n### getQueueStatus() / isRunning() - 2 tests\n- [ ] `getQueueStatus()` returns result of `deps.mergeQueue.getStats()`\n- [ ] `isRunning()` returns internal running state boolean\n\n### Worktree Cleanup - 2 tests\n- [ ] On successful merge (worker returns success), calls `deps.worktreeService.remove(worktreePath)`\n- [ ] On human-resolved merge (worker returns humanResolved), calls `deps.worktreeService.remove(worktreePath)`\n\n## Test Setup Pattern\n```typescript\ndescribe('MergeService', () =\u003e {\n  let service: MergeService;\n  let mockQueue: MergeQueue;\n  let mockWorker: MergeWorker;\n  let mockWorktree: WorktreeService;\n\n  beforeEach(() =\u003e {\n    mockQueue = { enqueue: vi.fn(), dequeue: vi.fn(), getStats: vi.fn() } as any;\n    mockWorker = { process: vi.fn() } as any;\n    mockWorktree = { remove: vi.fn() } as any;\n    \n    service = new MergeService({\n      mergeQueue: mockQueue,\n      mergeWorker: mockWorker,\n      worktreeService: mockWorktree,\n      eventEmitter: new EventEmitter(),\n    });\n  });\n});\n```\n\n## Events (implicit, not counted in tests)\n- mergeStarted, mergeCompleted, mergeFailed, conflict, escalated\n\n## Dependencies\n- F05 Worktree Remove (ch-112) - worktree cleanup\n- F24 Merge Queue (ch-glf)\n- F25 Merge Worker (ch-fe5)\n- F26 Conflict Classifier (ch-7pb)\n- F27 Auto-Resolver (ch-t31)\n- F28 Rebase-Retry (ch-xn6)\n- F29 Resolver Agent (ch-9sj)\n- F30 Human Escalation (ch-26c)\n\n## Files\n- src/services/MergeService.ts\n- tests/services/MergeService.test.ts\n\n## Plan\nSee: thoughts/shared/plans/features/F31-merge-service.md\n\n**Total: 7 tests (facade wiring + worktree cleanup)**","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T03:17:25.914154+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:25:45.665892+03:00","labels":["m5-merge"],"dependencies":[{"issue_id":"ch-8ee","depends_on_id":"ch-glf","type":"blocks","created_at":"2026-01-10T03:17:25.916827+03:00","created_by":"deligoez"},{"issue_id":"ch-8ee","depends_on_id":"ch-fe5","type":"blocks","created_at":"2026-01-10T03:17:25.918445+03:00","created_by":"deligoez"},{"issue_id":"ch-8ee","depends_on_id":"ch-7pb","type":"blocks","created_at":"2026-01-10T03:17:25.919817+03:00","created_by":"deligoez"},{"issue_id":"ch-8ee","depends_on_id":"ch-t31","type":"blocks","created_at":"2026-01-10T03:17:25.921151+03:00","created_by":"deligoez"},{"issue_id":"ch-8ee","depends_on_id":"ch-xn6","type":"blocks","created_at":"2026-01-10T03:17:25.922525+03:00","created_by":"deligoez"},{"issue_id":"ch-8ee","depends_on_id":"ch-9sj","type":"blocks","created_at":"2026-01-10T03:17:25.923867+03:00","created_by":"deligoez"},{"issue_id":"ch-8ee","depends_on_id":"ch-26c","type":"blocks","created_at":"2026-01-10T03:17:25.925216+03:00","created_by":"deligoez"},{"issue_id":"ch-8ee","depends_on_id":"ch-112","type":"blocks","created_at":"2026-01-10T08:38:29.617668+03:00","created_by":"deligoez"}]}
{"id":"ch-8j3","title":"F19: Orchestration Store - Zustand state management","description":"## What\nZustand store for orchestration state: mode, status, current task, stats.\n\n## Acceptance Criteria\n\n### Types\n- [ ] OperatingMode: 'semi-auto' | 'autopilot'\n- [ ] OrchestrationStatus: 'idle' | 'assigning' | 'running' | 'completing' | 'error'\n- [ ] OrchestrationState interface (12 properties)\n- [ ] OrchestrationActions interface (12 actions)\n\n### Mode\n- [ ] Defaults to 'semi-auto'\n- [ ] `setMode(mode)` changes mode\n\n### Status\n- [ ] `setStatus(status, error?)` sets status and optional error\n- [ ] `setIdle()` clears error and sets idle\n- [ ] `setError(error)` sets error status\n\n### Current Task\n- [ ] `setCurrentTask(taskId, agentId, agentType)` sets task details\n- [ ] `clearCurrentTask()` resets to null\n- [ ] `incrementIteration()` increments count\n\n### Stats\n- [ ] `recordCompletion(true)` increments tasksCompleted\n- [ ] `recordCompletion(false)` increments tasksFailed\n- [ ] `resetStats()` clears all stats\n\n### Autopilot\n- [ ] `setPaused(bool)` sets pause state\n- [ ] `setActiveAgentCount(n)` tracks running agents\n\n### Reset\n- [ ] `reset()` returns to initialState\n\n### Summary\n- [ ] 12 tests pass\n\n## Files\n- src/stores/orchestrationStore.ts (NEW)\n- tests/stores/orchestrationStore.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F19-orchestration-store.md\n\n## Notes\n- No dependencies (independent state store)\n- Similar pattern to agentStore, beadsStore\n- Services update store, components read","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T02:07:35.161308+03:00","created_by":"deligoez","updated_at":"2026-01-10T03:03:35.366181+03:00","labels":["m4-orchestration"]}
{"id":"ch-8vk","title":"F56a: ProgressBar Component - Horizontal progress bar with blocks","description":"## What\nHorizontal progress bar using Unicode block characters to show completion percentage.\n\n## Context from Master Plan\n```\n│ ▓▓▓▓░░░░░░ 35%    │\n```\n\n## API\n```typescript\n// src/components/ProgressBar.tsx\n\ninterface ProgressBarProps {\n  percent: number;       // 0-100\n  width?: number;        // Character width, default 10\n  showPercent?: boolean; // Show percentage text, default true\n}\n\nfunction ProgressBar({ percent, width = 10, showPercent = true }: ProgressBarProps): JSX.Element\n```\n\n## Visual Output\n- 0%:   `░░░░░░░░░░ 0%`\n- 35%:  `▓▓▓▓░░░░░░ 35%`\n- 100%: `▓▓▓▓▓▓▓▓▓▓ 100%`\n\n## Files\n- src/components/ProgressBar.tsx\n- src/components/ProgressBar.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows filled blocks (▓) for completed portion\n- [ ] Shows empty blocks (░) for remaining portion\n- [ ] Calculates correct number of filled blocks\n- [ ] Respects width prop\n- [ ] Shows percentage when showPercent=true\n- [ ] Hides percentage when showPercent=false\n- [ ] Clamps percent to 0-100 range\n- [ ] Handles negative percent (treats as 0)\n- [ ] Handles percent \u003e 100 (treats as 100)\n- [ ] Uses Ink `\u003cText color=\"green\"\u003e` for high progress (\u003e80%)\n- [ ] 10 tests pass\n\n## Tests\n1. Shows 0% with all empty blocks\n2. Shows 50% with half filled blocks\n3. Shows 100% with all filled blocks\n4. Respects custom width\n5. Shows percentage text by default\n6. Hides percentage when showPercent=false\n7. Clamps negative to 0\n8. Clamps \u003e100 to 100\n9. Uses `\u003cText color=\"green\"\u003e` for \u003e80%\n10. Calculates blocks correctly for various percents","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T12:48:33.051708+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:30:05.397798+03:00","labels":["m12-tui"]}
{"id":"ch-8w5","title":"F58a: TaskSummaryStats Component - Count tasks by status","description":"## What\nDisplay summary counts of tasks by status (done, running, pending, blocked).\n\n## Context from Master Plan\n```\n│ Tasks: 1 done, 3 running, 1 pending, 1 blocked | Merge: 1 queued | ? help   │\n```\n\n## API\n```typescript\n// src/components/TaskSummaryStats.tsx\n\ninterface TaskSummaryStatsProps {\n  done: number;\n  running: number;\n  pending: number;\n  blocked: number;\n}\n\nfunction TaskSummaryStats({ done, running, pending, blocked }: TaskSummaryStatsProps): JSX.Element\n```\n\n## Visual Output\n```\nTasks: 1 done, 3 running, 1 pending, 1 blocked\n```\n\n## Files\n- src/components/TaskSummaryStats.tsx\n- src/components/TaskSummaryStats.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows \"Tasks:\" prefix\n- [ ] Shows done count with \"done\" label\n- [ ] Shows running count with \"running\" label\n- [ ] Shows pending count with \"pending\" label\n- [ ] Shows blocked count with \"blocked\" label\n- [ ] Uses Ink `\u003cText color=\"green\"\u003e` for done count\n- [ ] Uses Ink `\u003cText color=\"blue\"\u003e` for running count\n- [ ] Uses Ink `\u003cText color=\"red\"\u003e` for blocked count\n- [ ] Handles zero counts correctly (still displays them)\n- [ ] 9 tests pass\n\n## Tests\n1. Shows \"Tasks:\" prefix\n2. Shows all four categories with comma separator\n3. Green color for done count\n4. Blue color for running count\n5. White/default for pending count\n6. Red color for blocked count\n7. Handles zero counts (0 done, 0 running, etc.)\n8. Displays in correct order: done, running, pending, blocked\n9. Uses comma+space separator between categories","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T12:49:00.890131+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:30:07.02853+03:00","labels":["m12-tui"]}
{"id":"ch-96v","title":"F63l: Priority Badge Colors","description":"## What\nAdd color-coded priority badges P0-P4 to TaskPanel.\n\n## Why\nMaster plan specifies colored priority badges:\n- [P1] Critical (red)\n- [P2] High (orange)\n- [P3] Medium (yellow)\n- [P4] Low (blue)\n\nCurrent implementation only tests P0 without color verification.\n\n## Acceptance Criteria\n- [ ] P0 badge displayed in magenta (critical)\n- [ ] P1 badge displayed in red\n- [ ] P2 badge displayed in orange/yellow\n- [ ] P3 badge displayed in cyan\n- [ ] P4 badge displayed in blue/dim\n- [ ] 5 tests pass\n\n## Tests (src/components/TaskPanel.test.tsx)\n1. `P0 badge is magenta (critical)`\n2. `P1 badge is red`\n3. `P2 badge is yellow/orange`\n4. `P3 badge is cyan`\n5. `P4 badge is blue/dim`\n\n## Files\n- src/components/TaskPanel.tsx (add colored badges)\n- src/components/TaskPanel.test.tsx (add tests)\n\n## Notes\n- P0 added as \"ultra-critical\" beyond plan's P1-P4\n- Colors should work in both light and dark terminals\n- Use Ink's `\u003cText color=\"red\"\u003e` etc.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T22:17:54.898221+03:00","created_by":"deligoez","updated_at":"2026-01-10T22:17:54.898221+03:00","labels":["m12-tui"]}
{"id":"ch-9fq","title":"F18a: useTaskSelection Hook - Task navigation and selection","description":"## What\nReact hook for task selection: up/down navigation, selection state, assign action.\n\n**IMPORTANT:** Task data comes from Orchestrator → BeadsCLI. Never call bd directly.\n\n## Acceptance Criteria\n\n### Interface\n- [ ] UseTaskSelectionResult: selectedTaskId, selectTask, selectNext, selectPrevious, assignSelected, canAssign, tasks, deferredTasks\n\n### Task Lists - 3 tests (NEW)\n- [ ] `tasks` returns active ready tasks (excludes deferred)\n- [ ] `deferredTasks` returns deferred tasks for display\n- [ ] Both lists sourced from Orchestrator (not direct bd)\n\n### Selection\n- [ ] `selectTask(id)` sets selected task ID\n- [ ] `selectNext()` cycles through ready tasks (wraps at end)\n- [ ] `selectPrevious()` cycles backwards (wraps at start)\n- [ ] Navigation skips blocked AND deferred tasks\n\n### Assignment\n- [ ] `canAssign` returns true when idle AND task selected\n- [ ] `canAssign` returns false when agent is running\n- [ ] `canAssign` returns false for deferred task\n- [ ] `assignSelected()` calls semiAutoController.startTask()\n\n### Summary\n- [ ] 10 tests pass (was 6)\n\n## Files\n- src/hooks/useTaskSelection.ts (NEW)\n- src/hooks/useTaskSelection.test.ts (NEW)\n\n## Notes\n- Uses useMemo to filter ready tasks\n- Works with SemiAutoController for assignment\n- **Deferred tasks shown grayed out in TUI but not selectable**\n- **All task data via Orchestrator → BeadsCLI pipeline**","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T02:07:14.369577+03:00","created_by":"deligoez","updated_at":"2026-01-10T22:36:50.481621+03:00","labels":["m4-orchestration"],"dependencies":[{"issue_id":"ch-9fq","depends_on_id":"ch-7gx","type":"blocks","created_at":"2026-01-10T02:07:14.372007+03:00","created_by":"deligoez"}]}
{"id":"ch-9sj","title":"F29: Resolver Agent","description":"## What\nSpawns Claude agent to resolve complex merge conflicts that can't be auto-resolved.\n\n## Testability Design\n\n**Problem:** Spawning subprocess is hard to test directly.\n\n**Solution:** Dependency injection with `AgentSpawner` interface.\n\n```typescript\ninterface AgentSpawner {\n  spawn(options: SpawnOptions): Promise\u003cAgentProcess\u003e;\n  kill(pid: number): void;\n}\n\ninterface AgentProcess {\n  pid: number;\n  stdout: Readable;\n  exitCode: Promise\u003cnumber\u003e;\n}\n\n// Production implementation\nclass CLIAgentSpawner implements AgentSpawner {\n  async spawn(options: SpawnOptions): Promise\u003cAgentProcess\u003e {\n    const child = spawn('claude', ['--prompt', options.prompt], {\n      cwd: options.cwd\n    });\n    return {\n      pid: child.pid,\n      stdout: child.stdout,\n      exitCode: new Promise(resolve =\u003e child.on('exit', resolve))\n    };\n  }\n}\n\n// Test implementation\nclass MockAgentSpawner implements AgentSpawner {\n  async spawn(options: SpawnOptions): Promise\u003cAgentProcess\u003e {\n    // Return mock process that resolves/fails as configured\n  }\n}\n```\n\n## API\n```typescript\n// src/services/ResolverAgent.ts\n\nclass ResolverAgent extends EventEmitter {\n  constructor(\n    private spawner: AgentSpawner,\n    private config: ResolverConfig\n  ) {\n    super();\n  }\n\n  /**\n   * Resolve conflict by spawning agent\n   * Emits: 'resolving', 'resolved', 'failed'\n   */\n  async resolve(conflict: ConflictAnalysis): Promise\u003cResolveResult\u003e\n\n  /**\n   * Build prompt with conflict context\n   */\n  buildPrompt(conflict: ConflictAnalysis): string\n\n  /**\n   * Verify no conflict markers remain\n   */\n  async verifyResolution(filePath: string): Promise\u003cboolean\u003e\n\n  /**\n   * Cancel running agent\n   */\n  cancel(): void\n}\n\ninterface ResolveResult {\n  success: boolean;\n  resolved: boolean;\n  needsHuman?: boolean;\n  error?: string;\n}\n```\n\n## Files\n- src/services/ResolverAgent.ts\n- src/services/AgentSpawner.ts (interface + CLIAgentSpawner)\n- tests/services/ResolverAgent.test.ts\n- tests/mocks/MockAgentSpawner.ts\n\n## Acceptance Criteria\n\n### resolve() - 6 tests\n- [ ] Calls spawner.spawn() with conflict resolution prompt\n- [ ] Returns `{ success: true, resolved: true }` when agent resolves (exit 0 + no markers)\n- [ ] Returns `{ needsHuman: true }` after maxAttempts failures\n- [ ] Emits 'resolving' event when agent starts\n- [ ] Emits 'resolved' event on successful resolution\n- [ ] Emits 'failed' event after maxAttempts failures\n\n### buildPrompt() - 2 tests\n- [ ] Includes all conflicting file contents\n- [ ] Includes conflict analysis for context\n\n### verifyResolution() - 1 test\n- [ ] Returns `true` when no conflict markers remain in file\n\n### cancel() - 1 test\n- [ ] Calls spawner.kill() with agent PID\n\n### AgentSpawner (separate unit) - 2 tests\n- [ ] CLIAgentSpawner.spawn() returns process with pid\n- [ ] CLIAgentSpawner.kill() terminates process\n\n**Total: 12 tests** (9 ResolverAgent + 2 AgentSpawner + 1 integration)\n\n## Tests\n1. resolve() calls spawner.spawn() with correct prompt\n2. resolve() returns success when agent resolves conflict\n3. resolve() escalates to human after maxAttempts\n4. resolve() emits resolving event\n5. resolve() emits resolved event\n6. resolve() emits failed event\n7. buildPrompt() includes file contents\n8. buildPrompt() includes analysis context\n9. verifyResolution() checks for conflict markers\n10. cancel() kills agent process\n11. CLIAgentSpawner.spawn() creates process\n12. CLIAgentSpawner.kill() terminates process\n\n## Notes\n- **Testable via dependency injection** - no subprocess mocking needed\n- MockAgentSpawner can simulate success, failure, timeout scenarios\n- CLIAgentSpawner is a thin wrapper, tested separately (integration test)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T03:16:59.889097+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:21:55.13997+03:00","labels":["m5-merge"],"dependencies":[{"issue_id":"ch-9sj","depends_on_id":"ch-xn6","type":"blocks","created_at":"2026-01-10T03:16:59.891451+03:00","created_by":"deligoez"}]}
{"id":"ch-9yl","title":"F40: Learning Extractor - Parse learnings from scratchpad content","description":"## What\nParse learnings section content into structured Learning objects.\n\n## Markdown Parsing Rules\n\n### Input Format\n```markdown\n### Category Name\n- Learning point one\n- Learning point two with more detail\n  that spans multiple lines\n\n### Another Category\n- Another learning point\n```\n\n### Parsing Rules\n1. **Category Detection**: H3 headings (`### `) define category for following bullets\n2. **Bullet Points**: Lines starting with `- ` are individual learnings\n3. **Multi-line**: Continuation lines (indented, no bullet) append to previous learning\n4. **Blank Lines**: Ignored, don't affect parsing\n5. **No Category**: Bullets before any H3 heading get category \"general\"\n6. **Category Normalization**: Heading text is lowercased and trimmed\n\n### Known Categories (detectCategory mapping)\n| Heading Contains | Category |\n|------------------|----------|\n| \"performance\" | \"performance\" |\n| \"test\" | \"testing\" |\n| \"debug\" | \"debugging\" |\n| \"error\", \"exception\" | \"error-handling\" |\n| \"pattern\" | \"patterns\" |\n| (no match) | \"general\" |\n\n## API\n```typescript\n// src/services/LearningExtractor.ts\n\nclass LearningExtractor {\n  /**\n   * Parse markdown learnings section into Learning objects\n   * @param content Raw learnings markdown section (from ScratchpadManager.extractLearningsSection)\n   * @param taskId Source task ID for attribution\n   * @param agentType Source agent type for attribution\n   * @returns Array of parsed Learning objects (empty array if no learnings found)\n   */\n  parse(content: string, taskId: string, agentType: AgentType): Learning[]\n\n  /**\n   * Detect category from heading text\n   * @param headingText The H3 heading text (without ###)\n   * @returns Normalized category string\n   */\n  detectCategory(headingText: string): string\n\n  /**\n   * Format single learning for appending to learnings.md\n   * @returns Markdown string with attribution comment\n   */\n  formatForStorage(learning: Learning): string\n}\n```\n\n## Format Output (formatForStorage)\n```markdown\n- Learning content here\n  \u003c!-- source: ch-abc, claude, 2026-01-10T12:00:00Z --\u003e\n```\n\n## Files\n- src/services/LearningExtractor.ts\n- tests/services/LearningExtractor.test.ts\n\n## Acceptance Criteria\n- [ ] `parse()` extracts each `- ` bullet as individual Learning\n- [ ] `parse()` joins multi-line bullets (indented continuation) into single learning\n- [ ] `parse()` assigns category from preceding `### ` heading\n- [ ] `parse()` assigns \"general\" category for bullets before any heading\n- [ ] `parse()` sets source.taskId, source.agentType, source.timestamp on each Learning\n- [ ] `parse()` returns empty array for empty/whitespace-only content\n- [ ] `parse()` returns empty array for content with no bullet points\n- [ ] `detectCategory()` returns \"performance\" for heading containing \"performance\"\n- [ ] `detectCategory()` returns \"testing\" for heading containing \"test\"\n- [ ] `detectCategory()` returns \"general\" for unrecognized heading\n- [ ] `detectCategory()` is case-insensitive\n- [ ] `formatForStorage()` outputs markdown with attribution HTML comment\n- [ ] `formatForStorage()` includes taskId, agentType, ISO timestamp in comment\n- [ ] 13 tests pass\n\n## Tests\n1. parse() extracts single bullet as learning\n2. parse() extracts multiple bullets as separate learnings\n3. parse() joins multi-line bullet into one learning\n4. parse() assigns category from heading\n5. parse() assigns \"general\" for bullets before heading\n6. parse() sets source fields correctly\n7. parse() returns empty array for empty content\n8. parse() returns empty array for no bullets\n9. detectCategory() maps \"performance\" correctly\n10. detectCategory() maps \"testing\" correctly\n11. detectCategory() returns \"general\" for unknown\n12. detectCategory() is case-insensitive\n13. formatForStorage() includes attribution comment","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T10:42:43.052343+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:27:56.243417+03:00","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-9yl","depends_on_id":"ch-uxk","type":"blocks","created_at":"2026-01-10T10:42:43.05388+03:00","created_by":"deligoez"}]}
{"id":"ch-a6h","title":"F41: Learning Store - Append learnings to shared file","description":"## What\nAppend extracted learnings to .agent/learnings.md and commit.\n\n## API\n```typescript\n// src/services/LearningStore.ts\n\nclass LearningStore {\n  constructor(private repoPath: string = '.') {}\n\n  /**\n   * Path to learnings file\n   */\n  readonly learningsPath = '.agent/learnings.md'\n\n  /**\n   * Append learnings to shared file\n   * @param learnings Array of Learning objects to append\n   */\n  async append(learnings: Learning[]): Promise\u003cvoid\u003e\n\n  /**\n   * Commit the learnings file\n   * @param taskId Source task for commit message\n   * @param agentType Source agent for commit message\n   */\n  async commit(taskId: string, agentType: AgentType): Promise\u003cvoid\u003e\n\n  /**\n   * Read all learnings from file\n   * @returns Map of category -\u003e learnings\n   */\n  async readAll(): Promise\u003cMap\u003cstring, Learning[]\u003e\u003e\n\n  /**\n   * Get learnings by category\n   */\n  async getByCategory(category: string): Promise\u003cLearning[]\u003e\n\n  /**\n   * Ensure .agent directory and learnings.md exist\n   */\n  async ensureExists(): Promise\u003cvoid\u003e\n}\n```\n\n## Files\n- src/services/LearningStore.ts\n- tests/services/LearningStore.test.ts\n\n## Acceptance Criteria\n- [ ] `append()` adds formatted learnings to end of file\n- [ ] `append()` preserves existing content\n- [ ] `commit()` creates commit with \"learn: extract from {taskId} ({agent})\"\n- [ ] `readAll()` parses existing learnings into Map\n- [ ] `getByCategory()` filters by category\n- [ ] `ensureExists()` creates .agent/learnings.md if missing\n- [ ] 7 tests pass\n\n## Tests\n1. append() adds learnings to file\n2. append() preserves existing content\n3. commit() creates properly formatted commit\n4. readAll() returns Map of categories\n5. getByCategory() filters correctly\n6. ensureExists() creates directory and file\n7. ensureExists() is idempotent","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T10:42:53.486064+03:00","created_by":"deligoez","updated_at":"2026-01-10T10:42:53.486064+03:00","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-a6h","depends_on_id":"ch-9yl","type":"blocks","created_at":"2026-01-10T10:42:53.487551+03:00","created_by":"deligoez"}]}
{"id":"ch-aap","title":"F56b: DurationDisplay Component - Format elapsed time","description":"## What\nFormat and display elapsed time from a start timestamp in human-readable format.\n\n## Context from Master Plan\n```\n│ iter 7/50 | 12m   │\n```\n\n## API\n```typescript\n// src/components/DurationDisplay.tsx\n\ninterface DurationDisplayProps {\n  startTime: number;     // Unix timestamp in ms\n  now?: number;          // Current time for testing, defaults to Date.now()\n}\n\nfunction DurationDisplay({ startTime, now }: DurationDisplayProps): JSX.Element\n```\n\n## Visual Output\n- \u003c 1 minute: `\u003c 1m`\n- 1-59 minutes: `12m`\n- 60+ minutes: `1h 15m`\n- 24+ hours: `1d 2h`\n\n## Files\n- src/components/DurationDisplay.tsx\n- src/components/DurationDisplay.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows \"\u003c 1m\" for durations under 1 minute\n- [ ] Shows \"Xm\" for minutes (1-59)\n- [ ] Shows \"Xh Ym\" for hours\n- [ ] Shows \"Xd Yh\" for days\n- [ ] Uses Ink `\u003cText dimColor\u003e` for the unit letters (m, h, d)\n- [ ] Handles future startTime (shows \"0m\")\n- [ ] Updates correctly with changing now prop\n- [ ] 7 tests pass\n\n## Tests\n1. Shows \"\u003c 1m\" for 30 seconds\n2. Shows \"1m\" for 60 seconds\n3. Shows \"12m\" for 720 seconds\n4. Shows \"1h 0m\" for 3600 seconds\n5. Shows \"1h 15m\" for 4500 seconds\n6. Shows \"1d 2h\" for 93600 seconds\n7. Handles future startTime (returns \"0m\")","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T12:48:34.393767+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:30:05.679942+03:00","labels":["m12-tui"]}
{"id":"ch-ah6","title":"F02a: State Types - ChorusState interface and SessionStats","description":"## What\nDefine TypeScript types for runtime state.\n\n## Acceptance Criteria\n- [ ] AgentStatus is union: 'idle' | 'running' | 'paused' | 'error'\n- [ ] MergeQueueItemStatus is union: 'pending' | 'merging' | 'conflict' | 'resolving'\n- [ ] AgentState.id is required string\n- [ ] AgentState.type is 'claude' | 'codex' | 'opencode'\n- [ ] AgentState.pid is required number\n- [ ] AgentState.taskId is required string\n- [ ] AgentState.worktree is required string\n- [ ] AgentState.branch is required string\n- [ ] AgentState.iteration is required number\n- [ ] AgentState.startedAt is required number (timestamp)\n- [ ] AgentState.status is AgentStatus\n- [ ] MergeQueueItem.taskId is required string\n- [ ] MergeQueueItem.branch is required string\n- [ ] MergeQueueItem.worktree is required string\n- [ ] MergeQueueItem.priority is required number\n- [ ] MergeQueueItem.status is MergeQueueItemStatus\n- [ ] MergeQueueItem.retries is required number\n- [ ] MergeQueueItem.enqueuedAt is required number (timestamp)\n- [ ] SessionStats has tasksCompleted, tasksFailed, mergesAuto, mergesManual, totalIterations, totalRuntime (all numbers)\n- [ ] ChorusState.version is required string\n- [ ] ChorusState.sessionId is required string\n- [ ] ChorusState.mode is 'semi-auto' | 'autopilot'\n- [ ] ChorusState.paused is required boolean\n- [ ] ChorusState.agents is Record\u003cstring, AgentState\u003e\n- [ ] ChorusState.mergeQueue is MergeQueueItem[]\n- [ ] ChorusState.checkpoint is string | null\n- [ ] ChorusState.stats is SessionStats\n- [ ] 6 tests pass\n\n## Files\n- src/types/state.ts (NEW)\n\n## Implementation\n```typescript\nexport type AgentStatus = 'idle' | 'running' | 'paused' | 'error';\nexport type MergeQueueItemStatus = 'pending' | 'merging' | 'conflict' | 'resolving';\n\nexport interface AgentState {\n  id: string;\n  type: 'claude' | 'codex' | 'opencode';\n  pid: number;\n  taskId: string;\n  worktree: string;\n  branch: string;\n  iteration: number;\n  startedAt: number;\n  status: AgentStatus;\n}\n\nexport interface MergeQueueItem {\n  taskId: string;\n  branch: string;\n  worktree: string;\n  priority: number;\n  status: MergeQueueItemStatus;\n  retries: number;\n  enqueuedAt: number;\n}\n\nexport interface SessionStats {\n  tasksCompleted: number;\n  tasksFailed: number;\n  mergesAuto: number;\n  mergesManual: number;\n  totalIterations: number;\n  totalRuntime: number;\n}\n\nexport interface ChorusState {\n  version: string;\n  sessionId: string;\n  mode: 'semi-auto' | 'autopilot';\n  paused: boolean;\n  agents: Record\u003cstring, AgentState\u003e;\n  mergeQueue: MergeQueueItem[];\n  checkpoint: string | null;\n  stats: SessionStats;\n}\n```\n\n## Test Cases\n1. AgentState accepts object with all required fields and valid AgentStatus\n2. AgentState.type accepts only 'claude' | 'codex' | 'opencode'\n3. MergeQueueItem accepts object with all required fields and valid MergeQueueItemStatus\n4. SessionStats accepts object with all 6 numeric fields\n5. ChorusState accepts complete state with agents={}, mergeQueue=[], checkpoint=null\n6. ChorusState accepts complete state with populated agents and mergeQueue\n\n## Notes\n- All timestamps (startedAt, enqueuedAt) are Unix epoch milliseconds\n- ChorusState.agents uses agent.id as key\n- ChorusState.checkpoint is null when no checkpoint exists","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:30:38.527356+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:23:17.794583+03:00","labels":["m1-infrastructure"]}
{"id":"ch-ahq","title":"F43a: Intervention Types - Intervention interfaces and enums","description":"## What\nDefine TypeScript interfaces for human intervention system.\n\n## API\n```typescript\n// src/types/intervention.ts\n\ntype InterventionType = \n  | 'pause'\n  | 'stop_agent'\n  | 'redirect_agent'\n  | 'edit_task'\n  | 'kill_all'\n  | 'rollback'\n  | 'block_task'\n  | 'approve_merge';\n\ninterface InterventionState {\n  paused: boolean;\n  pausedAt: Date | null;\n  pendingInterventions: Intervention[];\n}\n\ninterface Intervention {\n  type: InterventionType;\n  targetAgentId?: string;\n  targetTaskId?: string;\n  timestamp: Date;\n  reason?: string;\n}\n\ninterface InterventionResult {\n  success: boolean;\n  type: InterventionType;\n  message: string;\n  affectedAgents?: string[];\n  affectedTasks?: string[];\n}\n```\n\n## Files\n- src/types/intervention.ts\n\n## Acceptance Criteria\n- [ ] `InterventionType` is union of all 8 intervention types\n- [ ] `InterventionState` has paused, pausedAt, pendingInterventions\n- [ ] `Intervention` has type, optional targets, timestamp, reason\n- [ ] `InterventionResult` has success, type, message, affected lists\n- [ ] 5 tests pass\n\n## Tests\n1. InterventionType union includes all types\n2. InterventionState has required fields\n3. Intervention has required and optional fields\n4. InterventionResult has required fields\n5. Types are exported correctly","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T10:43:19.149013+03:00","created_by":"deligoez","updated_at":"2026-01-10T10:43:19.149013+03:00","labels":["m9-intervention"]}
{"id":"ch-akb","title":"F63a: Tab Panel Switch - Switch focus between TaskPanel and AgentGrid","description":"## What\nKeyboard handler for Tab key to switch focus between TaskPanel (left) and AgentGrid (right).\n\n## Shortcut\n- **Tab** - Switch focus between panels\n\n## Implementation\n```typescript\n// src/hooks/useKeyboard.ts - uses ink's useInput\nimport { useInput } from 'ink';\n\nexport function useKeyboard(options: UseKeyboardOptions) {\n  useInput((input, key) =\u003e {\n    if (key.tab) {\n      options.onPanelSwitch?.();\n    }\n  });\n}\n\ninterface UseKeyboardOptions {\n  onPanelSwitch?: () =\u003e void;\n  // ... other options\n}\n```\n\n```typescript\n// Usage in TwoColumnLayout.tsx\nconst [focusedPanel, setFocusedPanel] = useState\u003c'left' | 'right'\u003e('left');\n\nuseKeyboard({\n  onPanelSwitch: () =\u003e setFocusedPanel(p =\u003e p === 'left' ? 'right' : 'left')\n});\n```\n\n## Behavior\n- Tab toggles focus between left (TaskPanel) and right (AgentGrid)\n- Focused panel has highlighted border (borderColor: 'cyan' vs 'gray')\n- Keyboard navigation (j/k) applies to focused panel\n\n## Files\n- src/hooks/useKeyboard.ts (UPDATE)\n- src/hooks/useKeyboard.test.ts (UPDATE)\n- src/components/TwoColumnLayout.tsx (UPDATE for focus styling)\n\n## Acceptance Criteria\n- [ ] `useInput` detects `key.tab` and calls `onPanelSwitch()`\n- [ ] Focus state toggles between 'left' and 'right'\n- [ ] Focused panel border is cyan, unfocused is gray\n- [ ] 3 tests pass\n\n## Tests\n1. Tab key calls onPanelSwitch callback\n2. Focus state toggles left-\u003eright-\u003eleft\n3. Focused panel renders with cyan border","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T21:52:36.187319+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:30:07.072496+03:00","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-akb","depends_on_id":"ch-73t","type":"blocks","created_at":"2026-01-10T21:52:41.338248+03:00","created_by":"deligoez"}]}
{"id":"ch-amw","title":"F57a: HeaderBar Component - Full header with all elements","description":"## What\nComplete header bar composing title, version, ModeIndicator, AgentSlotsCounter, and help hint.\n\n## Migration Note\n**This component replaces the top portion of existing StatusBar.tsx**\n- Existing: StatusBar shows \"Chorus\" + counts + quit hint\n- New: HeaderBar shows version, mode, slots, help hint\n- After implementing HeaderBar, update Layout.tsx to use HeaderBar instead of StatusBar\n\n## Context from Master Plan\n```\n┌───────────────────────────────────────────────────────────────────────────┐\n│ CHORUS v2.0                      semi-auto ● 3/50              ? for help │\n└───────────────────────────────────────────────────────────────────────────┘\n```\n\n## API\n```typescript\n// src/components/HeaderBar.tsx\n\ninterface HeaderBarProps {\n  version?: string;         // e.g., \"2.0\"\n  mode: 'semi-auto' | 'autopilot';\n  runningAgents: number;\n  maxAgents: number;\n  showHelp?: boolean;       // default true\n}\n\nfunction HeaderBar({ version, mode, runningAgents, maxAgents, showHelp = true }: HeaderBarProps): JSX.Element\n```\n\n## Visual Layout\n```\nCHORUS v2.0                      semi-auto ● 3/50              ? for help\n[title] [version]                [ModeIndicator] [AgentSlotsCounter]        [help hint]\n```\n\n## Color Specs (Ink)\n- \"CHORUS\" title: bold, color=\"cyan\"\n- Version: color=\"gray\"\n- Help hint \"? for help\": dimColor\n\n## Files\n- src/components/HeaderBar.tsx\n- src/components/HeaderBar.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows \"CHORUS\" title in bold cyan (bold, color=\"cyan\")\n- [ ] Shows version (e.g., \"v2.0\") in gray when provided\n- [ ] Renders ModeIndicator with mode prop\n- [ ] Renders AgentSlotsCounter with runningAgents and maxAgents props\n- [ ] Shows \"? for help\" hint with dimColor when showHelp=true\n- [ ] Uses flexbox with justifyContent=\"space-between\"\n- [ ] Title on left, mode/slots in center, help on right\n- [ ] Handles missing version (shows only \"CHORUS\")\n- [ ] Hides help hint when showHelp=false\n- [ ] Passes correct props to child components\n- [ ] 10 tests pass\n\n## Tests\n1. Shows \"CHORUS\" title in bold cyan\n2. Shows version in gray when provided\n3. Hides version when not provided\n4. Renders ModeIndicator with correct mode\n5. Renders AgentSlotsCounter with correct counts\n6. Shows help hint with dimColor\n7. Hides help hint when showHelp=false\n8. Uses space-between layout\n9. Passes correct props to ModeIndicator\n10. Passes correct props to AgentSlotsCounter","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T12:48:59.83796+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:30:25.152084+03:00","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-amw","depends_on_id":"ch-mnd","type":"blocks","created_at":"2026-01-10T12:48:59.840343+03:00","created_by":"deligoez"},{"issue_id":"ch-amw","depends_on_id":"ch-3na","type":"blocks","created_at":"2026-01-10T12:48:59.842325+03:00","created_by":"deligoez"}]}
{"id":"ch-b5x","title":"F52: Hook Types - Hook event and handler interfaces","description":"## What\nDefine TypeScript interfaces for the Chorus hooks system.\n\n## API\n```typescript\n// src/types/hooks.ts\n\ntype HookEvent = \n  | 'pre-agent-start'\n  | 'post-agent-start'\n  | 'pre-task-claim'\n  | 'post-task-claim'\n  | 'pre-iteration'\n  | 'post-iteration'\n  | 'pre-task-complete'\n  | 'post-task-complete'\n  | 'pre-merge'\n  | 'post-merge'\n  | 'on-agent-error'\n  | 'on-agent-timeout'\n  | 'on-conflict';\n\ninterface HookInput {\n  event: HookEvent;\n  agent?: {\n    id: string;\n    type: AgentType;\n    worktree: string;\n  };\n  task?: {\n    id: string;\n    title: string;\n    status: string;\n  };\n  iteration?: {\n    number: number;\n    maxIterations: number;\n  };\n  output?: {\n    stdout: string;\n    exitCode: number;\n  };\n}\n\ninterface HookOutput {\n  result: 'continue' | 'block' | 'complete';\n  message?: string;\n}\n\ninterface HookHandler {\n  event: HookEvent;\n  command: string;\n  timeout?: number;\n}\n```\n\n## Files\n- src/types/hooks.ts\n\n## Acceptance Criteria\n- [ ] `HookEvent` is union of all 13 event types\n- [ ] `HookInput` has event, optional agent/task/iteration/output\n- [ ] `HookOutput` has result and optional message\n- [ ] `HookHandler` has event, command, optional timeout\n- [ ] Result type is union of continue/block/complete\n- [ ] 5 tests pass\n\n## Tests\n1. HookEvent union includes all events\n2. HookInput has required and optional fields\n3. HookOutput has required fields\n4. HookHandler has required fields\n5. Types are exported correctly","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T10:45:17.738244+03:00","created_by":"deligoez","updated_at":"2026-01-10T10:45:17.738244+03:00","labels":["m11-hooks"]}
{"id":"ch-c2p","title":"F59e: AgentTile Composed - Complete agent tile component","description":"## What\nComplete AgentTile composing header, progress, and output sections.\n\n## Context from Master Plan\n```\n┌───────────────────┐\n│ CLAUDE (ch-001)   │\n│ iter 7/50 | 12m   │\n│ ▓▓▓▓░░░░░░ 35%    │\n│                   │\n│ Reading auth...   │\n│ $ npm test        │\n│ ✓ 47 tests passed │\n└───────────────────┘\n```\n\n## API\n```typescript\n// src/components/AgentTile.tsx\n\ninterface AgentTileProps {\n  agent: {\n    id: string;\n    type: 'claude' | 'codex' | 'opencode';\n    taskId: string;\n    status: 'running' | 'idle' | 'paused' | 'error';\n    iteration: number;\n    maxIterations: number;\n    startTime: number;\n    statusText?: string;\n    lastCommand?: string;\n    testResult?: { passed: number; failed: number; };\n  };\n  isSelected?: boolean;\n  width?: number;\n}\n\nfunction AgentTile({ agent, isSelected = false, width }: AgentTileProps): JSX.Element\n```\n\n## Border Specs (Ink)\n- Default: borderStyle=\"single\", borderColor=\"gray\"\n- Selected: borderStyle=\"double\", borderColor=\"cyan\"\n- Error status: borderColor=\"red\" (regardless of selected)\n\n## Files\n- src/components/AgentTile.tsx\n- src/components/AgentTile.test.tsx\n\n## Acceptance Criteria\n- [ ] Composes AgentTileHeader with agent.type, agent.taskId, agent.status\n- [ ] Composes AgentTileProgress with iteration, maxIterations, startTime\n- [ ] Composes AgentTileOutput with statusText, lastCommand, testResult\n- [ ] Has single gray border by default (borderStyle=\"single\", borderColor=\"gray\")\n- [ ] Has double cyan border when selected (borderStyle=\"double\", borderColor=\"cyan\")\n- [ ] Shows \"starting...\" when iteration=0 (passed to AgentTileOutput.statusText)\n- [ ] Has red border when status='error' (borderColor=\"red\")\n- [ ] Respects width prop for box sizing\n- [ ] Passes correct props to child components\n- [ ] 9 tests pass\n\n## Tests\n1. Renders AgentTileHeader with correct props\n2. Renders AgentTileProgress with correct props\n3. Renders AgentTileOutput with correct props\n4. Has single gray border by default\n5. Has double cyan border when selected\n6. Shows \"starting...\" when iteration=0\n7. Has red border when status='error'\n8. Handles missing optional fields (statusText, lastCommand, testResult)\n9. Respects width prop","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T12:49:58.609321+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:30:23.461682+03:00","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-c2p","depends_on_id":"ch-j0z","type":"blocks","created_at":"2026-01-10T12:49:58.611565+03:00","created_by":"deligoez"},{"issue_id":"ch-c2p","depends_on_id":"ch-7ki","type":"blocks","created_at":"2026-01-10T12:50:18.171974+03:00","created_by":"deligoez"},{"issue_id":"ch-c2p","depends_on_id":"ch-49w","type":"blocks","created_at":"2026-01-10T12:50:18.263337+03:00","created_by":"deligoez"}]}
{"id":"ch-c8j","title":"F49: Iteration Rollback - Undo last N agent iterations","description":"## What\nRollback last N iterations of an agent's work (Level 1 rollback).\n\n## Key Definition: What is an \"Iteration\"?\n\nAn **iteration** = one complete agent run (spawn → completion/retry).\n\n**Iteration tracking:**\n- Each commit by agent MUST have `[ch-xxx]` suffix (enforced by F07, F04)\n- Iterations are numbered in state (F02c tracks iteration count per agent)\n- findIterationCommits() uses `git log --grep=\"[ch-xxx]\"` to find commits\n\n**Example:**\n```\nIteration 1: 3 commits [ch-abc]\nIteration 2: 2 commits [ch-abc] (retry)\nIteration 3: 1 commit [ch-abc] (success)\n```\n\n`rollback(worktree, 1)` undoes the last iteration's commits (1 commit in this case).\n\n## API\n```typescript\n// src/services/IterationRollback.ts\n\nclass IterationRollback {\n  /**\n   * Undo last N iterations for an agent\n   * Finds commits with [taskId] marker, groups by iteration\n   * Uses git reset --soft to undo commits\n   * @param worktreePath Path to agent's worktree\n   * @param taskId Task ID to identify commits (e.g., \"ch-abc\")\n   * @param iterations Number of iterations to undo (default: 1)\n   */\n  async rollback(\n    worktreePath: string,\n    taskId: string,\n    iterations?: number\n  ): Promise\u003cRollbackResult\u003e\n\n  /**\n   * Count commits for specific task in worktree\n   * Uses `git log --grep=\"[taskId]\" --oneline | wc -l`\n   */\n  async getTaskCommitCount(worktreePath: string, taskId: string): Promise\u003cnumber\u003e\n\n  /**\n   * Find commits belonging to a task\n   * Uses `git log --grep=\"[taskId]\" --format=%H`\n   * Returns commit hashes in reverse chronological order\n   */\n  async findTaskCommits(worktreePath: string, taskId: string): Promise\u003cstring[]\u003e\n\n  /**\n   * Get commits from specific iteration\n   * Requires iteration boundaries from state (checkpoint times)\n   */\n  async findIterationCommits(\n    worktreePath: string,\n    taskId: string,\n    iterationNumber: number\n  ): Promise\u003cstring[]\u003e\n}\n```\n\n## Files\n- src/services/IterationRollback.ts\n- tests/services/IterationRollback.test.ts\n\n## Acceptance Criteria\n- [ ] `rollback()` finds commits with `[taskId]` marker in message\n- [ ] `rollback()` runs `git reset --soft` to undo commits\n- [ ] `rollback()` returns RollbackResult with reverted commit hashes\n- [ ] `rollback()` fails gracefully if no commits found\n- [ ] `getTaskCommitCount()` counts commits with task marker\n- [ ] `findTaskCommits()` returns hashes in reverse chronological order\n- [ ] `findIterationCommits()` uses checkpoint timestamps to identify iteration boundaries\n- [ ] 7 tests pass\n\n## Tests\n1. rollback() finds commits by task ID marker\n2. rollback() resets correct commits\n3. rollback() returns reverted commit hashes\n4. rollback() handles no matching commits\n5. getTaskCommitCount() counts correctly\n6. findTaskCommits() returns chronological order\n7. findIterationCommits() respects iteration boundaries\n\n## Notes\n- Commit message format: `\u003ctype\u003e: \u003cdescription\u003e [ch-xxx]`\n- Iteration boundaries determined by checkpoint timestamps (F48)\n- Worktree context: all operations happen in agent's worktree, not main repo","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T10:44:38.327782+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:21:18.805758+03:00","labels":["m10-rollback"],"dependencies":[{"issue_id":"ch-c8j","depends_on_id":"ch-2r5","type":"blocks","created_at":"2026-01-10T10:44:38.329783+03:00","created_by":"deligoez"}]}
{"id":"ch-cg0","title":"F02c: State Agent Ops - Add/update/remove agents","description":"## What\nManage agent entries in ChorusState.agents with CRUD operations and iteration tracking.\n\n## Acceptance Criteria\n\n### CRUD Operations - 4 tests\n- [ ] `addAgent(agent)` adds AgentState to state.agents\n- [ ] `updateAgent(id, partial)` modifies existing agent\n- [ ] `removeAgent(id)` deletes agent from state\n- [ ] `getAgent(id)` returns agent or undefined\n\n### Iteration Management - 2 tests\n- [ ] `incrementIteration(id)` increments agent.iteration\n- [ ] `incrementIteration(id)` returns new iteration count\n\n### Status Updates - 2 tests\n- [ ] `setStatus(id, status)` updates agent.status\n- [ ] `getRunningAgents()` returns agents with status='running'\n\n### Summary\n- [ ] 8 tests pass\n\n## Files\n- src/services/StateService.ts (UPDATE - add agent methods)\n- tests/services/StateService.test.ts (UPDATE)\n\n## API\n```typescript\nclass StateService {\n  // Agent operations\n  addAgent(agent: AgentState): void;\n  updateAgent(id: string, partial: Partial\u003cAgentState\u003e): void;\n  removeAgent(id: string): void;\n  getAgent(id: string): AgentState | undefined;\n  \n  // Iteration\n  incrementIteration(id: string): number;\n  \n  // Status\n  setStatus(id: string, status: AgentStatus): void;\n  getRunningAgents(): AgentState[];\n}\n```","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:30:50.982849+03:00","created_by":"deligoez","updated_at":"2026-01-10T11:34:08.565188+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-cg0","depends_on_id":"ch-ah6","type":"blocks","created_at":"2026-01-10T01:30:50.984583+03:00","created_by":"deligoez"},{"issue_id":"ch-cg0","depends_on_id":"ch-81x","type":"blocks","created_at":"2026-01-10T01:37:13.386589+03:00","created_by":"deligoez"}]}
{"id":"ch-cwy","title":"F44: Agent Stop - Kill agent and stash worktree changes","description":"## What\nStop a specific agent, stash its worktree changes, return task to pending.\n\n## API\n\\`\\`\\`typescript\n// src/services/AgentStopper.ts\n\nclass AgentStopper {\n  constructor(\n    private slotManager: SlotManager,\n    private beadsCLI: BeadsCLI\n  ) {}\n\n  /**\n   * Stop specific agent by ID\n   * - Kill agent process\n   * - Stash worktree changes (git stash in worktree dir)\n   * - Return task to pending via beadsCLI.releaseTask()\n   */\n  async stopAgent(agentId: string): Promise\u003cInterventionResult\u003e\n\n  /**\n   * Stop agent working on a specific task\n   * - Find agent via slotManager.getAgentForTask()\n   * - If found, call stopAgent()\n   * - Returns null if no agent working on task\n   */\n  async stopAgentByTask(taskId: string): Promise\u003cInterventionResult | null\u003e\n\n  /**\n   * Get agent working on a task (if any)\n   */\n  getAgentForTask(taskId: string): AgentSlot | null\n\n  /**\n   * Stop all agents (emergency - KILL ALL Ctrl+C)\n   * - Kill all agent processes\n   * - Stash all worktree changes\n   * - All tasks to pending\n   * - Worktrees preserved (not deleted)\n   */\n  async stopAll(): Promise\u003cInterventionResult\u003e\n\n  /**\n   * Stash changes in agent's worktree\n   * Uses git stash in the worktree directory\n   */\n  async stashWorktreeChanges(worktreePath: string): Promise\u003cvoid\u003e\n}\n\\`\\`\\`\n\n## Files\n- src/services/AgentStopper.ts\n- tests/services/AgentStopper.test.ts\n\n## Acceptance Criteria\n- [ ] \\`stopAgent()\\` kills the agent process (process.kill or SIGTERM)\n- [ ] \\`stopAgent()\\` stashes uncommitted changes via git stash\n- [ ] \\`stopAgent()\\` calls beadsCLI.releaseTask() to return task to pending\n- [ ] \\`stopAgent()\\` releases the slot in SlotManager\n- [ ] \\`stopAgent()\\` returns error if agent not found\n- [ ] \\`stopAgentByTask()\\` returns null if no agent on task\n- [ ] \\`stopAgentByTask()\\` calls stopAgent() if agent found\n- [ ] \\`getAgentForTask()\\` queries SlotManager correctly\n- [ ] \\`stopAll()\\` stops all running agents\n- [ ] \\`stopAll()\\` returns affected agents count in result\n- [ ] \\`stashWorktreeChanges()\\` runs git stash in worktree directory\n- [ ] \\`stashWorktreeChanges()\\` handles no changes gracefully\n- [ ] 12 tests pass\n\n## Tests\n1. stopAgent() kills process\n2. stopAgent() stashes changes\n3. stopAgent() calls releaseTask()\n4. stopAgent() releases slot\n5. stopAgent() errors for unknown agent\n6. stopAgentByTask() returns null when no agent\n7. stopAgentByTask() stops agent when found\n8. getAgentForTask() returns slot when found\n9. getAgentForTask() returns null when not found\n10. stopAll() stops all agents\n11. stashWorktreeChanges() creates stash\n12. stashWorktreeChanges() handles no changes","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T10:43:39.672942+03:00","created_by":"deligoez","updated_at":"2026-01-10T12:16:14.895234+03:00","labels":["m9-intervention"],"dependencies":[{"issue_id":"ch-cwy","depends_on_id":"ch-ahq","type":"blocks","created_at":"2026-01-10T10:43:39.674465+03:00","created_by":"deligoez"},{"issue_id":"ch-cwy","depends_on_id":"ch-i9i","type":"blocks","created_at":"2026-01-10T10:43:39.675677+03:00","created_by":"deligoez"},{"issue_id":"ch-cwy","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-10T12:14:12.921751+03:00","created_by":"deligoez"}]}
{"id":"ch-ddk","title":"F45: Agent Redirect - Reassign agent to different task","description":"## What\nRedirect a running agent to work on a different task.\n\n**IMPORTANT:** All Beads access via BeadsCLI. Never call bd directly.\n\n## Context from Master Plan\n```\n3. REDIRECT AGENT (r)\n   - Assign current agent to different task\n   - Current task goes back to pending\n   - Useful when agent stuck on wrong approach\n```\n\n## API\n```typescript\n// src/services/AgentRedirector.ts\n\nclass AgentRedirector {\n  constructor(\n    private agentStopper: AgentStopper,\n    private beadsCLI: BeadsCLI,\n    private orchestrator: Orchestrator\n  ) {}\n\n  /**\n   * Redirect agent to new task\n   * - Stop current work via AgentStopper (stash changes, release task)\n   * - Claim new task via BeadsCLI.claimTask()\n   * - Restart agent with new task via Orchestrator.spawnAgentForTask()\n   * @returns InterventionResult with old and new task IDs\n   * @throws If validation fails or any step fails\n   */\n  async redirect(agentId: string, newTaskId: string): Promise\u003cInterventionResult\u003e\n\n  /**\n   * Validate redirect is possible\n   * Checks:\n   * 1. Agent exists and is running (via SlotManager through AgentStopper)\n   * 2. New task status is \"open\" (not \"in_progress\" or \"closed\")\n   * 3. New task has no unsatisfied blocking dependencies\n   * 4. New task does NOT have \"deferred\" label\n   */\n  async canRedirect(agentId: string, newTaskId: string): Promise\u003cboolean\u003e\n}\n```\n\n## InterventionResult Interface\n```typescript\ninterface InterventionResult {\n  success: boolean;\n  action: \"redirect\";\n  affectedTasks: {\n    released: string;   // Old task ID returned to pending\n    claimed: string;    // New task ID now assigned to agent\n  };\n  agentId: string;\n  timestamp: Date;\n}\n```\n\n## Files\n- src/services/AgentRedirector.ts\n- src/services/AgentRedirector.test.ts\n\n## Acceptance Criteria\n\n### redirect() - 7 tests\n- [ ] `redirect()` calls agentStopper.stopAgent(agentId) first\n- [ ] `redirect()` calls beadsCLI.getTask(newTaskId) to verify task state\n- [ ] `redirect()` fails with error if task status is not \"open\"\n- [ ] `redirect()` fails with error if task has blocking dependencies\n- [ ] `redirect()` fails with error if task has \"deferred\" label\n- [ ] `redirect()` calls beadsCLI.claimTask(newTaskId) after validation\n- [ ] `redirect()` calls orchestrator.spawnAgentForTask(agentId, newTaskId)\n- [ ] `redirect()` returns InterventionResult with both old and new task IDs\n\n### canRedirect() - 5 tests\n- [ ] `canRedirect()` returns false if agent not found in SlotManager\n- [ ] `canRedirect()` returns false if agent not running (status != \"running\")\n- [ ] `canRedirect()` returns false if task status is \"in_progress\"\n- [ ] `canRedirect()` returns false if task has \"deferred\" label\n- [ ] `canRedirect()` returns true when agent running AND task open AND not deferred\n\n### Summary\n- [ ] 12 tests pass\n\n## Tests\n1. redirect() stops current work via agentStopper\n2. redirect() validates task is open\n3. redirect() fails for in_progress task\n4. redirect() fails for blocked task\n5. redirect() fails for deferred task\n6. redirect() claims new task after validation\n7. redirect() spawns agent for new task\n8. redirect() returns InterventionResult with both task IDs\n9. canRedirect() returns false for unknown agent\n10. canRedirect() returns false for non-running agent\n11. canRedirect() returns false for deferred task\n12. canRedirect() returns true for valid redirect\n\n## Notes\n- **Deferred check is explicit in both redirect() and canRedirect()**\n- **All Beads operations via BeadsCLI dependency injection**\n- **AgentStopper handles stashing changes and releasing old task**","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T10:43:50.867286+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:27:58.38743+03:00","labels":["m9-intervention"],"dependencies":[{"issue_id":"ch-ddk","depends_on_id":"ch-cwy","type":"blocks","created_at":"2026-01-10T10:43:50.868803+03:00","created_by":"deligoez"},{"issue_id":"ch-ddk","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-10T10:43:50.869973+03:00","created_by":"deligoez"},{"issue_id":"ch-ddk","depends_on_id":"ch-0e7","type":"blocks","created_at":"2026-01-10T12:08:31.917833+03:00","created_by":"deligoez"}]}
{"id":"ch-dff","title":"F63j: Task Failed Status Indicator","description":"## What\nAdd `failed` status to BeadStatus type and TaskPanel indicator.\n\n## Why\nMaster plan specifies `✗ failed` indicator for tasks needing attention, but current implementation only has `tombstone`.\n\n## Acceptance Criteria\n- [ ] `BeadStatus` type includes `'failed'`\n- [ ] TaskPanel shows `✗` for failed tasks (red color)\n- [ ] Failed status distinct from blocked (`⊗`)\n- [ ] 3 tests pass\n\n## Tests (src/components/TaskPanel.test.tsx)\n1. `shows ✗ for failed tasks`\n2. `failed indicator is red colored`\n3. `failed status is distinct from blocked`\n\n## Files\n- src/types/bead.ts (add 'failed' to BeadStatus)\n- src/components/TaskPanel.tsx (add failed indicator)\n- src/components/TaskPanel.test.tsx (add tests)\n\n## Notes\n- `tombstone` may remain for soft-deleted tasks\n- `failed` = task attempted but needs attention","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T22:17:33.495969+03:00","created_by":"deligoez","updated_at":"2026-01-10T22:17:33.495969+03:00","labels":["m12-tui"]}
{"id":"ch-di6","title":"F46c: Intervention Panel - TUI modal for intervention actions","description":"## What\nTUI modal component that displays active agents and provides keybindings for intervention actions.\n\n## Context from Master Plan\n```\n┌─────────────────────────────────────────────────────────────────┐\n│              INTERVENTION DIALOG (Press 'i')                     │\n├─────────────────────────────────────────────────────────────────┤\n│                                                                  │\n│ Active Agents:                                                   │\n│   1. claude (bd-001) - iter 7/50 - running 12m                   │\n│   2. codex (bd-002) - iter 3/50 - running 5m                     │\n│                                                                  │\n│ Actions:                                                         │\n│   [p] Pause all      - Stop after current iterations             │\n│   [1] Focus claude   - View full output                          │\n│   [2] Focus codex    - View full output                          │\n│   [x] Stop agent     - Select which to stop                      │\n│   [r] Redirect       - Assign to different task                  │\n│   [e] Edit task      - Modify task and restart agent             │\n│   [b] Block task     - Mark task as blocked                      │\n│   [ESC] Close        - Return to main view                       │\n│                                                                  │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n## Mode Switching Flow\nThe panel uses internal modes for multi-step actions:\n\n```\n┌─────────────────────────────────────────────────────────────────┐\n│ Mode: 'main' (default)                                          │\n│   [p] → togglePause() → stays in 'main'                         │\n│   [1-9] → onFocusAgent(agentId) → closes panel                  │\n│   [x] → mode = 'stop-select'                                    │\n│   [r] → mode = 'redirect-select'                                │\n│   [e] → mode = 'edit-select'                                    │\n│   [b] → mode = 'block-select'                                   │\n│   [ESC] → onClose()                                             │\n├─────────────────────────────────────────────────────────────────┤\n│ Mode: 'stop-select'                                             │\n│   Shows: \"Select agent to stop: [1] claude [2] codex\"           │\n│   [1-9] → agentStopper.stopAgent(agentId) → mode = 'main'       │\n│   [ESC] → mode = 'main'                                         │\n├─────────────────────────────────────────────────────────────────┤\n│ Mode: 'redirect-select'                                         │\n│   Shows: \"Select agent to redirect: [1] claude [2] codex\"       │\n│   [1-9] → mode = 'redirect-task'                                │\n│   [ESC] → mode = 'main'                                         │\n├─────────────────────────────────────────────────────────────────┤\n│ Mode: 'redirect-task'                                           │\n│   Shows: \"Enter task ID: [input field]\"                         │\n│   [Enter] → agentRedirector.redirect(agentId, taskId)           │\n│   [ESC] → mode = 'main'                                         │\n├─────────────────────────────────────────────────────────────────┤\n│ Mode: 'edit-select'                                             │\n│   Shows: \"Select task to edit: [1] bd-001 [2] bd-002\"           │\n│   [1-9] → spawns `bd edit \u003ctaskId\u003e` → waits → taskEditor.notify │\n│   [ESC] → mode = 'main'                                         │\n├─────────────────────────────────────────────────────────────────┤\n│ Mode: 'block-select'                                            │\n│   Shows: \"Select task to block: [1] bd-001 [2] bd-002\"          │\n│   [1-9] → taskBlocker.blockTask(taskId) → mode = 'main'         │\n│   [ESC] → mode = 'main'                                         │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n## API\n```typescript\n// src/components/InterventionPanel.tsx\n\ntype PanelMode = \n  | 'main' \n  | 'stop-select' \n  | 'redirect-select' \n  | 'redirect-task' \n  | 'edit-select' \n  | 'block-select';\n\ninterface InterventionPanelProps {\n  visible: boolean;\n  onClose: () =\u003e void;\n  onFocusAgent?: (agentId: string) =\u003e void;\n}\n\nfunction InterventionPanel({ visible, onClose, onFocusAgent }: InterventionPanelProps): JSX.Element | null\n\n// Internal state:\n// - mode: PanelMode (starts at 'main')\n// - selectedAgentId: string | null (for multi-step actions)\n// - Gets agent list from OrchestrationStore (F19)\n// - Gets pause state from PauseHandler\n```\n\n## Keyboard Shortcut Integration\nThis panel uses its OWN keybindings when visible.\nParent component (App) must pass `visible` prop to disable global shortcuts.\nUses ink's useInput hook with `isActive: visible`.\n\n## Files\n- src/components/InterventionPanel.tsx\n- tests/components/InterventionPanel.test.tsx\n\n## Acceptance Criteria\n- [ ] Panel renders when `visible=true`, returns null when false\n- [ ] Gets active agents from OrchestrationStore via useStore()\n- [ ] Displays agent list with: type, taskId, iteration, duration\n- [ ] Shows action keybindings with descriptions in 'main' mode\n- [ ] 'p' key toggles pause via PauseHandler.togglePause()\n- [ ] Number keys (1-9) call onFocusAgent with correct agentId in 'main' mode\n- [ ] 'x' key transitions to 'stop-select' mode\n- [ ] 'r' key transitions to 'redirect-select' mode\n- [ ] 'e' key transitions to 'edit-select' mode\n- [ ] 'b' key transitions to 'block-select' mode\n- [ ] ESC in 'main' mode calls onClose()\n- [ ] ESC in sub-modes returns to 'main' mode\n- [ ] 'stop-select' mode shows agent selection prompt\n- [ ] Number key in 'stop-select' calls agentStopper.stopAgent()\n- [ ] 'edit-select' mode spawns `bd edit \u003ctaskId\u003e` subprocess\n- [ ] After bd edit closes, calls taskEditor.notifyTaskEdited()\n- [ ] Panel styled as modal overlay (Box with borderStyle='round')\n- [ ] useInput hook uses `isActive: visible` to scope keybindings\n- [ ] 18 tests pass\n\n## Tests\n1. Panel returns null when visible=false\n2. Panel renders agent list when visible=true\n3. Panel shows agent type and taskId\n4. Panel shows iteration count (e.g., \"iter 7/50\")\n5. Panel shows running duration (e.g., \"12m\")\n6. 'p' key calls PauseHandler.togglePause()\n7. Number key in main mode calls onFocusAgent\n8. 'x' key sets mode to 'stop-select'\n9. 'r' key sets mode to 'redirect-select'\n10. 'e' key sets mode to 'edit-select'\n11. 'b' key sets mode to 'block-select'\n12. ESC in main mode calls onClose\n13. ESC in sub-mode returns to main mode\n14. stop-select shows agent selection UI\n15. Number in stop-select calls agentStopper.stopAgent()\n16. edit-select spawns bd edit subprocess\n17. After bd edit, calls taskEditor.notifyTaskEdited()\n18. useInput receives isActive: visible\n\n## Deferred\n- Rollback ('R') key - integrate when M10 is available","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T12:07:58.830452+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:27:22.153629+03:00","labels":["m9-intervention"],"dependencies":[{"issue_id":"ch-di6","depends_on_id":"ch-ahq","type":"blocks","created_at":"2026-01-10T12:07:58.832997+03:00","created_by":"deligoez"},{"issue_id":"ch-di6","depends_on_id":"ch-fna","type":"blocks","created_at":"2026-01-10T12:07:58.834828+03:00","created_by":"deligoez"},{"issue_id":"ch-di6","depends_on_id":"ch-cwy","type":"blocks","created_at":"2026-01-10T12:07:58.836384+03:00","created_by":"deligoez"},{"issue_id":"ch-di6","depends_on_id":"ch-ddk","type":"blocks","created_at":"2026-01-10T12:07:58.837878+03:00","created_by":"deligoez"},{"issue_id":"ch-di6","depends_on_id":"ch-sb7","type":"blocks","created_at":"2026-01-10T12:07:58.839363+03:00","created_by":"deligoez"},{"issue_id":"ch-di6","depends_on_id":"ch-xe8","type":"blocks","created_at":"2026-01-10T12:07:58.840874+03:00","created_by":"deligoez"},{"issue_id":"ch-di6","depends_on_id":"ch-8j3","type":"blocks","created_at":"2026-01-10T12:18:20.719693+03:00","created_by":"deligoez"}]}
{"id":"ch-dzz","title":"F13: Task Closer - Mark tasks as closed via bd CLI","description":"## What\nClose completed tasks and manage task status via bd CLI (extends BeadsCLI from F12).\n\n## Acceptance Criteria\n- [ ] `closeTask(id, comment?)` runs `bd close \u003cid\u003e`\n- [ ] `closeTask()` supports optional comment via `--comment`\n- [ ] `closeTask()` throws on bd error\n- [ ] `reopenTask(id)` changes status back to open\n- [ ] `getTaskStatus(id)` returns current status string\n- [ ] `getTaskStatus(id)` returns null for invalid task\n- [ ] `getInProgressTasks()` returns array of in_progress tasks\n- [ ] `getClosedTasks()` returns array of closed tasks\n- [ ] 8 tests pass\n\n## Files\n- src/services/BeadsCLI.ts (UPDATE - add methods)\n- tests/services/BeadsCLI.test.ts (UPDATE - add tests)\n\n## Plan\nSee: thoughts/shared/plans/features/F13-task-closer.md\n\n## Notes\n- Extends BeadsCLI from F12\n- Use `bd close` (not `bd update --status=closed`)\n- reopenTask for false completion recovery\n- Use --json flag for structured output","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:39:07.662362+03:00","created_by":"deligoez","updated_at":"2026-01-10T02:52:17.529067+03:00","labels":["m3-task-mgmt"],"dependencies":[{"issue_id":"ch-dzz","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-10T01:39:40.054514+03:00","created_by":"deligoez"}]}
{"id":"ch-e7f","title":"F18b: TaskPanel Selection UI - Visual selection in TUI","description":"## What\nUpdate TaskPanel to show selection highlight, Enter key assignment, status icons.\n\n## Acceptance Criteria\n\n### Visual Selection\n- [ ] Selected task has blue background highlight\n- [ ] Arrow indicator (◀) shown on selected task\n- [ ] Shows \"Press Enter to assign\" when canAssign is true\n\n### Keyboard Handling\n- [ ] Up arrow calls selectPrevious\n- [ ] Down arrow calls selectNext\n- [ ] Enter key triggers assignSelected when canAssign\n\n### Status Display\n- [ ] Shows status icons per task (🔄 for in_progress)\n- [ ] Shows blocker count for blocked tasks\n- [ ] Shows ready/blocked counts in footer\n\n### Components\n- [ ] TaskRow component with highlight + status\n- [ ] getStatusColor() helper function\n- [ ] getStatusIcon() helper function\n\n### Summary\n- [ ] 4 tests pass\n\n## Files\n- src/components/TaskPanel.tsx (UPDATE)\n- src/components/TaskRow.tsx (NEW)\n- tests/components/TaskPanel.test.tsx (UPDATE)\n\n## Plan\nSee: thoughts/shared/plans/features/F18-task-selection-ui.md\n\n## Notes\n- Uses useInput from Ink for keyboard\n- Selection state from useTaskSelection hook","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T02:07:21.76659+03:00","created_by":"deligoez","updated_at":"2026-01-10T03:02:09.43101+03:00","labels":["m4-orchestration"],"dependencies":[{"issue_id":"ch-e7f","depends_on_id":"ch-9fq","type":"blocks","created_at":"2026-01-10T02:07:21.768899+03:00","created_by":"deligoez"}]}
{"id":"ch-eyd","title":"F42: Learning Injector - Inject relevant learnings into prompts","description":"## What\nInject relevant learnings into agent prompts (for non-Claude agents).\n\n## API\n```typescript\n// src/services/LearningInjector.ts\n\nclass LearningInjector {\n  constructor(private learningStore: LearningStore) {}\n\n  /**\n   * Get relevant learnings for a task based on labels/keywords\n   * @param task Task to find relevant learnings for\n   * @param limit Max number of learnings to include\n   * @returns Formatted markdown string of relevant learnings\n   */\n  async getRelevantLearnings(task: BeadsTask, limit?: number): Promise\u003cstring\u003e\n\n  /**\n   * Build prompt section with learnings\n   * @returns Markdown section \"# Relevant Learnings\\n...\"\n   */\n  async buildLearningsSection(task: BeadsTask): Promise\u003cstring\u003e\n\n  /**\n   * Check if agent needs learnings injected (non-Claude)\n   */\n  needsInjection(agentType: AgentType): boolean\n}\n```\n\n## Files\n- src/services/LearningInjector.ts\n- tests/services/LearningInjector.test.ts\n\n## Acceptance Criteria\n- [ ] `getRelevantLearnings()` returns learnings matching task labels\n- [ ] `getRelevantLearnings()` respects limit parameter\n- [ ] `getRelevantLearnings()` returns empty string if no matches\n- [ ] `buildLearningsSection()` formats as markdown section\n- [ ] `needsInjection()` returns false for 'claude'\n- [ ] `needsInjection()` returns true for 'codex', 'opencode'\n- [ ] 6 tests pass\n\n## Tests\n1. getRelevantLearnings() matches by task labels\n2. getRelevantLearnings() respects limit\n3. getRelevantLearnings() returns empty for no matches\n4. buildLearningsSection() formats correctly\n5. needsInjection() returns false for claude\n6. needsInjection() returns true for other agents","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T10:43:03.709956+03:00","created_by":"deligoez","updated_at":"2026-01-10T10:43:03.709956+03:00","labels":["deferred","m8-memory"],"dependencies":[{"issue_id":"ch-eyd","depends_on_id":"ch-a6h","type":"blocks","created_at":"2026-01-10T10:43:03.711498+03:00","created_by":"deligoez"}]}
{"id":"ch-fe5","title":"F25: Merge Worker","description":"## What\nPerforms git merge operations. Dequeues from MergeQueue and attempts merge.\n\n## Git Mocking Strategy\n\nUses dependency injection with `GitService` interface for testability:\n\n```typescript\ninterface GitService {\n  merge(branch: string): Promise\u003cGitMergeResult\u003e;\n  abortMerge(): Promise\u003cvoid\u003e;\n  getConflictFiles(): Promise\u003cstring[]\u003e;\n}\n\n// Production: uses child_process.exec\nclass RealGitService implements GitService { ... }\n\n// Tests: returns predetermined results\nclass MockGitService implements GitService {\n  private mergeResult: GitMergeResult;\n  setMergeResult(result: GitMergeResult): void;\n  merge(): Promise\u003cGitMergeResult\u003e;\n}\n\n// Constructor injection\nclass MergeWorker {\n  constructor(\n    private queue: MergeQueue,\n    private git: GitService = new RealGitService()\n  ) {}\n}\n```\n\n### Test Setup Pattern\n```typescript\nconst mockGit = new MockGitService();\nconst worker = new MergeWorker(queue, mockGit);\n\n// Test clean merge\nmockGit.setMergeResult({ success: true, merged: true });\n\n// Test conflict\nmockGit.setMergeResult({ \n  success: false, \n  hasConflict: true,\n  conflictFiles: ['src/index.ts'] \n});\n\n// Test git error\nmockGit.setMergeResult({ success: false, error: 'fatal: not a git repository' });\n```\n\n## Acceptance Criteria\n\n### merge() - 6 tests\n- [ ] Returns `{ success: true, merged: true }` when `mockGit` returns clean merge\n- [ ] Returns `{ hasConflict: true }` when `mockGit` indicates conflict\n- [ ] `conflictFiles` contains array from `mockGit.getConflictFiles()`\n- [ ] Emits 'mergeSuccess' event on `success: true`\n- [ ] Emits 'mergeConflict' event on `hasConflict: true`\n- [ ] Emits 'mergeError' event when `mockGit.merge()` throws\n\n### abort() - 2 tests\n- [ ] Calls `mockGit.abortMerge()` once\n- [ ] Sets `isMerging` to false after abort completes\n\n### isMerging() - 1 test\n- [ ] Returns `true` after merge() called, before promise resolves\n\n### Implicit (no dedicated tests)\n- 'mergeStart' event emitted at beginning of merge()\n\n## Files\n- src/services/GitService.ts (interface + RealGitService)\n- src/services/MergeWorker.ts\n- tests/services/MergeWorker.test.ts\n- tests/mocks/MockGitService.ts\n\n## Plan\nSee: thoughts/shared/plans/features/F25-merge-worker.md\n\n**Total: 9 tests**","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T03:16:18.292224+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:25:42.688883+03:00","labels":["m5-merge"],"dependencies":[{"issue_id":"ch-fe5","depends_on_id":"ch-glf","type":"blocks","created_at":"2026-01-10T03:16:18.294889+03:00","created_by":"deligoez"}]}
{"id":"ch-fna","title":"F43b: Pause Handler - Pause and resume orchestration","description":"## What\nHandle pause/resume of orchestration - stop spawning new tasks while allowing current agents to finish.\n\n## API\n```typescript\n// src/services/PauseHandler.ts\n\nclass PauseHandler {\n  constructor(private orchestrator: Orchestrator) {}\n\n  /**\n   * Pause orchestration\n   * - Stop spawning new agents\n   * - Current agents continue to next checkpoint\n   * - Preserve all state\n   */\n  async pause(): Promise\u003cInterventionResult\u003e\n\n  /**\n   * Resume orchestration\n   * - Enable spawning new agents\n   * - Continue from paused state\n   */\n  async resume(): Promise\u003cInterventionResult\u003e\n\n  /**\n   * Check if orchestration is paused\n   */\n  isPaused(): boolean\n\n  /**\n   * Get pause duration if paused\n   */\n  getPauseDuration(): number | null\n}\n```\n\n## Files\n- src/services/PauseHandler.ts\n- tests/services/PauseHandler.test.ts\n\n## Acceptance Criteria\n- [ ] `pause()` sets paused state to true\n- [ ] `pause()` records pausedAt timestamp\n- [ ] `pause()` returns InterventionResult with success=true\n- [ ] `resume()` sets paused state to false\n- [ ] `resume()` clears pausedAt\n- [ ] `isPaused()` returns correct boolean\n- [ ] `getPauseDuration()` returns ms since pause or null\n- [ ] 7 tests pass\n\n## Tests\n1. pause() sets paused to true\n2. pause() records timestamp\n3. pause() is idempotent (double pause OK)\n4. resume() sets paused to false\n5. resume() when not paused returns success\n6. isPaused() returns correct state\n7. getPauseDuration() calculates correctly","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T10:43:29.087701+03:00","created_by":"deligoez","updated_at":"2026-01-10T10:43:29.087701+03:00","labels":["m9-intervention"],"dependencies":[{"issue_id":"ch-fna","depends_on_id":"ch-ahq","type":"blocks","created_at":"2026-01-10T10:43:29.089184+03:00","created_by":"deligoez"},{"issue_id":"ch-fna","depends_on_id":"ch-0e7","type":"blocks","created_at":"2026-01-10T10:43:29.090362+03:00","created_by":"deligoez"}]}
{"id":"ch-g2h","title":"F42b: Learnings Panel - TUI component to view shared learnings","description":"## What\nTUI component to display shared learnings from .agent/learnings.md.\n\n## Keyboard\n- `L` key toggles LearningsPanel overlay\n\n## API\n```typescript\n// src/components/LearningsPanel.tsx\n\ninterface LearningsPanelProps {\n  isVisible: boolean;\n  onClose: () =\u003e void;\n}\n\nfunction LearningsPanel({ isVisible, onClose }: LearningsPanelProps): JSX.Element | null\n\n// Shows:\n// - List of learnings grouped by category\n// - Source attribution (task ID, agent, date)\n// - Category filter/navigation\n```\n\n## Files\n- src/components/LearningsPanel.tsx (NEW)\n- src/hooks/useLearningsPanel.ts (NEW)\n- tests/components/LearningsPanel.test.tsx (NEW)\n\n## Acceptance Criteria\n- [ ] Renders overlay when isVisible=true\n- [ ] Returns null when isVisible=false\n- [ ] Groups learnings by category (## headings)\n- [ ] Shows source attribution for each learning\n- [ ] Calls onClose when ESC pressed\n- [ ] Scrollable when many learnings\n- [ ] 6 tests pass\n\n## Tests\n1. Renders when isVisible=true\n2. Returns null when isVisible=false\n3. Groups learnings by category\n4. Shows source attribution\n5. ESC key calls onClose\n6. Handles empty learnings gracefully","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T11:46:29.619228+03:00","created_by":"deligoez","updated_at":"2026-01-10T11:46:29.619228+03:00","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-g2h","depends_on_id":"ch-a6h","type":"blocks","created_at":"2026-01-10T11:46:29.621385+03:00","created_by":"deligoez"}]}
{"id":"ch-g6z","title":"F20: useOrchestration Hook - TUI orchestration integration","description":"## What\nReact hook connecting TUI components to orchestration services and store.\n\n## Acceptance Criteria\n\n### Interface\n- [ ] UseOrchestrationResult: state + derived + actions\n- [ ] Returns 9 state properties from store\n- [ ] Returns 3 derived properties (isIdle, isRunning, canStartTask)\n- [ ] Returns 7 action functions\n\n### Initialization\n- [ ] Initializes with idle state\n- [ ] Creates services once via useMemo\n- [ ] Wires event handlers via useEffect\n- [ ] Cleans up event handlers on unmount\n\n### Actions\n- [ ] `startTask(taskId, agentType?)` starts via controller\n- [ ] `startTask` updates store status to 'assigning'\n- [ ] `startTask` sets error on failure\n- [ ] `cancelTask()` cancels and clears store\n\n### Event Handling\n- [ ] Updates store on 'taskCompleted'\n- [ ] Updates store on 'taskFailed'\n- [ ] Increments iteration on 'retry'\n\n### Derived State\n- [ ] `isIdle` = status === 'idle'\n- [ ] `canStartTask` = isIdle \u0026\u0026 mode === 'semi-auto'\n\n### Summary\n- [ ] 10 tests pass\n\n## Files\n- src/hooks/useOrchestration.ts (NEW)\n- tests/hooks/useOrchestration.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F20-use-orchestration.md\n\n## Notes\n- Similar pattern to useAgentManager\n- Autopilot actions are placeholders for M7\n- Services created once, events wired with cleanup","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T02:07:43.468053+03:00","created_by":"deligoez","updated_at":"2026-01-10T03:04:41.974004+03:00","labels":["m4-orchestration"],"dependencies":[{"issue_id":"ch-g6z","depends_on_id":"ch-0e7","type":"blocks","created_at":"2026-01-10T02:07:43.470457+03:00","created_by":"deligoez"},{"issue_id":"ch-g6z","depends_on_id":"ch-lhm","type":"blocks","created_at":"2026-01-10T02:07:43.47217+03:00","created_by":"deligoez"},{"issue_id":"ch-g6z","depends_on_id":"ch-7gx","type":"blocks","created_at":"2026-01-10T02:07:43.47353+03:00","created_by":"deligoez"},{"issue_id":"ch-g6z","depends_on_id":"ch-8j3","type":"blocks","created_at":"2026-01-10T02:07:43.474872+03:00","created_by":"deligoez"}]}
{"id":"ch-gk7","title":"F62b: TaskIterationDisplay Component - Show agent iteration on task","description":"## What\nComponent to display agent iteration information on a task in the task list.\n\n## Context from Master Plan\n```\n│ → ch-001 [P1] Implement auth   │\n│   ● claude | iter 7            │\n```\n\n## API\n```typescript\n// src/components/TaskIterationDisplay.tsx\n\ninterface TaskIterationDisplayProps {\n  agentType: 'claude' | 'codex' | 'opencode';\n  iteration: number;\n}\n\nfunction TaskIterationDisplay({ agentType, iteration }: TaskIterationDisplayProps): JSX.Element\n```\n\n## Visual Output\n```\n  ● claude | iter 7\n```\n\n## Files\n- src/components/TaskIterationDisplay.tsx\n- src/components/TaskIterationDisplay.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows agent type in lowercase\n- [ ] Shows iteration count with \"iter\" prefix\n- [ ] Uses pipe separator\n- [ ] Uses green dot for running indicator\n- [ ] Has proper indentation (matches task list)\n- [ ] Uses dimColor for the separator\n- [ ] 6 tests pass\n\n## Tests\n1. Shows agent type lowercase\n2. Shows \"iter X\" format\n3. Uses pipe separator\n4. Shows green dot indicator\n5. Has proper indentation\n6. Uses correct styling","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T12:51:47.383036+03:00","created_by":"deligoez","updated_at":"2026-01-10T13:06:18.276085+03:00","labels":["m12-tui"]}
{"id":"ch-glf","title":"F24: Merge Queue","description":"## What\nPriority queue for pending merge operations with dependency ordering and retry tracking.\n\n## Acceptance Criteria\n\n### enqueue() - 3 tests\n- [ ] `enqueue()` adds item to queue\n- [ ] Items sorted by priority (P1 \u003e P2 \u003e P3 \u003e P4)\n- [ ] Same priority items sorted by enqueuedAt (FIFO)\n\n### dequeue() - 4 tests\n- [ ] `dequeue()` returns highest priority item\n- [ ] `dequeue()` skips items with unmerged dependencies\n- [ ] `dequeue()` returns `null` when queue empty\n- [ ] `dequeue()` sets returned item as `processing`\n\n### deferToEnd() - 2 tests\n- [ ] Moves conflicted item to end of queue\n- [ ] Increments retry count on item\n\n### markCompleted() - 1 test\n- [ ] Clears `processing`, increments `stats.completed`\n\n### markFailed() - 2 tests\n- [ ] Clears `processing`, increments `stats.failed`\n- [ ] Returns `{ needsEscalation: true }` after 3 retries\n\n### getStats() - 1 test\n- [ ] Returns accurate pending/processing/completed/failed counts\n\n### Summary\n- [ ] 13 tests pass\n\n## Merge Ordering Rules (from plan)\n1. DEPENDENCY ORDER: If B depends on A, A merges first\n2. PRIORITY BOOST: P1 \u003e P2 \u003e P3 \u003e P4\n3. FIFO within same priority\n4. CONFLICT DEFERRAL: Failed items go to end, max 3 retries\n\n## Files\n- src/services/MergeQueue.ts\n- tests/services/MergeQueue.test.ts","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T03:16:04.345671+03:00","created_by":"deligoez","updated_at":"2026-01-10T11:36:36.790632+03:00","labels":["m5-merge"]}
{"id":"ch-glq","title":"F04: Worktree Create - git worktree add for isolation","description":"## What\nCreate isolated git worktrees for agent task execution.\n\n## Acceptance Criteria\n\n### create() - 7 tests\n- [ ] Runs: `git worktree add .worktrees/{agent}-{task} -b agent/{agent}/{task} main`\n- [ ] Creates `.worktrees/` directory if it doesn't exist\n- [ ] Copies `.agent/` template files into worktree root\n- [ ] Returns `WorktreeInfo` with path, branch, agentType, taskId\n- [ ] Throws `WorktreeExistsError` if worktree already exists for agent+task\n- [ ] Throws `GitError` if git worktree command fails (non-zero exit)\n- [ ] Template files are readable in new worktree (file content validation)\n\n### Template Files (copied to worktree) - must be tested\nTemplate source: `.agent/` directory in project root\n\n| File | Content |\n|------|---------|\n| `scratchpad.md` | Empty file (0 bytes) |\n| `CONVENTIONS.md` | Commit rules with task ID format, completion signal |\n\n### Query Methods - 4 tests\n- [ ] `exists(agentType, taskId)` returns `true` if `.worktrees/{agent}-{task}` directory exists\n- [ ] `exists(agentType, taskId)` returns `false` if directory doesn't exist\n- [ ] `getPath(agentType, taskId)` returns absolute path: `{projectDir}/.worktrees/{agent}-{task}`\n- [ ] `getBranch(agentType, taskId)` returns branch name: `agent/{agent}/{task}`\n\n### list() - 1 test\n- [ ] `list()` parses `git worktree list --porcelain` and returns array of `WorktreeInfo`\n\n### Summary\n- [ ] 12 tests pass\n\n## Files\n- src/services/WorktreeService.ts (NEW)\n- tests/services/WorktreeService.test.ts (NEW)\n- .agent/scratchpad.md (template - empty)\n- .agent/CONVENTIONS.md (template - commit rules)\n\n## Interface\n```typescript\ninterface WorktreeInfo {\n  path: string;      // .worktrees/claude-ch-a1b2\n  branch: string;    // agent/claude/ch-a1b2\n  agentType: string;\n  taskId: string;\n}\n\nclass WorktreeExistsError extends Error {}\nclass GitError extends Error {}\n\nclass WorktreeService {\n  constructor(projectDir: string);\n  \n  async create(agentType: string, taskId: string): Promise\u003cWorktreeInfo\u003e;\n  exists(agentType: string, taskId: string): boolean;\n  getPath(agentType: string, taskId: string): string;\n  getBranch(agentType: string, taskId: string): string;\n  list(): WorktreeInfo[];\n}\n```\n\n## Git Worktree List Parsing\n`git worktree list --porcelain` output format:\n```\nworktree /path/to/.worktrees/claude-ch-a1b2\nHEAD abc123def456\nbranch refs/heads/agent/claude/ch-a1b2\n\nworktree /path/to/.worktrees/cursor-ch-x1y2\nHEAD def789abc012\nbranch refs/heads/agent/cursor/ch-x1y2\n```\n\nParse into WorktreeInfo by:\n1. Extract path from `worktree` line\n2. Extract branch from `branch` line (strip `refs/heads/`)\n3. Parse agentType and taskId from branch name pattern\n\n## .agent/CONVENTIONS.md Template Content\n```markdown\n# Agent Conventions\n\n## Commit Messages\n\n**IMPORTANT:** Include task ID in every commit message.\n\nFormat: `\u003ctype\u003e: \u003cdescription\u003e [\u003ctask-id\u003e]`\n\nExample:\n```\nfeat: implement auth [ch-abc]\n```\n\nThis is required for task rollback to work.\n\n## Completion Signal\n\nWhen done, emit:\n```\n\u003cchorus\u003e\n  \u003cstatus\u003eCOMPLETE\u003c/status\u003e\n\u003c/chorus\u003e\n```\n```\n\n## Test Cases (12 total)\n1. create() runs git worktree add command correctly\n2. create() creates .worktrees/ directory if missing\n3. create() copies template files into worktree\n4. create() returns correct WorktreeInfo\n5. create() throws WorktreeExistsError if already exists\n6. create() throws GitError on git command failure\n7. create() template files are readable with correct content\n8. exists() returns true for existing worktree\n9. exists() returns false for non-existent worktree\n10. getPath() returns correct absolute path\n11. getBranch() returns correct branch name\n12. list() parses git worktree list output correctly","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:31:03.217127+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:22:56.728551+03:00","labels":["m1-infrastructure"]}
{"id":"ch-hhh","title":"F60a: AgentGrid Component - Tiling grid layout for agents","description":"## What\nTiling grid layout for displaying multiple agent tiles.\n\n## Context from Master Plan\n```\n│ │ CLAUDE (ch-001)   │ CODEX (ch-002)    │  │\n│ │ iter 7/50 | 12m   │ iter 3/50 | 5m    │  │\n│ │ ▓▓▓▓░░░░░░        │ ▓▓░░░░░░░░        │  │\n│ │                   │                   │  │\n│ │ GLM (ch-003)      │ [empty slot]      │  │\n│ │ iter 1/50 | 1m    │                   │  │\n│ │ ▓░░░░░░░░░        │                   │  │\n```\n\n## API\n```typescript\n// src/components/AgentGrid.tsx\n\ninterface AgentGridProps {\n  agents: Agent[];\n  maxSlots: number;\n  selectedIndex?: number;\n  gridConfig: GridConfig;  // from useAgentGrid\n}\n\nfunction AgentGrid({ agents, maxSlots, selectedIndex, gridConfig }: AgentGridProps): JSX.Element\n```\n\n## Files\n- src/components/AgentGrid.tsx\n- src/components/AgentGrid.test.tsx\n\n## Acceptance Criteria\n- [ ] Renders agents using AgentTile component with correct props\n- [ ] Renders EmptySlot for unused slots (maxSlots - agents.length)\n- [ ] Passes isSelected=true to AgentTile at selectedIndex\n- [ ] Fills slots left-to-right, top-to-bottom order\n- [ ] Uses gridConfig.columns for grid layout\n- [ ] Uses gridConfig.tileWidth for tile sizing\n- [ ] All tiles have equal width from gridConfig.tileWidth\n- [ ] Shows correct number of empty slots\n- [ ] Handles zero agents (shows all empty slots)\n- [ ] Handles agents.length \u003e maxSlots (renders only maxSlots)\n- [ ] Handles selectedIndex out of bounds (no selection)\n- [ ] Uses flexbox with wrap for grid rows\n- [ ] 12 tests pass\n\n## Tests\n1. Renders AgentTile for each agent\n2. Renders multiple agents in grid layout\n3. Renders EmptySlot for unused slots\n4. Passes isSelected=true to selected AgentTile\n5. Fills left-to-right, top-to-bottom\n6. Uses gridConfig.columns for layout\n7. Uses gridConfig.tileWidth for sizing\n8. Handles zero agents (all EmptySlot)\n9. Truncates if agents.length \u003e maxSlots\n10. Handles selectedIndex out of bounds\n11. Grid wraps at column boundary\n12. Passes correct agent props to AgentTile","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T12:50:49.783081+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:30:49.189627+03:00","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-hhh","depends_on_id":"ch-c2p","type":"blocks","created_at":"2026-01-10T12:50:49.785309+03:00","created_by":"deligoez"},{"issue_id":"ch-hhh","depends_on_id":"ch-if9","type":"blocks","created_at":"2026-01-10T12:50:49.78722+03:00","created_by":"deligoez"},{"issue_id":"ch-hhh","depends_on_id":"ch-70p","type":"blocks","created_at":"2026-01-10T12:51:52.806665+03:00","created_by":"deligoez"}]}
{"id":"ch-i9i","title":"F22: Agent Slot Manager","description":"## What\nManage available slots for parallel agent execution. Track and enforce maxParallel limits.\n\n## Acceptance Criteria\n\n### getAvailable() - 2 tests\n- [ ] `getAvailable()` returns `maxParallel` when no slots acquired\n- [ ] `getAvailable()` decreases by 1 for each acquired slot\n\n### getCapacity() / getInUse() - 2 tests\n- [ ] `getCapacity()` returns `maxParallel` (immutable)\n- [ ] `getInUse()` returns count of acquired slots\n\n### acquire() - 2 tests\n- [ ] `acquire()` returns `true` and decrements available\n- [ ] `acquire()` returns `false` when available === 0\n\n### release() - 2 tests\n- [ ] `release()` increments available count\n- [ ] `release()` throws Error when `inUse === 0`\n\n### Implicit (no dedicated tests)\n- `hasAvailable()` = `getAvailable() \u003e 0` (trivial wrapper)\n- `reset()` = sets `acquired = 0` (test/recovery utility)\n\n## Files\n- src/services/SlotManager.ts\n- tests/services/SlotManager.test.ts\n\n## Plan\nSee: thoughts/shared/plans/features/F22-slot-manager.md\n\n**Total: 8 tests**","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T03:16:03.109131+03:00","created_by":"deligoez","updated_at":"2026-01-10T08:13:58.790245+03:00","labels":["m6-parallelism"]}
{"id":"ch-iel","title":"F06: Worktree Query - List and get worktree info","description":"## What\nQuery worktree details and bulk operations to complete WorktreeService.\n\n## Acceptance Criteria\n\n### getInfo() - 4 tests\n- [ ] Returns `WorktreeInfo` with all fields populated including `headSha`\n- [ ] `headSha` retrieved via `git rev-parse HEAD` in worktree directory\n- [ ] Throws `WorktreeNotFoundError` if worktree doesn't exist\n- [ ] Returns correct agentType and taskId parsed from path/branch\n\n### removeAll() - 3 tests\n- [ ] Calls `remove()` for each worktree returned by `list()`\n- [ ] Skips worktrees that aren't agent worktrees (no agent/ branch prefix)\n- [ ] With `force: true`, passes force option to each remove() call\n\n### Edge Case - 1 test\n- [ ] removeAll() on empty worktree list completes without error (no-op)\n\n### Summary\n- [ ] 8 tests pass\n\n## Files\n- src/services/WorktreeService.ts (extend)\n- tests/services/WorktreeService.test.ts (extend)\n\n## Interface\n```typescript\ninterface WorktreeInfo {\n  path: string;      // /abs/path/.worktrees/claude-ch-a1b2\n  branch: string;    // agent/claude/ch-a1b2\n  agentType: string; // claude\n  taskId: string;    // ch-a1b2\n  headSha?: string;  // abc123def456 (only from getInfo())\n}\n\n// Add to WorktreeService class:\n\nasync getInfo(agentType: string, taskId: string): Promise\u003cWorktreeInfo\u003e;\n\nasync removeAll(options?: { force?: boolean }): Promise\u003cvoid\u003e;\n```\n\n## Implementation Notes\n\n### getInfo() Flow\n1. Check worktree exists via exists() - throw WorktreeNotFoundError if not\n2. Get path via getPath()\n3. Get branch via getBranch()\n4. Run `git -C {path} rev-parse HEAD` to get headSha\n5. Return complete WorktreeInfo object\n\n### removeAll() Flow\n1. Call list() to get all worktrees\n2. Filter to agent worktrees (branch starts with `agent/`)\n3. For each, call remove() with options.force if set\n4. If list is empty, return immediately (no-op)\n\n### Agent Worktree Detection\nA worktree is an agent worktree if:\n- Branch matches pattern: `agent/{agentType}/{taskId}`\n- OR path matches pattern: `.worktrees/{agentType}-{taskId}`\n\nNon-agent worktrees (main worktree, manual worktrees) should be skipped.\n\n## Test Cases (8 total)\n1. getInfo() returns complete WorktreeInfo with headSha\n2. getInfo() retrieves headSha via git rev-parse\n3. getInfo() throws WorktreeNotFoundError for non-existent worktree\n4. getInfo() correctly parses agentType and taskId\n5. removeAll() removes all agent worktrees\n6. removeAll() skips non-agent worktrees (main, manual)\n7. removeAll() with force: true passes force to remove()\n8. removeAll() completes successfully with empty worktree list\n\n## Prerequisite Methods (from F04 \u0026 F05)\nThis task assumes these methods are already implemented:\n- From F04: create(), exists(), getPath(), getBranch(), list()\n- From F05: remove(), isBranchMerged(), prune()","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:31:17.922621+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:23:24.780581+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-iel","depends_on_id":"ch-112","type":"blocks","created_at":"2026-01-10T01:31:17.924367+03:00","created_by":"deligoez"}]}
{"id":"ch-if9","title":"F59a: EmptySlot Component - Placeholder for unused agent slot","description":"## What\nPlaceholder component shown when an agent slot is unused.\n\n## Context from Master Plan\n```\n│ [empty slot]      │\n```\n\n## API\n```typescript\n// src/components/EmptySlot.tsx\n\ninterface EmptySlotProps {\n  width?: number;\n}\n\nfunction EmptySlot({ width }: EmptySlotProps): JSX.Element\n```\n\n## Visual Output\n```\n┌───────────────────┐\n│                   │\n│   [empty slot]    │\n│                   │\n└───────────────────┘\n```\n\n## Files\n- src/components/EmptySlot.tsx\n- src/components/EmptySlot.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows \"[empty slot]\" text\n- [ ] Text is centered horizontally and vertically\n- [ ] Text uses dimColor (Ink's dimColor prop)\n- [ ] Has single border style (borderStyle=\"single\")\n- [ ] Border uses gray color (borderColor=\"gray\")\n- [ ] Respects width prop for box sizing\n- [ ] 6 tests pass\n\n## Tests\n1. Shows \"[empty slot]\" text\n2. Text is centered\n3. Uses dimColor for text\n4. Has single border style\n5. Border uses gray color\n6. Respects width prop","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T12:49:26.136012+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:30:19.122839+03:00","labels":["m12-tui"]}
{"id":"ch-im6","title":"F63d: New Task (n) - Create new task via TUI","description":"## What\nKeyboard handler for 'n' key to create a new task via TUI input.\n\n## Shortcut\n- **n** - Open new task dialog\n\n## Implementation\n```typescript\n// src/hooks/useKeyboard.ts\nimport { useInput } from 'ink';\n\nexport function useKeyboard(options: UseKeyboardOptions) {\n  useInput((input, key) =\u003e {\n    if (input === 'n') {\n      options.onNewTask?.();\n    }\n  });\n}\n\ninterface UseKeyboardOptions {\n  onNewTask?: () =\u003e void;\n}\n```\n\n```typescript\n// NewTaskDialog.tsx\ninterface NewTaskDialogProps {\n  isOpen: boolean;\n  onSubmit: (title: string) =\u003e Promise\u003cvoid\u003e;\n  onCancel: () =\u003e void;\n}\n\nexport function NewTaskDialog({ isOpen, onSubmit, onCancel }: NewTaskDialogProps) {\n  const [title, setTitle] = useState('');\n  \n  useInput((input, key) =\u003e {\n    if (key.escape) onCancel();\n    if (key.return \u0026\u0026 title) onSubmit(title);\n  });\n  \n  if (!isOpen) return null;\n  // ... render input\n}\n```\n\n## Behavior\n- Pressing 'n' opens a task creation dialog/input\n- User enters task title via TextInput\n- Escape cancels dialog, Enter submits\n- Task created via `bd create \"\u003ctitle\u003e\"`\n- TaskPanel refreshes to show new task\n\n## Files\n- src/hooks/useKeyboard.ts (UPDATE)\n- src/hooks/useKeyboard.test.ts (UPDATE)\n- src/components/NewTaskDialog.tsx (NEW)\n- src/components/NewTaskDialog.test.tsx (NEW)\n\n## Acceptance Criteria\n- [ ] `useInput` detects 'n' and calls `onNewTask()`\n- [ ] NewTaskDialog renders when isOpen=true\n- [ ] Escape key calls `onCancel()`\n- [ ] Enter key with non-empty title calls `onSubmit(title)`\n- [ ] Enter key with empty title does nothing\n- [ ] `onSubmit` executes `bd create` command\n- [ ] 6 tests pass\n\n## Tests\n1. 'n' key calls onNewTask callback\n2. Dialog renders when isOpen=true, hidden when false\n3. Escape calls onCancel\n4. Enter with title calls onSubmit(title)\n5. Enter with empty title does not call onSubmit\n6. onSubmit runs bd create with title","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T21:53:28.785701+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:30:08.483955+03:00","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-im6","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-10T21:53:34.479722+03:00","created_by":"deligoez"}]}
{"id":"ch-j0z","title":"F59b: AgentTileHeader - Agent type, task ID, status icon","description":"## What\nTop section of AgentTile showing agent type, task ID, and status indicator.\n\n## Context from Master Plan\n```\n│ CLAUDE (ch-001)   │\n```\n\n## API\n```typescript\n// src/components/AgentTileHeader.tsx\n\ninterface AgentTileHeaderProps {\n  agentType: 'claude' | 'codex' | 'opencode';\n  taskId: string;\n  status: 'running' | 'idle' | 'paused' | 'error';\n}\n\nfunction AgentTileHeader({ agentType, taskId, status }: AgentTileHeaderProps): JSX.Element\n```\n\n## Visual Output\n- `● CLAUDE (ch-001)` - green dot for running\n- `○ CODEX (ch-002)` - gray dot for idle\n- `⏸ OPENCODE (ch-003)` - yellow for paused\n- `✗ CLAUDE (ch-001)` - red for error\n\n## Status Icon Colors (Ink)\n- running: color=\"green\", icon=\"●\"\n- idle: color=\"gray\", icon=\"○\"\n- paused: color=\"yellow\", icon=\"⏸\"\n- error: color=\"red\", icon=\"✗\"\n\n## Files\n- src/components/AgentTileHeader.tsx\n- src/components/AgentTileHeader.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows agent type in UPPERCASE (bold)\n- [ ] Shows task ID in parentheses after type\n- [ ] Shows green \"●\" for running status (color=\"green\")\n- [ ] Shows gray \"○\" for idle status (color=\"gray\")\n- [ ] Shows yellow \"⏸\" for paused status (color=\"yellow\")\n- [ ] Shows red \"✗\" for error status (color=\"red\")\n- [ ] Status icon appears before agent type\n- [ ] 7 tests pass\n\n## Tests\n1. Shows CLAUDE uppercase and bold\n2. Shows (ch-xxx) task ID format\n3. Shows green dot for running\n4. Shows gray dot for idle\n5. Shows yellow pause for paused\n6. Shows red X for error\n7. Status icon appears before agent type","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T12:49:27.267029+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:30:20.472003+03:00","labels":["m12-tui"]}
{"id":"ch-jbe","title":"F03c: Non-Claude CLI Detection","description":"## What\nExtend InitPrerequisites to detect non-Claude agent CLIs (codex, opencode).\n\n**Status:** DEFERRED - Will implement when non-Claude agent support is needed.\n\n## Why\nNon-Claude agents (codex, opencode) require their CLIs to be available.\nThis task adds detection for these additional agents.\n\n## Acceptance Criteria\n\n### detectAgentCLIs() - 4 tests\n- [ ] Returns array of available agent types including codex, opencode\n- [ ] Returns only 'claude' if others not found\n- [ ] Detects codex CLI when present\n- [ ] Detects opencode CLI when present\n\n### Summary\n- [ ] 4 tests pass\n\n## Types Extension\n```typescript\ninterface PrerequisiteResult {\n  // Existing fields...\n  agents: AgentType[];  // NEW: array of available agents\n}\n```\n\n## Files\n- src/services/InitPrerequisites.ts (UPDATE)\n- src/services/InitPrerequisites.test.ts (UPDATE)\n\n## Tests\n1. detectAgentCLIs() returns ['claude'] when others missing\n2. detectAgentCLIs() includes 'codex' when available\n3. detectAgentCLIs() includes 'opencode' when available\n4. detectAgentCLIs() returns all three when all present","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T22:43:47.138462+03:00","created_by":"deligoez","updated_at":"2026-01-10T22:43:47.138462+03:00","labels":["deferred","m1-infrastructure"],"dependencies":[{"issue_id":"ch-jbe","depends_on_id":"ch-0z7","type":"blocks","created_at":"2026-01-10T22:43:47.143596+03:00","created_by":"deligoez"}]}
{"id":"ch-jxp","title":"F51: Session Recovery - Recover from crash via state.json","description":"## What\nRecover Chorus state after a crash using persisted state.json.\n\n## Acceptance Criteria\n\n### needsRecovery() - 2 tests\n- [ ] Returns `true` if state.json has agents with running status\n- [ ] Returns `false` for clean/empty state\n\n### recover() - 4 tests\n- [ ] Loads persisted state from state.json\n- [ ] Kills orphan processes (checks if PID exists, kills if still running)\n- [ ] Returns crashed agent tasks to pending via `bd update --status=pending`\n- [ ] Returns RecoveryResult with restoredTasks, cleanedWorktrees, errors\n\n### resumeMergeQueue() - 2 tests\n- [ ] Re-enqueues pending items from state.mergeQueue\n- [ ] Skips items already processed\n\n### Handle Scenarios - 3 tests\n- [ ] `handleAgentCrash()` stashes worktree changes, returns task to pending\n- [ ] `handleWorktreeBroken()` removes broken worktree (force)\n- [ ] `handleOrphanedWorktree()` removes worktree not in state\n\n### Summary\n- [ ] 11 tests pass\n\n## Files\n- src/services/SessionRecovery.ts\n- tests/services/SessionRecovery.test.ts\n\n## API\n```typescript\ninterface RecoveryResult {\n  recovered: boolean;\n  restoredTasks: string[];\n  cleanedWorktrees: string[];\n  resumedMergeItems: number;\n  errors: string[];\n}\n\nclass SessionRecovery {\n  constructor(\n    private stateService: StateService,\n    private mergeService: MergeService\n  ) {}\n\n  async needsRecovery(): Promise\u003cboolean\u003e;\n  async recover(): Promise\u003cRecoveryResult\u003e;\n  async resumeMergeQueue(): Promise\u003cnumber\u003e;\n  async handleAgentCrash(agentId: string): Promise\u003cvoid\u003e;\n  async handleWorktreeBroken(worktreePath: string): Promise\u003cvoid\u003e;\n  async handleOrphanedWorktree(worktreePath: string): Promise\u003cvoid\u003e;\n}\n```\n\n## Recovery Flow (from plan)\n```typescript\nasync recover(): Promise\u003cRecoveryResult\u003e {\n  const state = await this.stateService.load();\n  \n  // 1. Kill orphan processes\n  for (const [id, agent] of Object.entries(state.agents)) {\n    if (!processExists(agent.pid)) {\n      await exec(`bd update ${agent.taskId} --status=pending`);\n      delete state.agents[id];\n    }\n  }\n  \n  // 2. Resume merge queue\n  await this.resumeMergeQueue();\n  \n  // 3. Save cleaned state\n  await this.stateService.save(state);\n  \n  return result;\n}\n```","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T10:45:01.661567+03:00","created_by":"deligoez","updated_at":"2026-01-10T11:13:04.11027+03:00","labels":["m10-rollback"],"dependencies":[{"issue_id":"ch-jxp","depends_on_id":"ch-2r5","type":"blocks","created_at":"2026-01-10T10:45:01.663431+03:00","created_by":"deligoez"},{"issue_id":"ch-jxp","depends_on_id":"ch-81x","type":"blocks","created_at":"2026-01-10T10:45:01.664656+03:00","created_by":"deligoez"},{"issue_id":"ch-jxp","depends_on_id":"ch-112","type":"blocks","created_at":"2026-01-10T10:48:19.707944+03:00","created_by":"deligoez"},{"issue_id":"ch-jxp","depends_on_id":"ch-8ee","type":"blocks","created_at":"2026-01-10T11:13:15.217574+03:00","created_by":"deligoez"}]}
{"id":"ch-k3d","title":"F10: Test Runner - Run project test command","description":"## What\nRun a test command and capture result (passed/failed, output, duration).\n\n## Acceptance Criteria\n- [ ] Constructor takes projectDir and testCommand\n- [ ] `run(cwd?)` executes command via shell\n- [ ] Returns `passed: true` for exit code 0\n- [ ] Returns `passed: false` for non-zero exit code\n- [ ] Captures stdout and stderr in output\n- [ ] Tracks execution duration (ms)\n- [ ] `runWithTimeout(cwd?, timeout?)` supports timeout\n- [ ] Returns exit code 124 on timeout\n- [ ] `getCommand()` returns test command\n- [ ] 6 tests pass\n\n## Files\n- src/services/TestRunner.ts (NEW)\n- tests/services/TestRunner.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F10-test-runner.md\n\n## Notes\n- TestRunner is generic - receives testCommand as constructor arg\n- Caller (F15 Orchestrator) reads config and passes testCommand\n- Uses `sh -c` to run command (supports pipes)\n- Default timeout: 5 minutes (300000ms)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:38:49.692278+03:00","created_by":"deligoez","updated_at":"2026-01-10T02:46:50.822793+03:00","labels":["m3-task-mgmt"]}
{"id":"ch-k9y","title":"F48: Checkpointer - Create and restore git tag checkpoints","description":"## What\nCreate and manage git tag checkpoints for rollback.\n\n## API\n```typescript\n// src/services/Checkpointer.ts\n\nclass Checkpointer {\n  constructor(private config: CheckpointConfig) {}\n\n  /**\n   * Create a checkpoint tag\n   * @param type Type of checkpoint\n   * @param taskId Optional task ID for pre_merge checkpoints\n   */\n  async create(type: Checkpoint['type'], taskId?: string): Promise\u003cCheckpoint\u003e\n\n  /**\n   * Restore to a checkpoint\n   * @param checkpointId Checkpoint to restore to\n   * @returns List of affected task IDs\n   */\n  async restore(checkpointId: string): Promise\u003cstring[]\u003e\n\n  /**\n   * List all checkpoints\n   */\n  async list(): Promise\u003cCheckpoint[]\u003e\n\n  /**\n   * Delete old checkpoints (keep last N)\n   */\n  async prune(keepCount: number): Promise\u003cnumber\u003e\n\n  /**\n   * Check if checkpoint should be created (based on config)\n   */\n  shouldCreate(type: Checkpoint['type']): boolean\n}\n```\n\n## Files\n- src/services/Checkpointer.ts\n- tests/services/Checkpointer.test.ts\n\n## Acceptance Criteria\n- [ ] `create()` creates git tag with format \"chorus-checkpoint-{timestamp}\"\n- [ ] `create()` stores checkpoint metadata\n- [ ] `restore()` runs git reset --hard to tag\n- [ ] `restore()` returns affected task IDs\n- [ ] `list()` returns all checkpoint objects\n- [ ] `prune()` deletes oldest checkpoints\n- [ ] `shouldCreate()` respects config settings\n- [ ] 8 tests pass\n\n## Tests\n1. create() creates git tag\n2. create() returns checkpoint object\n3. restore() resets to tag\n4. restore() returns affected tasks\n5. list() returns all checkpoints\n6. prune() deletes old checkpoints\n7. shouldCreate() returns true when enabled\n8. shouldCreate() returns false when disabled","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T10:44:27.200102+03:00","created_by":"deligoez","updated_at":"2026-01-10T10:44:27.200102+03:00","labels":["m10-rollback"],"dependencies":[{"issue_id":"ch-k9y","depends_on_id":"ch-2r5","type":"blocks","created_at":"2026-01-10T10:44:27.201667+03:00","created_by":"deligoez"}]}
{"id":"ch-kyx","title":"F63g: Grid Settings (g) - Open agent grid configuration","description":"## What\nKeyboard handler for 'g' key to open grid configuration dialog.\n\n## Shortcut\n- **g** - Open grid settings dialog\n\n## Implementation\n```typescript\n// src/hooks/useKeyboard.ts\nimport { useInput } from 'ink';\n\nexport function useKeyboard(options: UseKeyboardOptions) {\n  useInput((input, key) =\u003e {\n    if (input === 'g') {\n      options.onGridSettings?.();\n    }\n  });\n}\n\ninterface UseKeyboardOptions {\n  onGridSettings?: () =\u003e void;\n}\n```\n\n```typescript\n// GridSettingsDialog.tsx\ntype GridLayout = 'auto' | '1x1' | '2x2' | '2x3' | '1x4';\n\ninterface GridSettingsDialogProps {\n  isOpen: boolean;\n  currentLayout: GridLayout;\n  onSelect: (layout: GridLayout) =\u003e void;\n  onCancel: () =\u003e void;\n}\n\nexport function GridSettingsDialog({ isOpen, currentLayout, onSelect, onCancel }) {\n  const [selected, setSelected] = useState(currentLayout);\n  const layouts: GridLayout[] = ['auto', '1x1', '2x2', '2x3', '1x4'];\n  \n  useInput((input, key) =\u003e {\n    if (key.escape) onCancel();\n    if (key.return) onSelect(selected);\n    if (key.upArrow) setSelected(prev =\u003e /* previous option */);\n    if (key.downArrow) setSelected(prev =\u003e /* next option */);\n  });\n}\n```\n\n## Behavior\n- Pressing 'g' opens grid configuration dialog\n- Options: auto, 1x1, 2x2, 2x3, 1x4\n- Arrow keys navigate, Enter selects, Escape cancels\n- Selection updates useAgentGrid config\n\n## Files\n- src/hooks/useKeyboard.ts (UPDATE)\n- src/hooks/useKeyboard.test.ts (UPDATE)\n- src/components/GridSettingsDialog.tsx (NEW)\n- src/components/GridSettingsDialog.test.tsx (NEW)\n\n## Acceptance Criteria\n- [ ] `useInput` detects 'g' and calls `onGridSettings()`\n- [ ] Dialog renders layout options when isOpen=true\n- [ ] Current layout is visually highlighted\n- [ ] Up/Down arrow keys change selected option\n- [ ] Enter calls `onSelect(selectedLayout)`\n- [ ] Escape calls `onCancel()`\n- [ ] 6 tests pass\n\n## Tests\n1. 'g' key calls onGridSettings callback\n2. Dialog renders all layout options\n3. Current layout shows highlighted style\n4. Arrow keys navigate between options\n5. Enter calls onSelect with selected layout\n6. Escape calls onCancel","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T21:54:26.60091+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:30:11.003865+03:00","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-kyx","depends_on_id":"ch-70p","type":"blocks","created_at":"2026-01-10T21:54:31.889685+03:00","created_by":"deligoez"}]}
{"id":"ch-lhm","title":"F16b: Completion Handler - Retry and failure logic","description":"## What\nHandle retry logic, failure cases, blocked state, and agent crashes.\n\n## Acceptance Criteria\n\n### handleAgentExit() - No Signal Path - 3 tests\n- [ ] Returns `{ action: 'retry' }` when no completion signal and iteration \u003c max\n- [ ] Returns `{ action: 'retry' }` when tests fail (even with signal) and iteration \u003c max\n- [ ] Returns `{ action: 'failed' }` when no signal and iteration \u003e= max\n\n### handleAgentExit() - Blocked Path - 2 tests\n- [ ] Returns `{ action: 'blocked', reason }` when BLOCKED signal detected\n- [ ] Sets task status to \"blocked\" via bd update\n\n### handleAgentExit() - Crash Path - 2 tests\n- [ ] Returns `{ action: 'failed', reason: 'crash' }` on non-zero exit code\n- [ ] Sets task status to \"failed\", keeps worktree for inspection\n\n### handleRetry() - 3 tests\n- [ ] Emits \"retry\" event with { taskId, iteration }\n- [ ] Increments iteration count in agentStore\n- [ ] Respects `config.completion.maxIterations`\n\n### handleMaxReached() - 2 tests\n- [ ] Returns `{ action: 'failed', reason: 'max_iterations' }` when at limit\n- [ ] Emits \"failed\" event with taskId and iteration count\n\n### Summary\n- [ ] 12 tests pass\n\n## Exit Decision Tree (Priority Order)\n\n**CRITICAL: Conditions are checked in this EXACT order. First match wins.**\n\n```\nhandleAgentExit(exitCode, signal, testsPass, iteration, maxIterations):\n\n  1. CRASH CHECK (highest priority)\n     if exitCode !== 0:\n       → { action: 'failed', reason: 'crash' }\n       (non-zero exit = agent crashed, nothing else matters)\n\n  2. BLOCKED CHECK\n     if signal === 'BLOCKED':\n       → { action: 'blocked', reason: signal.reason }\n       (agent explicitly signaled blocked state)\n\n  3. SUCCESS CHECK\n     if signal === 'COMPLETE' \u0026\u0026 testsPass === true:\n       → delegate to F16a success handler\n       (this is the happy path)\n\n  4. MAX ITERATIONS CHECK\n     if iteration \u003e= maxIterations:\n       → { action: 'failed', reason: 'max_iterations' }\n       (exhausted retries)\n\n  5. RETRY (default)\n     → { action: 'retry' }\n     (covers: no signal, tests failed, incomplete work)\n```\n\n## Exit Handling Matrix\n\n| Priority | Exit Code | Signal | Tests | Action | Reason |\n|----------|-----------|--------|-------|--------|--------|\n| 1 | != 0 | any | any | failed | crash |\n| 2 | 0 | BLOCKED | any | blocked | signal.reason |\n| 3 | 0 | COMPLETE | pass | → F16a | success |\n| 4 | 0 | any | any | failed | max_iterations (if at limit) |\n| 5 | 0 | any | any | retry | default |\n\n## Edge Cases\n\n**Q: Exit 0 with COMPLETE signal but tests fail?**\nA: Row 5 - retry (tests must pass for success)\n\n**Q: Exit 0 with no signal and at max iterations?**\nA: Row 4 - failed with max_iterations\n\n**Q: Non-zero exit with BLOCKED signal?**\nA: Row 1 - crash (exit code check is first)\n\n**Q: BLOCKED signal with passing tests?**\nA: Row 2 - blocked (BLOCKED check before success check)\n\n## Files\n- src/services/CompletionHandler.ts (UPDATE)\n- tests/services/CompletionHandler.test.ts (UPDATE)\n\n## Notes\n- Does NOT respawn agent (Orchestrator handles retry)\n- Events allow loose coupling with Orchestrator\n- BLOCKED reason extracted from signal content\n- Keep worktree on crash for debugging","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T02:06:51.093896+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:24:32.818122+03:00","labels":["m4-orchestration"],"dependencies":[{"issue_id":"ch-lhm","depends_on_id":"ch-7jw","type":"blocks","created_at":"2026-01-10T02:06:51.096495+03:00","created_by":"deligoez"}]}
{"id":"ch-mdj","title":"F03b: Init Scaffold - Create directories and detect settings","description":"## What\nCreate Chorus directory structure, detect project settings, initialize Beads, and set up configuration.\n\n## Acceptance Criteria\n\n### createDirectories() - 5 tests\n- [ ] Creates `.chorus/` directory if not exists\n- [ ] Creates `.chorus/hooks/` directory if not exists\n- [ ] Creates `.agent/` directory with `learnings.md` template (empty markdown file)\n- [ ] Creates `.worktrees/` directory if not exists\n- [ ] Skips creation if directories already exist (idempotent)\n\n### detectProjectSettings() - 8 tests\n- [ ] Returns `{testCommand: \"npm test\"}` when `package.json` has `scripts.test`\n- [ ] Returns `{testCommand: \"pytest\"}` when `pyproject.toml` exists with `[tool.pytest]`\n- [ ] Returns `{testCommand: \"go test ./...\"}` when `go.mod` exists\n- [ ] Returns `{buildCommand: \"npm run build\"}` when `package.json` has `scripts.build`\n- [ ] Returns `{projectType: \"node\"}` when `package.json` exists\n- [ ] Returns `{projectType: \"python\"}` when `pyproject.toml` exists (no package.json)\n- [ ] Returns `{projectType: \"go\"}` when `go.mod` exists (no package.json/pyproject.toml)\n- [ ] Returns `{projectType: \"unknown\", testCommand: undefined, buildCommand: undefined}` when no project files found\n\n### initBeads() - 3 tests\n- [ ] Runs `bd init` when `.beads/` directory does not exist\n- [ ] Skips `bd init` when `.beads/` directory already exists\n- [ ] Throws `BeadsInitError` if `bd init` command fails (non-zero exit)\n\n### createAgentsMd() - 2 tests\n- [ ] Creates `AGENTS.md` with template content when file does not exist\n- [ ] Skips creation when `AGENTS.md` already exists (preserves user content)\n\n### updateGitignore() - 5 tests\n- [ ] Appends `.worktrees/` to `.gitignore` if not present\n- [ ] Appends `.chorus/state.json` to `.gitignore` if not present\n- [ ] Appends `.agent/scratchpad.md` to `.gitignore` if not present\n- [ ] Does not duplicate entries already in `.gitignore`\n- [ ] Creates `.gitignore` if file does not exist\n\n### initialize() - orchestration - 5 tests\n- [ ] Calls steps in order: prerequisites → directories → detect → initBeads → createAgentsMd → updateGitignore → writeConfig\n- [ ] Returns `InitResult` with `createdPaths` listing all new paths\n- [ ] Returns `InitResult` with `config` containing detected + default settings\n- [ ] Returns `InitResult` with `detectedSettings` from detectProjectSettings()\n- [ ] Throws `PrerequisiteError` if any prerequisite check fails (from F03a)\n\n### Summary\n- [ ] 28 tests pass\n\n## Types\n```typescript\ntype ProjectType = 'node' | 'python' | 'go' | 'unknown';\n\ninterface DetectedSettings {\n  testCommand?: string;\n  buildCommand?: string;\n  projectType: ProjectType;\n}\n\ninterface InitOptions {\n  agents: AgentType[];\n  defaultAgent?: AgentType;\n  maxParallel?: number;\n  interactive?: boolean;\n}\n\ninterface InitResult {\n  createdPaths: string[];\n  config: ChorusConfig;\n  detectedSettings: DetectedSettings;\n}\n\nclass BeadsInitError extends Error {\n  constructor(message: string, public exitCode: number) {\n    super(message);\n  }\n}\n\nclass PrerequisiteError extends Error {\n  constructor(message: string, public missing: MissingPrerequisite[]) {\n    super(message);\n  }\n}\n```\n\n## Detection Priority\nWhen multiple project files exist, detect in this order:\n1. `package.json` → node (highest priority)\n2. `pyproject.toml` → python\n3. `go.mod` → go\n4. None → unknown\n\n## AGENTS.md Template\n```markdown\n# Agents\n\nThis file documents agent behaviors for AI coding assistants.\n\n## Chorus\n\nThis project uses Chorus for multi-agent orchestration.\nSee `.chorus/` for configuration.\n```\n\n## Dependencies\n- F03a (ch-0z7) - Prerequisites check\n- F01c (ch-y43) - Config save\n\n## Files\n- src/services/InitScaffold.ts (NEW)\n- tests/services/InitScaffold.test.ts (NEW)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T11:20:13.868585+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:22:57.208537+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-mdj","depends_on_id":"ch-0z7","type":"blocks","created_at":"2026-01-10T11:20:13.870803+03:00","created_by":"deligoez"},{"issue_id":"ch-mdj","depends_on_id":"ch-y43","type":"blocks","created_at":"2026-01-10T11:20:13.872568+03:00","created_by":"deligoez"}]}
{"id":"ch-mnd","title":"F55a: ModeIndicator Component - Display operating mode with colored dot","description":"## What\nSimple component to display the current operating mode (semi-auto/autopilot) with a colored indicator dot.\n\n## Context from Master Plan\n```\nCHORUS v2.0                      semi-auto ● 3/50              ? for help\n```\n\n## API\n```typescript\n// src/components/ModeIndicator.tsx\n\ninterface ModeIndicatorProps {\n  mode: 'semi-auto' | 'autopilot';\n}\n\nfunction ModeIndicator({ mode }: ModeIndicatorProps): JSX.Element\n```\n\n## Visual Output\n- semi-auto: `semi-auto ●` (green dot via Ink `\u003cText color=\"green\"\u003e`)\n- autopilot: `autopilot ●` (yellow dot via Ink `\u003cText color=\"yellow\"\u003e`)\n\n## Files\n- src/components/ModeIndicator.tsx\n- src/components/ModeIndicator.test.tsx\n\n## Acceptance Criteria\n- [ ] Renders \"semi-auto\" text when mode='semi-auto'\n- [ ] Renders \"autopilot\" text when mode='autopilot'\n- [ ] Shows green dot (●) via `\u003cText color=\"green\"\u003e` for semi-auto mode\n- [ ] Shows yellow dot (●) via `\u003cText color=\"yellow\"\u003e` for autopilot mode\n- [ ] Handles undefined mode gracefully (shows \"unknown\" with gray dot)\n- [ ] Handles invalid mode string gracefully (shows \"unknown\" with gray dot)\n- [ ] Mode text and dot have correct spacing (single space between)\n- [ ] 7 tests pass\n\n## Tests\n1. Renders \"semi-auto\" text when mode='semi-auto'\n2. Renders \"autopilot\" text when mode='autopilot'\n3. Shows green dot for semi-auto\n4. Shows yellow dot for autopilot\n5. Handles undefined mode gracefully (shows \"unknown\")\n6. Handles invalid mode string gracefully (shows \"unknown\")\n7. Text and dot have correct spacing","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T12:48:07.102964+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:30:27.822194+03:00","labels":["m12-tui"]}
{"id":"ch-mpl","title":"F08: Signal Parser - Parse \u003cchorus\u003e signals from output","description":"## What\nParse \u003cchorus\u003e signals from agent output to detect completion, blocking, and other states.\n\n## Acceptance Criteria\n- [ ] parse() returns ParseResult with first signal found\n- [ ] parseAll() returns array of all signals in output\n- [ ] hasSignal() checks for specific signal type\n- [ ] isComplete() returns true for COMPLETE signal\n- [ ] isBlocked() returns true for BLOCKED signal\n- [ ] getProgress() returns number (0-100) or null\n- [ ] getReason() extracts reason from BLOCKED/NEEDS_HELP\n- [ ] Finds signal anywhere in output (not just end)\n- [ ] 10 tests pass\n\n## Files\n- src/types/signal.ts (NEW)\n- src/services/SignalParser.ts (NEW)\n- tests/services/SignalParser.test.ts (NEW)\n\n## API\n```typescript\ntype SignalType = 'COMPLETE' | 'BLOCKED' | 'NEEDS_HELP' | 'PROGRESS' | 'RESOLVED' | 'NEEDS_HUMAN';\n\ninterface Signal {\n  type: SignalType;\n  payload: string | null;\n  raw: string;\n}\n\ninterface ParseResult {\n  signal: Signal | null;\n  hasSignal: boolean;\n}\n\nclass SignalParser {\n  parse(output: string): ParseResult;\n  parseAll(output: string): Signal[];\n  hasSignal(output: string, type: SignalType): boolean;\n  isComplete(output: string): boolean;\n  isBlocked(output: string): boolean;\n  getProgress(output: string): number | null;\n  getReason(output: string): string | null;\n}\n```\n\n## Test Cases\n1. parse() returns COMPLETE signal\n2. parse() returns BLOCKED with reason\n3. parse() returns NEEDS_HELP with question\n4. parse() returns PROGRESS with percentage\n5. parse() returns null for no signal\n6. parse() finds signal in middle of output\n7. parseAll() finds multiple signals\n8. parseAll() returns empty for no signals\n9. isComplete() returns true for COMPLETE\n10. getProgress() clamps value to 0-100","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:38:13.856983+03:00","created_by":"deligoez","updated_at":"2026-01-10T02:34:33.427675+03:00","labels":["m2-agent-prep"]}
{"id":"ch-n6d","title":"F53: Hook Registry - Register and manage hook handlers","description":"## What\nRegistry for hook handlers - register, unregister, and list hooks per event.\n\n## API\n```typescript\n// src/services/HookRegistry.ts\n\nclass HookRegistry {\n  /**\n   * Register a hook handler for an event\n   */\n  register(handler: HookHandler): void\n\n  /**\n   * Unregister a hook handler\n   */\n  unregister(event: HookEvent, command: string): void\n\n  /**\n   * Get all handlers for an event\n   */\n  getHandlers(event: HookEvent): HookHandler[]\n\n  /**\n   * Check if event has any handlers\n   */\n  hasHandlers(event: HookEvent): boolean\n\n  /**\n   * Load handlers from .chorus/hooks/ directory\n   */\n  async loadFromDirectory(hooksDir: string): Promise\u003cvoid\u003e\n\n  /**\n   * Clear all handlers\n   */\n  clear(): void\n}\n```\n\n## Hook File Discovery Rules\n\n### Filename Convention\nFilename (without extension) MUST match a valid HookEvent:\n```\npre-agent-start.sh    → event: 'pre-agent-start'  ✓\npost-iteration.py     → event: 'post-iteration'   ✓\non-conflict.ts        → event: 'on-conflict'      ✓\nmy-custom-hook.sh     → IGNORED (not a valid HookEvent)\n```\n\n### Valid HookEvent Names (from F52 Hook Types)\n```typescript\ntype HookEvent = \n  | 'pre-agent-start'\n  | 'post-agent-stop'\n  | 'pre-iteration'\n  | 'post-iteration'\n  | 'on-conflict'\n  | 'pre-merge'\n  | 'post-merge'\n  | 'on-failure';\n```\n\n### File Requirements\n1. **Must be executable**: Check file mode (fs.access with X_OK)\n2. **Root level only**: Files in subdirectories are ignored\n3. **Any extension**: .sh, .py, .ts, .js all valid\n4. **Must match HookEvent**: Invalid event names are logged and skipped\n\n### Discovery Algorithm\n```\n1. List files in hooksDir (not recursive)\n2. For each file:\n   a. Skip if not a regular file (skip directories)\n   b. Skip if not executable\n   c. Extract event name: path.basename(file).split('.')[0]\n   d. Validate event name against HookEvent enum\n   e. If valid: register({ event, command: absolutePath, timeout: 30000 })\n   f. If invalid: log warning, skip\n```\n\n## Files\n- src/services/HookRegistry.ts\n- tests/services/HookRegistry.test.ts\n\n## Acceptance Criteria\n- [ ] `register()` adds handler to internal Map\u003cHookEvent, HookHandler[]\u003e\n- [ ] `register()` allows multiple handlers per event (array)\n- [ ] `unregister()` removes specific handler by command match\n- [ ] `unregister()` does nothing if handler not found\n- [ ] `getHandlers()` returns handlers array for event\n- [ ] `getHandlers()` returns empty array if no handlers\n- [ ] `hasHandlers()` returns true when handlers.length \u003e 0\n- [ ] `hasHandlers()` returns false when no handlers\n- [ ] `loadFromDirectory()` reads only root-level files\n- [ ] `loadFromDirectory()` skips non-executable files\n- [ ] `loadFromDirectory()` extracts event from filename (before first dot)\n- [ ] `loadFromDirectory()` validates event against HookEvent values\n- [ ] `loadFromDirectory()` ignores files with invalid event names\n- [ ] `loadFromDirectory()` registers with absolute path as command\n- [ ] `clear()` removes all handlers from all events\n- [ ] 15 tests pass\n\n## Tests\n1. register() adds handler to event\n2. register() allows multiple handlers per event\n3. unregister() removes handler by command\n4. unregister() does nothing for missing handler\n5. getHandlers() returns handlers for event\n6. getHandlers() returns empty array for no handlers\n7. hasHandlers() returns true when handlers exist\n8. hasHandlers() returns false when no handlers\n9. loadFromDirectory() reads root-level files\n10. loadFromDirectory() skips subdirectories\n11. loadFromDirectory() skips non-executable files\n12. loadFromDirectory() extracts event from \"pre-agent-start.sh\"\n13. loadFromDirectory() ignores invalid event name \"custom-hook.sh\"\n14. loadFromDirectory() registers with absolute path\n15. clear() removes all handlers","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T10:45:28.086391+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:27:47.273941+03:00","labels":["m11-hooks"],"dependencies":[{"issue_id":"ch-n6d","depends_on_id":"ch-b5x","type":"blocks","created_at":"2026-01-10T10:45:28.087917+03:00","created_by":"deligoez"}]}
{"id":"ch-nn6","title":"F54: Hook Runner - Execute hooks and handle responses","description":"## What\nExecute hook handlers and process their JSON input/output.\n\n## API\n```typescript\n// src/services/HookRunner.ts\n\ninterface HookRunnerOptions {\n  /**\n   * Behavior when a hook fails (timeout, crash, invalid output)\n   * - 'continue': Log error, return { result: 'continue' }, proceed to next hook\n   * - 'halt': Stop execution, propagate error up\n   * Default: 'continue' (hooks should not break orchestration)\n   */\n  onFailure: 'continue' | 'halt';\n}\n\nclass HookRunner {\n  constructor(\n    private registry: HookRegistry,\n    private options: HookRunnerOptions = { onFailure: 'continue' }\n  ) {}\n\n  /**\n   * Run all handlers for an event\n   * @param event Event type\n   * @param input Input data for hooks\n   * @returns Combined result from all hooks\n   */\n  async run(event: HookEvent, input: Omit\u003cHookInput, 'event'\u003e): Promise\u003cHookOutput\u003e\n\n  /**\n   * Run a single hook handler\n   * - Sends JSON via stdin\n   * - Parses JSON from stdout\n   * - Respects timeout\n   */\n  async runHandler(handler: HookHandler, input: HookInput): Promise\u003cHookOutput\u003e\n\n  /**\n   * Check if any hook blocked the action\n   */\n  isBlocked(outputs: HookOutput[]): boolean\n\n  /**\n   * Check if any hook signaled completion\n   */\n  isComplete(outputs: HookOutput[]): boolean\n}\n```\n\n## Error Handling Behavior\n\n### Failure Scenarios\n| Scenario | onFailure='continue' | onFailure='halt' |\n|----------|---------------------|------------------|\n| Hook times out | Log, return `{result:'continue'}` | Throw HookTimeoutError |\n| Hook exits non-zero | Log, return `{result:'continue'}` | Throw HookExecutionError |\n| Hook outputs invalid JSON | Log, return `{result:'continue'}` | Throw HookOutputError |\n| Hook outputs valid JSON | Use output as-is | Use output as-is |\n\n### Default: 'continue'\nRationale: Hooks are optional enhancements. A broken hook should not halt the entire orchestration.\nUser-installed hooks might have bugs - graceful degradation is preferred.\n\n### When to Use 'halt'\n- Critical security hooks (pre-merge validation)\n- Hooks that MUST succeed for correctness\n- Explicitly configured by user in config\n\n### Error Logging\nAll errors are logged with:\n- Hook command path\n- Event type\n- Error details (timeout duration, exit code, parse error)\n- Input that was sent (for debugging)\n\n## Combining Multiple Hook Outputs\n\nWhen multiple handlers exist for an event:\n```typescript\nrun() {\n  const outputs: HookOutput[] = [];\n  for (const handler of handlers) {\n    outputs.push(await runHandler(handler, input));\n  }\n  return combineOutputs(outputs);\n}\n\ncombineOutputs(outputs: HookOutput[]): HookOutput {\n  // Priority: block \u003e complete \u003e continue\n  if (outputs.some(o =\u003e o.result === 'block')) {\n    return { result: 'block', reason: outputs.find(o =\u003e o.result === 'block')?.reason };\n  }\n  if (outputs.some(o =\u003e o.result === 'complete')) {\n    return { result: 'complete' };\n  }\n  return { result: 'continue' };\n}\n```\n\n## Files\n- src/services/HookRunner.ts\n- tests/services/HookRunner.test.ts\n\n## Acceptance Criteria\n- [ ] `run()` executes all handlers from registry.getHandlers()\n- [ ] `run()` passes HookInput as JSON via stdin to subprocess\n- [ ] `run()` parses HookOutput from stdout JSON\n- [ ] `run()` respects handler.timeout (kills process after timeout)\n- [ ] `run()` returns `{result:'continue'}` when no handlers exist\n- [ ] `run()` combines multiple outputs (block \u003e complete \u003e continue)\n- [ ] `runHandler()` with onFailure='continue' logs and returns continue on timeout\n- [ ] `runHandler()` with onFailure='continue' logs and returns continue on non-zero exit\n- [ ] `runHandler()` with onFailure='continue' logs and returns continue on invalid JSON\n- [ ] `runHandler()` with onFailure='halt' throws HookTimeoutError on timeout\n- [ ] `runHandler()` with onFailure='halt' throws HookExecutionError on non-zero exit\n- [ ] `runHandler()` with onFailure='halt' throws HookOutputError on invalid JSON\n- [ ] `isBlocked()` returns true if any output.result === 'block'\n- [ ] `isBlocked()` returns false if no blocks\n- [ ] `isComplete()` returns true if any output.result === 'complete'\n- [ ] `isComplete()` returns false if no completes\n- [ ] 16 tests pass\n\n## Tests\n1. run() executes all handlers\n2. run() passes input via stdin as JSON\n3. run() parses output from stdout as JSON\n4. run() returns continue when no handlers\n5. run() combines outputs: block wins over continue\n6. run() combines outputs: complete wins over continue\n7. run() kills process on timeout\n8. runHandler() continue mode: logs and returns continue on timeout\n9. runHandler() continue mode: logs and returns continue on exit code 1\n10. runHandler() continue mode: logs and returns continue on invalid JSON\n11. runHandler() halt mode: throws HookTimeoutError on timeout\n12. runHandler() halt mode: throws HookExecutionError on exit code 1\n13. runHandler() halt mode: throws HookOutputError on invalid JSON\n14. isBlocked() returns true when any block\n15. isBlocked() returns false when no blocks\n16. isComplete() returns true when any complete","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T10:45:38.726297+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:28:12.342167+03:00","labels":["m11-hooks"],"dependencies":[{"issue_id":"ch-nn6","depends_on_id":"ch-n6d","type":"blocks","created_at":"2026-01-10T10:45:38.727874+03:00","created_by":"deligoez"}]}
{"id":"ch-nvo","title":"F57b: FooterBar Component - Bottom status line","description":"## What\nBottom status bar showing task summary stats, merge queue indicator, and help reminder.\n\n## Migration Note\n**This component replaces the bottom portion of existing StatusBar.tsx**\n- Existing: StatusBar only shows top bar (no footer)\n- New: FooterBar shows task stats + merge status + help hint\n- After implementing FooterBar, update Layout.tsx to add FooterBar at bottom\n\n## Context from Master Plan\n```\n├─────────────────────────────────────────────────────────────────────────────┤\n│ Tasks: 1 done, 3 running, 1 pending, 1 blocked | Merge: 1 queued | ? help   │\n└─────────────────────────────────────────────────────────────────────────────┘\n```\n\n## API\n```typescript\n// src/components/FooterBar.tsx\n\ninterface FooterBarProps {\n  taskStats: {\n    done: number;\n    running: number;\n    pending: number;\n    blocked: number;\n  };\n  mergeQueue: {\n    queued: number;\n    merging?: boolean;\n    conflict?: boolean;\n  };\n  showHelp?: boolean;       // default true\n}\n\nfunction FooterBar({ taskStats, mergeQueue, showHelp = true }: FooterBarProps): JSX.Element\n```\n\n## Visual Layout\n```\nTasks: 1 done, 3 running, 1 pending, 1 blocked | Merge: 1 queued | ? help\n[TaskSummaryStats]                              [MergeQueueIndicator] [help]\n```\n\n## Color Specs (Ink)\n- Pipe separator \"|\": color=\"gray\"\n- Help hint \"? help\": dimColor\n- Top border: borderTop, borderColor=\"gray\"\n\n## Files\n- src/components/FooterBar.tsx\n- src/components/FooterBar.test.tsx\n\n## Acceptance Criteria\n- [ ] Renders TaskSummaryStats with taskStats prop\n- [ ] Renders MergeQueueIndicator with mergeQueue prop\n- [ ] Shows \"? help\" hint with dimColor when showHelp=true\n- [ ] Uses gray pipe \"|\" separator between sections\n- [ ] Uses flexbox with horizontal alignment\n- [ ] Hides help hint when showHelp=false\n- [ ] Passes correct props to TaskSummaryStats\n- [ ] Passes correct props to MergeQueueIndicator\n- [ ] Has gray top border line (borderTop, borderColor=\"gray\")\n- [ ] 9 tests pass\n\n## Tests\n1. Renders TaskSummaryStats with correct props\n2. Renders MergeQueueIndicator with correct props\n3. Shows help hint with dimColor by default\n4. Hides help hint when showHelp=false\n5. Uses gray pipe separators\n6. Passes taskStats props correctly\n7. Passes mergeQueue props correctly\n8. Has gray top border\n9. Uses horizontal flexbox layout","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T12:49:25.867317+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:30:26.763249+03:00","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-nvo","depends_on_id":"ch-8w5","type":"blocks","created_at":"2026-01-10T12:49:25.869621+03:00","created_by":"deligoez"},{"issue_id":"ch-nvo","depends_on_id":"ch-105","type":"blocks","created_at":"2026-01-10T12:49:25.87148+03:00","created_by":"deligoez"}]}
{"id":"ch-ofm","title":"F50: Task Rollback - Revert all commits for a task","description":"## What\nRollback all commits associated with a task (Level 2 and Level 3 rollback).\n\n## Context from Master Plan\n\\`\\`\\`\nLevel 2: SINGLE TASK\n├── What: Undo all commits for one task\n├── How: git revert all commits with [task-id]\n└── State: Task → pending\n\nLevel 3: TASK + DEPENDENTS\n├── What: Undo task and all dependent tasks\n├── How: Identify chain, revert in order\n└── State: All affected → pending\n\\`\\`\\`\n\n## API\n\\`\\`\\`typescript\n// src/services/TaskRollback.ts\n\nclass TaskRollback {\n  constructor(private beadsCLI: BeadsCLI) {}\n\n  /**\n   * Revert all commits for a task (Level 2)\n   * Uses git revert for each commit with [task-id] in message\n   */\n  async rollback(taskId: string): Promise\u003cRollbackResult\u003e\n\n  /**\n   * Find all commits for a task\n   * Uses: git log --grep=\"[task-id]\" --format=\"%H\"\n   */\n  async findTaskCommits(taskId: string): Promise\u003cstring[]\u003e\n\n  /**\n   * Rollback task and all dependent tasks (Level 3)\n   * 1. Get dependent tasks via bd blocked-by\n   * 2. Rollback in reverse dependency order\n   */\n  async rollbackWithDependents(taskId: string): Promise\u003cRollbackResult\u003e\n}\n\\`\\`\\`\n\n## Commit Message Convention\nAgents MUST include task ID in commit messages for rollback to work:\n\\`\\`\\`\nfeat: implement user authentication [ch-abc]\n\n- Added login form\n- Added JWT validation\n\\`\\`\\`\n\nThe \\`[ch-xxx]\\` suffix is searched by \\`git log --grep\\`.\n\n## Files\n- src/services/TaskRollback.ts\n- tests/services/TaskRollback.test.ts\n\n## Acceptance Criteria\n- [ ] \\`rollback()\\` finds commits using git log --grep=\"[task-id]\"\n- [ ] \\`rollback()\\` reverts commits in reverse chronological order\n- [ ] \\`rollback()\\` returns task to pending status via beadsCLI\n- [ ] \\`rollback()\\` returns RollbackResult with revertedCommits list\n- [ ] \\`findTaskCommits()\\` returns commit hashes in order\n- [ ] \\`findTaskCommits()\\` returns empty array if no commits found\n- [ ] \\`rollbackWithDependents()\\` gets dependent tasks via bd CLI\n- [ ] \\`rollbackWithDependents()\\` reverts in correct order (dependents first)\n- [ ] \\`rollbackWithDependents()\\` returns all affected task IDs\n- [ ] 9 tests pass\n\n## Tests\n1. rollback() finds task commits\n2. rollback() reverts in correct order\n3. rollback() sets task to pending\n4. rollback() handles no commits found (returns success with empty list)\n5. findTaskCommits() returns correct commits\n6. findTaskCommits() returns empty for unknown task\n7. rollbackWithDependents() includes dependent tasks\n8. rollbackWithDependents() orders correctly (dependents first)\n9. rollbackWithDependents() sets all tasks to pending","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T10:44:48.050857+03:00","created_by":"deligoez","updated_at":"2026-01-10T12:27:55.158259+03:00","labels":["m10-rollback"],"dependencies":[{"issue_id":"ch-ofm","depends_on_id":"ch-2r5","type":"blocks","created_at":"2026-01-10T10:44:48.052322+03:00","created_by":"deligoez"},{"issue_id":"ch-ofm","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-10T12:28:02.465646+03:00","created_by":"deligoez"}]}
{"id":"ch-q1j","title":"F07b: Non-Claude Context Injection","description":"## What\nExtend PromptBuilder to inject context for non-Claude agents (codex, opencode).\n\n**Status:** DEFERRED - Will implement when non-Claude agent support is needed.\n\n## Why\nNon-Claude agents don't natively load `.claude/rules` or project context.\nThis task adds AGENTS.md and learnings injection for codex/opencode.\n\n## Acceptance Criteria\n\n### needsContextInjection() - 2 tests\n- [ ] Returns false for 'claude'\n- [ ] Returns true for 'codex', 'opencode'\n\n### Context Loading - 2 tests\n- [ ] `loadAgentsMd(projectDir)` reads AGENTS.md if exists\n- [ ] `loadLearnings(projectDir)` reads .agent/learnings.md if exists\n\n### build() Extension - 2 tests\n- [ ] Injects AGENTS.md content for non-Claude agents\n- [ ] Injects learnings content for non-Claude agents\n\n### Summary\n- [ ] 6 tests pass\n\n## Files\n- src/services/PromptBuilder.ts (UPDATE)\n- src/services/PromptBuilder.test.ts (UPDATE)\n\n## API Extension\n```typescript\ninterface PromptContext {\n  task: Bead;\n  agentType: AgentType;  // NEW\n  branch: string;\n  taskId: string;\n  config: ChorusConfig;\n  learnings?: string;    // NEW\n}\n\nclass PromptBuilder {\n  // Existing methods...\n  \n  // NEW methods for non-Claude\n  loadAgentsMd(projectDir: string): string | null;\n  loadLearnings(projectDir: string): string | null;\n  needsContextInjection(agentType: AgentType): boolean;\n}\n```\n\n## Tests\n1. needsContextInjection() returns false for claude\n2. needsContextInjection() returns true for codex\n3. loadAgentsMd() reads file when exists\n4. loadAgentsMd() returns null when missing\n5. build() injects AGENTS.md for codex\n6. build() injects learnings for non-claude","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T22:43:22.437116+03:00","created_by":"deligoez","updated_at":"2026-01-10T22:43:22.437116+03:00","labels":["deferred","m2-agent-prep"],"dependencies":[{"issue_id":"ch-q1j","depends_on_id":"ch-wk8","type":"blocks","created_at":"2026-01-10T22:43:22.442508+03:00","created_by":"deligoez"}]}
{"id":"ch-r12","title":"F02d: State Persistence - Debounced save and clear","description":"## What\nPersist state to disk with debouncing.\n\n## Acceptance Criteria\n- [ ] `save()` writes state to `.chorus/state.json`\n- [ ] `save()` creates parent directory if missing\n- [ ] `saveDebounced()` coalesces rapid calls within 100ms window\n- [ ] `saveDebounced()` writes only once after debounce period expires\n- [ ] `clear()` removes state file from disk\n- [ ] `clear()` returns silently if file does not exist (idempotent)\n- [ ] 6 tests pass\n\n## Files\n- src/services/StateService.ts (extend)\n- tests/services/StateService.test.ts (extend)\n\n## Implementation\n```typescript\nprivate saveTimeout: NodeJS.Timeout | null = null;\nprivate readonly DEBOUNCE_MS = 100;\n\nsave(): void {\n  const dir = path.dirname(this.statePath);\n  if (!fs.existsSync(dir)) fs.mkdirSync(dir, { recursive: true });\n  fs.writeFileSync(this.statePath, JSON.stringify(this.state, null, 2));\n}\n\nsaveDebounced(): void {\n  if (this.saveTimeout) clearTimeout(this.saveTimeout);\n  this.saveTimeout = setTimeout(() =\u003e this.save(), this.DEBOUNCE_MS);\n}\n\nclear(): void {\n  if (fs.existsSync(this.statePath)) {\n    fs.unlinkSync(this.statePath);\n  }\n  this.state = null;\n}\n```\n\n## Test Cases\n1. `save()` creates state.json file with valid JSON content\n2. `save()` creates .chorus directory if missing\n3. `saveDebounced()` called 3x in 50ms results in only 1 file write\n4. `saveDebounced()` writes file after 100ms debounce period\n5. `clear()` removes existing state file\n6. `clear()` does not throw when file does not exist","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:30:51.05887+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:22:57.718499+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-r12","depends_on_id":"ch-ah6","type":"blocks","created_at":"2026-01-10T01:30:51.060628+03:00","created_by":"deligoez"},{"issue_id":"ch-r12","depends_on_id":"ch-81x","type":"blocks","created_at":"2026-01-10T01:37:14.840129+03:00","created_by":"deligoez"}]}
{"id":"ch-sb7","title":"F46: Task Block - Manually block task and stop agent","description":"## What\nManually mark a task as blocked, stopping any agent working on it.\n\n## Design Decision: Blocked = Label (not Status)\n\n**Why label instead of status:**\n- Beads standard statuses: open, in_progress, closed\n- \"blocked\" is a modifier, not a state\n- Task can be \"open + blocked\" (ready to unblock)\n- Consistent with \"deferred\" (also a label)\n- BeadsCLI.getReadyTasks() excludes blocked labels\n\n## Context from Master Plan\n```\n7. BLOCK TASK (b)\n   - Manually mark task as blocked\n   - Agent stops, picks different task\n```\n\n## API\n```typescript\n// src/services/TaskBlocker.ts\n\nclass TaskBlocker {\n  constructor(\n    private agentStopper: AgentStopper,\n    private beadsCLI: BeadsCLI\n  ) {}\n\n  /**\n   * Block a task manually\n   * - If agent running on task, stop it via agentStopper.stopAgentByTask()\n   * - Add \"blocked\" label via beadsCLI.addLabel(taskId, 'blocked')\n   * - Set task status to \"open\" if was in_progress\n   * - Record block reason in task notes\n   */\n  async blockTask(taskId: string, reason: string): Promise\u003cInterventionResult\u003e\n\n  /**\n   * Unblock a task\n   * - Remove \"blocked\" label via beadsCLI.removeLabel(taskId, 'blocked')\n   * - Task remains open, now appears in getReadyTasks()\n   */\n  async unblockTask(taskId: string): Promise\u003cInterventionResult\u003e\n\n  /**\n   * Check if task is manually blocked\n   * - Checks for \"blocked\" label in task.labels\n   */\n  async isBlocked(taskId: string): Promise\u003cboolean\u003e\n}\n```\n\n## Files\n- src/services/TaskBlocker.ts\n- tests/services/TaskBlocker.test.ts\n\n## Acceptance Criteria\n- [ ] `blockTask()` calls agentStopper.stopAgentByTask() if agent running\n- [ ] `blockTask()` adds \"blocked\" label via beadsCLI\n- [ ] `blockTask()` sets status to \"open\" if was in_progress\n- [ ] `blockTask()` records reason in task notes\n- [ ] `blockTask()` returns InterventionResult with stopped agent if any\n- [ ] `unblockTask()` removes \"blocked\" label\n- [ ] `unblockTask()` returns success even if not blocked\n- [ ] `isBlocked()` checks task.labels for \"blocked\"\n- [ ] 8 tests pass\n\n## Tests\n1. blockTask() stops running agent\n2. blockTask() adds blocked label\n3. blockTask() sets status to open\n4. blockTask() records reason\n5. blockTask() returns affectedAgents when agent stopped\n6. unblockTask() removes blocked label\n7. unblockTask() when not blocked is OK\n8. isBlocked() checks labels correctly\n\n## Notes\n- **Blocked = label, not status** (design decision)\n- BeadsCLI.getReadyTasks({ excludeLabels: ['blocked', 'deferred'] })\n- Blocked tasks visible in TUI (grayed out) but not auto-assigned","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T10:44:00.289314+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:20:46.131774+03:00","labels":["m9-intervention"],"dependencies":[{"issue_id":"ch-sb7","depends_on_id":"ch-ahq","type":"blocks","created_at":"2026-01-10T10:44:00.290809+03:00","created_by":"deligoez"},{"issue_id":"ch-sb7","depends_on_id":"ch-cwy","type":"blocks","created_at":"2026-01-10T10:44:00.292179+03:00","created_by":"deligoez"},{"issue_id":"ch-sb7","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-10T12:16:20.871911+03:00","created_by":"deligoez"}]}
{"id":"ch-sl9","title":"F62a: BlockedTaskInfo Component - Show blocker information","description":"## What\nComponent to show blocker information for a blocked task.\n\n## Context from Master Plan\n```\n│ ⊗ ch-005 [P3] Refactor         │\n│   blocked by ch-001            │\n```\n\n## API\n```typescript\n// src/components/BlockedTaskInfo.tsx\n\ninterface BlockedTaskInfoProps {\n  blockers: Array\u003c{\n    id: string;\n    status: 'open' | 'in_progress' | 'closed';\n  }\u003e;\n}\n\nfunction BlockedTaskInfo({ blockers }: BlockedTaskInfoProps): JSX.Element\n```\n\n## Visual Output\n- Single blocker: `└─ Waiting: ch-001 (in_progress)`\n- Multiple blockers: `└─ Waiting: ch-001, ch-002`\n\n## Files\n- src/components/BlockedTaskInfo.tsx\n- src/components/BlockedTaskInfo.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows \"Waiting:\" prefix\n- [ ] Shows blocker ID(s)\n- [ ] Shows blocker status in parentheses for single blocker\n- [ ] Comma-separates multiple blockers (no status shown)\n- [ ] Uses tree branch character (└─)\n- [ ] Uses dim styling (Ink: dimColor prop on Text)\n- [ ] Returns null for empty blockers array\n- [ ] 7 tests pass\n\n## Tests\n1. Shows single blocker with status in parentheses\n2. Shows multiple blockers comma-separated without status\n3. Uses \"Waiting:\" prefix\n4. Uses tree branch character\n5. Uses dim styling\n6. Returns null for empty blockers array\n7. Handles mixed statuses in multiple blockers","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T12:51:46.480784+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:29:46.180368+03:00","labels":["m12-tui"]}
{"id":"ch-sro","title":"F01b: Config Load - Read config from .chorus/config.json","description":"## What\nLoad configuration from .chorus/config.json file.\n\n## Acceptance Criteria\n- [ ] load() reads and parses JSON file\n- [ ] Returns default config if file doesn't exist\n- [ ] Throws on invalid JSON\n- [ ] Caches loaded config\n- [ ] get() returns cached config (calls load if not cached)\n- [ ] exists() checks if config file exists\n- [ ] 5 tests pass\n\n## Files\n- src/services/ConfigService.ts (NEW - partial)\n- tests/services/ConfigService.test.ts (NEW)\n\n## Implementation\n```typescript\nexport class ConfigService {\n  private configPath: string;\n  private config: ChorusConfig | null = null;\n  \n  constructor(projectDir: string) {\n    this.configPath = path.join(projectDir, '.chorus', 'config.json');\n  }\n  \n  load(): ChorusConfig {\n    if (!fs.existsSync(this.configPath)) {\n      this.config = getDefaultConfig();\n      return this.config;\n    }\n    this.config = JSON.parse(fs.readFileSync(this.configPath, 'utf-8'));\n    return this.config;\n  }\n  \n  get(): ChorusConfig {\n    if (!this.config) return this.load();\n    return this.config;\n  }\n  \n  exists(): boolean {\n    return fs.existsSync(this.configPath);\n  }\n}\n```\n\n## Test Cases\n1. load() returns defaults when file missing\n2. load() parses existing config file\n3. load() throws on malformed JSON\n4. get() returns cached config\n5. exists() returns false when no file","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:30:22.3151+03:00","created_by":"deligoez","updated_at":"2026-01-10T02:23:37.380881+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-sro","depends_on_id":"ch-2n6","type":"blocks","created_at":"2026-01-10T01:30:22.316939+03:00","created_by":"deligoez"}]}
{"id":"ch-t31","title":"F27: Auto-Resolver","description":"## What\nAutomatically resolve trivial conflicts: whitespace, imports, and special file types.\n\n## Special File Merge Strategies\n\nEach special file type has a concrete, testable strategy:\n\n### 1. `.beads/issues.jsonl` - \"beads-merge\"\n**Strategy:** Accept both versions (JSONL is append-only)\n```typescript\n// Input: conflicting JSONL\n\u003c\u003c\u003c\u003c\u003c\u003c\u003c HEAD\n{\"id\": \"ch-abc\", \"title\": \"Task A\"}\n=======\n{\"id\": \"ch-xyz\", \"title\": \"Task B\"}\n\u003e\u003e\u003e\u003e\u003e\u003e\u003e feature\n\n// Output: both lines preserved\n{\"id\": \"ch-abc\", \"title\": \"Task A\"}\n{\"id\": \"ch-xyz\", \"title\": \"Task B\"}\n```\n**Test:** Parse both sides, concatenate, dedupe by id\n\n### 2. `package-lock.json` - \"regenerate\"\n**Strategy:** Delete conflicted file, run `npm install`\n```typescript\n// Mock: FileService.delete() + ProcessRunner.exec('npm install')\n// Verify: delete called, npm install called, returns success\n```\n**Test:** Verify correct commands called via mocks\n\n### 3. `.agent/learnings.md` - \"append-dedup\"\n**Strategy:** Parse markdown sections, merge, deduplicate by heading\n```typescript\n// Input: conflicting learnings\n\u003c\u003c\u003c\u003c\u003c\u003c\u003c HEAD\n## Pattern: Config Loading\nLoad config from file...\n=======\n## Pattern: Error Handling\nHandle errors gracefully...\n\u003e\u003e\u003e\u003e\u003e\u003e\u003e feature\n\n// Output: both sections preserved\n## Pattern: Config Loading\nLoad config from file...\n\n## Pattern: Error Handling\nHandle errors gracefully...\n```\n**Test:** Extract headings, concatenate sections, dedupe by heading text\n\n### 4. Auto-generated files - \"regenerate-command\"\n**Strategy:** Run configured command to regenerate\n```typescript\nconst AUTO_GENERATED: Record\u003cstring, string\u003e = {\n  'src/generated/types.ts': 'npm run generate:types',\n  'docs/api.md': 'npm run docs:generate',\n};\n```\n**Test:** Verify configured command executed via ProcessRunner mock\n\n## Mocking Strategy\n\n```typescript\ninterface FileService {\n  read(path: string): Promise\u003cstring\u003e;\n  write(path: string, content: string): Promise\u003cvoid\u003e;\n  delete(path: string): Promise\u003cvoid\u003e;\n}\n\ninterface ProcessRunner {\n  exec(command: string): Promise\u003c{ stdout: string; exitCode: number }\u003e;\n}\n\nclass AutoResolver {\n  constructor(\n    private files: FileService = new RealFileService(),\n    private process: ProcessRunner = new RealProcessRunner()\n  ) {}\n}\n```\n\n## Acceptance Criteria\n\n### resolveWhitespace() - 2 tests\n- [ ] Resolves conflict where only difference is trailing whitespace\n- [ ] Resolves conflict where only difference is indentation (tabs vs spaces)\n\n### resolveImports() - 2 tests\n- [ ] Merges `import` statements from both HEAD and feature branch\n- [ ] Removes duplicate imports and sorts alphabetically\n\n### resolveSpecialFile() - 4 tests\n- [ ] `.beads/issues.jsonl`: Concatenates both JSONL versions, dedupes by id\n- [ ] `package-lock.json`: Calls `files.delete()` then `process.exec('npm install')`\n- [ ] `.agent/learnings.md`: Parses markdown, merges sections, dedupes by heading\n- [ ] Auto-generated file: Calls `process.exec()` with configured command\n\n### canResolve() - 2 tests\n- [ ] Returns `true` for `ConflictType.WHITESPACE` and `ConflictType.IMPORTS`\n- [ ] Returns `true` when `filepath` matches key in `SPECIAL_FILES`\n\n## Files\n- src/services/AutoResolver.ts\n- src/services/FileService.ts (interface + RealFileService)\n- src/services/ProcessRunner.ts (interface + RealProcessRunner)\n- tests/services/AutoResolver.test.ts\n- tests/mocks/MockFileService.ts\n- tests/mocks/MockProcessRunner.ts\n\n**Total: 10 tests**","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T03:16:42.288688+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:25:43.675834+03:00","labels":["m5-merge"],"dependencies":[{"issue_id":"ch-t31","depends_on_id":"ch-7pb","type":"blocks","created_at":"2026-01-10T03:16:42.291207+03:00","created_by":"deligoez"}]}
{"id":"ch-tdt","title":"F63k: Agent Paused Status Indicator","description":"## What\nAdd `paused` status to AgentStatus type and agent display indicators.\n\n## Why\nMaster plan specifies:\n- `○ idle` (waiting for task)\n- `⏸ paused` (user paused)\n\nCurrent implementation has `stopped` but no `paused` distinction.\n\n## Acceptance Criteria\n- [ ] `AgentStatus` type includes `'paused'`\n- [ ] MainContent shows `○` for idle agents (gray)\n- [ ] MainContent shows `⏸` for paused agents (yellow)\n- [ ] Idle vs paused are visually distinct\n- [ ] 4 tests pass\n\n## Tests (src/components/MainContent.test.tsx)\n1. `shows ○ for idle agent`\n2. `shows ⏸ for paused agent`\n3. `idle indicator is gray colored`\n4. `paused indicator is yellow colored`\n\n## Files\n- src/types/agent.ts (add 'paused' to AgentStatus)\n- src/components/MainContent.tsx (update indicators)\n- src/components/MainContent.test.tsx (add tests)\n\n## Notes\n- `stopped` = agent terminated (exit)\n- `paused` = agent suspended by user (can resume)\n- `idle` = agent waiting for task assignment","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T22:17:42.137574+03:00","created_by":"deligoez","updated_at":"2026-01-10T22:17:42.137574+03:00","labels":["m12-tui"]}
{"id":"ch-tpj","title":"F02e: State Merge Queue - Manage merge queue operations","description":"## What\nManage merge queue in state for tracking branches ready to merge.\n\n## Acceptance Criteria\n- [ ] `enqueueMerge(item)` adds item to mergeQueue array\n- [ ] `enqueueMerge(item)` maintains priority sort (highest first)\n- [ ] `dequeueMerge()` returns and removes highest priority item\n- [ ] `dequeueMerge()` returns `undefined` when queue is empty\n- [ ] `updateMergeItem(taskId, partial)` modifies existing item by taskId\n- [ ] `updateMergeItem(taskId, partial)` does nothing if taskId not found (no throw)\n- [ ] `incrementStat(key)` increments specified SessionStats field by 1\n- [ ] `update(partial)` merges partial state into current state\n- [ ] 8 tests pass\n\n## Files\n- src/services/StateService.ts (extend)\n- tests/services/StateService.test.ts (extend)\n\n## Implementation\n```typescript\nenqueueMerge(item: MergeQueueItem): void {\n  this.state.mergeQueue.push(item);\n  this.state.mergeQueue.sort((a, b) =\u003e b.priority - a.priority);\n  this.saveDebounced();\n}\n\ndequeueMerge(): MergeQueueItem | undefined {\n  const item = this.state.mergeQueue.shift();\n  if (item) this.saveDebounced();\n  return item;\n}\n\nupdateMergeItem(taskId: string, partial: Partial\u003cMergeQueueItem\u003e): void {\n  const item = this.state.mergeQueue.find(i =\u003e i.taskId === taskId);\n  if (item) Object.assign(item, partial);\n  this.saveDebounced();\n}\n\nincrementStat(key: keyof SessionStats): void {\n  (this.state.stats[key] as number)++;\n  this.saveDebounced();\n}\n\nupdate(partial: Partial\u003cChorusState\u003e): void {\n  Object.assign(this.state, partial);\n  this.saveDebounced();\n}\n```\n\n## Test Cases\n1. `enqueueMerge()` adds item to mergeQueue\n2. `enqueueMerge()` sorts by priority descending (P1 before P3)\n3. `dequeueMerge()` returns highest priority item\n4. `dequeueMerge()` removes returned item from queue\n5. `dequeueMerge()` returns `undefined` when queue is empty\n6. `updateMergeItem()` modifies item matching taskId\n7. `updateMergeItem()` does not throw when taskId not found\n8. `incrementStat('tasksCompleted')` increases counter from 0 to 1","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T02:26:18.79708+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:22:59.140272+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-tpj","depends_on_id":"ch-81x","type":"blocks","created_at":"2026-01-10T02:26:18.802044+03:00","created_by":"deligoez"},{"issue_id":"ch-tpj","depends_on_id":"ch-ah6","type":"blocks","created_at":"2026-01-10T02:26:40.031341+03:00","created_by":"deligoez"}]}
{"id":"ch-uoa","title":"F11: Completion Checker - Detect task completion (signal + tests)","description":"## What\nCheck if agent has completed task using signal detection AND test verification.\n\n## Acceptance Criteria\n- [ ] `check()` returns `complete: false` if no signal\n- [ ] `check()` returns `complete: true` if signal + tests pass\n- [ ] `check()` returns `complete: false` if signal + tests fail\n- [ ] `check()` respects `requireTests` config option (false = skip tests)\n- [ ] `check()` runs tests in worktree path\n- [ ] `hasCompletionSignal()` quick check without running tests\n- [ ] `isBlocked()` detects BLOCKED signal and extracts reason\n- [ ] `needsHelp()` detects NEEDS_HELP signal and extracts question\n- [ ] CompletionResult includes: complete, hasSignal, testsPassed, reason, testOutput\n- [ ] 9 tests pass\n\n## Files\n- src/services/CompletionChecker.ts (NEW)\n- tests/services/CompletionChecker.test.ts (NEW)\n\n## Notes\n- AND logic: signal + tests = complete\n- requireTests: true (default) = tests must pass\n- requireTests: false = skip test check, signal alone is enough\n- isBlocked/needsHelp are helpers for Orchestrator (F15)\n\n## Completion Matrix\n| Signal | Tests | requireTests | Result |\n|--------|-------|--------------|--------|\n| ✓ | ✓ | true | COMPLETE |\n| ✓ | ✗ | true | Continue |\n| ✗ | ✓ | true | Continue |\n| ✗ | ✗ | true | Continue |\n| ✓ | - | false | COMPLETE |\n| ✗ | - | false | Continue |","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:38:59.126542+03:00","created_by":"deligoez","updated_at":"2026-01-10T11:09:13.741464+03:00","labels":["m3-task-mgmt"],"dependencies":[{"issue_id":"ch-uoa","depends_on_id":"ch-mpl","type":"blocks","created_at":"2026-01-10T01:38:59.129353+03:00","created_by":"deligoez"},{"issue_id":"ch-uoa","depends_on_id":"ch-k3d","type":"blocks","created_at":"2026-01-10T01:38:59.130889+03:00","created_by":"deligoez"}]}
{"id":"ch-uxk","title":"F39a: Learning Types - Learning and Scratchpad interfaces","description":"## What\nDefine TypeScript interfaces for the memory/learning system.\n\n## API\n```typescript\n// src/types/learning.ts\n\ninterface Learning {\n  id: string;\n  content: string;\n  category: string;  // 'performance' | 'testing' | 'patterns' | 'gotchas'\n  source: {\n    taskId: string;\n    agentType: AgentType;\n    timestamp: Date;\n  };\n}\n\ninterface Scratchpad {\n  path: string;\n  content: string;\n  learningsSection: string | null;\n}\n\ninterface LearningsFile {\n  path: string;  // '.agent/learnings.md'\n  categories: Map\u003cstring, Learning[]\u003e;\n}\n```\n\n## Files\n- src/types/learning.ts\n\n## Acceptance Criteria\n- [ ] `Learning` interface has id, content, category, source fields\n- [ ] `Scratchpad` interface has path, content, learningsSection fields\n- [ ] `LearningsFile` interface has path and categories fields\n- [ ] Source includes taskId, agentType, timestamp\n- [ ] Category is union type of valid categories\n- [ ] 5 tests pass\n\n## Tests\n1. Learning interface has required fields\n2. Scratchpad interface has required fields\n3. LearningsFile interface has required fields\n4. Source type is correct\n5. Category union type works","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T10:42:22.318154+03:00","created_by":"deligoez","updated_at":"2026-01-10T10:42:22.318154+03:00","labels":["m8-memory"]}
{"id":"ch-wk8","title":"F07: Prompt Builder - Build task prompts with context","description":"## What\nBuild agent prompts with task context, acceptance criteria, commit rules, and Chorus signal protocol.\n\n**Note:** This task covers Claude agent only. Non-Claude context injection is in F07b (deferred).\n\n## Acceptance Criteria\n\n### build() - Main Entry (3 tests)\n- [ ] `build()` returns string containing task title from `context.task.title`\n- [ ] `build()` returns string containing `context.branch` value\n- [ ] `build()` output contains sections in order: task section, then commit rules, then completion protocol\n\n### buildTaskSection() - 2 tests\n- [ ] `buildTaskSection(task)` returns string containing `task.title`\n- [ ] `buildTaskSection(task)` returns string containing `task.body` (acceptance criteria markdown)\n\n### buildCommitRulesSection() - 2 tests\n- [ ] `buildCommitRulesSection(\"ch-abc\")` returns string containing `[ch-abc]`\n- [ ] `buildCommitRulesSection(taskId)` returns string containing \"Commit Message Rules\"\n\n### buildCompletionSection() - 2 tests\n- [ ] `buildCompletionSection(config)` returns string containing `\u003cchorus\u003e`\n- [ ] `buildCompletionSection(config)` returns string containing signal format instructions\n\n### Summary\n- [ ] 9 tests pass\n\n## Files\n- src/services/PromptBuilder.ts (NEW)\n- src/services/PromptBuilder.test.ts (NEW)\n\n## API\n```typescript\ninterface PromptContext {\n  task: Bead;\n  branch: string;\n  taskId: string;\n  config: ChorusConfig;\n}\n\nclass PromptBuilder {\n  build(context: PromptContext): string;\n  buildTaskSection(task: Bead): string;\n  buildCommitRulesSection(taskId: string): string;\n  buildCompletionSection(config: ChorusConfig): string;\n}\n```\n\n## Commit Rules Section Template\n```markdown\n## Commit Message Rules\n\n**IMPORTANT:** Include task ID in every commit message for rollback support.\n\nFormat:\n```\n\u003ctype\u003e: \u003cdescription\u003e [\u003ctask-id\u003e]\n\n- Detail 1\n- Detail 2\n```\n\nExample:\n```\nfeat: implement user authentication [ch-abc]\n\n- Added login form\n- Added JWT validation\n```\n\nThe `[ch-xxx]` suffix is required for task rollback to work.\n```\n\n## Tests (9 total)\n1. `build()` returns string containing task title\n2. `build()` returns string containing branch name\n3. `build()` output has sections in correct order (task -\u003e commit rules -\u003e completion)\n4. `buildTaskSection()` returns string containing task.title\n5. `buildTaskSection()` returns string containing task.body\n6. `buildCommitRulesSection(\"ch-abc\")` returns string containing \"[ch-abc]\"\n7. `buildCommitRulesSection()` returns string containing \"Commit Message Rules\"\n8. `buildCompletionSection()` returns string containing \"\u003cchorus\u003e\"\n9. `buildCompletionSection()` returns string containing signal format\n\n## Notes\n- Claude agent loads its own context via .claude/rules\n- Non-Claude context injection (AGENTS.md, learnings) → F07b (deferred)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:38:04.926365+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:24:20.346983+03:00","labels":["m2-agent-prep"],"dependencies":[{"issue_id":"ch-wk8","depends_on_id":"ch-2n6","type":"blocks","created_at":"2026-01-10T11:00:15.753799+03:00","created_by":"deligoez"}]}
{"id":"ch-xe8","title":"F46b: Task Editor - Handle restart after task edit","description":"## What\nHandle the \"Edit Task\" intervention - when a task is edited while an agent is working on it, restart the agent with the updated prompt.\n\n## Context from Master Plan\n```\n4. EDIT TASK (e)\n   - Modify task description/criteria\n   - If agent running: signal restart\n```\n\n## Design Decision: No `bd edit` Integration\nThe `bd edit` command opens an interactive editor - this is a CLI concern, not a service concern.\nTaskEditor only handles the **notification** that a task was edited externally.\nThe TUI (InterventionPanel) handles opening `bd edit` as a subprocess.\n\n## API\n```typescript\n// src/services/TaskEditor.ts\n\nclass TaskEditor {\n  constructor(\n    private agentStopper: AgentStopper,\n    private orchestrator: Orchestrator\n  ) {}\n\n  /**\n   * Notify that a task was edited externally\n   * - Check if agent running via agentStopper.getAgentForTask()\n   * - If agent running, stop and restart with new prompt\n   * - If no agent, just return success\n   */\n  async notifyTaskEdited(taskId: string): Promise\u003cInterventionResult\u003e\n\n  /**\n   * Check if an agent is working on a task\n   */\n  hasAgentForTask(taskId: string): boolean\n\n  /**\n   * Get the agent ID working on a task (or null)\n   */\n  getAgentIdForTask(taskId: string): string | null\n}\n```\n\n## Files\n- src/services/TaskEditor.ts\n- tests/services/TaskEditor.test.ts\n\n## Acceptance Criteria\n- [ ] `notifyTaskEdited()` checks for agent via agentStopper.getAgentForTask()\n- [ ] `notifyTaskEdited()` returns success with action='none' if no agent running\n- [ ] `notifyTaskEdited()` stops agent via agentStopper.stopAgent() when running\n- [ ] `notifyTaskEdited()` restarts agent via orchestrator.spawnAgentForTask()\n- [ ] `notifyTaskEdited()` returns InterventionResult with affectedAgents array\n- [ ] `hasAgentForTask()` returns true when agent is working on task\n- [ ] `hasAgentForTask()` returns false when no agent on task\n- [ ] `getAgentIdForTask()` returns agent ID when running, null otherwise\n- [ ] 8 tests pass\n\n## Tests\n1. notifyTaskEdited() with no agent returns success with action='none'\n2. notifyTaskEdited() with agent stops it via agentStopper.stopAgent()\n3. notifyTaskEdited() restarts agent via orchestrator.spawnAgentForTask()\n4. notifyTaskEdited() returns affected agent ID in result\n5. notifyTaskEdited() returns empty affectedAgents when no agent\n6. hasAgentForTask() returns true when agent exists\n7. hasAgentForTask() returns false when no agent\n8. getAgentIdForTask() returns agentId or null appropriately\n\n## Note\n`bd edit` subprocess handling is done in InterventionPanel (F46c), not here.\nThis service only handles the post-edit notification and agent restart logic.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T12:07:26.106866+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:26:43.167772+03:00","labels":["m9-intervention"],"dependencies":[{"issue_id":"ch-xe8","depends_on_id":"ch-cwy","type":"blocks","created_at":"2026-01-10T12:07:26.108815+03:00","created_by":"deligoez"},{"issue_id":"ch-xe8","depends_on_id":"ch-0e7","type":"blocks","created_at":"2026-01-10T12:08:33.027038+03:00","created_by":"deligoez"}]}
{"id":"ch-xn6","title":"F28: Rebase-Retry","description":"## What\nResolves simple conflicts by rebasing feature branch onto latest main.\n\n## Conflict Detection Strategy\nRebase conflicts are detected by:\n1. Running `git rebase main` and checking exit code\n2. Exit code 0 = clean rebase (no conflicts)\n3. Non-zero exit + presence of `.git/rebase-merge/` or `.git/rebase-apply/` = conflicts\n4. Check `git status` for \"rebase in progress\" state\n\n## Dependency Injection Pattern\n```typescript\ninterface RebaseRetryDeps {\n  exec: (cmd: string) =\u003e Promise\u003c{ exitCode: number; stdout: string; stderr: string }\u003e;\n  fileExists: (path: string) =\u003e Promise\u003cboolean\u003e;\n}\n\nclass RebaseRetry {\n  constructor(private deps: RebaseRetryDeps) {}\n}\n```\n\n## Acceptance Criteria\n\n### rebase() - 3 tests\n- [ ] Returns `{ success: true, rebased: true }` when `git rebase main` exits 0\n- [ ] Returns `{ success: false, hadConflicts: true }` when exit code != 0 AND `.git/rebase-merge/` exists\n- [ ] Returns `{ success: false, hadConflicts: false, error: string }` on other git errors\n\n### rebaseAndRetry() - 2 tests\n- [ ] Calls `rebase()`, if success returns `{ ready: true }` for merge retry\n- [ ] Calls `rebase()`, if conflicts calls `abortRebase()` and returns `{ ready: false, aborted: true }`\n\n### abortRebase() - 1 test\n- [ ] Runs `git rebase --abort` via `deps.exec()` and returns success\n\n## Test Setup Pattern\n```typescript\nconst mockDeps: RebaseRetryDeps = {\n  exec: vi.fn(),\n  fileExists: vi.fn(),\n};\n\n// Clean rebase\nmockDeps.exec.mockResolvedValueOnce({ exitCode: 0, stdout: '', stderr: '' });\n\n// Conflict scenario\nmockDeps.exec.mockResolvedValueOnce({ exitCode: 1, stdout: '', stderr: 'CONFLICT' });\nmockDeps.fileExists.mockResolvedValueOnce(true); // .git/rebase-merge/ exists\n```\n\n## Files\n- src/services/RebaseRetry.ts\n- tests/services/RebaseRetry.test.ts\n\n## Plan\nSee: thoughts/shared/plans/features/F28-rebase-retry.md\n\n**Total: 6 tests**","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T03:16:43.477781+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:25:44.298297+03:00","labels":["m5-merge"],"dependencies":[{"issue_id":"ch-xn6","depends_on_id":"ch-7pb","type":"blocks","created_at":"2026-01-10T03:16:43.479618+03:00","created_by":"deligoez"}]}
{"id":"ch-y43","title":"F01c: Config Save - Write config to file with validation","description":"## What\nSave configuration to .chorus/config.json with validation.\n\n## Acceptance Criteria\n- [ ] save() writes config to file with 2-space indent JSON\n- [ ] save() creates .chorus/ directory if it doesn't exist\n- [ ] save() overwrites existing config file\n- [ ] update() merges partial config with current config\n- [ ] update() calls save() after merge\n- [ ] validate() returns true for valid ChorusConfig\n- [ ] validate() returns false for null/undefined input\n- [ ] validate() returns false for non-object input\n- [ ] validate() returns false when version is missing\n- [ ] validate() returns false when mode is invalid (not 'semi-auto' or 'autopilot')\n- [ ] validate() returns false when agents section is missing\n- [ ] validate() returns false when agents.default is not valid AgentType\n- [ ] validate() returns false when project.testCommand is missing\n- [ ] 7 tests pass\n\n## Files\n- src/services/ConfigService.ts (extend)\n- tests/services/ConfigService.test.ts (extend)\n\n## Implementation\n```typescript\nsave(config: ChorusConfig): void {\n  const dir = path.dirname(this.configPath);\n  if (!fs.existsSync(dir)) {\n    fs.mkdirSync(dir, { recursive: true });\n  }\n  fs.writeFileSync(this.configPath, JSON.stringify(config, null, 2));\n  this.config = config;\n}\n\nupdate(partial: Partial\u003cChorusConfig\u003e): void {\n  const current = this.get();\n  const merged = { ...current, ...partial };\n  this.save(merged);\n}\n\nvalidate(config: unknown): config is ChorusConfig {\n  if (!config || typeof config !== 'object') return false;\n  const c = config as Record\u003cstring, unknown\u003e;\n  if (!c.version || typeof c.version !== 'string') return false;\n  if (c.mode !== 'semi-auto' \u0026\u0026 c.mode !== 'autopilot') return false;\n  if (!c.agents || typeof c.agents !== 'object') return false;\n  const agents = c.agents as Record\u003cstring, unknown\u003e;\n  if (!['claude', 'codex', 'opencode'].includes(agents.default as string)) return false;\n  if (!c.project || !(c.project as Record\u003cstring, unknown\u003e).testCommand) return false;\n  return true;\n}\n```\n\n## Test Cases\n1. save() creates directory and writes formatted JSON\n2. save() overwrites existing file\n3. update() merges partial and saves\n4. validate() accepts valid ChorusConfig\n5. validate() rejects null, undefined, and non-objects\n6. validate() rejects invalid mode values\n7. validate() rejects missing required fields (version, agents.default, project.testCommand)\n\n## Notes\n- Validation is strict: missing any required field returns false\n- Partial update uses shallow merge (nested objects replaced, not merged)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:30:30.340211+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:23:16.592098+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-y43","depends_on_id":"ch-sro","type":"blocks","created_at":"2026-01-10T01:30:30.342251+03:00","created_by":"deligoez"}]}
{"id":"ch-zqi","title":"F12: Task Claimer - Claim tasks via bd CLI","description":"## What\nBeads CLI wrapper for task operations: claim, release, query, create, and **filtered retrieval**.\n\n**IMPORTANT:** All Chorus components MUST use BeadsCLI to access Beads. Direct `bd` calls are prohibited.\n\n## Acceptance Criteria\n\n### claimTask() - 2 tests\n- [ ] `claimTask(id, assignee)` runs `bd update \u003cid\u003e --status=in_progress --assignee=\u003cagent\u003e`\n- [ ] `claimTask()` throws on bd error\n\n### releaseTask() - 2 tests\n- [ ] `releaseTask(id)` runs `bd update \u003cid\u003e --status=open --assignee=`\n- [ ] `releaseTask()` throws on bd error\n\n### getTask() - 3 tests\n- [ ] `getTask(id)` returns parsed task for valid ID\n- [ ] `getTask(id)` returns null for invalid ID\n- [ ] `getTask(id)` includes custom fields (model, agent, acceptance_criteria)\n\n### getReadyTasks() - 6 tests\n- [ ] `getReadyTasks()` returns array of ready tasks\n- [ ] `getReadyTasks({ excludeLabels: ['deferred'] })` filters out tasks with deferred label\n- [ ] `getReadyTasks({ includeLabels: ['m1-infrastructure'] })` returns only tasks with that label\n- [ ] `getReadyTasks({ includeLabels: ['m1'], excludeLabels: ['deferred'] })` excludes first, then includes (see precedence)\n- [ ] `getReadyTasks()` returns empty array on error\n- [ ] `getReadyTasks()` with empty options returns all ready tasks\n\n### Filter Precedence Rules\n**CRITICAL: Exclude always wins over include.**\n\n```\nFilter Algorithm:\n1. Start with all ready tasks from bd\n2. Apply excludeLabels: remove any task where task.labels includes ANY excludeLabel\n3. Apply includeLabels: keep only tasks where task.labels includes ANY includeLabel\n4. Return filtered list\n```\n\n**Example with precedence:**\n```\nTasks:\n  - A: labels=['m1', 'deferred']\n  - B: labels=['m1']\n  - C: labels=['m2']\n\ngetReadyTasks({ includeLabels: ['m1'], excludeLabels: ['deferred'] })\n  Step 1: [A, B, C]\n  Step 2 (exclude 'deferred'): [B, C]  // A removed\n  Step 3 (include 'm1'): [B]           // C removed\n  Result: [B]\n```\n\n**Edge case: same label in both arrays**\n```\ngetReadyTasks({ includeLabels: ['m1'], excludeLabels: ['m1'] })\n  → Returns [] (exclude wins, all m1 tasks removed before include filter)\n```\n\n### createTask() - 3 tests\n- [ ] `createTask(title, options)` runs `bd create` with priority, labels, depends\n- [ ] `createTask()` supports custom fields via `--custom model=X`\n- [ ] `createTask()` returns created task ID\n\n### Utility - 2 tests\n- [ ] `isAvailable()` returns true if bd installed\n- [ ] `isInitialized()` returns true if .beads/ exists\n\n### Summary\n- [ ] 18 tests pass\n\n## Types\n```typescript\ninterface GetReadyOptions {\n  excludeLabels?: string[];  // e.g., ['deferred', 'v2'] - applied FIRST\n  includeLabels?: string[];  // e.g., ['m1-infrastructure'] - applied SECOND\n}\n\ninterface TaskOptions {\n  priority?: 1 | 2 | 3 | 4;\n  labels?: string[];\n  depends?: string[];\n  model?: string;\n  agent?: AgentType;\n  acceptanceCriteria?: string[];\n}\n\ninterface Task {\n  id: string;\n  title: string;\n  description?: string;\n  priority: number;\n  status: string;\n  labels: string[];\n  dependencies: string[];\n  custom?: {\n    model?: string;\n    agent?: string;\n    acceptance_criteria?: string[];\n  };\n}\n```\n\n## Files\n- src/services/BeadsCLI.ts (NEW)\n- src/services/BeadsCLI.test.ts (NEW)\n\n## Notes\n- Use execa for CLI calls\n- Parse JSON output (bd show --json, bd ready --json)\n- projectDir is cwd for all bd commands\n- **Label filtering happens in-memory after bd ready --json returns**\n- Default excludeLabels in production: ['deferred']","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-10T01:39:31.364679+03:00","created_by":"deligoez","updated_at":"2026-01-10T23:24:31.544719+03:00","labels":["m3-task-mgmt"]}
