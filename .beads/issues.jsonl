{"id":"bd-41v","title":"F01: Config System - Read/write .chorus/config.json","description":"## What\nRead/write .chorus/config.json for persistent settings.\n\n## Acceptance Criteria\n- [ ] Can load config from .chorus/config.json\n- [ ] Returns default config if file doesn't exist\n- [ ] Can save config to file\n- [ ] Creates .chorus/ directory if needed\n- [ ] Validates config structure\n- [ ] 8 tests pass\n\n## Files\n- src/types/config.ts (NEW)\n- src/services/ConfigService.ts (NEW)\n- tests/services/ConfigService.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F01-config-system.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:23:49.453114+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m1-infrastructure"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-47p","title":"F08: Signal Parser - Parse \u003cchorus\u003e signals from agent output","description":"## What\nParse \u003cchorus\u003e signals from agent output.\n\n## Acceptance Criteria\n- [ ] Parses COMPLETE, BLOCKED, PROGRESS signals\n- [ ] Returns null for no signal\n- [ ] isComplete(), isBlocked() helpers\n- [ ] getProgress() returns number\n- [ ] getReason() extracts reason text\n- [ ] 10 tests pass\n\n## Files\n- src/types/signal.ts (NEW)\n- src/services/SignalParser.ts (NEW)\n- tests/services/SignalParser.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F08-signal-parser.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:24:46.721297+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m2-agent-prep"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-bin","title":"F02: State System - Runtime state in .chorus/state.json","description":"## What\nManage runtime state in .chorus/state.json (transient, gitignored).\n\n## Acceptance Criteria\n- [ ] Can initialize new session state\n- [ ] Can load existing state for recovery\n- [ ] Can add/update/remove agents from state\n- [ ] Can manage merge queue\n- [ ] Persists changes with debounce (100ms)\n- [ ] clear() removes state file\n- [ ] 8 tests pass\n\n## Files\n- src/types/state.ts (NEW)\n- src/services/StateService.ts (NEW)\n- tests/services/StateService.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F02-state-system.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:23:57.385137+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m1-infrastructure"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-bxq","title":"F09: Agent-Task Linking - Associate agent with task ID","description":"## What\nAssociate spawned agents with task IDs, track in store and state.\n\n## Acceptance Criteria\n- [ ] Agent type includes taskId, agentType, worktree, branch\n- [ ] getAgentByTaskId() finds correct agent\n- [ ] getAgentsByType() filters correctly\n- [ ] incrementIteration() updates count\n- [ ] 5 tests pass\n\n## Files\n- src/types/agent.ts (extend)\n- src/stores/agentStore.ts (extend)\n- tests/stores/agentStore.test.ts (extend)\n\n## Plan\nSee: thoughts/shared/plans/features/F09-agent-task-linking.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:24:54.82499+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m2-agent-prep"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-d7v","title":"F07: Prompt Builder - Build agent prompts with task context","description":"## What\nBuild agent prompts with task context, acceptance criteria, signal protocol.\n\n## Acceptance Criteria\n- [ ] Generates prompt with task description\n- [ ] Includes acceptance criteria (or default)\n- [ ] Includes completion protocol with signal\n- [ ] Claude: no extra injection\n- [ ] Codex/OpenCode: includes AGENTS.md + learnings\n- [ ] 8 tests pass\n\n## Files\n- src/services/PromptBuilder.ts (NEW)\n- tests/services/PromptBuilder.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F07-prompt-builder.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:24:46.64524+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m2-agent-prep"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-hix","title":"F06: Worktree Service Complete - Full lifecycle management","description":"## What\nComplete worktree lifecycle: create, list, query, remove.\n\n## Acceptance Criteria\n- [ ] All F04 create tests pass\n- [ ] All F05 cleanup tests pass\n- [ ] list() returns all agent worktrees\n- [ ] getInfo() returns complete info\n- [ ] removeAll() cleans up everything\n- [ ] 4 additional tests (14 total)\n\n## Files\n- src/services/WorktreeService.ts (finalize)\n- tests/services/WorktreeService.test.ts (complete)\n\n## Plan\nSee: thoughts/shared/plans/features/F06-worktree-service.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:24:27.012325+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m1-infrastructure"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-jez","title":"F05: Worktree Cleanup - git worktree remove after merge","description":"## What\nRemove git worktrees after merge.\n\n## Acceptance Criteria\n- [ ] Removes worktree directory\n- [ ] Deletes branch if merged to main\n- [ ] Keeps branch if not merged (warning)\n- [ ] Force option for uncommitted changes\n- [ ] Throws if worktree doesn't exist\n- [ ] 5 tests pass\n\n## Files\n- src/services/WorktreeService.ts (extend)\n- tests/services/WorktreeService.test.ts (extend)\n\n## Plan\nSee: thoughts/shared/plans/features/F05-worktree-cleanup.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:24:18.998566+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m1-infrastructure"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-mdv","title":"F04: Worktree Create - git worktree add for agent isolation","description":"## What\nCreate git worktrees for agent isolation.\n\n## Acceptance Criteria\n- [ ] Creates worktree at .worktrees/{agent}-{task}\n- [ ] Creates branch agent/{agent}/{task} from main\n- [ ] Creates .worktrees/ directory if needed\n- [ ] Throws if worktree already exists\n- [ ] Returns correct WorktreeInfo\n- [ ] 5 tests pass\n\n## Files\n- src/services/WorktreeService.ts (NEW - partial)\n- tests/services/WorktreeService.test.ts (NEW)\n\n## Plan\nSee: thoughts/shared/plans/features/F04-worktree-create.md","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:24:04.989699+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:29:59.047538+03:00","labels":["critical-path","feature","m1-infrastructure"],"deleted_at":"2026-01-10T01:29:59.047538+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"bd-uvl","title":"F05: Worktree Remove - Cleanup after merge","description":"## What\nRemove git worktrees after task completion.\n\n## Acceptance Criteria\n- [ ] remove() runs: git worktree remove {path}\n- [ ] Deletes branch if merged to main\n- [ ] Keeps branch if not merged (logs warning)\n- [ ] force option for uncommitted changes\n- [ ] 5 tests pass\n\n## Files\n- src/services/WorktreeService.ts (extend)\n- tests/services/WorktreeService.test.ts (extend)\n\n## Test Cases\n1. remove() deletes worktree dir\n2. remove() deletes merged branch\n3. remove() keeps unmerged branch\n4. remove() with force works\n5. remove() throws if not exists","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:31:03.293979+03:00","created_by":"deligoez","updated_at":"2026-01-10T01:31:30.582217+03:00","labels":["critical-path","feature","m1-infrastructure"],"deleted_at":"2026-01-10T01:31:30.582217+03:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"ch-001","title":"Write hello to test.txt","description":"Create test.txt and write 'Hello from Chorus!'","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-10T01:23:14.777764+03:00","updated_at":"2026-01-10T01:47:09.417655+03:00","deleted_at":"2026-01-10T01:47:09.417655+03:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"ch-002","title":"Count to 10","description":"Print numbers 1 to 10","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-10T01:23:14.777764+03:00","updated_at":"2026-01-10T01:47:09.485954+03:00","deleted_at":"2026-01-10T01:47:09.485954+03:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"ch-003","title":"Show current date","status":"tombstone","priority":3,"issue_type":"task","assignee":"agent-1","created_at":"2026-01-10T01:23:14.777764+03:00","updated_at":"2026-01-10T01:47:09.553706+03:00","deleted_at":"2026-01-10T01:47:09.553706+03:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"ch-02h","title":"F63e: Manual Done (d) - Mark selected task as done","description":"## What\nKeyboard handler for 'd' key to manually mark the selected task as done.\n\n## Shortcut\n- **d** - Mark selected task as done (manual completion)\n\n## API\n```typescript\n// Update src/hooks/useKeyboard.ts\n\ninterface UseKeyboardOptions {\n  // ... existing options\n  onMarkDone?: () =\u003e void;\n}\n\n// Or in useTaskSelection hook:\ninterface UseTaskSelectionReturn {\n  // ... existing\n  markSelectedDone: () =\u003e Promise\u003cvoid\u003e;\n}\n```\n\n## Unit Testing Strategy\n\nAll tests use mocked dependencies:\n\n```typescript\n// Mock TaskCloser\nconst mockTaskCloser = { closeTask: vi.fn() };\n\n// Mock AgentStopper  \nconst mockAgentStopper = { stopAgent: vi.fn() };\n\n// Mock SlotManager\nconst mockSlotManager = { releaseSlot: vi.fn() };\n\n// Test: verify correct mock methods called\nexpect(mockTaskCloser.closeTask).toHaveBeenCalledWith('ch-001');\n```\n\n## Files\n- src/hooks/useKeyboard.ts (UPDATE)\n- src/hooks/useKeyboard.test.ts (UPDATE)\n\n## Acceptance Criteria\n- [ ] 'd' key triggers markSelectedDone callback\n- [ ] markSelectedDone() is no-op when no task selected\n- [ ] markSelectedDone() calls taskCloser.closeTask(selectedTaskId)\n- [ ] markSelectedDone() calls agentStopper.stopAgent() if task has running agent\n- [ ] markSelectedDone() calls slotManager.releaseSlot() after agent stopped\n- [ ] markSelectedDone() triggers UI re-render after close\n\n### Summary\n- [ ] 6 tests pass\n\n## Test Cases (Unit Tests with Mocks)\n1. 'd' key calls markSelectedDone callback\n2. markSelectedDone() returns early when selectedTaskId is null\n3. markSelectedDone() calls mockTaskCloser.closeTask with selectedTaskId\n4. markSelectedDone() calls mockAgentStopper.stopAgent when task has agent\n5. markSelectedDone() calls mockSlotManager.releaseSlot after stopAgent\n6. markSelectedDone() triggers state update (useStore update call)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T21:53:51.670465+03:00","created_by":"deligoez","updated_at":"2026-01-11T23:13:11.292962+03:00","closed_at":"2026-01-11T23:13:11.292962+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-02h","depends_on_id":"ch-dzz","type":"blocks","created_at":"2026-01-10T21:53:57.175208+03:00","created_by":"deligoez"},{"issue_id":"ch-02h","depends_on_id":"ch-cwy","type":"blocks","created_at":"2026-01-11T14:01:39.947336+03:00","created_by":"deligoez"},{"issue_id":"ch-02h","depends_on_id":"ch-i9i","type":"blocks","created_at":"2026-01-11T14:01:41.40194+03:00","created_by":"deligoez"}]}
{"id":"ch-06m","title":"F80a: Project Detector Service","description":"## What\nDetect project type from configuration files (package.json, composer.json, etc.).\n\n## Files\n- `src/services/ProjectDetector.ts`\n- `src/services/ProjectDetector.test.ts`\n\n## Acceptance Criteria\n- [ ] `detect()` returns ProjectType enum value\n- [ ] `detect()` identifies Node.js from `package.json`\n- [ ] `detect()` identifies PHP from `composer.json`\n- [ ] `detect()` identifies Python from `pyproject.toml` or `requirements.txt`\n- [ ] `detect()` identifies Go from `go.mod`\n- [ ] `detect()` identifies Rust from `Cargo.toml`\n- [ ] `detect()` returns `'unknown'` if no config files found\n- [ ] `suggestQualityCommands(type: ProjectType)` returns default commands per type\n- [ ] `getProjectName()` extracts name from config file (package.json name, etc.)\n- [ ] `getProjectName()` returns directory name if no name in config\n- [ ] 10 tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:04:56.599521+03:00","created_by":"deligoez","updated_at":"2026-01-11T22:27:16.906261+03:00","closed_at":"2026-01-11T22:27:16.906261+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-06m","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:13.431774+03:00","created_by":"deligoez"}]}
{"id":"ch-080n","title":"E2E-10: Assign Task (Enter)","description":"## What\nVerify Enter assigns task to idle agent.\n\n## Tests (3 tests)\n1. Enter assigns selected task to idle agent\n2. Agent tile shows task ID\n3. Task shows iteration display\n\n## Files\n- src/e2e/assign-task.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T21:18:12.457738+03:00","created_by":"deligoez","updated_at":"2026-01-12T05:33:15.386958+03:00","closed_at":"2026-01-12T05:33:15.386958+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-080n","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:18:12.460069+03:00","created_by":"deligoez"},{"issue_id":"ch-080n","depends_on_id":"ch-ukl","type":"blocks","created_at":"2026-01-11T21:18:12.462081+03:00","created_by":"deligoez"}]}
{"id":"ch-0e01","title":"E2E-00: Test Infrastructure","description":"## What\nSet up cli-testing-library based E2E testing infrastructure.\n\n## Acceptance Criteria\n- [ ] npm install cli-testing-library\n- [ ] Create src/test-utils/e2e-helpers.ts with:\n  - renderApp() - spawn chorus process\n  - waitForText(text, timeout) - wait for output\n  - pressKey(key) - simulate single key\n  - pressKeys([keys]) - simulate key sequence\n  - cleanup() - kill process\n- [ ] Vitest config for E2E tests (longer timeout)\n- [ ] 3 smoke tests pass\n\n## Tests\n1. renderApp() spawns process and shows output\n2. waitForText() finds text in output\n3. pressKey() sends input to process\n\n## Files\n- package.json\n- src/test-utils/e2e-helpers.ts (NEW)\n- src/test-utils/e2e-helpers.test.ts (NEW)\n- vitest.config.e2e.ts (NEW - optional)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-11T21:17:31.32594+03:00","created_by":"deligoez","updated_at":"2026-01-11T21:29:16.441233+03:00","closed_at":"2026-01-11T21:29:16.441233+03:00","close_reason":"Closed","labels":["m12-tui"]}
{"id":"ch-0e7","title":"F15a: Orchestrator Core - Task Assignment","description":"## What\nCentral coordinator: task selection → worktree creation → prompt building → agent spawning → tracking.\n\n**IMPORTANT:** All Beads access MUST go through BeadsCLI (F12). No direct `bd` CLI calls.\n\n## Acceptance Criteria\n\n### Types (src/types/orchestration.ts)\n- [ ] AssignmentResult: success, agentId, taskId, worktree, error?\n- [ ] OrchestratorConfig: projectDir, config, agentManager, beadsCLI\n- [ ] TaskAssignment: taskId, agentType, modelOverride?\n\n### Constructor\n- [ ] Receives BeadsCLI instance via dependency injection\n- [ ] Stores beadsCLI as private field\n\n### assignTask()\n- [ ] Creates worktree for task\n- [ ] Claims task via `beadsCLI.claimTask()`\n- [ ] Builds prompt with task context\n- [ ] Spawns agent in worktree directory\n- [ ] Copies `.chorus/templates/scratchpad.md` to `{worktree}/.agent/scratchpad.md`\n- [ ] Substitutes `{task_id}` placeholder in scratchpad template\n- [ ] Verifies AGENTS.md is accessible in worktree\n- [ ] Returns AssignmentResult on success\n- [ ] Emits \"assigned\" event\n- [ ] Returns error if task not found\n- [ ] Returns error if task already assigned\n- [ ] Returns error if dependencies not met\n\n### canAssign()\n- [ ] Returns `{ can: true }` for ready open task\n- [ ] Returns `{ can: false }` for in_progress task\n- [ ] Returns `{ can: false }` for closed task\n- [ ] Returns `{ can: false }` if max agents reached\n- [ ] Checks dependencies are closed\n\n### getAgentType()\n- [ ] Uses task custom.agent if specified\n- [ ] Falls back to config default\n\n### Helper Methods\n- [ ] `getTask(id)` delegates to `beadsCLI.getTask()`\n- [ ] `getReadyTasks()` delegates to `beadsCLI.getReadyTasks({ excludeLabels: ['deferred'] })`\n- [ ] `getAgentConfig(type)` returns config for agent type\n- [ ] Passes CHORUS_TASK_ID, CHORUS_BRANCH env vars\n- [ ] Applies model override if allowed\n\n### Summary\n- [ ] 21 tests pass\n\n## Files\n- src/services/Orchestrator.ts (NEW)\n- src/types/orchestration.ts (NEW)\n- src/services/Orchestrator.test.ts (NEW)\n\n## Scratchpad Template Setup\n```typescript\n// During assignTask():\nconst templatePath = path.join(projectDir, '.chorus/templates/scratchpad.md');\nconst targetDir = path.join(worktreePath, '.agent');\nconst targetPath = path.join(targetDir, 'scratchpad.md');\n\n// Create .agent directory if needed\nawait fs.mkdir(targetDir, { recursive: true });\n\n// Copy and substitute template\nlet content = await fs.readFile(templatePath, 'utf-8');\ncontent = content.replace(/\\{task_id\\}/g, taskId);\nawait fs.writeFile(targetPath, content);\n\n// Verify AGENTS.md accessible\nconst agentsMdPath = path.join(worktreePath, 'AGENTS.md');\nif (!await fs.access(agentsMdPath).then(() =\u003e true).catch(() =\u003e false)) {\n  console.warn('AGENTS.md not found in worktree');\n}\n```\n\n## Notes\n- Core service - everything flows through here\n- Extends EventEmitter for 'assigned', 'error' events\n- Agent spawn in worktree cwd\n- Completion handling is F16 (not here)\n- Timeout handling is F15b (separate task)\n- **All Beads access via BeadsCLI - never direct bd calls**\n- **getReadyTasks excludes deferred tasks by default**\n- **Scratchpad template enables agent iteration tracking**\n- **AGENTS.md provides repo-specific agent guidance**","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T01:47:53.010882+03:00","created_by":"deligoez","updated_at":"2026-01-11T19:49:12.495717+03:00","closed_at":"2026-01-11T19:49:12.495717+03:00","close_reason":"Closed","labels":["m4-orchestration"],"dependencies":[{"issue_id":"ch-0e7","depends_on_id":"ch-iel","type":"blocks","created_at":"2026-01-10T01:47:53.01358+03:00","created_by":"deligoez"},{"issue_id":"ch-0e7","depends_on_id":"ch-wk8","type":"blocks","created_at":"2026-01-10T01:47:53.015317+03:00","created_by":"deligoez"},{"issue_id":"ch-0e7","depends_on_id":"ch-3y0","type":"blocks","created_at":"2026-01-10T01:47:53.016714+03:00","created_by":"deligoez"},{"issue_id":"ch-0e7","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-10T01:47:53.01801+03:00","created_by":"deligoez"},{"issue_id":"ch-0e7","depends_on_id":"ch-glq","type":"blocks","created_at":"2026-01-11T13:31:07.881885+03:00","created_by":"deligoez"}]}
{"id":"ch-0el","title":"F82b: Conversation Manager Service","description":"## What\nManage user↔agent dialogue with history tracking.\n\n## Files\n- `src/services/ConversationManager.ts`\n- `src/services/ConversationManager.test.ts`\n\n## Acceptance Criteria\n- [ ] `addUserMessage(text: string)` adds user message with timestamp\n- [ ] `addAgentMessage(text: string)` adds agent response with timestamp\n- [ ] `addSystemMessage(text: string)` adds system message with timestamp\n- [ ] `getHistory()` returns all messages array\n- [ ] `getLastN(n: number)` returns last N messages\n- [ ] `clear()` resets conversation to empty\n- [ ] `toPromptFormat()` formats messages for agent input\n- [ ] Each message has `role`, `content`, `timestamp` fields\n- [ ] Handles context window limits (truncates oldest when \u003e limit)\n- [ ] `serialize()` returns JSON string for persistence\n- [ ] `restore(json: string)` restores from serialized state\n- [ ] 12 tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:06:38.395767+03:00","created_by":"deligoez","updated_at":"2026-01-11T22:32:46.750043+03:00","closed_at":"2026-01-11T22:32:46.750043+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-0el","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:13.808694+03:00","created_by":"deligoez"}]}
{"id":"ch-0fwe","title":"F63-merge-view: Merge Queue View Key (M) - Open merge queue panel","description":"## What\nKeyboard handler for 'M' key to open the merge queue panel.\n\n## Context from Master Plan\n```\nGENERAL\nM    Merge queue view\n```\n\n## Shortcut\n- **M** (Shift+m) - Open merge queue panel\n\n## Behavior\n- Opens a panel showing the merge queue status\n- Shows: queued merges, in-progress merge, completed merges\n- Can view conflict status for each merge\n- Can approve/reject from this panel\n\n## Implementation\n\n```typescript\n// src/hooks/useMergeViewKey.ts\n\ninterface UseMergeViewKeyOptions {\n  onOpen: () =\u003e void;\n  isDisabled?: boolean;\n}\n\nfunction useMergeViewKey(options: UseMergeViewKeyOptions) {\n  useInput((input) =\u003e {\n    if (input === 'M' \u0026\u0026 !options.isDisabled) {\n      options.onOpen();\n    }\n  });\n}\n\n// src/components/MergeQueuePanel.tsx\ninterface MergeQueuePanelProps {\n  isOpen: boolean;\n  queue: MergeQueueItem[];\n  onClose: () =\u003e void;\n  onApprove: (itemId: string) =\u003e void;\n  onReject: (itemId: string) =\u003e void;\n}\n\ninterface MergeQueueItem {\n  id: string;\n  taskId: string;\n  branch: string;\n  status: 'queued' | 'in_progress' | 'conflict' | 'completed' | 'failed';\n  conflictCount?: number;\n}\n```\n\n## Acceptance Criteria\n\n### Open Panel - 2 tests\n- [ ] 'M' (uppercase) key opens merge queue panel\n- [ ] 'm' (lowercase) does NOT open (that's Mode Toggle)\n\n### Panel Content - 4 tests\n- [ ] Shows queued items with task ID and branch\n- [ ] Shows in-progress item with status indicator\n- [ ] Shows conflict count for items with conflicts\n- [ ] Shows completed/failed items (last 5)\n\n### Navigation - 3 tests\n- [ ] j/k navigates queue items when panel focused\n- [ ] Enter on conflict item shows conflict details\n- [ ] Escape closes the panel\n\n### Actions - 2 tests\n- [ ] 'a' key approves selected merge (if awaiting approval)\n- [ ] 'x' key rejects selected merge (if awaiting approval)\n\n### Summary\n- [ ] 11 tests pass\n\n## Files\n- src/hooks/useMergeViewKey.ts (NEW)\n- src/hooks/useMergeViewKey.test.ts (NEW)\n- src/components/MergeQueuePanel.tsx (NEW)\n- src/components/MergeQueuePanel.test.tsx (NEW)\n\n## Dependencies\n- F24 (MergeQueue) for queue data\n- F58b (MergeQueueIndicator) for status display\n\n## Notes\n- 'M' = uppercase, case-sensitive\n- Panel shows real-time updates to queue\n- Approve/reject shortcuts only work in this panel","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T13:18:22.26395+03:00","created_by":"deligoez","updated_at":"2026-01-12T08:45:18.278604+03:00","closed_at":"2026-01-12T08:45:18.278604+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-0fwe","depends_on_id":"ch-glf","type":"blocks","created_at":"2026-01-11T13:18:36.398355+03:00","created_by":"deligoez"},{"issue_id":"ch-0fwe","depends_on_id":"ch-105","type":"blocks","created_at":"2026-01-11T13:18:36.502662+03:00","created_by":"deligoez"},{"issue_id":"ch-0fwe","depends_on_id":"ch-89dk","type":"blocks","created_at":"2026-01-11T14:37:27.719713+03:00","created_by":"deligoez"}]}
{"id":"ch-0ok","title":"F61b: ShortcutCategory Component - Grouped keyboard shortcuts","description":"## What\nComponent to display a category of keyboard shortcuts with title and key-description pairs.\n\n## Context from Master Plan\n```\n│  NAVIGATION                     │\n│  j/↓  Move down                 │\n│  k/↑  Move up                   │\n│  Tab  Switch panels             │\n│  1-9  Quick select              │\n```\n\n## API\n```typescript\n// src/components/ShortcutCategory.tsx\n\ninterface Shortcut {\n  key: string;           // e.g., \"j/↓\"\n  description: string;   // e.g., \"Move down\"\n}\n\ninterface ShortcutCategoryProps {\n  title: string;\n  shortcuts: Shortcut[];\n}\n\nfunction ShortcutCategory({ title, shortcuts }: ShortcutCategoryProps): JSX.Element\n```\n\n## Files\n- src/components/ShortcutCategory.tsx\n- src/components/ShortcutCategory.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows category title in bold\n- [ ] Lists all shortcuts with key and description\n- [ ] Key is left-aligned, fixed width\n- [ ] Description uses dim styling (Ink: dimColor prop on Text)\n- [ ] Handles empty shortcuts array\n- [ ] 5 tests pass\n\n## Tests\n1. Shows category title in bold\n2. Lists all shortcuts with key and description\n3. Key has fixed width alignment\n4. Description uses dim styling\n5. Handles empty shortcuts array","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:51:16.471906+03:00","created_by":"deligoez","updated_at":"2026-01-11T20:37:28.290375+03:00","closed_at":"2026-01-11T20:37:28.290375+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-0ok","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:53.629472+03:00","created_by":"deligoez"}]}
{"id":"ch-0qmq","title":"TS08: EventEmitter Integration","description":"## What\nImplement event emission for all mutations.\n\n## Files\n- `src/services/TaskStore.ts`\n- `src/services/TaskStore.test.ts`\n\n## Acceptance Criteria\n- [ ] TaskStore extends EventEmitter\n- [ ] Emits `task:created` on create\n- [ ] Emits `task:updated` on update/lifecycle methods\n- [ ] Emits `task:closed` on complete\n- [ ] Emits `task:deleted` on delete\n- [ ] Emits `change` after any mutation (with all tasks)\n- [ ] Emits `error` on errors (optional)\n- [ ] 7 tests pass","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:13:31.789512+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:13:31.789512+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-0qmq","depends_on_id":"ch-8pne","type":"blocks","created_at":"2026-01-13T00:13:31.792497+03:00","created_by":"deligoez"},{"issue_id":"ch-0qmq","depends_on_id":"ch-3oot","type":"blocks","created_at":"2026-01-13T00:21:30.005675+03:00","created_by":"deligoez"}]}
{"id":"ch-0vb","title":"F63f: Fullscreen Agent (f) - Expand agent tile to fullscreen","description":"## What\nKeyboard handler for 'f' key to expand selected agent tile to fullscreen view.\n\n## Shortcut\n- **f** - Toggle fullscreen for selected agent\n\n## API\n```typescript\n// src/hooks/useKeyboard.ts\ninterface UseKeyboardOptions {\n  onToggleFullscreen?: () =\u003e void;\n}\n\n// src/components/AgentFullscreen.tsx\ninterface AgentFullscreenProps {\n  agent: Agent;\n  onExit: () =\u003e void;\n}\n```\n\n## Behavior\n- 'f' expands selected agent tile to full terminal size\n- Shows full agent output with scroll\n- 'f' again or Escape returns to grid view\n- j/k scrolls output in fullscreen\n\n## Files\n- src/hooks/useKeyboard.ts (UPDATE)\n- src/components/AgentFullscreen.tsx (NEW)\n- src/components/AgentFullscreen.test.tsx (NEW)\n\n## Acceptance Criteria\n- [ ] `useInput` detects 'f' and calls `onToggleFullscreen()`\n- [ ] AgentFullscreen renders agent output at full terminal size\n- [ ] 'f' key in fullscreen calls `onExit()`\n- [ ] Escape key in fullscreen calls `onExit()`\n- [ ] Output is scrollable (up/down or j/k)\n- [ ] Scroll stops at top (can't scroll above first line)\n- [ ] Scroll stops at bottom (can't scroll below last line)\n\n### Summary\n- [ ] 7 tests pass\n\n## Test Cases\n1. 'f' key calls onToggleFullscreen\n2. Fullscreen renders at full terminal size\n3. 'f' in fullscreen exits\n4. Escape in fullscreen exits\n5. j/k scrolls output in fullscreen\n6. Scroll stops at top boundary\n7. Scroll stops at bottom boundary","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T21:54:06.420171+03:00","created_by":"deligoez","updated_at":"2026-01-12T05:41:42.532515+03:00","closed_at":"2026-01-12T05:41:42.532515+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-0vb","depends_on_id":"ch-70p","type":"blocks","created_at":"2026-01-11T14:01:43.059896+03:00","created_by":"deligoez"},{"issue_id":"ch-0vb","depends_on_id":"ch-c2p","type":"blocks","created_at":"2026-01-11T14:01:43.913411+03:00","created_by":"deligoez"}]}
{"id":"ch-0z7","title":"F03a: Init Prerequisites - Check system requirements","description":"## What\nCheck system prerequisites before initialization: git repo, Node.js version, Beads CLI, and Claude agent CLI.\n\n**Note:** This task covers Claude agent only. Non-Claude CLI detection is in F03c (deferred).\n\n## Acceptance Criteria\n\n### checkGitRepo() - 2 tests\n- [ ] Returns true if current directory is a git repository (`.git/` exists)\n- [ ] Returns false if `.git/` directory does not exist\n\n### checkNodeVersion() - 3 tests\n- [ ] Returns `{valid: true, version: \"22.1.0\"}` when Node.js \u003e= 20\n- [ ] Returns `{valid: false, version: \"18.0.0\"}` when Node.js \u003c 20\n- [ ] Returns `{valid: false, version: null}` when Node.js not installed (command fails)\n\n### checkBeadsCLI() - 2 tests\n- [ ] Returns true if `bd --version` exits with code 0\n- [ ] Returns false if `bd` command not found (exits non-zero)\n\n### checkClaudeCLI() - 2 tests\n- [ ] Returns true if `claude --version` exits with code 0\n- [ ] Returns false if `claude` command not found (exits non-zero)\n\n### checkAll() - 2 tests\n- [ ] Returns PrerequisiteResult with all check results populated\n- [ ] Returns `missing` array with install instructions for each failed check\n\n### Summary\n- [ ] 11 tests pass\n\n## Types\n```typescript\ninterface NodeVersionResult {\n  valid: boolean;\n  version: string | null;\n}\n\ninterface PrerequisiteResult {\n  gitRepo: boolean;\n  nodeVersion: boolean;\n  nodeVersionFound: string | null;  // e.g., \"22.1.0\" or null if not installed\n  beadsCLI: boolean;\n  claudeCLI: boolean;\n  missing: MissingPrerequisite[];\n  allPassed: boolean;\n}\n\ninterface MissingPrerequisite {\n  name: string;\n  instruction: string;\n}\n```\n\n## Install Instructions (for missing array)\n| Check | Instruction |\n|-------|-------------|\n| gitRepo | \"Run `git init` to initialize a git repository\" |\n| nodeVersion | \"Install Node.js 20+ from https://nodejs.org\" |\n| beadsCLI | \"Install Beads: `brew install beads-ai/tap/beads`\" |\n| claudeCLI | \"Install Claude Code: `npm install -g @anthropic-ai/claude-code`\" |\n\n## Files\n- src/services/InitPrerequisites.ts (NEW)\n- tests/services/InitPrerequisites.test.ts (NEW)\n\n## Notes\n- Non-Claude agent CLI detection (codex, opencode) → F03c (deferred)\n- Version parsing: extract from `node --version` output (e.g., \"v22.1.0\" → \"22.1.0\")","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T11:20:00.706785+03:00","created_by":"deligoez","updated_at":"2026-01-11T22:20:03.903139+03:00","closed_at":"2026-01-11T22:20:03.903139+03:00","close_reason":"Closed","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-0z7","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:34.648471+03:00","created_by":"deligoez"}]}
{"id":"ch-105","title":"F58b: MergeQueueIndicator Component - Show merge queue status","description":"## What\nDisplay merge queue status showing items pending merge.\n\n## Context from Master Plan\n```\n│ Tasks: 1 done, 3 running, 1 pending, 1 blocked | Merge: 1 queued | ? help   │\n```\n\n## API\n```typescript\n// src/components/MergeQueueIndicator.tsx\n\ninterface MergeQueueIndicatorProps {\n  queued: number;\n  merging?: boolean;     // Currently merging\n  conflict?: boolean;    // Has conflict\n}\n\nfunction MergeQueueIndicator({ queued, merging, conflict }: MergeQueueIndicatorProps): JSX.Element\n```\n\n## Visual Output\n- Empty queue: `Merge: 0 queued`\n- Items queued: `Merge: 3 queued`\n- Merging: `Merge: ● merging...`\n- Conflict: `Merge: ⚠ conflict`\n\n## Files\n- src/components/MergeQueueIndicator.tsx\n- src/components/MergeQueueIndicator.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows \"Merge:\" prefix\n- [ ] Shows queued count when no activity\n- [ ] Shows \"merging...\" with spinner (●) when merging=true\n- [ ] Shows \"conflict\" with warning icon (⚠) when conflict=true\n- [ ] Uses Ink `\u003cText color=\"yellow\"\u003e` for merging state\n- [ ] Uses Ink `\u003cText color=\"red\"\u003e` for conflict state\n- [ ] Conflict takes priority over merging (if both true, show conflict)\n- [ ] 7 tests pass\n\n## Tests\n1. Shows \"Merge: 0 queued\" for empty queue\n2. Shows \"Merge: 3 queued\" for items in queue\n3. Shows merging state with ● indicator\n4. Shows conflict state with ⚠ warning\n5. Uses `\u003cText color=\"yellow\"\u003e` for merging\n6. Uses `\u003cText color=\"red\"\u003e` for conflict\n7. Conflict state takes priority over merging state","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:49:02.012057+03:00","created_by":"deligoez","updated_at":"2026-01-11T20:17:31.091596+03:00","closed_at":"2026-01-11T20:17:31.091596+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-105","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:53.024879+03:00","created_by":"deligoez"}]}
{"id":"ch-10el","title":"E2E-47: QualityCommandRunner Integration Tests","description":"## What\nE2E tests for QualityCommandRunner executing real shell commands.\n\n## Acceptance Criteria\n- [ ] Runs real `npm test` command and captures exit code\n- [ ] Runs real `npm run typecheck` and captures output\n- [ ] Returns correct exit code for passing commands\n- [ ] Returns correct exit code for failing commands\n- [ ] Handles timeout correctly\n- [ ] Runs commands in correct working directory\n- [ ] 8 tests pass\n\n## Files\n- src/e2e/quality-command-runner.e2e.test.ts\n\n## Implementation Notes\n- Use createGitRepoWithChorus() helper\n- Add minimal package.json with test script to temp repo\n- Test both passing and failing commands\n- Test working directory is respected","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T00:07:30.656709+03:00","created_by":"deligoez","updated_at":"2026-01-12T00:30:03.920116+03:00","closed_at":"2026-01-12T00:30:03.920116+03:00","close_reason":"Closed","labels":["m12-tui"]}
{"id":"ch-10ii","title":"BUG: Re-enable fresh-init file watcher test (still skipped)","description":"## What\nch-211i was closed but the test is still skipped.\n\n## Current State\nsrc/e2e/fresh-init.e2e.test.ts:53 has:\n```\n// SKIPPED: Flaky under parallel load - see ch-211i\nit.skip(\"can create first task via file\", async () =\u003e {\n```\n\n## Problem\n- Bug task ch-211i marked as closed\n- But test is still skipped\n- Either test needs to be re-enabled or issue not actually fixed\n\n## Acceptance Criteria\n- [ ] Investigate if ch-211i fix actually resolved the issue\n- [ ] Re-enable test OR document why still skipped\n- [ ] Remove .skip from test method\n- [ ] 1 test passes (not skipped)\n\n## Files\n- src/e2e/fresh-init.e2e.test.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T13:36:08.097648+03:00","created_by":"deligoez","updated_at":"2026-01-12T13:56:32.087773+03:00","closed_at":"2026-01-12T13:56:32.087773+03:00","close_reason":"Closed","labels":["m12-tui"]}
{"id":"ch-112","title":"F05: Worktree Remove - Cleanup after merge","description":"## What\nRemove git worktrees after task completion.\n\n## Acceptance Criteria\n\n### remove() - 6 tests\n- [ ] Runs: `git worktree remove {path}` for the specified agent+task\n- [ ] Throws `WorktreeNotFoundError` if worktree doesn't exist\n- [ ] Deletes branch after worktree removal if `deleteBranch: true` and branch is merged\n- [ ] Keeps branch if not merged (does NOT throw, just skips branch deletion)\n- [ ] With `force: true`, runs `git worktree remove --force` (handles uncommitted changes)\n- [ ] With `deleteBranch: false`, does NOT delete branch even if merged\n\n### isBranchMerged() - 2 tests\n- [ ] Returns `true` if branch is merged into main (via `git branch --merged main`)\n- [ ] Returns `false` if branch is NOT merged into main\n\n### prune() - 1 test\n- [ ] Runs: `git worktree prune` to clean stale entries\n\n### Edge Cases - 1 test\n- [ ] remove() throws `BranchNotFoundError` if branch doesn't exist (already deleted)\n\n### Summary\n- [ ] 10 tests pass\n\n## Files\n- src/services/WorktreeService.ts (extend)\n- src/services/WorktreeService.test.ts (extend)\n\n## Interface\n```typescript\nclass WorktreeNotFoundError extends Error {}\nclass BranchNotFoundError extends Error {}\n\n// Add to WorktreeService class:\n\nasync remove(agentType: string, taskId: string, options?: {\n  deleteBranch?: boolean;  // default: true\n  force?: boolean;         // default: false\n}): Promise\u003cvoid\u003e;\n\nasync isBranchMerged(branch: string): Promise\u003cboolean\u003e;\n\nasync prune(): Promise\u003cvoid\u003e;\n```\n\n## Removal Flow\n1. Check worktree exists (throw WorktreeNotFoundError if not)\n2. Run `git worktree remove {path}` (or with --force)\n3. If deleteBranch option (default true):\n   - Check if branch exists (throw BranchNotFoundError if not)\n   - Check if branch merged via isBranchMerged()\n   - If merged: `git branch -d {branch}`\n   - If not merged: skip (do nothing, branch preserved)\n\n## Test Cases (10 total)\n1. remove() runs git worktree remove command\n2. remove() throws WorktreeNotFoundError if worktree doesn't exist\n3. remove() deletes branch when merged and deleteBranch: true (default)\n4. remove() keeps branch when not merged (no error)\n5. remove() with force: true uses --force flag\n6. remove() with deleteBranch: false keeps branch even if merged\n7. isBranchMerged() returns true for merged branch\n8. isBranchMerged() returns false for unmerged branch\n9. prune() runs git worktree prune\n10. remove() throws BranchNotFoundError if branch already deleted","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T01:31:10.574386+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:45:43.479611+03:00","closed_at":"2026-01-11T18:45:43.479611+03:00","close_reason":"Closed","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-112","depends_on_id":"ch-glq","type":"blocks","created_at":"2026-01-10T01:31:10.576808+03:00","created_by":"deligoez"}]}
{"id":"ch-134l","title":"FX05: Persistence Layer - Snapshot storage and atomic writes","description":"## What\nImplement snapshot persistence for crash recovery. Store full actor hierarchy to disk.\n\n## Acceptance Criteria\n- [ ] `persistSnapshot(actor)` saves to `.chorus/state.xstate.json`\n- [ ] `loadSnapshot()` reads from `.chorus/state.xstate.json`\n- [ ] Atomic write via temp file + rename\n- [ ] Spawned agents included in snapshot (deep persistence)\n- [ ] Snapshot is JSON-serializable\n- [ ] Periodic snapshot (every 5 seconds)\n- [ ] Manual checkpoint creates snapshot\n- [ ] 8 tests pass\n\n## Tests\n1. persistSnapshot creates file\n2. loadSnapshot returns valid snapshot\n3. Atomic write survives process kill during write\n4. Spawned agents included in getPersistedSnapshot\n5. Snapshot can restore machine with createActor(machine, { snapshot })\n6. Periodic snapshot runs every 5 seconds\n7. Manual CHECKPOINT_CREATED triggers immediate snapshot\n8. Invalid snapshot file returns null (graceful failure)\n\n## Files\n- src/services/persistence.ts\n\n## Dependencies\n- FX03 (Root Machine)\n- FX04 (Agent Machine)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-11T15:26:38.321457+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:09:14.192028+03:00","closed_at":"2026-01-11T18:09:14.192028+03:00","close_reason":"Closed","labels":["m-1-xstate"],"dependencies":[{"issue_id":"ch-134l","depends_on_id":"ch-kjae","type":"blocks","created_at":"2026-01-11T15:26:38.325711+03:00","created_by":"deligoez"},{"issue_id":"ch-134l","depends_on_id":"ch-qz9m","type":"blocks","created_at":"2026-01-11T15:26:38.3289+03:00","created_by":"deligoez"}]}
{"id":"ch-16xu","title":"TS02: TaskStore CRUD Operations","description":"## What\nImplement basic CRUD operations with in-memory Map storage.\n\n## Files\n- `src/services/TaskStore.ts`\n- `src/services/TaskStore.test.ts`\n\n## Acceptance Criteria\n- [ ] `constructor(projectDir: string)` initializes store\n- [ ] `create(input: CreateTaskInput)` creates task with sequential ID\n- [ ] `get(id: string)` returns task or undefined\n- [ ] `update(id: string, changes)` updates task, throws if not found\n- [ ] `delete(id: string)` soft-deletes task (tombstone)\n- [ ] Sequential ID generation: `ch-1`, `ch-2`, etc.\n- [ ] `initNextId()` continues sequence from existing tasks\n- [ ] 8 tests pass","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-13T00:12:22.736315+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:30:43.949288+03:00","closed_at":"2026-01-13T00:30:43.949288+03:00","close_reason":"Closed","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-16xu","depends_on_id":"ch-ua17","type":"blocks","created_at":"2026-01-13T00:12:22.740187+03:00","created_by":"deligoez"}]}
{"id":"ch-171","title":"F84a: Validation Rules Engine","description":"## What\nApply validation rules to tasks (atomic, testable, right-sized checks).\n\n## Files\n- `src/services/ValidationRulesEngine.ts`\n- `src/services/ValidationRulesEngine.test.ts`\n\n## Acceptance Criteria\n- [ ] `validate(task: Task)` returns `ValidationResult` with errors/warnings/suggestions\n- [ ] Checks atomic: flags tasks with multiple responsibilities (heuristic: multiple verbs)\n- [ ] Checks testable: flags vague words like \"works correctly\", \"handles properly\"\n- [ ] Checks right-sized: flags tasks with \u003e `max_criteria` acceptance criteria\n- [ ] Checks description length: flags tasks with description \u003e `max_length` chars\n- [ ] Checks context-fit: flags tasks that exceed estimated context window size\n- [ ] Checks naming pattern if configured in rules\n- [ ] Checks forbidden words if configured in rules\n- [ ] If `require_test_file` enabled in rules, flags tasks without explicit test file reference\n- [ ] `suggestFix(error: ValidationError)` returns fix suggestion string\n- [ ] `canAutoFix(error: ValidationError)` returns boolean\n- [ ] `applyFix(task: Task, fix: Fix)` returns modified task\n- [ ] Rules configurable via task-rules.md (loads on construction)\n- [ ] Built-in rules always run regardless of config\n- [ ] Custom rules optional and additive\n- [ ] Returns empty errors array for valid task\n- [ ] 17 tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:05:07.1159+03:00","created_by":"deligoez","updated_at":"2026-01-12T03:11:26.336376+03:00","closed_at":"2026-01-12T03:11:26.336376+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-171","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:13.902911+03:00","created_by":"deligoez"}]}
{"id":"ch-19o","title":"F32c: RalphLoop Error Handling","description":"## What\nRalphLoop error handling: catch assignment failures, error thresholds, pause for human review.\n\n## Acceptance Criteria\n\n### Error Handling - 4 tests\n- [ ] `processLoop()` emits \"error\" event with Error object on assignment failure\n- [ ] `processLoop()` continues loop after error (catches, emits, continues)\n- [ ] `processLoop()` pauses and emits \"errorThreshold\" event after 3 consecutive errors\n- [ ] `processLoop()` waits for human review before continuing after \"errorThreshold\"\n\n### Error Recovery - 2 tests\n- [ ] `resume()` resets consecutiveErrorCount to 0\n- [ ] `resume()` continues processLoop after error threshold pause\n\n### Summary\n- [ ] 6 tests pass\n\n## Event Specifications\n```typescript\ninterface RalphLoopErrorEvents {\n  \"error\": (error: Error) =\u003e void;\n  \"errorThreshold\": (consecutiveErrors: number, lastError: Error) =\u003e void;\n}\n```\n\n## API\n```typescript\n// Internal state\nprivate consecutiveErrorCount: number = 0;\nprivate isPaused: boolean = false;\n\n// Methods\nresume(): void;  // Called by human after reviewing errors\n```\n\n## Files\n- src/services/RalphLoop.ts (UPDATE)\n- src/services/RalphLoop.test.ts (UPDATE)\n\n## Notes\n- Error threshold: 3 consecutive errors\n- After threshold: emit event + pause + wait for resume()\n- Successful assignment resets consecutiveErrorCount\n\n## Dependencies\n- F32b (ch-3pa) - Core processing loop","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T23:51:38.181974+03:00","created_by":"deligoez","updated_at":"2026-01-11T00:05:41.171257+03:00","closed_at":"2026-01-11T00:05:41.171257+03:00","close_reason":"Closed","labels":["m7-autopilot"]}
{"id":"ch-1a7k","title":"E2E-46: StateService Integration Tests","description":"## What\nE2E tests for StateService with real file system persistence.\n\n## Acceptance Criteria\n- [ ] `save()` writes state.json to .chorus/ directory\n- [ ] `load()` restores state from disk correctly\n- [ ] `load()` returns null if no state file exists\n- [ ] State survives process restart simulation\n- [ ] Handles corrupted state file gracefully\n- [ ] 6 tests pass\n\n## Files\n- src/e2e/state-service.e2e.test.ts\n\n## Implementation Notes\n- Use createGitRepoWithChorus() helper\n- Test actual file persistence, not mocked\n- Simulate restart by creating new StateService instance","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T00:07:20.460098+03:00","created_by":"deligoez","updated_at":"2026-01-12T00:57:22.525792+03:00","closed_at":"2026-01-12T00:57:22.525792+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-1a7k","depends_on_id":"ch-r12","type":"blocks","created_at":"2026-01-12T00:08:47.923633+03:00","created_by":"deligoez"}]}
{"id":"ch-1ag3","title":"INT-06: Signal parsing from real Claude output","description":"## What\nIntegration test: Verify our signal parser works with real Claude output.\n\n## Test Scenarios\n1. TASK_COMPLETE signal\n   - Prompt Claude to output: [CHORUS:TASK_COMPLETE:{\"success\":true}]\n   - Verify SignalParser extracts it correctly\n\n2. LEARNING signal\n   - Prompt Claude to output: [CHORUS:LEARNING:{\"content\":\"test learning\"}]\n   - Verify signal parsed correctly\n\n3. PROGRESS signal\n   - Prompt Claude to output: [CHORUS:PROGRESS:{\"iteration\":1,\"status\":\"working\"}]\n   - Verify signal parsed correctly\n\n4. Mixed output (signal embedded in text)\n   - Prompt with: \"First explain, then output signal\"\n   - Verify signal extracted from mixed content\n\n## Why Deterministic\n- Exact signal format in prompt\n- Parser output is binary (parsed or not)\n- JSON structure is exact\n\n## Acceptance Criteria\n- [ ] TASK_COMPLETE signal parsed\n- [ ] LEARNING signal parsed\n- [ ] PROGRESS signal parsed\n- [ ] Signals extracted from mixed output\n- [ ] 4 tests pass\n\n## Files\n- src/integration/signal-parsing.integration.test.ts (create)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T14:26:14.809579+03:00","created_by":"deligoez","updated_at":"2026-01-12T14:52:22.039902+03:00","closed_at":"2026-01-12T14:52:22.039902+03:00","close_reason":"Closed","labels":["m2-agent-prep"],"dependencies":[{"issue_id":"ch-1ag3","depends_on_id":"ch-9tjq","type":"blocks","created_at":"2026-01-12T14:26:14.812573+03:00","created_by":"deligoez"}]}
{"id":"ch-1bn0","title":"FR03: Beads Reviewing Status - Add reviewing to BeadStatus type","description":"## What\nAdd \"reviewing\" to BeadStatus type and update related handlers.\n\n## Acceptance Criteria\n- [ ] Add `\"reviewing\"` to `BeadStatus` union in `src/types/bead.ts`\n- [ ] `StatusIndicator` renders `⏳` for \"reviewing\" status\n- [ ] `bd update ch-xxx --status=reviewing` command works\n- [ ] TaskPanel counts \"reviewing\" in stats footer\n- [ ] 4 tests pass\n\n## Files\n- src/types/bead.ts\n- src/components/StatusIndicator.tsx\n- src/components/TaskPanel.tsx","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:10:56.73307+03:00","created_by":"deligoez","updated_at":"2026-01-12T15:21:02.046247+03:00","closed_at":"2026-01-12T15:21:02.046247+03:00","close_reason":"Closed","labels":["m13-review"]}
{"id":"ch-1f1k","title":"E2E-S01: Sprint Planning E2E - Plan and start sprint with settings","description":"## What\nE2E test for sprint planning flow.\n\n## Acceptance Criteria\n- [ ] Open sprint planning with Shift+S\n- [ ] Select 3 tasks, set max iterations to 10\n- [ ] Start sprint (Enter)\n- [ ] Verify sprint running with correct settings\n- [ ] 4 tests pass\n\n## Files\n- src/e2e/sprint-planning.e2e.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T15:14:17.738523+03:00","created_by":"deligoez","updated_at":"2026-01-12T17:51:21.880833+03:00","closed_at":"2026-01-12T17:51:21.880833+03:00","close_reason":"Closed","labels":["m13b-sprint"],"dependencies":[{"issue_id":"ch-1f1k","depends_on_id":"ch-tw4j","type":"blocks","created_at":"2026-01-12T15:14:17.7421+03:00","created_by":"deligoez"}]}
{"id":"ch-1gi","title":"F39b: Scratchpad Manager - Read and clear agent scratchpad","description":"## What\nManage agent scratchpads - read content and clear after extraction.\n\n## Scratchpad Path Format\nThe scratchpad file is located at a fixed path within each agent's worktree:\n```\n{worktreePath}/.agent/scratchpad.md\n```\n\nExample: `/Users/dev/project/.chorus/worktrees/claude-ch-abc/.agent/scratchpad.md`\n\n**Why `.agent/` directory?**\n- `.chorus/` is for project-wide config (git-tracked)\n- `.agent/` is for per-agent instance data (gitignored in worktree)\n- Keeps agent's working files separate from shared config\n\n## API\n```typescript\n// src/services/ScratchpadManager.ts\n\ninterface Scratchpad {\n  content: string;       // Full file content\n  path: string;          // Absolute path to scratchpad file\n  modifiedAt: Date;      // File modification time\n}\n\nclass ScratchpadManager {\n  constructor(private worktreePath: string) {}\n\n  // Computed property\n  get scratchpadPath(): string {\n    return path.join(this.worktreePath, '.agent', 'scratchpad.md');\n  }\n\n  /**\n   * Read scratchpad content from agent's worktree\n   * @returns Scratchpad object or null if file doesn't exist\n   */\n  async read(): Promise\u003cScratchpad | null\u003e\n\n  /**\n   * Extract learnings section from scratchpad content\n   * Looks for \"## Learnings\" heading, extracts until next ## heading or EOF\n   * @returns Raw markdown of learnings section (without the heading) or null\n   */\n  extractLearningsSection(content: string): string | null\n\n  /**\n   * Clear scratchpad by deleting the file\n   */\n  async clear(): Promise\u003cvoid\u003e\n\n  /**\n   * Check if scratchpad file exists\n   */\n  async exists(): Promise\u003cboolean\u003e\n}\n```\n\n## Files\n- src/services/ScratchpadManager.ts\n- tests/services/ScratchpadManager.test.ts\n\n## Acceptance Criteria\n- [ ] `scratchpadPath` returns `{worktreePath}/.agent/scratchpad.md`\n- [ ] `read()` returns Scratchpad with content, path, and modifiedAt when file exists\n- [ ] `read()` returns null when file doesn't exist (not throws)\n- [ ] `extractLearningsSection()` returns content after \"## Learnings\" until next \"##\" heading\n- [ ] `extractLearningsSection()` returns content after \"## Learnings\" until EOF if no next heading\n- [ ] `extractLearningsSection()` returns null if no \"## Learnings\" heading found\n- [ ] `extractLearningsSection()` is case-insensitive for heading match\n- [ ] `clear()` deletes the scratchpad file\n- [ ] `clear()` succeeds silently if file doesn't exist (idempotent)\n- [ ] `exists()` returns true when file exists\n- [ ] `exists()` returns false when file missing\n- [ ] 11 tests pass\n\n## Tests\n1. scratchpadPath returns correct path (.agent/scratchpad.md)\n2. read() returns Scratchpad when file exists\n3. read() includes modifiedAt from file stats\n4. read() returns null when file missing\n5. extractLearningsSection() extracts until next heading\n6. extractLearningsSection() extracts until EOF\n7. extractLearningsSection() returns null without heading\n8. extractLearningsSection() is case-insensitive\n9. clear() removes scratchpad file\n10. clear() succeeds when file missing\n11. exists() returns correct boolean\n\n## Scratchpad Format Example\n```markdown\n# Task Scratchpad: ch-abc\n\n## Notes\nSome random notes here\n\n## Learnings\n- [LOCAL] This specific function needs memoization for performance\n- [CROSS-CUTTING] All API endpoints require rate limiting middleware\n- [ARCHITECTURAL] Use dependency injection for service instantiation\n\n## Blockers\n- Waiting on API spec clarification\n```\n\nFor above, `extractLearningsSection()` returns:\n```markdown\n- [LOCAL] This specific function needs memoization for performance\n- [CROSS-CUTTING] All API endpoints require rate limiting middleware\n- [ARCHITECTURAL] Use dependency injection for service instantiation\n```\n\n## Notes\n- Path changed from `.chorus/scratchpad.md` to `.agent/scratchpad.md` to align with master plan\n- `.agent/` directory created by F04 WorktreeService during worktree creation","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T10:42:31.99359+03:00","created_by":"deligoez","updated_at":"2026-01-11T19:04:27.150939+03:00","closed_at":"2026-01-11T19:04:27.150939+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-1gi","depends_on_id":"ch-uxk","type":"blocks","created_at":"2026-01-10T10:42:31.99564+03:00","created_by":"deligoez"}]}
{"id":"ch-1hq","title":"F32d: RalphLoop Deadlock Detection","description":"## What\nRalphLoop deadlock and runaway detection: stuck agent detection, max tasks safeguard, idle timeout.\n\n## Acceptance Criteria\n\n### Stuck Agent Detection (Per-Agent) - 3 tests\n- [ ] Tracks git commit count per agent via `git rev-list --count HEAD` in worktree\n- [ ] Emits \"stuckAgent\" event when specific agent has 5 iterations with 0 new commits\n- [ ] Pauses RalphLoop and waits for user decision: `continue` or `stop`\n\n### Max Tasks Safeguard - 2 tests\n- [ ] Stops after maxTotalTasks processed (configurable, default 100)\n- [ ] Emits \"maxTasksReached\" event when limit hit\n\n### Idle Timeout - 1 test\n- [ ] Emits \"idleTimeout\" event if no progress for idleTimeout ms (default 60000ms)\n\n### Auto-Stop - 1 test\n- [ ] Sets isRunning=false after emitting \"allDone\" (auto-stop)\n\n### Summary\n- [ ] 7 tests pass\n\n## Stuck Agent Detection\n\n**CRITICAL:** Per-agent tracking, not across all agents.\n\n```typescript\n// Track commits per agent\nprivate commitCounts: Map\u003cstring, number\u003e = new Map();\nprivate iterationsWithoutCommit: Map\u003cstring, number\u003e = new Map();\n\nasync checkProgress(agentId: string, worktreePath: string): Promise\u003cvoid\u003e {\n  const currentCommits = await getCommitCount(worktreePath);\n  const lastCommits = this.commitCounts.get(agentId) ?? 0;\n  \n  if (currentCommits === lastCommits) {\n    const iterations = (this.iterationsWithoutCommit.get(agentId) ?? 0) + 1;\n    this.iterationsWithoutCommit.set(agentId, iterations);\n    \n    if (iterations \u003e= this.config.stuckIterationThreshold) {\n      this.emit('stuckAgent', agentId, iterations);\n      await this.pauseForUserDecision(agentId);\n    }\n  } else {\n    // Progress made - reset counter\n    this.iterationsWithoutCommit.set(agentId, 0);\n    this.commitCounts.set(agentId, currentCommits);\n  }\n}\n```\n\n## User Decision on Stuck Agent\n\nWhen stuck agent detected:\n```\n┌──────────────────────────────────────┐\n│ ⚠️  Agent may be stuck               │\n│                                      │\n│ Agent: claude-ch-001                 │\n│ Task: F15 Orchestrator Core          │\n│ Iterations without commits: 5        │\n│                                      │\n│ [c] Continue   [s] Stop agent        │\n└──────────────────────────────────────┘\n```\n\n- **Continue:** Reset counter, agent continues\n- **Stop:** Stop agent, task returns to pending\n\n## Event Specifications\n```typescript\ninterface RalphLoopDeadlockEvents {\n  \"stuckAgent\": (agentId: string, iterationsWithoutCommit: number) =\u003e void;\n  \"maxTasksReached\": (count: number) =\u003e void;\n  \"idleTimeout\": () =\u003e void;\n}\n```\n\n## Configuration\n```typescript\ninterface RalphLoopConfig {\n  // ... existing from F32a/b\n  stuckIterationThreshold: number;  // default 5 (per agent)\n  maxTotalTasks: number;            // default 100 (safeguard)\n  idleTimeout: number;              // default 60000ms (1 minute)\n}\n```\n\n## Implementation Notes\n\n**Safeguards not in master plan but necessary:**\n- `maxTotalTasks`: Prevents infinite loop if tasks keep being created\n- `idleTimeout`: Prevents RalphLoop hanging when no ready tasks\n\n**Master plan items implemented:**\n- Stuck agent detection (5 iterations, per agent)\n- User choice (continue or stop)\n\n## Dependencies\n- F32b RalphLoop Core (ch-3pa)\n\n## Files\n- src/services/RalphLoop.ts (UPDATE)\n- src/services/RalphLoop.test.ts (UPDATE)\n\n## Notes\n- Adds to existing RalphLoop class from F32b\n- Per-agent tracking via Map\u003cagentId, count\u003e\n- Counter resets on any git commit in worktree\n- User decision via TUI prompt (or CLI in headless mode)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T23:52:08.769418+03:00","created_by":"deligoez","updated_at":"2026-01-12T06:56:50.087798+03:00","closed_at":"2026-01-12T06:56:50.087798+03:00","close_reason":"Closed","labels":["m7-autopilot"],"dependencies":[{"issue_id":"ch-1hq","depends_on_id":"ch-3pa","type":"blocks","created_at":"2026-01-10T23:52:08.772352+03:00","created_by":"deligoez"}]}
{"id":"ch-1iw9","title":"E2E-60: Checkpoint \u0026 Rollback System","description":"## What\nE2E tests for checkpoint creation and rollback workflows.\n\n## Acceptance Criteria\n- [ ] Checkpoint tag created before autopilot start\n- [ ] Multiple checkpoints tracked with correct timestamps\n- [ ] Iteration rollback reverts last N commits\n- [ ] Task rollback reverts all commits for task\n- [ ] Rollback fails gracefully if no checkpoints exist\n- [ ] Rollback updates Chorus state (removes agent, reopens task)\n- [ ] 8 tests pass\n\n## Files\n- src/e2e/checkpoint-rollback.e2e.test.ts\n\n## Implementation Notes\n- Use createGitRepoWithChorus() helper\n- Create commits to rollback\n- Verify git state after rollback","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T00:39:25.606889+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:19:22.726908+03:00","closed_at":"2026-01-12T01:19:22.726908+03:00","close_reason":"Closed","labels":["m10-rollback"],"dependencies":[{"issue_id":"ch-1iw9","depends_on_id":"ch-2r5","type":"blocks","created_at":"2026-01-12T00:39:25.608813+03:00","created_by":"deligoez"},{"issue_id":"ch-1iw9","depends_on_id":"ch-k9y","type":"blocks","created_at":"2026-01-12T00:39:25.611389+03:00","created_by":"deligoez"},{"issue_id":"ch-1iw9","depends_on_id":"ch-c8j","type":"blocks","created_at":"2026-01-12T00:39:25.613566+03:00","created_by":"deligoez"},{"issue_id":"ch-1iw9","depends_on_id":"ch-ofm","type":"blocks","created_at":"2026-01-12T00:39:25.615713+03:00","created_by":"deligoez"}]}
{"id":"ch-1x96","title":"TS20: Delete Beads Service Files","description":"## What\nRemove old Beads service implementation.\n\n## Files to delete\n- `src/services/BeadsCLI.ts`\n- `src/services/BeadsCLI.test.ts`\n- `src/services/BeadsService.ts`\n- `src/services/BeadsService.test.ts`\n- `src/services/BeadsParser.ts`\n- `src/services/BeadsParser.test.ts`\n- `src/types/bead.ts`\n- `src/test/fixtures/mockBeadsCLI.ts`\n\n## Acceptance Criteria\n- [ ] All Beads service files deleted\n- [ ] No remaining imports of deleted files\n- [ ] `npm run quality` passes\n- [ ] 0 tests (deletion task)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-13T00:16:02.710701+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:16:02.710701+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-1x96","depends_on_id":"ch-pe0e","type":"blocks","created_at":"2026-01-13T00:16:02.71299+03:00","created_by":"deligoez"},{"issue_id":"ch-1x96","depends_on_id":"ch-ahbp","type":"blocks","created_at":"2026-01-13T00:22:38.184962+03:00","created_by":"deligoez"},{"issue_id":"ch-1x96","depends_on_id":"ch-o78b","type":"blocks","created_at":"2026-01-13T00:22:38.302738+03:00","created_by":"deligoez"}]}
{"id":"ch-211i","title":"BUG: Flaky file watcher E2E test under parallel load","description":"## What\nThe E2E test \"can create first task via file\" in fresh-init.e2e.test.ts is flaky.\nIt passes in isolation but fails under parallel test load.\n\n## Root Cause (suspected)\n- File system event propagation timing varies under load\n- chokidar file watcher may not pick up changes fast enough during parallel tests\n\n## Acceptance Criteria\n- [ ] Test passes reliably with full test suite (parallel execution)\n- [ ] Investigate chokidar timing behavior\n- [ ] Consider: retry mechanism, longer polling, or isolated test file\n- [ ] 1 test is stable\n\n## Files\n- src/e2e/fresh-init.e2e.test.ts\n- src/services/BeadsWatcher.ts (if exists)\n\n## Current Workaround\nTest is marked with `.skip` until fixed.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T22:02:53.427629+03:00","created_by":"deligoez","updated_at":"2026-01-12T08:03:36.070495+03:00","closed_at":"2026-01-12T08:03:36.070495+03:00","close_reason":"Closed","labels":["m12-tui"]}
{"id":"ch-24qw","title":"F96d: TUI Notifications for Queued Updates","description":"## What\nShow TUI notifications when updates are queued for in_progress tasks.\n\n## Why\nUser should know when Plan Review found changes affecting running agents, especially for major changes or redundant task marking.\n\n## Acceptance Criteria\n- [ ] Minor updates: Silent (no notification)\n- [ ] Major updates: Show info in status bar \"1 update queued for ch-xxx\"\n- [ ] Redundant marking: Show warning \"ch-xxx marked redundant while agent working\"\n- [ ] User can press key to see queued updates detail\n- [ ] Notification clears after update applied\n- [ ] 6 tests pass\n\n## Deferred Reason\nMVP applies updates silently at next iteration. This adds user visibility.\n\n## TUI Integration\n```\n┌─────────────────────────────────────────────────────────────────┐\n│ ⚠ ch-015 marked redundant while agent working [r to redirect]  │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n## Files\n- src/components/QueuedUpdateNotification.tsx\n- tests/components/QueuedUpdateNotification.test.tsx","status":"deferred","priority":3,"issue_type":"task","created_at":"2026-01-12T09:09:11.149614+03:00","created_by":"deligoez","updated_at":"2026-01-12T12:23:16.287277+03:00","labels":["deferred","m8-memory"],"dependencies":[{"issue_id":"ch-24qw","depends_on_id":"ch-djom","type":"blocks","created_at":"2026-01-12T09:09:11.152487+03:00","created_by":"deligoez"}]}
{"id":"ch-26c","title":"F30: Human Escalation","description":"## What\nFinal fallback when all automated resolution fails. Pauses autopilot for human intervention.\n\n## Retry Trigger from Master Plan\n\nHuman escalation is triggered after **3 or more consecutive failures** in any resolution path:\n- 3+ failed auto-resolve attempts (SIMPLE conflicts)\n- 3+ failed rebase-retry attempts (MEDIUM conflicts)  \n- 3+ failed agent-resolve attempts (COMPLEX conflicts)\n\nThe retry count is tracked per merge item in MergeQueue.\n\n## Acceptance Criteria\n\n### shouldEscalate() - 2 tests\n- [ ] Returns `true` when retryCount \u003e= 3 (integration with MergeQueue retry tracking)\n- [ ] Returns `false` when retryCount \u003c 3 (give resolution strategies more attempts)\n\n### escalate() - 3 tests\n- [ ] Emits 'escalated' event with request details (taskId, worktree, retryCount)\n- [ ] Returns Promise that waits for human action\n- [ ] Sets `pending` state with request\n\n### markResolved() - 1 test\n- [ ] Clears pending, emits 'resolved', resolves with `action: 'merged'`\n\n### markSkipped() - 1 test\n- [ ] Clears pending, emits 'skipped', resolves with `action: 'skipped'` (autopilot continues)\n\n### markCancelled() - 1 test\n- [ ] Clears pending, emits 'cancelled', resolves with `action: 'cancelled'` (autopilot stops)\n\n### hasPending() / getPending() - 1 test\n- [ ] `hasPending()` returns true when pending\n- [ ] `getPending()` returns request or null\n\n## EscalationRequest Interface\n\n```typescript\ninterface EscalationRequest {\n  taskId: string;\n  worktreePath: string;\n  conflictFiles: string[];\n  retryCount: number;        // How many times resolution was attempted\n  lastAttempt: 'auto' | 'rebase' | 'agent';  // Which strategy failed last\n  error?: string;\n}\n```\n\n## Files\n- src/services/HumanEscalation.ts\n- tests/services/HumanEscalation.test.ts\n\n## Plan\nSee: thoughts/shared/plans/features/F30-human-escalation.md\n\n**Total: 9 tests**","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T03:17:01.402172+03:00","created_by":"deligoez","updated_at":"2026-01-11T19:35:10.230099+03:00","closed_at":"2026-01-11T19:35:10.230099+03:00","close_reason":"Closed","labels":["m5-merge"],"dependencies":[{"issue_id":"ch-26c","depends_on_id":"ch-9sj","type":"blocks","created_at":"2026-01-10T03:17:10.806465+03:00","created_by":"deligoez"}]}
{"id":"ch-2bra","title":"E2E-38: Initial Load","description":"## What\nE2E test for initial application load state.\n\n## Acceptance Criteria\n- [ ] Shows loading state while initializing\n- [ ] Loads tasks from beads file\n- [ ] Restores session state if available\n- [ ] Shows empty state if no tasks\n- [ ] 4 tests pass\n\n## Test Cases\n1. `it('shows loading state initially')`\n2. `it('loads tasks from beads file')`\n3. `it('restores previous session state')`\n4. `it('shows empty state for new projects')`\n\n## Files\n- tests/e2e/initial-load.test.ts\n\n## Dependencies\n- ch-0e01 (E2E Infrastructure)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:22:35.924374+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:57:49.204257+03:00","closed_at":"2026-01-12T01:57:49.204257+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-2bra","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:22:35.927235+03:00","created_by":"deligoez"}]}
{"id":"ch-2gt","title":"F63y: Pause/Resume Key (Space) - Toggle orchestration pause","description":"## What\nKeyboard handler for Space key to pause/resume orchestration.\n\n## Context from Master Plan\n```\nMODE CONTROL\nSpace Pause/resume\n```\n\n## Shortcut\n- **Space** - Toggle pause/resume\n\n## Difference from 'p' in Intervention Panel\n- **Space** = App-level quick toggle (no modal)\n- **'p' in intervention panel** = Same action but within modal context\n\nBoth call the same PauseHandler.togglePause() method.\n\n## Implementation\n\n```typescript\n// src/hooks/usePauseKey.ts\n\ninterface UsePauseKeyOptions {\n  pauseHandler: PauseHandler;\n  isPaused: boolean;\n  onPauseChange?: (paused: boolean) =\u003e void;\n  isDisabled?: boolean;  // e.g., when modal open\n}\n\nfunction usePauseKey(options: UsePauseKeyOptions) {\n  useInput((input, key) =\u003e {\n    // Space key detection\n    if (input === ' ' \u0026\u0026 !options.isDisabled) {\n      const newState = options.pauseHandler.togglePause();\n      options.onPauseChange?.(newState);\n    }\n  });\n}\n```\n\n## Acceptance Criteria\n\n### Toggle Pause - 3 tests\n- [ ] Space when running → pauses orchestration\n- [ ] Space when paused → resumes orchestration\n- [ ] Calls `pauseHandler.togglePause()`\n\n### Visual Feedback - 2 tests\n- [ ] Shows \"Paused\" indicator in HeaderBar\n- [ ] Shows toast: \"Orchestration paused\" / \"Orchestration resumed\"\n\n### Behavior When Paused - 2 tests\n- [ ] No new agents spawned while paused\n- [ ] Running agents continue to completion\n\n### Disabled State - 2 tests\n- [ ] No-op when modal is open\n- [ ] No-op when not in semi-auto/autopilot mode\n\n### Summary\n- [ ] 9 tests pass\n\n## Files\n- src/hooks/usePauseKey.ts (NEW)\n- src/hooks/usePauseKey.test.ts (NEW)\n\n## Dependencies\n- F43b (PauseHandler) for pause logic\n\n## Notes\n- Quick toggle for pause without opening intervention menu\n- Same as 'p' in intervention panel but faster access\n- Agents in progress continue (graceful pause)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T12:45:22.333647+03:00","created_by":"deligoez","updated_at":"2026-01-12T05:06:10.578394+03:00","closed_at":"2026-01-12T05:06:10.578394+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-2gt","depends_on_id":"ch-fna","type":"blocks","created_at":"2026-01-11T12:45:22.337479+03:00","created_by":"deligoez"},{"issue_id":"ch-2gt","depends_on_id":"ch-89dk","type":"blocks","created_at":"2026-01-11T14:37:27.805694+03:00","created_by":"deligoez"}]}
{"id":"ch-2hw","title":"F84: Task Validator Controller","description":"## What\nValidate batch of tasks using rules engine and dependency checker.\n\n## Files\n- `src/services/TaskValidator.ts`\n- `src/services/TaskValidator.test.ts`\n\n## Dependencies\n- F84a (ch-171): ValidationRulesEngine\n- F84b (ch-32r): DependencyChecker\n\n## Acceptance Criteria\n- [ ] `validateAll(tasks: Task[])` returns `BatchValidationResult`\n- [ ] Runs ValidationRulesEngine on each task\n- [ ] Runs DependencyChecker on all tasks\n- [ ] Aggregates errors, warnings, suggestions from all sources\n- [ ] `isAllValid()` returns true only if no errors\n- [ ] `getErrors()` returns errors only (no warnings)\n- [ ] `getFixableTasks()` returns tasks with auto-fixable errors\n- [ ] `applyAllFixes()` returns array of fixed tasks\n- [ ] `getCounts()` returns `{ errors, warnings, suggestions }`\n- [ ] Logs validation results via SessionLogger\n- [ ] 10 tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:07:13.322834+03:00","created_by":"deligoez","updated_at":"2026-01-12T03:15:24.408656+03:00","closed_at":"2026-01-12T03:15:24.408656+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-2hw","depends_on_id":"ch-171","type":"blocks","created_at":"2026-01-11T03:07:13.326414+03:00","created_by":"deligoez"},{"issue_id":"ch-2hw","depends_on_id":"ch-32r","type":"blocks","created_at":"2026-01-11T03:07:13.329099+03:00","created_by":"deligoez"}]}
{"id":"ch-2n6","title":"F01a: Config Types - ChorusConfig interface and defaults","description":"## What\nDefine TypeScript types for Chorus configuration.\n\n**MVP Note:** While AgentType includes 'codex' | 'opencode' for future expansion,\nMVP implementation only supports 'claude'. Default config uses Claude only.\n\n## Files\n- src/types/config.ts (NEW)\n- src/types/config.test.ts (NEW)\n\n## Type Requirements (compile-time)\n\n### AgentType \u0026 AgentTypeConfig\n- AgentType is union: 'claude' | 'codex' | 'opencode'\n- AgentTypeConfig.command is required string\n- AgentTypeConfig.args is required string[]\n- AgentTypeConfig.model is optional string\n- AgentTypeConfig.allowModelOverride is optional boolean\n\n### QualityCommand\n- QualityCommand.name is required string\n- QualityCommand.command is required string\n- QualityCommand.required is required boolean\n- QualityCommand.order is required number\n\n### ChorusConfig\n- version is required string\n- mode is 'semi-auto' | 'autopilot'\n- project.name is optional string\n- project.type is optional ProjectType\n- project.taskIdPrefix is required string\n- agents.default is AgentType\n- agents.maxParallel is number\n- agents.timeoutMinutes is number\n- agents.available is Partial\u003cRecord\u003cAgentType, AgentTypeConfig\u003e\u003e\n- qualityCommands is QualityCommand[]\n- completion.signal is string\n- completion.requireTests is boolean\n- completion.maxIterations is number\n- completion.taskTimeout is number\n- merge.autoResolve is boolean\n- merge.agentResolve is boolean\n- merge.requireApproval is boolean\n- tui.agentGrid is 'auto' | string\n- checkpoints.beforeAutopilot is boolean\n- checkpoints.beforeMerge is boolean\n- checkpoints.periodic is number\n- planReview.enabled is boolean\n- planReview.maxIterations is number\n- planReview.triggerOn is string[]\n- planReview.autoApply is 'none' | 'minor' | 'all'\n- planReview.requireApproval is string[]\n- createdAt is optional string (ISO timestamp)\n- updatedAt is optional string (ISO timestamp)\n\n## Acceptance Criteria (runtime tests)\n- [ ] AgentTypeConfig accepts object with command and args only\n- [ ] AgentTypeConfig accepts object with all fields including model\n- [ ] QualityCommand interface accepts valid quality command object\n- [ ] ChorusConfig requires all top-level sections\n- [ ] getDefaultConfig() returns valid ChorusConfig with expected defaults\n- [ ] getDefaultConfig() returns Claude-only agent configuration\n- [ ] getDefaultConfig() returns qualityCommands array with npm test as required\n- [ ] getDefaultConfig() returns project.taskIdPrefix as 'ch-'\n- [ ] getDefaultConfig() returns agents.timeoutMinutes as 30\n- [ ] getDefaultConfig() returns checkpoints with all fields\n- [ ] getDefaultConfig() returns planReview with all fields\n- [ ] getDefaultConfig() sets createdAt and updatedAt to current timestamp\n\n### Summary\n- [ ] 12 tests pass\n\n## Implementation\n```typescript\nexport type AgentType = 'claude' | 'codex' | 'opencode';\nexport type ProjectType = 'node' | 'php' | 'python' | 'go' | 'rust' | 'unknown';\n\nexport interface QualityCommand {\n  name: string;\n  command: string;\n  required: boolean;\n  order: number;\n}\n\nexport interface AgentTypeConfig {\n  command: string;\n  args: string[];\n  model?: string;\n  allowModelOverride?: boolean;\n}\n\nexport interface CheckpointsConfig {\n  beforeAutopilot: boolean;\n  beforeMerge: boolean;\n  periodic: number;  // 0 = disabled\n}\n\nexport interface PlanReviewConfig {\n  enabled: boolean;\n  maxIterations: number;\n  triggerOn: string[];  // 'cross_cutting' | 'architectural'\n  autoApply: 'none' | 'minor' | 'all';\n  requireApproval: string[];  // 'redundant' | 'dependency_change'\n}\n\nexport interface ChorusConfig {\n  version: string;\n  mode: 'semi-auto' | 'autopilot';\n  \n  project: { \n    name?: string;\n    type?: ProjectType;\n    taskIdPrefix: string; \n  };\n  \n  agents: {\n    default: AgentType;\n    maxParallel: number;\n    timeoutMinutes: number;\n    available: Partial\u003cRecord\u003cAgentType, AgentTypeConfig\u003e\u003e;\n  };\n  \n  qualityCommands: QualityCommand[];\n  \n  completion: { \n    signal: string; \n    requireTests: boolean; \n    maxIterations: number; \n    taskTimeout: number; \n  };\n  \n  merge: { \n    autoResolve: boolean; \n    agentResolve: boolean; \n    requireApproval: boolean; \n  };\n  \n  tui: { \n    agentGrid: 'auto' | string; \n  };\n  \n  checkpoints: CheckpointsConfig;\n  \n  planReview: PlanReviewConfig;\n  \n  createdAt?: string;\n  updatedAt?: string;\n}\n\nexport function getDefaultConfig(): ChorusConfig {\n  const now = new Date().toISOString();\n  return {\n    version: '3.1',\n    mode: 'semi-auto',\n    project: { taskIdPrefix: 'ch-' },\n    agents: {\n      default: 'claude',\n      maxParallel: 3,\n      timeoutMinutes: 30,\n      available: {\n        claude: { command: 'claude', args: ['--dangerously-skip-permissions'] }\n      }\n    },\n    qualityCommands: [\n      { name: 'test', command: 'npm test', required: true, order: 1 }\n    ],\n    completion: {\n      signal: '\u003cchorus\u003eCOMPLETE\u003c/chorus\u003e',\n      requireTests: true,\n      maxIterations: 50,\n      taskTimeout: 30\n    },\n    merge: {\n      autoResolve: true,\n      agentResolve: true,\n      requireApproval: false\n    },\n    tui: { agentGrid: 'auto' },\n    checkpoints: {\n      beforeAutopilot: true,\n      beforeMerge: true,\n      periodic: 5\n    },\n    planReview: {\n      enabled: true,\n      maxIterations: 5,\n      triggerOn: ['cross_cutting', 'architectural'],\n      autoApply: 'minor',\n      requireApproval: ['redundant', 'dependency_change']\n    },\n    createdAt: now,\n    updatedAt: now\n  };\n}\n```\n\n## Notes\n- MVP supports Claude only\n- AgentType union kept for type compatibility\n- Non-Claude configs added via deferred tasks (F07b, F03c)\n- Config version 3.1 matches master plan","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T01:30:10.093924+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:28:36.382565+03:00","closed_at":"2026-01-11T18:28:36.382565+03:00","close_reason":"Closed","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-2n6","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:34.455837+03:00","created_by":"deligoez"}]}
{"id":"ch-2oin","title":"E2E-08: Recovery \u0026 Rollback","description":"## What\nE2E tests for checkpoint, undo, and rollback operations.\n\n## Tests (8 tests)\n\n### Checkpoint\n1. 'c' creates checkpoint\n2. Checkpoint confirmation shown\n3. Checkpoint ID displayed\n\n### Undo\n4. 'u' undoes last action\n5. Task state reverts\n6. Undo confirmation shown\n\n### Recovery Keys\n7. 'r' triggers task retry\n8. 'R' opens rollback menu\n\n## Files\n- src/e2e/recovery.e2e.test.ts (NEW)\n\n## Depends On\n- ch-kxpd: E2E Infrastructure\n- ch-6aq: Create Checkpoint Key\n- ch-zsn: Undo Key\n- ch-kns: Task Recovery Keys","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-11T21:16:27.291402+03:00","created_by":"deligoez","updated_at":"2026-01-11T21:23:25.295446+03:00","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-2oin","depends_on_id":"ch-kxpd","type":"blocks","created_at":"2026-01-11T21:16:27.294052+03:00","created_by":"deligoez"},{"issue_id":"ch-2oin","depends_on_id":"ch-6aq","type":"blocks","created_at":"2026-01-11T21:16:27.295948+03:00","created_by":"deligoez"},{"issue_id":"ch-2oin","depends_on_id":"ch-zsn","type":"blocks","created_at":"2026-01-11T21:16:27.297526+03:00","created_by":"deligoez"},{"issue_id":"ch-2oin","depends_on_id":"ch-kns","type":"blocks","created_at":"2026-01-11T21:16:27.299314+03:00","created_by":"deligoez"}],"deleted_at":"2026-01-11T21:23:25.295446+03:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"ch-2po","title":"F61c: HelpPanel Enhanced - All shortcuts grouped by category","description":"## What\nEnhanced HelpPanel showing all keyboard shortcuts from Section 14, grouped by category.\n\n## Context from Master Plan\n```\n┌─────────────────────────────────────────────────────────────────┐\n│                        KEYBOARD SHORTCUTS                        │\n├─────────────────────────────────────────────────────────────────┤\n│                                                                  │\n│  NAVIGATION                     AGENT CONTROL                    │\n│  j/↓  Move down                 s      Spawn agent for task      │\n│  k/↑  Move up                   x      Stop selected agent       │\n│  Tab  Switch panels             r      Redirect agent            │\n│  1-9  Quick select              Enter  Assign task to agent      │\n│                                                                  │\n│  MODE CONTROL                   TASK MANAGEMENT                  │\n│  m    Toggle mode               n      New task                  │\n│  Space Pause/resume             e      Edit task                 │\n│  a    Start autopilot           b      Block task                │\n│                                 d      Mark done (manual)        │\n│                                                                  │\n│  VIEW                           RECOVERY                         │\n│  f    Fullscreen agent          R      Rollback menu             │\n│  g    Grid settings             c      Create checkpoint         │\n│  l    View logs                 u      Undo last action          │\n│  L    View learnings                                             │\n│                                                                  │\n│  PLANNING \u0026 LEARNING            GENERAL                          │\n│  P    Plan more tasks           ?    Toggle help                 │\n│  Shift+P Force plan             i    Intervention menu           │\n│  Ctrl+L Review learnings        q    Quit (confirm if agents)    │\n│  Shift+L Force review           M    Merge queue view            │\n│                                                                  │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n## API\n```typescript\n// src/components/HelpPanel.tsx (UPDATE)\n\ninterface HelpPanelProps {\n  visible: boolean;\n}\n\n// Categories:\n// NAVIGATION: j/↓, k/↑, Tab, 1-9\n// AGENT CONTROL: s, x, r, Enter\n// MODE CONTROL: m, Space, a\n// TASK MANAGEMENT: n, e, b, d\n// VIEW: f, g, l, L\n// RECOVERY: R, c, u\n// PLANNING \u0026 LEARNING: P, Shift+P, Ctrl+L, Shift+L\n// GENERAL: ?, q, i, M\n```\n\n## Files\n- src/components/HelpPanel.tsx (UPDATE existing)\n- src/components/HelpPanel.test.tsx (UPDATE existing)\n\n## Acceptance Criteria\n- [ ] Shows all 8 categories (including PLANNING \u0026 LEARNING)\n- [ ] Navigation: j/↓, k/↑, Tab, 1-9\n- [ ] Agent Control: s, x, r, Enter\n- [ ] Mode Control: m, Space, a (includes 'm' for \"Toggle semi-auto/autopilot\")\n- [ ] Task Management: n, e, b, d\n- [ ] View: f, g, l, L\n- [ ] Recovery: R, c, u\n- [ ] Planning \u0026 Learning: P (Plan more tasks), Shift+P (Force plan), Ctrl+L (Review learnings), Shift+L (Force review)\n- [ ] General: ?, q, i, M\n- [ ] Categories arranged in two columns\n- [ ] Returns null when visible=false\n- [ ] 13 tests pass\n\n## Tests\n1. Returns null when visible=false\n2. Shows NAVIGATION category shortcuts\n3. Shows AGENT CONTROL category shortcuts\n4. Shows MODE CONTROL category shortcuts (including 'm' key)\n5. Shows TASK MANAGEMENT category shortcuts\n6. Shows VIEW category shortcuts\n7. Shows RECOVERY category shortcuts\n8. Shows PLANNING \u0026 LEARNING category shortcuts\n9. Shows GENERAL category shortcuts (including M for Merge queue view)\n10. Categories in two-column layout\n11. P key shows \"Plan more tasks\"\n12. 'm' key shows \"Toggle semi-auto/autopilot\"\n13. Shows close hint","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:51:17.970137+03:00","created_by":"deligoez","updated_at":"2026-01-11T20:44:17.005056+03:00","closed_at":"2026-01-11T20:44:17.005056+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-2po","depends_on_id":"ch-0ok","type":"blocks","created_at":"2026-01-10T12:51:30.181324+03:00","created_by":"deligoez"}]}
{"id":"ch-2r5","title":"F47: Rollback Types - Rollback and checkpoint interfaces","description":"## What\nDefine TypeScript interfaces for rollback and checkpoint system.\n\n## API\n```typescript\n// src/types/rollback.ts\n\ntype RollbackLevel = \n  | 'iteration'     // Level 1: Undo last N iterations\n  | 'task'          // Level 2: Undo all commits for task\n  | 'task_chain'    // Level 3: Task + dependents\n  | 'session';      // Level 4: Reset to checkpoint\n\ninterface Checkpoint {\n  id: string;\n  tag: string;        // git tag name\n  timestamp: Date;\n  type: 'autopilot_start' | 'pre_merge' | 'periodic';\n  taskId?: string;    // For pre_merge checkpoints\n}\n\ninterface CheckpointConfig {\n  enabled: boolean;\n  beforeAutopilot: boolean;\n  beforeMerge: boolean;\n  periodic: number;   // Every N completed tasks (0 = disabled)\n}\n\ninterface RollbackResult {\n  success: boolean;\n  level: RollbackLevel;\n  revertedCommits: string[];\n  affectedTasks: string[];\n  message: string;\n}\n```\n\n## Files\n- src/types/rollback.ts\n\n## Acceptance Criteria\n- [ ] `RollbackLevel` is union of 4 levels\n- [ ] `Checkpoint` has id, tag, timestamp, type fields\n- [ ] `CheckpointConfig` has enabled, beforeAutopilot, beforeMerge, periodic\n- [ ] `RollbackResult` has success, level, revertedCommits, affectedTasks\n- [ ] 5 tests pass\n\n## Tests\n1. RollbackLevel union includes all levels\n2. Checkpoint has required fields\n3. CheckpointConfig has required fields\n4. RollbackResult has required fields\n5. Types are exported correctly","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T10:44:16.592124+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:23:53.237487+03:00","closed_at":"2026-01-11T18:23:53.237487+03:00","close_reason":"Closed","labels":["m10-rollback"],"dependencies":[{"issue_id":"ch-2r5","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:52.315476+03:00","created_by":"deligoez"}]}
{"id":"ch-2s0w","title":"CHORE: Remove Zustand, complete XState migration","description":"## What\nRemove legacy Zustand store now that XState migration is complete.\n\n## Current State\nZustand still used in:\n- src/stores/agentStore.ts\n- src/hooks/useAgentManager.ts\n\n## Problem\n- Dual state management (Zustand + XState)\n- Confusion about which to use\n- Extra dependency\n\n## Solution\n1. Remove agentStore.ts\n2. Update useAgentManager to use XState\n3. Remove zustand from package.json\n4. Update any remaining imports\n\n## Acceptance Criteria\n- [ ] agentStore.ts removed\n- [ ] useAgentManager uses XState context\n- [ ] No zustand imports in codebase\n- [ ] zustand removed from dependencies\n- [ ] All tests pass\n- [ ] 4 tests pass\n\n## Files\n- src/stores/agentStore.ts (remove)\n- src/hooks/useAgentManager.ts (update)\n- package.json (remove zustand)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T13:29:07.190017+03:00","created_by":"deligoez","updated_at":"2026-01-12T13:49:07.972675+03:00","closed_at":"2026-01-12T13:49:07.972675+03:00","close_reason":"Closed","labels":["m-1-xstate"]}
{"id":"ch-2yp","title":"F100: Spec Evolution Tracker","description":"## What\nTracks spec files and their section states (draft, planning, tasked, archived).\n\n## Acceptance Criteria\n- [ ] `SpecEvolutionTracker` class exists\n- [ ] `loadSpec(filePath)` parses spec file and extracts sections\n- [ ] `getSectionStatus(heading)` returns section state (draft, planning, tasked, archived)\n- [ ] `markSectionTasked(heading, taskIds)` updates section to tasked state\n- [ ] `getUnplannedSections()` returns array of draft sections\n- [ ] `getNextPlanningSection()` returns first draft section\n- [ ] `isSpecComplete()` returns true if all sections are tasked\n- [ ] `saveProgress()` persists to spec-progress.json\n- [ ] `loadProgress()` loads from spec-progress.json\n- [ ] Parses markdown headings (## syntax) as sections\n- [ ] 12 tests pass\n\n## Section States\n- `draft` (📋) - Not yet converted to tasks\n- `planning` (🚧) - Currently being converted\n- `tasked` (✅) - Tasks exist in Beads\n- `archived` (🏁) - All tasks closed, section complete\n\n## Files\n- src/services/SpecEvolutionTracker.ts\n- src/types/spec.ts\n- tests/services/SpecEvolutionTracker.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T09:17:10.231257+03:00","created_by":"deligoez","updated_at":"2026-01-11T22:42:50.404253+03:00","closed_at":"2026-01-11T22:42:50.404253+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-2yp","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:54.401818+03:00","created_by":"deligoez"}]}
{"id":"ch-32r","title":"F84b: Dependency Checker Service","description":"## What\nCheck task dependencies for cycles and ordering.\n\n## Files\n- `src/services/DependencyChecker.ts`\n- `src/services/DependencyChecker.test.ts`\n\n## Acceptance Criteria\n- [ ] `check(tasks: Task[])` returns `DependencyResult` object\n- [ ] Detects circular dependencies (A→B→C→A)\n- [ ] Returns cycle path array for circular dependency errors\n- [ ] Validates all dependency IDs exist in task list\n- [ ] Returns error for non-existent dependency ID\n- [ ] `topologicalSort(tasks: Task[])` returns execution order array\n- [ ] `topologicalSort()` places tasks with no deps first\n- [ ] Handles deep dependency chains (A→B→C→D→E)\n- [ ] `getDependents(taskId: string)` returns tasks depending on it\n- [ ] `getBlockers(taskId: string)` returns tasks blocking it\n- [ ] `canStart(taskId: string, completedIds: string[])` checks if deps satisfied\n- [ ] 12 tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:07:04.23006+03:00","created_by":"deligoez","updated_at":"2026-01-11T22:38:43.3222+03:00","closed_at":"2026-01-11T22:38:43.3222+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-32r","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:13.995555+03:00","created_by":"deligoez"}]}
{"id":"ch-3i0","title":"F81b: Chat Input Component","description":"## What\nUser text input with send functionality for chat interface.\n\n## Files\n- `src/components/ChatInput.tsx`\n- `src/components/ChatInput.test.tsx`\n\n## Acceptance Criteria\n- [ ] Renders text input with placeholder text\n- [ ] Enter key sends message and clears input\n- [ ] Shift+Enter inserts newline for multiline input\n- [ ] Supports pasting multiline text (task lists, specs)\n- [ ] Esc key clears input without sending\n- [ ] Ctrl+C triggers cancel/exit callback\n- [ ] Shows \"\u003e \" prompt prefix\n- [ ] Up arrow navigates to previous history entry\n- [ ] Down arrow navigates to next history entry\n- [ ] `onSend(message: string)` callback emits on send\n- [ ] 10 tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:06:05.94541+03:00","created_by":"deligoez","updated_at":"2026-01-12T03:41:25.643349+03:00","closed_at":"2026-01-12T03:41:25.643349+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-3i0","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:13.616836+03:00","created_by":"deligoez"}]}
{"id":"ch-3i6","title":"F46c-b: Intervention Panel - Stop/Block Modes","description":"## What\nIntervention Panel stop-select and block-select modes for stopping agents and blocking tasks.\n\n## Mode Flow\n```\nMain mode:\n  [x] → mode = 'stop-select'\n  [b] → mode = 'block-select'\n\nstop-select mode:\n  Shows: \"Select agent to stop: [1] claude [2] codex\"\n  [1-9] → agentStopper.stopAgent(agentId) → mode = 'main'\n  [ESC] → mode = 'main'\n\nblock-select mode:\n  Shows: \"Select task to block: [1] bd-001 [2] bd-002\"\n  [1-9] → taskBlocker.blockTask(taskId) → mode = 'main'\n  [ESC] → mode = 'main'\n```\n\n## Acceptance Criteria\n\n### Mode Transitions - 2 tests\n- [ ] 'b' key in main mode transitions to 'block-select' mode\n- [ ] ESC in stop-select or block-select returns to 'main' mode\n\n### Stop Select Mode - 2 tests\n- [ ] stop-select mode shows agent selection prompt with numbers\n- [ ] Number key in stop-select calls agentStopper.stopAgent() and returns to main\n\n### Block Select Mode - 2 tests\n- [ ] block-select mode shows task selection prompt with numbers\n- [ ] Number key in block-select calls taskBlocker.blockTask() and returns to main\n\n### Summary\n- [ ] 6 tests pass\n\n## Files\n- src/components/InterventionPanel.tsx (UPDATE)\n- src/components/InterventionPanel.test.tsx (UPDATE)\n\n## Dependencies\n- F46c-a (ch-di6) - Main mode and base component","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T23:52:19.59514+03:00","created_by":"deligoez","updated_at":"2026-01-12T07:34:45.285104+03:00","closed_at":"2026-01-12T07:34:45.285104+03:00","close_reason":"Closed","labels":["m9-intervention"],"dependencies":[{"issue_id":"ch-3i6","depends_on_id":"ch-di6","type":"blocks","created_at":"2026-01-10T23:52:19.599188+03:00","created_by":"deligoez"}]}
{"id":"ch-3ji","title":"F63c: Mode Toggle (m) - Toggle between semi-auto and autopilot","description":"## What\nHandle 'm' key to toggle between operating modes.\n\n## Acceptance Criteria\n- [ ] 'm' toggles between semi-auto and autopilot\n- [ ] Updates ModeIndicator color (green \u003c-\u003e yellow)\n- [ ] Shows toast: \"Switched to [mode] mode\"\n- [ ] Updates state.json mode field\n- [ ] Verifies state.json contains updated mode after toggle\n- [ ] 6 tests pass\n\n## Dependencies\n- F17 Semi-Auto Mode (ch-7gx)\n- F19 Orchestration Store (ch-8j3)\n\n## Context\nThis is a TUI keyboard handler that toggles the operating mode.\nThe actual RalphLoop start/stop logic is handled by F32a/F17.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T21:53:13.192068+03:00","created_by":"deligoez","updated_at":"2026-01-12T05:01:51.188353+03:00","closed_at":"2026-01-12T05:01:51.188353+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-3ji","depends_on_id":"ch-7gx","type":"blocks","created_at":"2026-01-11T14:01:39.076794+03:00","created_by":"deligoez"},{"issue_id":"ch-3ji","depends_on_id":"ch-89dk","type":"blocks","created_at":"2026-01-11T14:37:27.891416+03:00","created_by":"deligoez"},{"issue_id":"ch-3ji","depends_on_id":"ch-vskx","type":"blocks","created_at":"2026-01-11T15:27:36.617757+03:00","created_by":"deligoez"}]}
{"id":"ch-3l5i","title":"TS05b: Query Convenience Methods","description":"## What\nImplement convenience query methods and stats.\n\n## Files\n- `src/services/TaskStore.ts`\n- `src/services/TaskStore.test.ts`\n\n## Acceptance Criteria\n- [ ] `ready()` returns `todo` tasks with no unmet dependencies\n- [ ] `doing()` returns tasks with status `doing`\n- [ ] `done()` returns tasks with status `done`\n- [ ] `stuck()` returns tasks with unmet dependencies\n- [ ] `later()` returns tasks with status `later`\n- [ ] `getStats()` returns count per status\n- [ ] 6 tests pass","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-13T00:21:58.151283+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:21:58.151283+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-3l5i","depends_on_id":"ch-suuw","type":"blocks","created_at":"2026-01-13T00:21:58.153431+03:00","created_by":"deligoez"}]}
{"id":"ch-3na","title":"F55b: AgentSlotsCounter Component - Display running/max agent slots","description":"## What\nDisplay agent slot usage as \"X/Y\" format with color coding based on utilization.\n\n## Context from Master Plan\n```\nCHORUS v2.0                      semi-auto ● 3/50              ? for help\n```\n\n## API\n```typescript\n// src/components/AgentSlotsCounter.tsx\n\ninterface AgentSlotsCounterProps {\n  running: number;\n  max: number;\n}\n\nfunction AgentSlotsCounter({ running, max }: AgentSlotsCounterProps): JSX.Element\n```\n\n## Visual Output\n- \"● 0/3\" - green dot via `\u003cText color=\"green\"\u003e`, no agents running\n- \"● 2/3\" - yellow dot via `\u003cText color=\"yellow\"\u003e`, some slots used\n- \"● 3/3\" - red dot via `\u003cText color=\"red\"\u003e`, all slots full\n\n## Files\n- src/components/AgentSlotsCounter.tsx\n- src/components/AgentSlotsCounter.test.tsx\n\n## Acceptance Criteria\n- [ ] Renders \"X/Y\" format correctly (e.g., \"2/3\")\n- [ ] Shows green dot via `\u003cText color=\"green\"\u003e` when running === 0\n- [ ] Shows yellow dot via `\u003cText color=\"yellow\"\u003e` when running \u003e 0 and running \u003c max\n- [ ] Shows red dot via `\u003cText color=\"red\"\u003e` when running === max (full)\n- [ ] Handles undefined running (defaults to 0)\n- [ ] Handles undefined max (defaults to 0)\n- [ ] Handles max=0 (shows \"0/0\" with gray dot via `\u003cText color=\"gray\"\u003e`)\n- [ ] Handles negative values (treats as 0)\n- [ ] 9 tests pass\n\n## Tests\n1. Renders \"0/3\" format correctly\n2. Renders \"3/3\" format correctly\n3. Shows green dot when no agents running\n4. Shows yellow dot when partially full\n5. Shows red dot when full\n6. Handles undefined running (defaults to 0)\n7. Handles undefined max (defaults to 0)\n8. Handles max=0 (shows gray dot)\n9. Handles negative values (treats as 0)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:48:31.76657+03:00","created_by":"deligoez","updated_at":"2026-01-11T20:12:30.239381+03:00","closed_at":"2026-01-11T20:12:30.239381+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-3na","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:52.621419+03:00","created_by":"deligoez"}]}
{"id":"ch-3oot","title":"TS04: Task Lifecycle Methods","description":"## What\nImplement task status transitions.\n\n## Files\n- `src/services/TaskStore.ts`\n- `src/services/TaskStore.test.ts`\n\n## Acceptance Criteria\n- [ ] `claim(id)` transitions `todo` → `doing`, throws if not claimable\n- [ ] `release(id)` transitions `doing` → `todo`\n- [ ] `complete(id, reason?)` transitions `doing` → `done`\n- [ ] `fail(id, reason?)` transitions `doing` → `failed`, sets lastError\n- [ ] `defer(id)` transitions to `later`\n- [ ] `reopen(id)` transitions `done`/`failed` → `todo`\n- [ ] Invalid transitions throw descriptive errors\n- [ ] Updates `execution.startedAt` on claim\n- [ ] Updates `execution.completedAt` on complete/fail\n- [ ] 12 tests pass","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-13T00:12:42.584967+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:37:29.084602+03:00","closed_at":"2026-01-13T00:37:29.084602+03:00","close_reason":"Closed","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-3oot","depends_on_id":"ch-kakj","type":"blocks","created_at":"2026-01-13T00:12:42.589096+03:00","created_by":"deligoez"}]}
{"id":"ch-3pa","title":"F32b: RalphLoop Core - Task Assignment","description":"## What\nRalphLoop core task assignment loop: slot management, priority ordering, completion handling, iteration management.\n\n**IMPORTANT:** All Beads access via Orchestrator.getReadyTasks(). No direct `bd` CLI calls.\n\n## Acceptance Criteria\n\n### Task Assignment - 8 tests\n- [ ] `processLoop()` assigns tasks to available slots from SlotManager\n- [ ] `processLoop()` respects maxParallel limit (never exceeds configured value)\n- [ ] `processLoop()` picks tasks by priority order: P1 first, P2 second, P3 third, P4 last\n- [ ] `processLoop()` picks FIFO within same priority (oldest ready task first)\n- [ ] `processLoop()` handles \"taskCompleted\" event from Orchestrator\n- [ ] `processLoop()` queues merge via MergeService with worktreePath and taskId on completion\n- [ ] `slotManager.acquire()` returns `false` when all slots occupied (edge case)\n- [ ] `processLoop()` never assigns tasks with 'deferred' label (filtered by Orchestrator.getReadyTasks())\n\n### Iteration Loop and Signal Handling - 6 tests\n- [ ] `processLoop()` respawns agent on NO_SIGNAL if iteration \u003c maxIterations\n- [ ] `processLoop()` marks task as TIMEOUT after maxIterations with no signal\n- [ ] `processLoop()` emits \"taskTimeout\" event on max iterations reached\n- [ ] `processLoop()` frees agent slot when task signals BLOCKED\n- [ ] `processLoop()` keeps task in BLOCKED state (does not close)\n- [ ] `processLoop()` picks next ready task after BLOCKED\n\n### Loop Control - 2 tests\n- [ ] `processLoop()` only assigns tasks from Orchestrator.getReadyTasks() (blocked tasks never assigned)\n- [ ] `processLoop()` emits \"allDone\" event when readyTasks=0 AND activeSlots=0\n\n### Summary\n- [ ] 16 tests pass\n\n## Event Specifications\n```typescript\ninterface RalphLoopCoreEvents {\n  \"allDone\": () =\u003e void;\n  \"taskCompleted\": (taskId: string, worktreePath: string) =\u003e void;\n  \"taskTimeout\": (taskId: string, iterations: number) =\u003e void;\n}\n```\n\n## Dependencies\n- F32a RalphLoop Control (ch-5tj)\n\n## Files\n- src/services/RalphLoop.ts\n- src/services/RalphLoop.test.ts\n\n## Notes\n- Core assignment logic only\n- Error handling in F32c\n- Deadlock detection in F32d\n- **All task queries via Orchestrator.getReadyTasks()**\n- **FIFO within priority ensures deterministic test behavior**\n- **BLOCKED signal frees slot but keeps task in BLOCKED state for manual intervention**","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T08:40:25.033038+03:00","created_by":"deligoez","updated_at":"2026-01-12T06:47:11.631903+03:00","closed_at":"2026-01-12T06:47:11.631903+03:00","close_reason":"Closed","labels":["m7-autopilot"],"dependencies":[{"issue_id":"ch-3pa","depends_on_id":"ch-5tj","type":"blocks","created_at":"2026-01-10T08:40:25.03556+03:00","created_by":"deligoez"},{"issue_id":"ch-3pa","depends_on_id":"ch-0e7","type":"blocks","created_at":"2026-01-11T00:29:44.937024+03:00","created_by":"deligoez"}]}
{"id":"ch-3xt","title":"F83a: Spec Chunker Service","description":"## What\nSplit large spec files into processable chunks for Plan Agent.\n\n## Files\n- `src/services/SpecChunker.ts`\n- `src/services/SpecChunker.test.ts`\n\n## Acceptance Criteria\n- [ ] `chunk(content: string, size?: number)` returns chunks array\n- [ ] Default chunk size is 500 lines\n- [ ] Preserves section boundaries (markdown headers stay with content)\n- [ ] Each chunk has `startLine`, `endLine`, `content` fields\n- [ ] Handles files smaller than chunk size (returns single chunk)\n- [ ] Handles very large files (10K+ lines)\n- [ ] `getProgress(chunkIndex: number)` returns progress percentage\n- [ ] 8 tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:07:52.372587+03:00","created_by":"deligoez","updated_at":"2026-01-11T22:36:09.855284+03:00","closed_at":"2026-01-11T22:36:09.855284+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-3xt","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:14.094744+03:00","created_by":"deligoez"}]}
{"id":"ch-3y0","title":"F09: Agent-Task Linking - Track agent-task association","description":"## What\nAssociate spawned agents with task IDs and track in agentStore.\n\n## Acceptance Criteria\n\n### Agent Type (2 tests)\n- [ ] `Agent` interface has fields: `taskId: string`, `agentType: AgentType`, `worktree: string`, `branch: string`\n- [ ] `Agent` interface has fields: `iteration: number`, `startedAt: Date`\n\n### getAgentByTaskId() - 2 tests\n- [ ] `getAgentByTaskId(\"ch-abc\")` returns `Agent` object when agent with taskId \"ch-abc\" exists\n- [ ] `getAgentByTaskId(\"ch-xyz\")` returns `null` when no agent has that taskId\n\n### getAgentsByType() - 2 tests\n- [ ] `getAgentsByType(\"claude\")` returns array of agents where `agentType === \"claude\"`\n- [ ] `getAgentsByType(\"aider\")` returns empty array `[]` when no agents of that type exist\n\n### incrementIteration() - 1 test\n- [ ] `incrementIteration(\"ch-abc\")` increments `agent.iteration` from 1 to 2 for agent with taskId \"ch-abc\"\n\n### Summary\n- [ ] 7 tests pass\n\n## Files\n- src/types/agent.ts (UPDATE - add fields)\n- src/stores/agentStore.ts (UPDATE - add actions)\n- tests/stores/agentStore.test.ts (UPDATE - add tests)\n\n## API\n```typescript\n// In src/types/agent.ts\ntype AgentType = 'claude' | 'aider' | 'codex';\n\ninterface Agent {\n  taskId: string;\n  agentType: AgentType;\n  worktree: string;\n  branch: string;\n  iteration: number;\n  startedAt: Date;\n}\n\n// In src/stores/agentStore.ts (actions)\ninterface AgentStoreActions {\n  getAgentByTaskId(taskId: string): Agent | null;\n  getAgentsByType(type: AgentType): Agent[];\n  incrementIteration(taskId: string): void;\n}\n```\n\n## Tests (7 total)\n1. Agent interface has taskId, agentType, worktree, branch fields\n2. Agent interface has iteration, startedAt fields\n3. getAgentByTaskId() returns Agent when exists\n4. getAgentByTaskId() returns null when not found\n5. getAgentsByType() returns matching agents\n6. getAgentsByType() returns empty array when none match\n7. incrementIteration() increments iteration count\n\n## Plan\nSee: thoughts/shared/plans/features/F09-agent-task-linking.md","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T01:38:24.319933+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:27:18.438585+03:00","closed_at":"2026-01-11T18:27:18.438585+03:00","close_reason":"Closed","labels":["m2-agent-prep"],"dependencies":[{"issue_id":"ch-3y0","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:34.924281+03:00","created_by":"deligoez"}]}
{"id":"ch-3zla","title":"E2E-43: InitPrerequisites Integration Tests","description":"## What\nEnd-to-end tests for InitPrerequisites using real system checks.\n\n## Why\nCurrent unit tests mock fs and process runner. Need real tests to verify:\n- Git CLI detection\n- bd CLI detection\n- Directory existence checks\n\n## Tests (6 tests)\n\n### Git Detection (2 tests)\n1. Detects git when available\n2. Returns correct git version\n\n### Beads Detection (2 tests)\n3. Detects bd when available\n4. Returns correct bd version\n\n### Directory Checks (2 tests)\n5. Detects .git directory\n6. Detects .beads directory\n\n## Files\n- src/e2e/init-prerequisites.e2e.test.ts (NEW)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T23:35:29.329372+03:00","created_by":"deligoez","updated_at":"2026-01-11T23:53:26.795562+03:00","closed_at":"2026-01-11T23:53:26.795562+03:00","close_reason":"InitPrerequisites E2E tests - 7 tests","labels":["m12-tui"]}
{"id":"ch-3zvn","title":"BUG: PlanAgent.executeClaudeCall returns empty string (placeholder)","description":"## What\nPlanAgent.executeClaudeCall() is a placeholder that returns empty string instead of actually calling Claude CLI.\n\n## Current State\n```typescript\nprivate executeClaudeCall(_message: string): string {\n  // In real implementation, this would spawn Claude CLI\n  // For now, return empty response\n  return \"\";\n}\n```\n\n## Location\n- src/services/PlanAgent.ts:255\n\n## Acceptance Criteria\n- [ ] executeClaudeCall spawns Claude CLI with message\n- [ ] Returns Claude's response\n- [ ] Uses AgentSpawner or similar for CLI execution\n- [ ] Tests updated to cover real execution\n\n## Files\n- src/services/PlanAgent.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T14:21:04.14177+03:00","created_by":"deligoez","updated_at":"2026-01-12T17:26:59.850794+03:00","closed_at":"2026-01-12T17:26:59.850794+03:00","close_reason":"Closed","labels":["m0-planning"]}
{"id":"ch-44vh","title":"E2E-01: App Renders Correctly","description":"## What\nVerify app renders with basic structure visible.\n\n## Tests (4 tests)\n1. App shows \"CHORUS\" title in output\n2. App shows mode indicator text\n3. App shows task panel area\n4. App shows agent grid area\n\n## Files\n- src/e2e/app-renders.e2e.test.ts\n\n## Notes\nTests completed HeaderBar, FooterBar, TwoColumnLayout components.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T21:17:46.071785+03:00","created_by":"deligoez","updated_at":"2026-01-11T21:31:21.091829+03:00","closed_at":"2026-01-11T21:31:21.091829+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-44vh","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:17:46.07852+03:00","created_by":"deligoez"},{"issue_id":"ch-44vh","depends_on_id":"ch-amw","type":"blocks","created_at":"2026-01-11T21:25:08.419582+03:00","created_by":"deligoez"},{"issue_id":"ch-44vh","depends_on_id":"ch-nvo","type":"blocks","created_at":"2026-01-11T21:25:08.490261+03:00","created_by":"deligoez"},{"issue_id":"ch-44vh","depends_on_id":"ch-73t","type":"blocks","created_at":"2026-01-11T21:25:08.560947+03:00","created_by":"deligoez"}]}
{"id":"ch-45zs","title":"TS08-E2E: Events E2E Tests","description":"## What\nE2E tests for event emission.\n\n## Files\n- `src/e2e/taskstore-events.e2e.test.ts`\n\n## Acceptance Criteria\n- [ ] Events fire correctly for lifecycle changes\n- [ ] `change` event includes updated task list\n- [ ] 2 tests pass","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:13:47.269787+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:13:47.269787+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-45zs","depends_on_id":"ch-0qmq","type":"blocks","created_at":"2026-01-13T00:13:47.272905+03:00","created_by":"deligoez"}]}
{"id":"ch-49w","title":"F59d: AgentTileOutput - Status text and test results","description":"## What\nStatus text and test result display for agent tile.\n\n## Visual\n```\nReading auth configuration...\n$ npm test\n✓ 47 tests passed\n```\n\n## API\n```typescript\n// src/components/AgentTileOutput.tsx\n\ninterface AgentTileOutputProps {\n  statusText?: string;      // e.g., \"Reading auth...\"\n  lastCommand?: string;     // e.g., \"npm test\"\n  testResult?: {\n    passed: number;\n    failed: number;\n  };\n}\n\nfunction AgentTileOutput({ statusText, lastCommand, testResult }: AgentTileOutputProps): JSX.Element\n```\n\n## Example Output\n```\nReading auth configuration...\n$ npm test\n✓ 47 tests passed\n```\n\n## Color Specs (Ink)\n- statusText: dimColor (uses Ink's dimColor prop)\n- command \"$\" prefix: color=\"gray\"\n- checkmark \"✓\": color=\"green\" (all tests pass)\n- X mark \"✗\": color=\"red\" (any test fails)\n- passed count: color=\"green\"\n- failed count: color=\"red\"\n\n## Files\n- src/components/AgentTileOutput.tsx\n- src/components/AgentTileOutput.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows status text with dimColor when provided\n- [ ] Shows last command with gray \"$\" prefix\n- [ ] Shows green \"✓\" checkmark when all tests pass (failed=0)\n- [ ] Shows red \"✗\" when any tests fail (failed\u003e0)\n- [ ] Shows \"X passed, Y failed\" format when failures exist\n- [ ] Shows \"X tests passed\" format when no failures\n- [ ] Shows \"0 tests\" or empty when passed=0 AND failed=0\n- [ ] Handles missing optional props (renders nothing for missing)\n\n### Summary\n- [ ] 8 tests pass\n\n## Test Cases\n1. Shows status text with dimColor\n2. Shows command with gray $ prefix\n3. Shows green checkmark for all pass\n4. Shows red X for failures\n5. Shows \"X passed, Y failed\" format\n6. Shows \"X tests passed\" format\n7. Handles zero test results (passed=0, failed=0)\n8. Handles missing optional props","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:49:57.208382+03:00","created_by":"deligoez","updated_at":"2026-01-11T20:21:13.520107+03:00","closed_at":"2026-01-11T20:21:13.520107+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-49w","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:53.325635+03:00","created_by":"deligoez"}]}
{"id":"ch-4ba","title":"F80b: Config Wizard Component","description":"## What\nInteractive TUI for config setup (project info, quality commands, rules).\nHandles Steps 2-4 of 5-step Init flow (after Prerequisites, before Plan Review Config).\n\n## Files\n- `src/components/ConfigWizard.tsx`\n- `src/components/ConfigWizard.test.tsx`\n\n## Dependencies\n- F80a (ch-06m): Uses ProjectDetector for initial detection\n\n## Init Flow Context\n```\nStep 1/5: Prerequisites Check  → F80 (before wizard)\nStep 2/5: Project Detection    → This component\nStep 3/5: Quality Commands     → This component\nStep 4/5: Task Validation Rules → This component\nStep 5/5: Plan Review Config   → F80d (after wizard)\n```\n\n## Acceptance Criteria\n\n### Step 2/5: Project Detection\n- [ ] Displays detected project type, allows editing\n- [ ] Project name input with default from detection\n- [ ] Task ID prefix input with default 'ch-'\n\n### Step 3/5: Quality Commands\n- [ ] Lists quality commands with add/remove/toggle actions\n- [ ] `add \u003cname\u003e \u003ccommand\u003e` adds new command\n- [ ] `toggle \u003cn\u003e` toggles required/optional for command at index\n- [ ] `remove \u003cn\u003e` removes command at index\n\n### Step 4/5: Task Validation Rules\n- [ ] Shows built-in rules (read-only display)\n- [ ] Configurable limits input (max_criteria, max_length)\n\n### Navigation \u0026 UX\n- [ ] Navigation with Enter (next) and Tab (focus)\n- [ ] Free text input for questions/corrections\n- [ ] Header shows \"Step N/5\" matching overall init flow\n- [ ] `onComplete(config: WizardConfig)` callback emits final config\n- [ ] 12 tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:05:27.36435+03:00","created_by":"deligoez","updated_at":"2026-01-12T02:44:35.138515+03:00","closed_at":"2026-01-12T02:44:35.138515+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-4ba","depends_on_id":"ch-06m","type":"blocks","created_at":"2026-01-11T03:05:27.368565+03:00","created_by":"deligoez"}]}
{"id":"ch-4cvf","title":"CHORE: Fix Vitest 4 poolOptions deprecation warning","description":"## What\nVitest 4 deprecated `test.poolOptions` - need to migrate to new config format.\n\n## Warning\n```\nDEPRECATED: test.poolOptions was removed in Vitest 4.\nAll previous poolOptions are now top-level options.\n```\n\n## Migration Guide\nhttps://vitest.dev/guide/migration#pool-rework\n\n## Files\n- vitest.config.ts\n- vitest.integration.config.ts\n\n## Acceptance Criteria\n- [ ] No deprecation warning when running tests\n- [ ] Config follows Vitest 4 best practices","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T14:28:27.930083+03:00","created_by":"deligoez","updated_at":"2026-01-12T17:56:17.892479+03:00","closed_at":"2026-01-12T17:56:17.892479+03:00","close_reason":"Closed","labels":["m1-infrastructure"]}
{"id":"ch-4edr","title":"E2E-24: Merge Queue View (M key)","description":"## What\nE2E test for merge queue view with 'M' key (Shift+m).\n\n## Acceptance Criteria\n- [ ] Pressing 'M' (Shift+m) opens merge queue panel\n- [ ] Shows queued merges with status indicators\n- [ ] Shows current merge progress if any\n- [ ] Can scroll through queue with j/k\n- [ ] Pressing 'M' again closes panel\n- [ ] Pressing Escape closes panel\n- [ ] 6 tests pass\n\n## Test Cases\n1. `it('opens merge queue panel when M is pressed')`\n2. `it('displays queued merges')`\n3. `it('shows merge status indicators')`\n4. `it('scrolls through queue with j/k')`\n5. `it('closes panel when M pressed again')`\n6. `it('closes panel with Escape')`\n\n## Files\n- tests/e2e/merge-queue-view.test.ts\n\n## Dependencies\n- ch-0e01 (E2E Infrastructure)\n- ch-0fwe (F63-merge-view Merge Queue View Key)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:20:46.324417+03:00","created_by":"deligoez","updated_at":"2026-01-12T09:49:24.393864+03:00","closed_at":"2026-01-12T09:49:24.393864+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-4edr","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:20:46.32797+03:00","created_by":"deligoez"},{"issue_id":"ch-4edr","depends_on_id":"ch-0fwe","type":"blocks","created_at":"2026-01-11T21:20:46.330003+03:00","created_by":"deligoez"}]}
{"id":"ch-4ow","title":"F63b: Quick Select (1-9) - Select task by number key","description":"## What\nKeyboard handler for number keys 1-9 to quickly select a task by its visible position.\n\n## Shortcut\n- **1-9** - Select task at position N in the visible list\n\n## Implementation\n```typescript\n// src/hooks/useKeyboard.ts\nimport { useInput } from 'ink';\n\nexport function useKeyboard(options: UseKeyboardOptions) {\n  useInput((input, key) =\u003e {\n    // input is the character pressed (e.g., '1', '2', etc.)\n    const num = parseInt(input, 10);\n    if (num \u003e= 1 \u0026\u0026 num \u003c= 9) {\n      options.onQuickSelect?.(num - 1);  // Convert to 0-indexed\n    }\n  });\n}\n\ninterface UseKeyboardOptions {\n  onQuickSelect?: (index: number) =\u003e void;\n  panelFocus?: 'left' | 'right';  // Only fires when 'left'\n}\n```\n\n## Behavior\n- Keys 1-9 select task at that position (1-indexed display, 0-indexed callback)\n- Only works when TaskPanel is focused (panelFocus === 'left')\n- Ignores if position \u003e visible task count (handled by consumer)\n\n## Files\n- src/hooks/useKeyboard.ts (UPDATE)\n- src/hooks/useKeyboard.test.ts (UPDATE)\n\n## Acceptance Criteria\n- [ ] `useInput` detects keys '1'-'9' and calls `onQuickSelect(index)`\n- [ ] Key '1' calls `onQuickSelect(0)`, key '9' calls `onQuickSelect(8)`\n- [ ] Key '0' does not trigger callback\n- [ ] Non-numeric keys do not trigger callback\n- [ ] 4 tests pass\n\n## Tests\n1. Key '1' calls onQuickSelect(0)\n2. Key '9' calls onQuickSelect(8)\n3. Key '0' is ignored (no callback)\n4. Letter key 'a' is ignored (no callback)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T21:52:56.472068+03:00","created_by":"deligoez","updated_at":"2026-01-11T23:24:27.930336+03:00","closed_at":"2026-01-11T23:24:27.930336+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-4ow","depends_on_id":"ch-89dk","type":"blocks","created_at":"2026-01-11T14:37:27.978243+03:00","created_by":"deligoez"}]}
{"id":"ch-4oz","title":"F63i: Merge Queue View (M) - Show merge queue panel","description":"## What\nKeyboard handler for 'M' (shift+m) key to show merge queue status panel.\n\n## Shortcut\n- **M** (Shift+M) - Open merge queue panel\n\n## API\n```typescript\n// Update src/hooks/useKeyboard.ts\n\ninterface UseKeyboardOptions {\n  // ... existing options\n  onMergeQueue?: () =\u003e void;\n}\n```\n\n## Behavior\n- Pressing 'M' opens merge queue panel\n- Shows queued items with status\n- Shows current merge progress\n- Shows conflict status if any\n- Escape closes panel\n\n## Visual Layout\n```\n┌─────────────────────────────────────┐\n│         MERGE QUEUE (3)             │\n├─────────────────────────────────────┤\n│ ● ch-001 Merging... (50%)           │\n│ ○ ch-003 Queued (waiting)           │\n│ ○ ch-005 Queued (waiting)           │\n├─────────────────────────────────────┤\n│ Conflicts: 0 | Merged today: 5      │\n└─────────────────────────────────────┘\n```\n\n## Files\n- src/hooks/useKeyboard.ts (UPDATE)\n- src/hooks/useKeyboard.test.ts (UPDATE)\n- src/components/MergeQueuePanel.tsx (NEW)\n- src/components/MergeQueuePanel.test.tsx (NEW)\n\n## Acceptance Criteria\n- [ ] 'M' key triggers merge queue callback\n- [ ] Opens panel with queue items\n- [ ] Shows merge progress for active item\n- [ ] Shows waiting status for queued items\n- [ ] Shows conflict count\n- [ ] Escape closes panel\n- [ ] Shows \"Queue empty\" message when no items\n- [ ] Refreshes automatically when queue changes\n- [ ] 8 tests pass\n\n## Tests\n1. 'M' key calls onMergeQueue\n2. Panel shows queued items\n3. Shows merge progress\n4. Shows waiting status\n5. Shows conflict count\n6. Escape closes panel\n7. Shows \"Queue empty\" message when queue is empty\n8. Re-renders when queue state changes","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T21:55:02.425593+03:00","created_by":"deligoez","updated_at":"2026-01-11T14:01:53.367734+03:00","closed_at":"2026-01-11T14:01:53.367734+03:00","close_reason":"Duplicate of ch-0fwe (F63-merge-view: Merge Queue View Key)","labels":["m5-merge"],"dependencies":[{"issue_id":"ch-4oz","depends_on_id":"ch-glf","type":"blocks","created_at":"2026-01-10T21:55:07.323462+03:00","created_by":"deligoez"}]}
{"id":"ch-4pw0","title":"E2E-65: Human Intervention System","description":"## What\nE2E tests for intervention controls - pause, stop, redirect, block.\n\n## Acceptance Criteria\n- [ ] Pause pauses all agents mid-task\n- [ ] Resume resumes paused agents\n- [ ] Stop agent kills process, returns task to pending\n- [ ] Redirect agent transfers task to different worker\n- [ ] Block task marks task blocked, frees agent\n- [ ] Multiple interventions don't corrupt state\n- [ ] Agent output preserved after intervention\n- [ ] TUI modal closes correctly after intervention\n- [ ] 9 tests pass\n\n## Files\n- src/e2e/intervention-system.e2e.test.ts\n\n## Implementation Notes\n- Test each intervention type\n- Verify state consistency after intervention","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T00:40:14.925027+03:00","created_by":"deligoez","updated_at":"2026-01-12T09:18:04.51754+03:00","closed_at":"2026-01-12T09:18:04.51754+03:00","close_reason":"Closed","labels":["m9-intervention"],"dependencies":[{"issue_id":"ch-4pw0","depends_on_id":"ch-ahq","type":"blocks","created_at":"2026-01-12T00:40:14.926647+03:00","created_by":"deligoez"},{"issue_id":"ch-4pw0","depends_on_id":"ch-fna","type":"blocks","created_at":"2026-01-12T00:40:14.929336+03:00","created_by":"deligoez"},{"issue_id":"ch-4pw0","depends_on_id":"ch-cwy","type":"blocks","created_at":"2026-01-12T00:40:14.931681+03:00","created_by":"deligoez"},{"issue_id":"ch-4pw0","depends_on_id":"ch-ddk","type":"blocks","created_at":"2026-01-12T00:40:14.933801+03:00","created_by":"deligoez"},{"issue_id":"ch-4pw0","depends_on_id":"ch-sb7","type":"blocks","created_at":"2026-01-12T00:40:14.93612+03:00","created_by":"deligoez"},{"issue_id":"ch-4pw0","depends_on_id":"ch-di6","type":"blocks","created_at":"2026-01-12T00:40:14.943179+03:00","created_by":"deligoez"}]}
{"id":"ch-4wo3","title":"E2E-17: New Task (n)","description":"## What\nVerify n key creates new task.\n\n## Tests (3 tests)\n1. Pressing n opens task input\n2. Can enter task title\n3. Task appears in list\n\n## Files\n- src/e2e/new-task.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T21:18:38.465376+03:00","created_by":"deligoez","updated_at":"2026-01-12T05:46:54.054245+03:00","closed_at":"2026-01-12T05:46:54.054245+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-4wo3","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:18:38.471695+03:00","created_by":"deligoez"},{"issue_id":"ch-4wo3","depends_on_id":"ch-im6","type":"blocks","created_at":"2026-01-11T21:18:38.474771+03:00","created_by":"deligoez"}]}
{"id":"ch-555","title":"F63h: View Logs (l) - Show agent logs panel","description":"## What\nKeyboard handler for 'l' key to show agent logs panel.\n\n## Shortcut\n- **l** - View logs for selected agent\n\n## API\n```typescript\n// src/hooks/useKeyboard.ts\ninterface UseKeyboardOptions {\n  onViewLogs?: () =\u003e void;\n}\n\n// src/components/LogsPanel.tsx\ninterface LogsPanelProps {\n  isOpen: boolean;\n  logs: LogEntry[];\n  onClose: () =\u003e void;\n}\n\ninterface LogEntry {\n  timestamp: Date;\n  content: string;\n}\n```\n\n## Behavior\n- 'l' opens logs panel for selected agent\n- Shows scrollable list of log entries\n- Each entry shows timestamp and content\n- j/k or arrows scroll through logs\n- Escape closes panel\n\n## Files\n- src/hooks/useKeyboard.ts (UPDATE)\n- src/components/LogsPanel.tsx (NEW)\n- src/components/LogsPanel.test.tsx (NEW)\n\n## Acceptance Criteria\n- [ ] `useInput` detects 'l' and calls `onViewLogs()`\n- [ ] LogsPanel renders when isOpen=true\n- [ ] Each log entry shows timestamp and content\n- [ ] j/downArrow increases scroll offset\n- [ ] k/upArrow decreases scroll offset (min 0)\n- [ ] Scroll stops at bottom (max = logs.length - visibleLines)\n- [ ] Escape calls `onClose()`\n\n### Summary\n- [ ] 7 tests pass\n\n## Test Cases\n1. 'l' key calls onViewLogs\n2. Panel renders when isOpen=true\n3. Log entries show timestamp and content\n4. j/down increases scroll offset\n5. k/up decreases scroll offset (min 0)\n6. Scroll stops at bottom boundary\n7. Escape closes panel","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T21:54:41.165172+03:00","created_by":"deligoez","updated_at":"2026-01-12T04:55:12.27199+03:00","closed_at":"2026-01-12T04:55:12.27199+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-555","depends_on_id":"ch-vskx","type":"blocks","created_at":"2026-01-11T15:27:37.021685+03:00","created_by":"deligoez"}]}
{"id":"ch-56xu","title":"E2E-20: Edit Task (e)","description":"## What\nVerify e key opens task editor.\n\n## Tests (3 tests)\n1. Pressing e opens editor\n2. Can modify task\n3. Changes saved\n\n## Files\n- src/e2e/edit-task.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T21:18:38.729099+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:04:25.732144+03:00","closed_at":"2026-01-12T01:04:25.732144+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-56xu","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:18:38.730559+03:00","created_by":"deligoez"},{"issue_id":"ch-56xu","depends_on_id":"ch-xe8","type":"blocks","created_at":"2026-01-11T21:18:38.732552+03:00","created_by":"deligoez"}]}
{"id":"ch-5axj","title":"TS06-E2E: Dependency E2E Tests","description":"## What\nE2E tests for dependency management.\n\n## Files\n- `src/e2e/taskstore-dependencies.e2e.test.ts`\n\n## Acceptance Criteria\n- [ ] Dependencies persist across restarts\n- [ ] Completing blocker unblocks dependent\n- [ ] Circular dependency prevented\n- [ ] 3 tests pass","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:13:29.05059+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:13:29.05059+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-5axj","depends_on_id":"ch-8pne","type":"blocks","created_at":"2026-01-13T00:13:29.053212+03:00","created_by":"deligoez"}]}
{"id":"ch-5bd","title":"F85a: Review TUI Component","description":"## What\nDisplay validation results and iteration progress.\n\n## Files\n- `src/components/ReviewResults.tsx`\n- `src/components/ReviewResults.test.tsx`\n\n## Dependencies\n- F84 (ch-2hw): TaskValidator for validation results\n\n## Acceptance Criteria\n- [ ] Shows iteration number (e.g., \"Iteration 1/3\")\n- [ ] Lists errors with task ID and error message\n- [ ] Shows suggested fix for each error\n- [ ] Shows \"-\u003e Splitting into...\" suggestion for oversized tasks\n- [ ] Shows \"-\u003e Reordering...\" suggestion for dependency issues\n- [ ] Shows \"-\u003e Need clarification\" for vague criteria\n- [ ] Lists warnings in separate section\n- [ ] Shows available actions (fix, split, reorder)\n- [ ] Color coding: red for errors, yellow for warnings\n- [ ] Shows summary counts (X errors, Y warnings)\n- [ ] Scrollable for many validation issues\n- [ ] Shows \"All tasks valid\" when no issues\n- [ ] 12 tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:07:21.937888+03:00","created_by":"deligoez","updated_at":"2026-01-12T03:50:46.728784+03:00","closed_at":"2026-01-12T03:50:46.728784+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-5bd","depends_on_id":"ch-2hw","type":"blocks","created_at":"2026-01-11T03:07:21.941676+03:00","created_by":"deligoez"}]}
{"id":"ch-5gxg","title":"FX06: Event Sourcing - Backup recovery mechanism","description":"## What\nImplement event sourcing as fallback recovery mechanism when snapshot restoration fails.\n\n## Acceptance Criteria\n- [ ] `persistEvent(event)` appends to `.chorus/events.jsonl`\n- [ ] Each event has timestamp\n- [ ] `replayEvents()` reads all events and replays\n- [ ] Event log can be truncated after successful snapshot\n- [ ] Log rotation (max 10MB, archive old)\n- [ ] 6 tests pass\n\n## Tests\n1. persistEvent appends to JSONL file\n2. Events have timestamp field\n3. replayEvents creates machine from events\n4. Replayed machine reaches same state as original\n5. Log truncation after snapshot preserves recovery\n6. Log rotation archives when \u003e 10MB\n\n## Files\n- src/services/event-sourcing.ts\n\n## Dependencies\n- FX03 (Root Machine)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-11T15:26:47.898709+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:07:08.053667+03:00","closed_at":"2026-01-11T18:07:08.053667+03:00","close_reason":"Closed","labels":["m-1-xstate"],"dependencies":[{"issue_id":"ch-5gxg","depends_on_id":"ch-kjae","type":"blocks","created_at":"2026-01-11T15:26:47.902541+03:00","created_by":"deligoez"}]}
{"id":"ch-5imz","title":"BUG: BeadsCLI E2E tests fail in no-db JSONL-only mode","description":"## What\n6 E2E tests in beads-cli.e2e.test.ts are skipped because bd CLI commands don't work correctly in no-db JSONL-only mode.\n\n## Skipped Tests\n1. `getTask()` - returns task object for existing task\n2. `claimTask()` - claims task without error\n3. `releaseTask()` - releases task without error\n4. `closeTask()` - closes task without error\n5. `reopenTask()` - reopens task without error\n6. `getInProgressTasks()` - returns list of in-progress tasks\n\n## Root Cause\n- bd CLI's `show`, `update`, `close` commands don't resolve task IDs correctly when running in no-db mode\n- The test creates a temp repo with `.beads/config.yaml` containing `no-db: true`\n- bd returns errors like \"resolving ID chorus-git: no issue found\"\n\n## Possible Solutions\n1. **Wait for bd fix** - Report to beads maintainers\n2. **Use full database mode** - But requires sqlite setup in tests\n3. **Mock bd for these tests** - But defeats the purpose of E2E\n\n## Acceptance Criteria\n- [ ] All 6 skipped tests pass\n- [ ] Remove `.skip` from test methods\n\n## Files\n- src/e2e/beads-cli.e2e.test.ts:69, 94, 103, 118, 127, 159","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T00:22:22.692682+03:00","created_by":"deligoez","updated_at":"2026-01-12T11:31:51.47869+03:00","closed_at":"2026-01-12T11:31:51.47869+03:00","close_reason":"Fixed by correcting regex for task ID parsing and array handling in getTask()","labels":["m12-tui"]}
{"id":"ch-5loa","title":"E2E-R03: Redo with Feedback E2E - Submit feedback and verify injection","description":"## What\nE2E test for feedback submission and injection.\n\n## Acceptance Criteria\n- [ ] Create task in \"reviewing\" status with completion result\n- [ ] Submit redo with feedback via modal (quick issues + custom text)\n- [ ] Verify feedback saved to `.chorus/feedback/{taskId}.json`\n- [ ] Verify feedback injected when agent picks up task (mock agent)\n- [ ] 4 tests pass\n\n## Files\n- src/e2e/feedback-flow.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:13:53.756901+03:00","created_by":"deligoez","updated_at":"2026-01-12T17:09:29.903422+03:00","closed_at":"2026-01-12T17:09:29.903422+03:00","close_reason":"Closed","labels":["m13-review"],"dependencies":[{"issue_id":"ch-5loa","depends_on_id":"ch-iaru","type":"blocks","created_at":"2026-01-12T15:13:53.760576+03:00","created_by":"deligoez"},{"issue_id":"ch-5loa","depends_on_id":"ch-fhxb","type":"blocks","created_at":"2026-01-12T15:13:53.766467+03:00","created_by":"deligoez"}]}
{"id":"ch-5tj","title":"F32a: RalphLoop Control","description":"## What\nRalphLoop types, constructor, and control methods (start/stop/pause/resume). Foundation for autopilot loop.\n\n## Acceptance Criteria\n\n### start() - 3 tests\n- [ ] `start()` emits \"started\" event\n- [ ] `start()` begins processing task queue (sets up loop)\n- [ ] `start()` is idempotent (calling twice doesn't restart)\n\n### stop() - 3 tests\n- [ ] `stop()` stops accepting new tasks\n- [ ] `stop()` waits for active agents to complete before returning\n- [ ] `stop()` emits \"stopped\" event\n\n### pause() / resume() - 2 tests\n- [ ] `pause()` stops new task assignment without killing agents\n- [ ] `resume()` continues task assignment\n\n### Status Methods (implicit - tested via control tests)\n- `getStatus()` returns LoopStatus object\n- `isRunning()` returns boolean\n- `isPaused()` returns boolean\n\n### Summary\n- [ ] 8 tests pass\n\n## Dependencies\n- F15 Orchestrator Core (ch-0e7) - for task assignment\n  - **Note:** Orchestrator provides `getReadyTasks()` which filters out blocked and deferred tasks\n- F16b Completion Handler Retry (ch-lhm) - for completion detection\n- F22 Slot Manager (ch-i9i) - for slot availability\n- F31 Merge Service (ch-8ee) - for merge queueing\n\n## Files\n- src/services/RalphLoop.ts (types, constructor, control methods)\n- tests/services/RalphLoop.test.ts\n\n## Plan\nSee: thoughts/shared/plans/features/F32-ralph-loop.md (F32a section)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T03:17:43.652411+03:00","created_by":"deligoez","updated_at":"2026-01-12T06:28:07.021956+03:00","closed_at":"2026-01-12T06:28:07.021956+03:00","close_reason":"Closed","labels":["m7-autopilot"],"dependencies":[{"issue_id":"ch-5tj","depends_on_id":"ch-lhm","type":"blocks","created_at":"2026-01-10T03:17:43.655134+03:00","created_by":"deligoez"},{"issue_id":"ch-5tj","depends_on_id":"ch-i9i","type":"blocks","created_at":"2026-01-10T03:17:43.656848+03:00","created_by":"deligoez"},{"issue_id":"ch-5tj","depends_on_id":"ch-8ee","type":"blocks","created_at":"2026-01-10T03:17:43.658246+03:00","created_by":"deligoez"},{"issue_id":"ch-5tj","depends_on_id":"ch-0e7","type":"blocks","created_at":"2026-01-10T08:30:36.673504+03:00","created_by":"deligoez"}]}
{"id":"ch-60jx","title":"E2E-22: View Logs (l key)","description":"## What\nE2E test for viewing agent logs with 'l' key.\n\n## Acceptance Criteria\n- [ ] Pressing 'l' expands agent output panel\n- [ ] Shows full log history for selected agent\n- [ ] Can scroll through logs with j/k\n- [ ] Pressing 'l' again collapses to normal view\n- [ ] Pressing Escape exits log view\n- [ ] 5 tests pass\n\n## Test Cases\n1. `it('expands log view when l is pressed')`\n2. `it('shows agent output history')`\n3. `it('scrolls through logs with j/k')`\n4. `it('collapses log view when l pressed again')`\n5. `it('exits log view with Escape')`\n\n## Files\n- tests/e2e/view-logs.test.ts\n\n## Dependencies\n- ch-0e01 (E2E Infrastructure)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:20:44.241673+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:34:01.710345+03:00","closed_at":"2026-01-12T01:34:01.710345+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-60jx","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:20:44.242875+03:00","created_by":"deligoez"}]}
{"id":"ch-69la","title":"CHORE: Integrate node-pty for TTY-dependent E2E tests","description":"## What\nIntegrate node-pty to enable proper TTY testing for Ink's useInput hook in E2E tests.\n\n## Why\n- cli-testing-library uses pipes, not TTY\n- Ink's useInput requires `process.stdin.isTTY = true`\n- Currently 2 E2E tests skipped due to TTY limitation\n- Other tests work around the issue instead of testing properly\n\n## Acceptance Criteria\n- [ ] node-pty installed as dev dependency\n- [ ] PTY test helper created (similar to Ink's approach)\n- [ ] Skipped intervention-menu tests unskipped and working\n- [ ] Existing workaround tests converted to use PTY where beneficial\n- [ ] Best practices documented in e2e-testing.md\n- [ ] All tests pass\n- [ ] Quality checks pass\n\n## Implementation\n1. `npm install -D node-pty`\n2. Create `src/test-utils/pty-helpers.ts`\n3. Fix intervention-menu.e2e.test.ts skipped tests\n4. Review other E2E tests for PTY improvements\n5. Update e2e-testing.md with best practices\n\n## Files\n- package.json\n- src/test-utils/pty-helpers.ts (new)\n- src/e2e/intervention-menu.e2e.test.ts\n- .claude/rules/e2e-testing.md","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T11:44:35.754601+03:00","created_by":"deligoez","updated_at":"2026-01-12T12:14:59.9919+03:00","closed_at":"2026-01-12T12:14:59.9919+03:00","close_reason":"Closed","labels":["m12-tui"]}
{"id":"ch-6aq","title":"F63w: Create Checkpoint Key (c) - Manual checkpoint creation","description":"## What\nKeyboard handler to manually create a checkpoint (git tag).\n\n## Context from Master Plan\n```\nRECOVERY\nc      Create checkpoint\n```\n\n## Shortcut\n- **c** - Create manual checkpoint\n\n## Implementation\n\n```typescript\n// src/hooks/useCheckpointKey.ts\n\ninterface UseCheckpointKeyOptions {\n  checkpointer: Checkpointer;\n  onCreated?: (tag: string) =\u003e void;\n  onError?: (error: string) =\u003e void;\n}\n\nfunction useCheckpointKey(options: UseCheckpointKeyOptions) {\n  useInput(async (input) =\u003e {\n    if (input !== 'c') return;\n    \n    try {\n      const tag = await options.checkpointer.create('manual');\n      options.onCreated?.(tag);\n    } catch (error) {\n      options.onError?.(error.message);\n    }\n  });\n}\n```\n\n## Acceptance Criteria\n\n### Create Checkpoint - 3 tests\n- [ ] 'c' key calls `checkpointer.create('manual')`\n- [ ] Creates git tag with format: `chorus-checkpoint-{timestamp}`\n- [ ] Shows confirmation: \"Checkpoint created: {tag}\"\n\n### Error Handling - 2 tests\n- [ ] Shows error if git tag fails (dirty state, etc.)\n- [ ] Shows error if no commits to checkpoint\n\n### Idempotency - 2 tests\n- [ ] Multiple 'c' presses create distinct checkpoints\n- [ ] Timestamp ensures unique tag names\n\n### Summary\n- [ ] 7 tests pass\n\n## Files\n- src/hooks/useCheckpointKey.ts (NEW)\n- src/hooks/useCheckpointKey.test.ts (NEW)\n\n## Dependencies\n- F48 (Checkpointer) for checkpoint creation\n\n## Notes\n- Manual checkpoint = user-triggered safety point\n- Used before risky operations\n- Can rollback to any checkpoint via 'R' key","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T12:45:18.062964+03:00","created_by":"deligoez","updated_at":"2026-01-12T05:27:09.679236+03:00","closed_at":"2026-01-12T05:27:09.679236+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-6aq","depends_on_id":"ch-k9y","type":"blocks","created_at":"2026-01-11T12:45:18.066913+03:00","created_by":"deligoez"}]}
{"id":"ch-6i1c","title":"E2E-64: Parallel Agent Orchestration","description":"## What\nE2E tests for SlotManager limiting concurrent agents.\n\n## Acceptance Criteria\n- [ ] SlotManager enforces maxParallel limit\n- [ ] nth agent queues when all slots full\n- [ ] Agent completion frees slot\n- [ ] Queued agent spawns automatically\n- [ ] Priority ordering for queued agents\n- [ ] Works with both semi-auto and autopilot\n- [ ] Agent limit respects config changes\n- [ ] 8 tests pass\n\n## Files\n- src/e2e/parallel-agents.e2e.test.ts\n\n## Implementation Notes\n- Test with multiple agents spawning\n- Verify slot allocation/deallocation","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T00:40:04.079825+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:25:10.17714+03:00","closed_at":"2026-01-12T01:25:10.17714+03:00","close_reason":"Closed","labels":["m6-parallelism"],"dependencies":[{"issue_id":"ch-6i1c","depends_on_id":"ch-i9i","type":"blocks","created_at":"2026-01-12T00:40:04.083041+03:00","created_by":"deligoez"},{"issue_id":"ch-6i1c","depends_on_id":"ch-0e7","type":"blocks","created_at":"2026-01-12T00:40:04.085672+03:00","created_by":"deligoez"},{"issue_id":"ch-6i1c","depends_on_id":"ch-7gx","type":"blocks","created_at":"2026-01-12T00:40:04.087859+03:00","created_by":"deligoez"}]}
{"id":"ch-6n5","title":"F63t: Intervention Menu Key (i) - Open intervention panel","description":"## What\nKeyboard handler to open the Intervention Panel modal.\n\n## Context from Master Plan\n```\nGENERAL\ni      Intervention menu\n```\n\n## Shortcut\n- **i** - Open intervention menu/panel\n\n## Implementation\n\n```typescript\n// src/hooks/useInterventionKey.ts\n\ninterface UseInterventionKeyOptions {\n  onOpen: () =\u003e void;\n  isDisabled?: boolean;  // e.g., when another modal is open\n}\n\nfunction useInterventionKey(options: UseInterventionKeyOptions) {\n  useInput((input) =\u003e {\n    if (input === 'i' \u0026\u0026 !options.isDisabled) {\n      options.onOpen();\n    }\n  });\n}\n\n// Usage in App.tsx\nconst [interventionVisible, setInterventionVisible] = useState(false);\n\nuseInterventionKey({\n  onOpen: () =\u003e setInterventionVisible(true),\n  isDisabled: helpVisible || otherModalVisible\n});\n\n\u003cInterventionPanel \n  visible={interventionVisible}\n  onClose={() =\u003e setInterventionVisible(false)}\n/\u003e\n```\n\n## Acceptance Criteria\n\n### Open Panel - 2 tests\n- [ ] 'i' key sets intervention panel visible=true\n- [ ] InterventionPanel renders when visible\n\n### Close Panel - 2 tests\n- [ ] ESC key inside panel closes it (handled by F46c-a)\n- [ ] onClose callback sets visible=false\n\n### Modal Exclusivity - 2 tests\n- [ ] No-op when another modal is open (help, logs, etc.)\n- [ ] No-op when intervention panel already open\n\n### Summary\n- [ ] 6 tests pass\n\n## Files\n- src/hooks/useInterventionKey.ts (NEW)\n- src/hooks/useInterventionKey.test.ts (NEW)\n\n## Dependencies\n- F46c-a (InterventionPanel) must exist\n\n## Notes\n- Intervention panel provides: pause, stop, redirect, edit, block\n- 'i' opens the panel, panel-internal keys handle actions\n- Only one modal can be open at a time","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T12:44:36.472286+03:00","created_by":"deligoez","updated_at":"2026-01-12T07:24:42.391773+03:00","closed_at":"2026-01-12T07:24:42.391773+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-6n5","depends_on_id":"ch-di6","type":"blocks","created_at":"2026-01-11T12:44:36.476959+03:00","created_by":"deligoez"}]}
{"id":"ch-6oy","title":"F85b: Fix Applier Service","description":"## What\nApply suggested fixes to tasks (modify, split, reorder).\n\n## Files\n- `src/services/FixApplier.ts`\n- `src/services/FixApplier.test.ts`\n\n## Dependencies\n- F84 (ch-2hw): TaskValidator for fix suggestions\n\n## Acceptance Criteria\n- [ ] `applyFix(task: Task, fix: Fix)` returns modified task\n- [ ] Handles split fix: returns array of multiple tasks\n- [ ] Handles rewrite fix: returns single modified task\n- [ ] Handles reorder fix: returns reordered task list\n- [ ] Preserves original task ID on modification\n- [ ] Generates new sequential IDs for split tasks\n- [ ] Updates dependencies when task is split\n- [ ] `needsUserInput(fix: Fix)` returns true for clarification fixes\n- [ ] Logs applied fixes via SessionLogger\n- [ ] 10 tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:07:30.29679+03:00","created_by":"deligoez","updated_at":"2026-01-12T03:23:54.932613+03:00","closed_at":"2026-01-12T03:23:54.932613+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-6oy","depends_on_id":"ch-2hw","type":"blocks","created_at":"2026-01-11T03:07:30.300619+03:00","created_by":"deligoez"}]}
{"id":"ch-6oyo","title":"E2E-57: XState Snapshot \u0026 Recovery","description":"## What\nE2E tests for hybrid persistence strategy (snapshot + event sourcing fallback).\n\n## Acceptance Criteria\n- [ ] Snapshot saves after agent spawned/completed\n- [ ] App restart loads snapshot, resumes agents\n- [ ] Corrupted snapshot triggers event sourcing fallback\n- [ ] Event replay reconstructs state correctly\n- [ ] Spawned agent refs restored from snapshot\n- [ ] Graceful degradation when no snapshot exists\n- [ ] 8 tests pass\n\n## Files\n- src/e2e/xstate-persistence.e2e.test.ts\n\n## Implementation Notes\n- Simulate crash by killing process\n- Verify state restoration with real file system","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T00:38:53.011911+03:00","created_by":"deligoez","updated_at":"2026-01-12T00:47:18.017549+03:00","closed_at":"2026-01-12T00:47:18.017549+03:00","close_reason":"Closed","labels":["m-1-xstate"],"dependencies":[{"issue_id":"ch-6oyo","depends_on_id":"ch-134l","type":"blocks","created_at":"2026-01-12T00:38:53.015115+03:00","created_by":"deligoez"},{"issue_id":"ch-6oyo","depends_on_id":"ch-5gxg","type":"blocks","created_at":"2026-01-12T00:38:53.0178+03:00","created_by":"deligoez"}]}
{"id":"ch-6rh8","title":"F64b: AgentGrid Integration - Grid + Tiles + Empty Slots","description":"## What\nIntegration tests verifying AgentGrid renders correctly with various agent counts and configurations.\n\n## Components Under Test\n- F60a AgentGrid (ch-hhh)\n- F60b useAgentGrid hook (ch-70p)\n- F59e AgentTile (ch-c2p)\n- F59a EmptySlot (ch-if9)\n\n## Integration Scenarios\n\n### 1. Grid Configurations\n```\n2x2 Grid (4 slots, 2 agents):\n┌───────────────────┬───────────────────┐\n│ AgentTile (ch-01) │ AgentTile (ch-02) │\n├───────────────────┼───────────────────┤\n│ [EmptySlot]       │ [EmptySlot]       │\n└───────────────────┴───────────────────┘\n\n1x3 Grid (narrow terminal):\n┌───────────────────┐\n│ AgentTile (ch-01) │\n├───────────────────┤\n│ AgentTile (ch-02) │\n├───────────────────┤\n│ [EmptySlot]       │\n└───────────────────┘\n```\n\n### 2. Dynamic Updates\n- Agent spawned → tile appears in grid\n- Agent stopped → tile replaced with EmptySlot\n- Grid config changed → layout recalculates\n\n## Acceptance Criteria\n\n### Grid Layout Tests - 4 tests\n- [ ] 2x2 config renders 4 cells correctly\n- [ ] 1x4 config renders vertical stack\n- [ ] \"auto\" config adapts to terminal width\n- [ ] All cells same size within grid\n\n### Agent/Empty Mix Tests - 4 tests\n- [ ] 3 agents, 4 slots → 3 tiles + 1 empty\n- [ ] 0 agents, 4 slots → 4 empty slots\n- [ ] 4 agents, 4 slots → 4 tiles, no empty\n- [ ] Agents fill top-left first, empties bottom-right\n\n### Dynamic Update Tests - 3 tests\n- [ ] New agent appears immediately in next empty slot\n- [ ] Stopped agent replaced by EmptySlot\n- [ ] Changing grid config (via 'g' key) re-renders\n\n### Tile Content Tests - 3 tests\n- [ ] Each tile shows correct agent type and task ID\n- [ ] Progress bar updates with iteration\n- [ ] Duration display ticks every second\n\n### Selection Tests - 2 tests\n- [ ] Selected tile has highlighted border\n- [ ] Navigation keys move selection correctly\n\n### Summary\n- [ ] 16 tests pass\n\n## Files\n- src/components/AgentGrid.integration.test.tsx (NEW)\n\n## Dependencies\n- F60a AgentGrid\n- F60b useAgentGrid\n- F59e AgentTile\n- F59a EmptySlot\n\n## Notes\n- Use fake timers for duration testing\n- Mock useAgentGrid for layout tests\n- Test with ink-testing-library","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T12:47:26.097116+03:00","created_by":"deligoez","updated_at":"2026-01-11T22:03:49.607461+03:00","closed_at":"2026-01-11T22:03:49.607461+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-6rh8","depends_on_id":"ch-hhh","type":"blocks","created_at":"2026-01-11T12:47:26.099753+03:00","created_by":"deligoez"},{"issue_id":"ch-6rh8","depends_on_id":"ch-c2p","type":"blocks","created_at":"2026-01-11T12:47:26.102043+03:00","created_by":"deligoez"},{"issue_id":"ch-6rh8","depends_on_id":"ch-if9","type":"blocks","created_at":"2026-01-11T12:47:26.104076+03:00","created_by":"deligoez"},{"issue_id":"ch-6rh8","depends_on_id":"ch-70p","type":"blocks","created_at":"2026-01-11T12:47:26.106034+03:00","created_by":"deligoez"}]}
{"id":"ch-6sg","title":"F06b: Chorus Worktree CLI Commands","description":"## What\nCLI commands for worktree management: `chorus worktree clean`, `chorus worktree list`.\n\n## Context from Master Plan\n\n**Worktree Cleanup Commands:**\n```bash\n# Cleanup specific failed task worktree\nchorus worktree clean \u003ctask-id\u003e\n\n# Cleanup all failed/timeout task worktrees\nchorus worktree clean --failed\n\n# Cleanup all worktrees (nuclear option)\nchorus worktree clean --all\n\n# List orphaned worktrees\nchorus worktree list --orphaned\n```\n\n## Commands\n\n### `chorus worktree clean \u003ctask-id\u003e`\n- Removes worktree for specific task\n- Uses WorktreeService.remove() with force: true\n- Shows: \"Cleaned worktree for ch-xxx\"\n\n### `chorus worktree clean --failed`\n- Finds all tasks with `failed=true` or `timeout=true` custom field\n- Removes worktrees for each\n- Shows: \"Cleaned N worktrees for failed/timeout tasks\"\n\n### `chorus worktree clean --all`\n- Removes ALL chorus worktrees (.worktrees/*)\n- Requires confirmation: \"This will remove all worktrees. Continue? [y/N]\"\n- Uses WorktreeService.prune() after removal\n\n### `chorus worktree list`\n- Lists all worktrees in .worktrees/\n- Shows: task-id, agent-type, status, created-at\n\n### `chorus worktree list --orphaned`\n- Lists worktrees without matching in-progress task\n- Shows: path, created-at, suggested-action\n\n## Acceptance Criteria\n\n### clean \u003ctask-id\u003e - 3 tests\n- [ ] Removes worktree via WorktreeService.remove()\n- [ ] Throws error if worktree doesn't exist\n- [ ] Shows success message with task ID\n\n### clean --failed - 3 tests\n- [ ] Gets tasks with failed=true OR timeout=true via BeadsCLI\n- [ ] Removes worktree for each task\n- [ ] Shows count of cleaned worktrees\n\n### clean --all - 3 tests\n- [ ] Prompts for confirmation (unless --yes flag)\n- [ ] Removes all worktrees in .worktrees/\n- [ ] Runs git worktree prune after\n\n### list - 2 tests\n- [ ] Lists all worktrees with task info\n- [ ] Returns empty list if no worktrees\n\n### list --orphaned - 2 tests\n- [ ] Identifies worktrees without matching in-progress task\n- [ ] Shows suggested action for each orphan\n\n### Summary\n- [ ] 13 tests pass\n\n## Files\n- src/cli/commands/worktree.ts (NEW)\n- src/cli/commands/worktree.test.ts (NEW)\n\n## Dependencies\n- F05 (WorktreeService) for remove/prune\n- F06 (WorktreeQuery) for list\n- F12 (BeadsCLI) for task status queries (cross-milestone, intentional: needed for --failed flag)\n\n## Notes\n- Worktree path: `.worktrees/` at project root (per Decision #17)\n- Cross-milestone dependency on F12 (ch-zqi) is intentional: `clean --failed` needs BeadsCLI to query task status","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T11:36:15.284612+03:00","created_by":"deligoez","updated_at":"2026-01-12T09:57:16.210817+03:00","closed_at":"2026-01-12T09:57:16.210817+03:00","close_reason":"Closed","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-6sg","depends_on_id":"ch-112","type":"blocks","created_at":"2026-01-11T11:36:20.765207+03:00","created_by":"deligoez"},{"issue_id":"ch-6sg","depends_on_id":"ch-iel","type":"blocks","created_at":"2026-01-11T11:36:20.857664+03:00","created_by":"deligoez"},{"issue_id":"ch-6sg","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-11T11:36:20.948771+03:00","created_by":"deligoez"}]}
{"id":"ch-6ta","title":"F63n: Approve Merge Key (a)","description":"## What\nKeyboard shortcut 'a' to approve pending merge requests in the TUI merge queue panel.\n\n## Why\nOperators need a quick way to approve merge requests that require human approval (escalated from F30 Human Escalation).\n\n## Acceptance Criteria\n- [ ] Key 'a' triggers merge approval action\n- [ ] Only active when merge queue panel is focused\n- [ ] Only enabled when a merge request is selected\n- [ ] Approves the currently selected merge request\n- [ ] Updates merge queue state after approval\n- [ ] Shows confirmation feedback in TUI\n- [ ] Disabled when no pending approvals exist\n- [ ] 7 tests pass\n\n## Implementation Notes\n- Integrate with F30 Human Escalation (ch-26c)\n- Should work within merge queue view (F63-merge-view)\n- Consider adding visual indicator for approvable items\n\n## Files\n- src/tui/keys/approveMergeKey.ts\n- tests/tui/keys/approveMergeKey.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T12:27:28.182695+03:00","created_by":"deligoez","updated_at":"2026-01-12T05:51:59.841152+03:00","closed_at":"2026-01-12T05:51:59.841152+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-6ta","depends_on_id":"ch-26c","type":"blocks","created_at":"2026-01-11T12:27:28.187059+03:00","created_by":"deligoez"}]}
{"id":"ch-70p","title":"F60b: useAgentGrid Hook - Grid calculation logic","description":"## What\nReact hook that calculates grid configuration based on terminal width and settings.\n\n## Context from Master Plan\n```json\n{\n  \"tui\": {\n    \"agentGrid\": \"auto\"  // or \"2x2\", \"2x3\", \"1x4\", etc.\n  }\n}\n\n// Auto-fit logic:\n// terminalWidth \u003c 120: 1 column\n// terminalWidth \u003c 180: 2 columns\n// else: 3+ columns\n```\n\n## API\n```typescript\n// src/hooks/useAgentGrid.ts\n\ninterface GridConfig {\n  columns: number;\n  rows: number;\n  tileWidth: number;\n}\n\nfunction useAgentGrid(\n  terminalWidth: number,\n  agentCount: number,\n  maxAgents: number,\n  configOverride?: 'auto' | '1x1' | '2x2' | '2x3' | '1x4'\n): GridConfig\n```\n\n## Files\n- src/hooks/useAgentGrid.ts\n- src/hooks/useAgentGrid.test.ts\n\n## Acceptance Criteria\n- [ ] Returns 1 column for width \u003c 120\n- [ ] Returns 2 columns for width 120-179\n- [ ] Returns 3 columns for width \u003e= 180\n- [ ] Respects \"2x2\" override (2 cols, min 2 rows)\n- [ ] Respects \"1x4\" override (1 col, min 4 rows)\n- [ ] Calculates rows: Math.ceil(maxAgents / columns)\n- [ ] Calculates tileWidth based on terminal width and columns\n- [ ] Handles undefined terminalWidth (defaults to 1 column)\n- [ ] Same inputs produce same output (referentially stable)\n- [ ] Handles zero agentCount without error\n\n### Summary\n- [ ] 10 tests pass\n\n## Tests\n1. Returns 1 column for width \u003c 120\n2. Returns 2 columns for width 120-179\n3. Returns 3 columns for width \u003e= 180\n4. Respects \"2x2\" config override\n5. Respects \"1x4\" config override\n6. Calculates rows correctly\n7. Calculates tileWidth correctly (width / columns minus padding)\n8. Handles undefined terminalWidth\n9. Same inputs return same result (memoization behavior)\n10. Handles zero agentCount without error\n\n## Notes\n- Implementation should use useMemo for performance\n- Tests verify behavior, not implementation details","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:50:50.731402+03:00","created_by":"deligoez","updated_at":"2026-01-11T20:25:01.541824+03:00","closed_at":"2026-01-11T20:25:01.541824+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-70p","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:53.426527+03:00","created_by":"deligoez"}]}
{"id":"ch-72yh","title":"TS20c: Update Test Fixtures","description":"## What\nUpdate test fixture files and helpers.\n\n## Files to update\n- `src/test-utils/e2e-fixtures.ts`\n- `src/test-utils/e2e-helpers.ts`\n- Any mock factories\n\n## Acceptance Criteria\n- [ ] Fixtures create Task objects instead of Bead\n- [ ] `createTestProject()` uses `.chorus/tasks.jsonl`\n- [ ] Helper functions updated for TaskStore\n- [ ] All tests pass\n- [ ] 0 new tests (migration task)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-13T00:16:28.593662+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:16:28.593662+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-72yh","depends_on_id":"ch-bi8b","type":"blocks","created_at":"2026-01-13T00:16:28.595916+03:00","created_by":"deligoez"}]}
{"id":"ch-73mw","title":"E2E-61: Session Recovery on Crash","description":"## What\nE2E tests for session recovery after unexpected crash.\n\n## Acceptance Criteria\n- [ ] Running agents detected from state\n- [ ] Agent processes killed (using kill -0 check)\n- [ ] Tasks returned to pending status\n- [ ] Orphaned worktrees identified and removed\n- [ ] Merge queue items resumed from pending status\n- [ ] Recovery completes without data loss\n- [ ] 7 tests pass\n\n## Files\n- src/e2e/session-recovery.e2e.test.ts\n\n## Implementation Notes\n- Simulate crash by writing corrupt state\n- Create orphaned worktrees to cleanup","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T00:39:34.986226+03:00","created_by":"deligoez","updated_at":"2026-01-12T09:04:13.209981+03:00","closed_at":"2026-01-12T09:04:13.209981+03:00","close_reason":"Closed","labels":["m10-rollback"],"dependencies":[{"issue_id":"ch-73mw","depends_on_id":"ch-jxp","type":"blocks","created_at":"2026-01-12T00:39:34.989611+03:00","created_by":"deligoez"},{"issue_id":"ch-73mw","depends_on_id":"ch-ozc","type":"blocks","created_at":"2026-01-12T00:39:34.992645+03:00","created_by":"deligoez"},{"issue_id":"ch-73mw","depends_on_id":"ch-112","type":"blocks","created_at":"2026-01-12T00:39:34.994749+03:00","created_by":"deligoez"}]}
{"id":"ch-73s","title":"F87: Session Logger Service","description":"## What\nAppend-only JSONL logging for all Chorus events across all modes.\n\n## Files\n- `src/services/SessionLogger.ts`\n- `src/services/SessionLogger.test.ts`\n\n## Acceptance Criteria\n- [ ] `log(event: SessionEvent)` appends JSON line to `.chorus/session-log.jsonl`\n- [ ] Each entry includes `timestamp`, `mode`, `eventType`, `details` fields\n- [ ] `log()` creates file if it doesn't exist\n- [ ] `log()` handles concurrent writes safely (append-only mode)\n- [ ] `getRecentEvents(n: number)` returns last N events as array\n- [ ] `getRecentEvents(n)` returns empty array if file doesn't exist\n- [ ] `getEventsByMode(mode: string)` returns filtered events\n- [ ] `getEventsByType(type: string)` returns filtered events\n- [ ] Gracefully skips corrupted/invalid JSON lines during read\n- [ ] 10 tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:04:33.720335+03:00","created_by":"deligoez","updated_at":"2026-01-11T22:23:05.314656+03:00","closed_at":"2026-01-11T22:23:05.314656+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-73s","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:13.243363+03:00","created_by":"deligoez"}]}
{"id":"ch-73t","title":"F61a: TwoColumnLayout Component - Split pane for Tasks/Agents","description":"## What\nSplit pane layout component with configurable left/right ratio for Tasks and Agents panels.\n\n## Architecture Note\n**TwoColumnLayout is used INSIDE Layout, not as a replacement**\n\nComponent hierarchy:\n```\nLayout (outer shell)\n├── HeaderBar (top)\n├── TwoColumnLayout (content area) ← THIS COMPONENT\n│   ├── TaskPanel (left 30%)\n│   └── AgentGrid (right 70%)\n└── FooterBar (bottom)\n```\n\n- Layout = app shell (border, header, footer, content area)\n- TwoColumnLayout = content area split (Tasks/Agents)\n- Update Layout.tsx to use TwoColumnLayout as its children wrapper\n\n## State Ownership\n**TwoColumnLayout owns focus state internally** (changed from v1)\n- Focus management: Internal state (left/right)\n- Panel selection: Internal state\n- Exposes onToggleFocus callback for F63a Tab Panel Switch\n- Parent receives focus change notifications but doesn't control it\n\n## Context from Master Plan\n```\n│ TASKS (4)                      │ AGENTS (Tiling View)                        │\n│─────────────────────────────── │──────────────────────────────────────────── │\n│ → bd-001 [P1] Implement auth   │ ┌───────────────────┬───────────────────┐  │\n```\n\n## API\n```typescript\n// src/components/TwoColumnLayout.tsx\n\ninterface TwoColumnLayoutProps {\n  left: React.ReactNode;\n  right: React.ReactNode;\n  leftWidth?: number;      // Percentage, default 30\n  rightWidth?: number;     // Percentage, default 70\n  separator?: boolean;     // Show vertical separator, default true\n  onToggleFocus?: (focused: 'left' | 'right') =\u003e void; // Focus change callback\n}\n\nfunction TwoColumnLayout({ left, right, leftWidth = 30, rightWidth = 70, separator = true, onToggleFocus }: TwoColumnLayoutProps): JSX.Element\n```\n\n## Visual Layout\n```\n│ [LEFT PANE 30%]  │ [RIGHT PANE 70%]                    │\n│                  │                                      │\n│ TaskPanel        │ AgentGrid                           │\n│                  │                                      │\n```\n\n## Files\n- src/components/TwoColumnLayout.tsx\n- src/components/TwoColumnLayout.test.tsx\n\n## Acceptance Criteria\n- [ ] Renders left pane content\n- [ ] Renders right pane content\n- [ ] Applies default 30/70 width ratio\n- [ ] Respects custom ratio (e.g., 50/50)\n- [ ] Shows vertical separator when separator=true\n- [ ] Hides separator when separator=false\n- [ ] Fills available height\n- [ ] Handles missing left (shows empty pane)\n- [ ] Maintains internal focus state (left/right)\n- [ ] Exposes onToggleFocus callback for F63a\n- [ ] Applies visual focus indicator to focused panel\n- [ ] 11 tests pass\n\n## Tests\n1. Renders left pane content\n2. Renders right pane content\n3. Applies default 30/70 ratio\n4. Respects custom ratio\n5. Shows vertical separator by default\n6. Hides separator when separator=false\n7. Fills available height\n8. Handles missing left/right gracefully\n9. Maintains internal focus state (starts with left)\n10. Calls onToggleFocus callback when focus changes\n11. Applies cyan border to focused panel, gray to unfocused","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:50:52.281328+03:00","created_by":"deligoez","updated_at":"2026-01-11T20:35:42.684591+03:00","closed_at":"2026-01-11T20:35:42.684591+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-73t","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:53.52797+03:00","created_by":"deligoez"}]}
{"id":"ch-75l6","title":"E2E-30: Error States","description":"## What\nE2E test for error state display and recovery.\n\n## Acceptance Criteria\n- [ ] Failed tasks show ✗ indicator in red\n- [ ] Failed agents show error status\n- [ ] Error messages display in agent output\n- [ ] Recovery options available for failed states\n- [ ] 4 tests pass\n\n## Test Cases\n1. `it('shows failed task indicator')`\n2. `it('shows failed agent status')`\n3. `it('displays error messages in output')`\n4. `it('shows recovery options for failed tasks')`\n\n## Files\n- tests/e2e/error-states.test.ts\n\n## Dependencies\n- ch-0e01 (E2E Infrastructure)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:21:49.11383+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:43:47.822545+03:00","closed_at":"2026-01-12T01:43:47.822545+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-75l6","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:21:49.116577+03:00","created_by":"deligoez"}]}
{"id":"ch-7bb","title":"F46c-d: Intervention Panel - Edit Mode","description":"## What\nIntervention Panel edit-select mode: select task to edit via bd edit subprocess.\n\n## Mode Flow\n```\nMain mode:\n  [e] → mode = 'edit-select'\n\nedit-select mode:\n  Shows: \"Select task to edit: [1] bd-001 [2] bd-002\"\n  [1-9] → taskEditor.editTask(taskId) → mode = 'main'\n  [ESC] → mode = 'main'\n```\n\n## Acceptance Criteria\n\n### Mode Transition - 1 test\n- [ ] 'e' key in main mode transitions to 'edit-select' mode\n\n### Edit Select Mode - 2 tests\n- [ ] edit-select mode shows task selection prompt with numbers\n- [ ] Number key in edit-select calls taskEditor.editTask() and returns to main\n\n### Summary\n- [ ] 3 tests pass\n\n## Files\n- src/components/InterventionPanel.tsx (UPDATE)\n- src/components/InterventionPanel.test.tsx (UPDATE)\n\n## Dependencies\n- F46c-a (ch-di6) - Main mode and base component\n\n## Notes\n- taskEditor.editTask() spawns `bd edit \u003cid\u003e` subprocess\n- After edit completes, agent may need restart (handled in F46b)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T23:52:52.29654+03:00","created_by":"deligoez","updated_at":"2026-01-12T07:42:21.303505+03:00","closed_at":"2026-01-12T07:42:21.303505+03:00","close_reason":"Closed","labels":["m9-intervention"],"dependencies":[{"issue_id":"ch-7bb","depends_on_id":"ch-di6","type":"blocks","created_at":"2026-01-10T23:52:52.300108+03:00","created_by":"deligoez"}]}
{"id":"ch-7gx","title":"F17: Semi-Auto Mode - User-initiated single task execution","description":"## What\nSemi-auto mode: user selects task → agent runs → completes → STOP. Uses ChorusMachine orchestration region for state management.\n\n## Architecture Change (XState v5)\n\n**CRITICAL:** Semi-auto state is managed in ChorusMachine, NOT a separate service.\n\n```typescript\n// OLD (Standalone service) - DO NOT USE\nclass SemiAutoController extends EventEmitter {\n  private activeTaskIds: string[] = [];\n  // ...\n}\n\n// NEW (XState integration) - CORRECT\n// State tracked in machine context:\n// snapshot.context.orchestration.activeTaskIds\n// Actions send events to machine\n```\n\n## XState Integration\n\nSemi-auto is NOT a separate machine - it's the default orchestration mode.\nThe orchestration region handles semi-auto logic via guards and actions.\n\n```typescript\n// In ChorusMachine orchestration region:\norchestration: {\n  initial: 'idle',\n  context: {\n    activeTaskIds: [] as string[],\n    activeAgentIds: [] as string[],\n  },\n  states: {\n    idle: {\n      on: {\n        SPAWN_AGENT: {\n          target: 'running',\n          guard: 'hasAvailableSlot',\n          actions: ['claimSlot', 'spawnAgent', 'trackActiveTask']\n        }\n      }\n    },\n    running: {\n      on: {\n        SPAWN_AGENT: {\n          guard: 'hasAvailableSlot',\n          actions: ['claimSlot', 'spawnAgent', 'trackActiveTask']\n        },\n        AGENT_COMPLETED: {\n          actions: ['releaseSlot', 'removeActiveTask'],\n          target: 'checkIfIdle'\n        },\n        AGENT_FAILED: {\n          actions: ['releaseSlot', 'removeActiveTask'],\n          target: 'checkIfIdle'\n        },\n        STOP_AGENT: {\n          actions: ['stopAgent', 'releaseSlot', 'removeActiveTask'],\n          target: 'checkIfIdle'\n        },\n        STOP_ALL: {\n          actions: ['stopAllAgents', 'releaseAllSlots', 'clearActiveTasks'],\n          target: 'idle'\n        },\n        PAUSE: 'paused'\n      }\n    },\n    paused: {\n      on: { RESUME: 'running' }\n    },\n    checkIfIdle: {\n      always: [\n        { target: 'idle', guard: 'noActiveTasks' },\n        { target: 'running' }\n      ]\n    }\n  }\n}\n```\n\n## SemiAutoController as Thin Wrapper\n\nSemiAutoController becomes a thin wrapper for machine interaction:\n\n```typescript\nexport class SemiAutoController {\n  constructor(private actorRef: AnyActorRef) {}\n\n  startTask(taskId: string): Result\u003cvoid, SlotError\u003e {\n    const snapshot = this.actorRef.getSnapshot();\n    \n    // Check slot availability via guard logic\n    if (!canSpawnAgent(snapshot)) {\n      return err({ type: 'NO_SLOTS_AVAILABLE' });\n    }\n    \n    // Send event to machine\n    this.actorRef.send({ type: 'SPAWN_AGENT', taskId });\n    return ok(undefined);\n  }\n\n  cancelTask(taskId: string): void {\n    this.actorRef.send({ type: 'STOP_AGENT', taskId });\n  }\n\n  cancelAll(options?: { preserveChanges?: boolean }): void {\n    this.actorRef.send({ \n      type: 'STOP_ALL', \n      preserveChanges: options?.preserveChanges \n    });\n  }\n\n  getStatus(): SemiAutoStatus {\n    const ctx = this.actorRef.getSnapshot().context;\n    return {\n      activeTaskIds: ctx.orchestration.activeTaskIds,\n      activeAgentIds: ctx.orchestration.activeAgentIds,\n      iteration: ctx.stats.iteration,\n    };\n  }\n\n  isIdle(): boolean {\n    return this.actorRef.getSnapshot().matches({ orchestration: 'idle' });\n  }\n}\n```\n\n## XState Testing Pattern\n\n```typescript\nimport { createActor } from 'xstate';\nimport { describe, it, expect, vi } from 'vitest';\n\ndescribe('SemiAutoController (XState)', () =\u003e {\n  it('should spawn agent via machine event', () =\u003e {\n    // Arrange\n    const actor = createActor(chorusMachine);\n    actor.start();\n    const controller = new SemiAutoController(actor);\n\n    // Act\n    controller.startTask('ch-001');\n\n    // Assert\n    const snapshot = actor.getSnapshot();\n    expect(snapshot.context.orchestration.activeTaskIds).toContain('ch-001');\n    expect(snapshot.matches({ orchestration: 'running' })).toBe(true);\n  });\n\n  it('should return error when no slots available', () =\u003e {\n    // Arrange\n    const actor = createActor(chorusMachine, {\n      input: { config: { maxParallel: 1 } }\n    });\n    actor.start();\n    actor.send({ type: 'SPAWN_AGENT', taskId: 'ch-001' });\n    const controller = new SemiAutoController(actor);\n\n    // Act\n    const result = controller.startTask('ch-002');\n\n    // Assert\n    expect(result.isErr()).toBe(true);\n    expect(result.error.type).toBe('NO_SLOTS_AVAILABLE');\n  });\n\n  it('should transition to idle when last task completes', () =\u003e {\n    // Arrange\n    const actor = createActor(chorusMachine);\n    actor.start();\n    actor.send({ type: 'SPAWN_AGENT', taskId: 'ch-001' });\n\n    // Act\n    actor.send({ type: 'AGENT_COMPLETED', agentId: 'agent-1', taskId: 'ch-001' });\n\n    // Assert\n    expect(actor.getSnapshot().matches({ orchestration: 'idle' })).toBe(true);\n    expect(actor.getSnapshot().context.orchestration.activeTaskIds).toHaveLength(0);\n  });\n\n  it('should stay running when other tasks still active', () =\u003e {\n    // Arrange\n    const actor = createActor(chorusMachine, {\n      input: { config: { maxParallel: 3 } }\n    });\n    actor.start();\n    actor.send({ type: 'SPAWN_AGENT', taskId: 'ch-001' });\n    actor.send({ type: 'SPAWN_AGENT', taskId: 'ch-002' });\n\n    // Act\n    actor.send({ type: 'AGENT_COMPLETED', agentId: 'agent-1', taskId: 'ch-001' });\n\n    // Assert\n    expect(actor.getSnapshot().matches({ orchestration: 'running' })).toBe(true);\n    expect(actor.getSnapshot().context.orchestration.activeTaskIds).toContain('ch-002');\n  });\n\n  it('should stop all agents on STOP_ALL', () =\u003e {\n    // Arrange\n    const actor = createActor(chorusMachine, {\n      input: { config: { maxParallel: 3 } }\n    });\n    actor.start();\n    actor.send({ type: 'SPAWN_AGENT', taskId: 'ch-001' });\n    actor.send({ type: 'SPAWN_AGENT', taskId: 'ch-002' });\n    const controller = new SemiAutoController(actor);\n\n    // Act\n    controller.cancelAll();\n\n    // Assert\n    expect(actor.getSnapshot().matches({ orchestration: 'idle' })).toBe(true);\n    expect(actor.getSnapshot().context.orchestration.activeTaskIds).toHaveLength(0);\n  });\n});\n```\n\n## Acceptance Criteria\n\n### Machine State - 4 tests\n- [ ] Initial orchestration state is 'idle'\n- [ ] SPAWN_AGENT transitions idle → running\n- [ ] Last AGENT_COMPLETED transitions running → idle\n- [ ] STOP_ALL transitions any → idle\n\n### Slot Management (via guards) - 3 tests\n- [ ] Guard `hasAvailableSlot` blocks SPAWN_AGENT when full\n- [ ] Action `claimSlot` decrements available slots\n- [ ] Action `releaseSlot` increments available slots on completion/cancel\n\n### Active Task Tracking - 3 tests\n- [ ] `trackActiveTask` adds taskId to context.activeTaskIds\n- [ ] `removeActiveTask` removes taskId on completion/cancel\n- [ ] `clearActiveTasks` empties array on STOP_ALL\n\n### Controller Wrapper - 4 tests\n- [ ] `startTask()` returns Result with slot error\n- [ ] `cancelTask()` sends STOP_AGENT event\n- [ ] `cancelAll()` sends STOP_ALL event with options\n- [ ] `getStatus()` returns current state from machine\n\n### Helper Methods - 2 tests\n- [ ] `isIdle()` uses machine.matches()\n- [ ] `getActiveTaskCount()` reads from context\n\n### Summary\n- [ ] 16 tests pass\n\n## Files\n- src/services/SemiAutoController.ts (THIN WRAPPER)\n- tests/services/SemiAutoController.test.ts\n- src/machines/chorus.machine.ts (orchestration region - already in FX03)\n\n## Implementation Notes\n- Most logic is IN the machine (guards, actions, transitions)\n- SemiAutoController is optional convenience wrapper\n- Components can send events directly to machine via useOrchestration hook\n- The \"checkIfIdle\" state uses always transition with guard","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T02:07:06.427237+03:00","created_by":"deligoez","updated_at":"2026-01-11T20:08:27.794483+03:00","closed_at":"2026-01-11T20:08:27.794483+03:00","close_reason":"Closed","labels":["m4-orchestration"],"dependencies":[{"issue_id":"ch-7gx","depends_on_id":"ch-0e7","type":"blocks","created_at":"2026-01-10T02:07:06.429867+03:00","created_by":"deligoez"},{"issue_id":"ch-7gx","depends_on_id":"ch-lhm","type":"blocks","created_at":"2026-01-10T02:07:06.431531+03:00","created_by":"deligoez"},{"issue_id":"ch-7gx","depends_on_id":"ch-i9i","type":"blocks","created_at":"2026-01-10T11:17:05.604847+03:00","created_by":"deligoez"},{"issue_id":"ch-7gx","depends_on_id":"ch-999","type":"blocks","created_at":"2026-01-10T23:51:05.34936+03:00","created_by":"deligoez"}]}
{"id":"ch-7h5","title":"F81a: Planning TUI Layout Component","description":"## What\n80% agent window + 20% chat input layout for planning mode.\n\n## Files\n- `src/components/PlanningLayout.tsx`\n- `src/components/PlanningLayout.test.tsx`\n\n## Acceptance Criteria\n- [ ] Renders 80% height agent window area\n- [ ] Renders 20% height chat input area\n- [ ] Agent window scrolls for long content\n- [ ] Shows mode indicator \"PLANNING\" in header\n- [ ] Shows help shortcut hints in footer\n- [ ] Responds to terminal resize events\n- [ ] Manages focus between agent window and input area\n- [ ] Accepts `children` prop for agent content\n- [ ] Accepts `onMessage(text: string)` callback for input\n- [ ] 10 tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:05:59.082271+03:00","created_by":"deligoez","updated_at":"2026-01-12T03:37:12.717763+03:00","closed_at":"2026-01-12T03:37:12.717763+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-7h5","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:13.71446+03:00","created_by":"deligoez"}]}
{"id":"ch-7ju","title":"F14: Dependency Resolver - Check task dependencies","description":"## What\nCheck if task dependencies are satisfied before assignment.\n\n## Acceptance Criteria\n\n### check()\n- [ ] `check(id)` returns `satisfied: true` when no dependencies\n- [ ] `check(id)` returns `satisfied: true` when all deps closed\n- [ ] `check(id)` returns `pending[]` for open deps\n- [ ] `check(id)` returns `inProgress[]` for in_progress deps\n- [ ] `check(id)` returns `failed[]` for missing deps\n\n### getDependencies()\n- [ ] `getDependencies(id)` returns empty array for no deps\n- [ ] `getDependencies(id)` returns list of dependency IDs\n\n### isDependencySatisfied()\n- [ ] `isDependencySatisfied(depId)` returns true if dep is closed\n- [ ] `isDependencySatisfied(depId)` returns false if dep is open/in_progress\n\n### getDependents()\n- [ ] `getDependents(id)` returns tasks blocked by this task\n- [ ] `getDependents(id)` returns empty array if nothing blocked\n\n### hasCircularDependency()\n- [ ] `hasCircularDependency(id)` returns false for linear deps\n- [ ] `hasCircularDependency(id)` returns true for circular deps\n\n### Summary\n- [ ] DependencyStatus interface: satisfied, pending[], inProgress[], failed[]\n- [ ] 14 tests pass\n\n## Files\n- src/services/DependencyResolver.ts (NEW)\n- tests/services/DependencyResolver.test.ts (NEW)\n\n## Notes\n- Uses BeadsCLI to query task status\n- Deps stored in task.dependencies array\n- Circular dependency check uses visited set","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T02:06:33.869228+03:00","created_by":"deligoez","updated_at":"2026-01-11T19:51:48.327944+03:00","closed_at":"2026-01-11T19:51:48.327944+03:00","close_reason":"Closed","labels":["m4-orchestration"],"dependencies":[{"issue_id":"ch-7ju","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-10T02:06:33.87357+03:00","created_by":"deligoez"}]}
{"id":"ch-7jw","title":"F16a: Completion Handler - Success path handling","description":"## What\nHandle successful task completion: detect signal + tests pass → extract learnings → close task → CASCADE unblock dependents → emit events.\n\n## Acceptance Criteria\n\n### Types\n- [ ] CompletionHandlerConfig: completionChecker, beadsCLI, dependencyResolver, worktreeService, config, scratchpadManager, learningExtractor, learningStore\n- [ ] TaskCompletionResult: taskId, agentId, success, iteration, reason, testOutput?, unblockedTasks?\n\n### handleAgentExit() - Success Path - 5 tests\n- [ ] Returns success when signal + tests pass\n- [ ] Closes task via `beadsCLI.closeTask()`\n- [ ] Emits \"completed\" event with taskId, agentId\n- [ ] Emits \"readyForMerge\" event with taskId, branch, worktreePath\n- [ ] Returns TaskCompletionResult with success=true\n\n### handleSuccess() - Core - 2 tests\n- [ ] Closes task with agent comment\n- [ ] Emits \"readyForMerge\" for merge queue\n\n### handleSuccess() - Learning Extraction - 6 tests\n- [ ] Reads scratchpad from agent's worktree via ScratchpadManager.read()\n- [ ] Extracts learnings if learningsSection present via LearningExtractor.parse()\n- [ ] Skips extraction gracefully when no learnings section\n- [ ] Appends learnings to shared store via LearningStore.append()\n- [ ] Commits learnings with attribution via LearningStore.commit()\n- [ ] Clears scratchpad after successful extraction via ScratchpadManager.clear()\n\n### handleSuccess() - CASCADE Unblock - 4 tests\n- [ ] Gets dependent tasks via `dependencyResolver.getDependents(taskId)`\n- [ ] For each dependent: checks if ALL dependencies now satisfied\n- [ ] Clears `blocked` custom field for newly unblocked tasks via `bd update \u003cid\u003e --custom blocked=`\n- [ ] Returns `unblockedTasks[]` in TaskCompletionResult\n- [ ] Emits \"tasksUnblocked\" event with taskIds array\n\n### Summary\n- [ ] 17 tests pass\n\n## CASCADE Unblock Flow\n\n**CRITICAL:** When a task completes, dependents may become unblocked:\n\n```\nTask ch-000 completes:\n  1. Close task: bd close ch-000\n  2. Get dependents: dependencyResolver.getDependents('ch-000')\n     → Returns: ['ch-001', 'ch-002']\n  3. For each dependent:\n     a. Check ALL deps satisfied: dependencyResolver.check(depId)\n     b. If satisfied.satisfied === true:\n        - Clear blocked flag: bd update ch-001 --custom blocked=\n        - Add to unblockedTasks[]\n  4. Emit \"tasksUnblocked\" event\n  5. If autopilot mode: Orchestrator auto-assigns if slots available\n```\n\n**Example:**\n```\nch-001 depends on [ch-000, ch-002]\nch-003 depends on [ch-000]\n\nWhen ch-000 closes:\n  - ch-001: check → ch-002 still open → NOT unblocked\n  - ch-003: check → all deps closed → UNBLOCKED\n  → unblockedTasks = ['ch-003']\n  → emit \"tasksUnblocked\" with ['ch-003']\n```\n\n## Files\n- src/services/CompletionHandler.ts (NEW)\n- tests/services/CompletionHandler.test.ts (NEW)\n\n## Tests\n1. handleAgentExit() returns success when signal + tests pass\n2. handleAgentExit() closes task via beadsCLI\n3. handleAgentExit() emits \"completed\" event\n4. handleAgentExit() emits \"readyForMerge\" event\n5. handleSuccess() extracts and stores learnings when present\n6. handleSuccess() skips extraction when no learnings section\n7. handleSuccess() commits learnings with attribution\n8. handleSuccess() clears scratchpad after extraction\n9. handleSuccess() handles missing scratchpad gracefully\n10. handleSuccess() gets dependents via dependencyResolver\n11. handleSuccess() checks each dependent's full dependency satisfaction\n12. handleSuccess() clears blocked flag for newly unblocked tasks\n13. handleSuccess() returns unblockedTasks in result\n14. handleSuccess() emits \"tasksUnblocked\" event\n15. handleSuccess() handles no dependents gracefully (empty array)\n16. handleSuccess() skips dependent if other deps still open\n17. CASCADE works for multiple dependents becoming unblocked\n\n## Notes\n- Extends EventEmitter for events\n- Does NOT respawn agent (Orchestrator's job)\n- Merge queue handled by MergeService (M5)\n- Learning extraction uses F39b, F40, F41 building blocks\n- CASCADE uses F14 DependencyResolver\n- Autopilot mode listens to \"tasksUnblocked\" to auto-assign","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T02:06:42.739971+03:00","created_by":"deligoez","updated_at":"2026-01-11T19:55:57.664559+03:00","closed_at":"2026-01-11T19:55:57.664559+03:00","close_reason":"Closed","labels":["m4-orchestration"],"dependencies":[{"issue_id":"ch-7jw","depends_on_id":"ch-uoa","type":"blocks","created_at":"2026-01-10T02:06:42.742454+03:00","created_by":"deligoez"},{"issue_id":"ch-7jw","depends_on_id":"ch-dzz","type":"blocks","created_at":"2026-01-10T02:06:42.744143+03:00","created_by":"deligoez"},{"issue_id":"ch-7jw","depends_on_id":"ch-1gi","type":"blocks","created_at":"2026-01-10T11:45:49.206763+03:00","created_by":"deligoez"},{"issue_id":"ch-7jw","depends_on_id":"ch-a6h","type":"blocks","created_at":"2026-01-10T11:45:49.335553+03:00","created_by":"deligoez"},{"issue_id":"ch-7jw","depends_on_id":"ch-7ju","type":"blocks","created_at":"2026-01-11T11:35:17.113169+03:00","created_by":"deligoez"},{"issue_id":"ch-7jw","depends_on_id":"ch-9yl","type":"blocks","created_at":"2026-01-11T14:56:26.74463+03:00","created_by":"deligoez"}]}
{"id":"ch-7ki","title":"F59c: AgentTileProgress - Progress bar, iteration, duration","description":"## What\nMiddle section of AgentTile showing progress bar, iteration count, and elapsed time.\n\n## Context from Master Plan\n```\n│ iter 7/50 | 12m   │\n│ ▓▓▓▓░░░░░░ 35%    │\n```\n\n## API\n```typescript\n// src/components/AgentTileProgress.tsx\n\ninterface AgentTileProgressProps {\n  iteration: number;\n  maxIterations: number;\n  startTime: number;      // Unix timestamp (ms)\n  progressPercent?: number; // If not provided, calculate from iteration/max\n}\n\nfunction AgentTileProgress({ iteration, maxIterations, startTime, progressPercent }: AgentTileProgressProps): JSX.Element\n```\n\n## Visual Output\n```\niter 7/50 | 12m\n▓▓▓▓░░░░░░ 35%\n```\n\n## Color Specs (Ink)\n- \"iter X/Y\": default color\n- Pipe separator \"|\": color=\"gray\"\n- Duration: passed to DurationDisplay (uses its colors)\n- Progress bar: passed to ProgressBar (uses its colors)\n\n## Files\n- src/components/AgentTileProgress.tsx\n- src/components/AgentTileProgress.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows iteration as \"iter X/Y\" format\n- [ ] Renders DurationDisplay with startTime prop\n- [ ] Renders ProgressBar with calculated or explicit percent\n- [ ] Uses gray pipe \"|\" separator between iter and duration\n- [ ] Calculates progress as (iteration/maxIterations)*100 if progressPercent not provided\n- [ ] Uses explicit progressPercent when provided\n- [ ] Passes correct props to child components (ProgressBar, DurationDisplay)\n\n### Summary\n- [ ] 7 tests pass\n\n## Tests\n1. Shows \"iter 7/50\" format correctly\n2. Renders DurationDisplay with startTime prop\n3. Renders ProgressBar component\n4. Uses gray pipe separator between iteration and duration\n5. Calculates progress = (iteration/maxIterations)*100 when progressPercent undefined\n6. Uses explicit progressPercent when provided (overrides calculation)\n7. Passes width prop to ProgressBar","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:49:56.14468+03:00","created_by":"deligoez","updated_at":"2026-01-11T20:26:30.944357+03:00","closed_at":"2026-01-11T20:26:30.944357+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-7ki","depends_on_id":"ch-8vk","type":"blocks","created_at":"2026-01-10T12:49:56.146891+03:00","created_by":"deligoez"},{"issue_id":"ch-7ki","depends_on_id":"ch-aap","type":"blocks","created_at":"2026-01-10T12:49:56.148801+03:00","created_by":"deligoez"}]}
{"id":"ch-7kmp","title":"BUG: Fix ink-testing-library TTY mock issues in hook tests","description":"## What\nPARTIALLY RESOLVED: 50 of 91 failing tests now pass.\n\nNode.js 22+ shows DEP0190 deprecation warnings:\n`DeprecationWarning: Passing args to a child process with shell option true can lead to security vulnerabilities, as the arguments are not escaped, only joined with spaces`\n\n## Root Cause\n1. TTY mock not set for tests - ink useInput disabled\n2. SET_MODE action not executing in chorus machine\n\n## Resolution\n- Added vitest.setup.ts with process.stdin.isTTY = true mock\n- Fixed SET_MODE transition in chorus.machine.ts to include setMode action\n- 50 tests now passing\n\n## Remaining Issues (41 tests)\nMostly E2E tests that spawn actual app (cli-testing-library). These may need separate investigation for:\n- App build issues\n- cli-testing-library TTY handling\n- InterventionPanel test assertions\n\n## Acceptance Criteria\n- [x] All useKeyboard tests pass (14 tests - was 9)\n- [x] All useKeyboardRouter tests pass (17 tests - was 15)\n- [x] All useNavigationKeys tests pass (10 tests - was 6)\n- [x] All TwoColumnLayout tests pass (12 tests - was 2)\n- [x] Layout integration tests pass\n- [ ] E2E keyboard tests pass (separate issue)\n- [x] 50 of 91 previously failing tests now pass\n\n## Files\n- vitest.setup.ts (new)\n- vitest.config.ts\n- src/machines/chorus.machine.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T09:00:50.033834+03:00","created_by":"deligoez","updated_at":"2026-01-12T09:14:48.46656+03:00","closed_at":"2026-01-12T09:14:48.46656+03:00","close_reason":"Closed","labels":["bug"]}
{"id":"ch-7m74","title":"E2E-29: Status Transitions","description":"## What\nE2E test for visual status transitions in TUI.\n\n## Acceptance Criteria\n- [ ] Task status changes reflect immediately in UI\n- [ ] Agent status changes reflect immediately in UI\n- [ ] Color changes match status (green=running, yellow=paused, etc.)\n- [ ] Status indicators animate correctly (P0 flashing)\n- [ ] 4 tests pass\n\n## Test Cases\n1. `it('updates task status indicator on change')`\n2. `it('updates agent status indicator on change')`\n3. `it('shows correct colors for each status')`\n4. `it('P0 priority badge flashes')`\n\n## Files\n- tests/e2e/status-transitions.test.ts\n\n## Dependencies\n- ch-0e01 (E2E Infrastructure)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:21:47.93776+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:41:54.225347+03:00","closed_at":"2026-01-12T01:41:54.225347+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-7m74","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:21:47.939586+03:00","created_by":"deligoez"}]}
{"id":"ch-7pb","title":"F26: Conflict Classifier","description":"## What\nAnalyzes merge conflicts and classifies by complexity (SIMPLE, MEDIUM, COMPLEX).\n\n## Classification Levels (per Master Plan)\n\n### SIMPLE (Auto-resolve)\n- `.beads/issues.jsonl` - Beads merge driver\n- `package-lock.json` - Regenerate\n- `.agent/learnings.md` - Append both, dedup\n- Auto-generated files - Regenerate\n\n### MEDIUM (Rebase+retry)\n- Same file, different sections\n- No semantic overlap\n\n### COMPLEX (Agent-resolve)\n- Same lines edited\n- Semantic conflicts\n- Core files\n\n## Acceptance Criteria\n\n### classifyFile() - 5 tests\n- [ ] `.beads/issues.jsonl` classified as `SIMPLE`\n- [ ] `package-lock.json` classified as `SIMPLE`\n- [ ] Same file different sections classified as `MEDIUM`\n- [ ] Same lines edited classified as `COMPLEX`\n- [ ] Core files with semantic conflicts classified as `COMPLEX`\n\n### analyze() - 2 tests\n- [ ] Analyzes all given conflict files\n- [ ] Returns overall type as worst-case (COMPLEX \u003e MEDIUM \u003e SIMPLE)\n\n### getSuggestedStrategy() - 4 tests\n- [ ] Returns 'auto' for SIMPLE\n- [ ] Returns 'rebase' for MEDIUM\n- [ ] Returns 'agent' for COMPLEX\n- [ ] Returns 'human' when agent fails COMPLEX\n\n### Implicit (no dedicated tests)\n- `getOverallType()` - tested via analyze() worst-case test\n- `isAutoResolvable()` - returns true when type=SIMPLE\n\n### Summary\n- [ ] 11 tests pass\n\n## Files\n- src/services/ConflictClassifier.ts\n- tests/services/ConflictClassifier.test.ts\n\n## Plan\nSee: thoughts/shared/plans/features/F26-conflict-classifier.md\n\n**Total: 11 tests**","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T03:16:29.152626+03:00","created_by":"deligoez","updated_at":"2026-01-11T19:25:14.849489+03:00","closed_at":"2026-01-11T19:25:14.849489+03:00","close_reason":"Closed","labels":["m5-merge"],"dependencies":[{"issue_id":"ch-7pb","depends_on_id":"ch-fe5","type":"blocks","created_at":"2026-01-10T03:16:29.155521+03:00","created_by":"deligoez"}]}
{"id":"ch-7qez","title":"E2E-03: Navigation \u0026 Selection","description":"## What\nE2E tests for keyboard navigation in TaskPanel and AgentGrid.\n\n## Tests (10 tests)\n\n### Task Navigation\n1. 'j' moves selection down in task list\n2. 'k' moves selection up in task list\n3. '↓' arrow moves selection down\n4. '↑' arrow moves selection up\n5. Navigation stops at list boundaries (no wrap)\n\n### Panel Focus\n6. Tab switches focus from TaskPanel to AgentGrid\n7. Tab switches focus from AgentGrid to TaskPanel\n8. Focused panel has visual indicator (cyan border)\n\n### Quick Select\n9. Number keys 1-9 select corresponding task\n10. Selection persists after panel focus change\n\n## Files\n- src/e2e/navigation.e2e.test.ts (NEW)\n\n## Depends On\n- ch-kxpd: E2E Infrastructure\n- ch-b8l: Navigation Keys\n- ch-akb: Tab Panel Switch","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-11T21:15:41.147529+03:00","created_by":"deligoez","updated_at":"2026-01-11T21:23:24.981057+03:00","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-7qez","depends_on_id":"ch-kxpd","type":"blocks","created_at":"2026-01-11T21:15:41.150245+03:00","created_by":"deligoez"},{"issue_id":"ch-7qez","depends_on_id":"ch-b8l","type":"blocks","created_at":"2026-01-11T21:15:41.153363+03:00","created_by":"deligoez"},{"issue_id":"ch-7qez","depends_on_id":"ch-akb","type":"blocks","created_at":"2026-01-11T21:15:41.15516+03:00","created_by":"deligoez"}],"deleted_at":"2026-01-11T21:23:24.981057+03:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"ch-81x","title":"F02b: State Init/Load - Initialize or recover session state","description":"## What\nInitialize new state or load existing for recovery.\n\n## Acceptance Criteria\n- [ ] `init()` creates fresh state with UUID sessionId (valid UUID format)\n- [ ] `init()` sets startedAt to current timestamp\n- [ ] `init()` sets empty agents object and empty mergeQueue array\n- [ ] `init()` sets mode to 'semi-auto' as default (actual mode determined by hierarchy: CLI \u003e planning-state \u003e state.json \u003e config.json)\n- [ ] `load()` returns `null` if state file does not exist\n- [ ] `load()` returns parsed `ChorusState` if file exists and valid\n- [ ] `load()` throws `Error('Invalid state structure')` if file is malformed\n- [ ] `get()` returns current state after init/load\n- [ ] `get()` throws `Error('State not initialized')` if called before init/load\n- [ ] 9 tests pass\n\n## Mode Hierarchy Note\nMode initialization uses 'semi-auto' as the default value in state. The actual runtime mode is determined by this precedence (highest to lowest):\n1. CLI flag (`--mode=autopilot`)\n2. planning-state.json (`chosenMode` field from planning phase)\n3. state.json (persisted from previous session)\n4. config.json (user configuration)\n\n## Files\n- src/services/StateService.ts (NEW - partial)\n- tests/services/StateService.test.ts (NEW)\n\n## Implementation\n\\`\\`\\`typescript\nexport class StateService {\n  private statePath: string;\n  private state: ChorusState | null = null;\n\n  constructor(projectDir: string) {\n    this.statePath = path.join(projectDir, '.chorus', 'state.json');\n  }\n\n  init(): ChorusState {\n    this.state = {\n      version: '1.0',\n      sessionId: crypto.randomUUID(),\n      startedAt: Date.now(),\n      mode: 'semi-auto',  // Default; actual mode determined by hierarchy\n      paused: false,\n      agents: {},\n      mergeQueue: [],\n      checkpoint: null,\n      stats: { tasksCompleted: 0, tasksFailed: 0, mergesAuto: 0, mergesManual: 0, totalIterations: 0, totalRuntime: 0 }\n    };\n    return this.state;\n  }\n\n  load(): ChorusState | null {\n    if (!fs.existsSync(this.statePath)) return null;\n    const data = JSON.parse(fs.readFileSync(this.statePath, 'utf-8'));\n    if (!this.isValidState(data)) throw new Error('Invalid state structure');\n    this.state = data;\n    return this.state;\n  }\n\n  get(): ChorusState {\n    if (!this.state) throw new Error('State not initialized');\n    return this.state;\n  }\n\n  private isValidState(data: unknown): data is ChorusState {\n    if (!data || typeof data !== 'object') return false;\n    const s = data as Record\u003cstring, unknown\u003e;\n    return !!(s.sessionId \u0026\u0026 s.startedAt \u0026\u0026 s.agents \u0026\u0026 s.stats);\n  }\n}\n\\`\\`\\`\n\n## Test Cases\n1. `init()` generates sessionId in UUID format (matches regex)\n2. `init()` sets startedAt to timestamp close to Date.now()\n3. `init()` creates empty agents object `{}`\n4. `init()` creates empty mergeQueue array `[]`\n5. `init()` sets mode to 'semi-auto' as default\n6. `load()` returns `null` when state file does not exist\n7. `load()` returns parsed ChorusState when file exists and valid\n8. `load()` throws `Error('Invalid state structure')` on malformed JSON\n9. `get()` throws `Error('State not initialized')` before init/load","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T01:30:50.906489+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:57:31.760261+03:00","closed_at":"2026-01-11T18:57:31.760261+03:00","close_reason":"Closed","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-81x","depends_on_id":"ch-ah6","type":"blocks","created_at":"2026-01-10T01:30:50.908184+03:00","created_by":"deligoez"}]}
{"id":"ch-89dk","title":"F64c: Keyboard Router - Central key handling and conflict prevention","description":"## What\nCentral keyboard router that coordinates all keyboard handlers and prevents conflicts.\n\n## Problem\nMultiple hooks use `useInput()` independently:\n- useNavigationKeys (j/k/↓/↑)\n- useQuickControlKeys (x/r/e/b)\n- useRecoveryKeys (r/R/X/+)\n- usePauseKey (Space)\n- useModeToggle (m)\n- useMergeViewKey (M)\n- useQuitKey (q)\n- etc.\n\nThis can cause:\n- Multiple handlers responding to same key\n- Handler order unpredictability\n- Context-dependent behavior hard to manage\n\n## Solution\nCentral KeyboardRouter that:\n1. Registers all keyboard handlers\n2. Determines which handler(s) should respond based on context\n3. Prevents duplicate handling\n\n## Implementation\n\n```typescript\n// src/hooks/useKeyboardRouter.ts\n\ntype KeyContext = {\n  focusedPanel: 'left' | 'right';\n  selectedTask: Task | null;\n  modalOpen: 'help' | 'intervention' | 'logs' | 'learnings' | 'gridSettings' | null;\n  isPaused: boolean;\n  currentMode: 'semi-auto' | 'autopilot';\n};\n\ntype KeyHandler = {\n  keys: string[];\n  condition: (ctx: KeyContext, key: string) =\u003e boolean;\n  handler: (ctx: KeyContext, key: string) =\u003e void;\n  priority: number;  // Higher = checked first\n};\n\nfunction useKeyboardRouter(handlers: KeyHandler[], context: KeyContext) {\n  useInput((input, key) =\u003e {\n    const pressedKey = normalizeKey(input, key);\n    \n    // Find first matching handler\n    const sorted = handlers.sort((a, b) =\u003e b.priority - a.priority);\n    for (const h of sorted) {\n      if (h.keys.includes(pressedKey) \u0026\u0026 h.condition(context, pressedKey)) {\n        h.handler(context, pressedKey);\n        return;  // Only one handler runs\n      }\n    }\n  });\n}\n```\n\n## Key Priority Matrix\n\n| Key | Context | Handler | Priority |\n|-----|---------|---------|----------|\n| r | failed task | RecoveryKeys (retry) | 100 |\n| r | normal task | QuickControlKeys (redirect) | 50 |\n| x | failed task | RecoveryKeys (cleanup) | 100 |\n| x | normal task | QuickControlKeys (stop) | 50 |\n| m | any | ModeToggle (semi-auto/autopilot) | 50 |\n| M | any | MergeQueueView | 50 |\n| q | any | QuitHandler | 50 |\n| ESC | modal open | Modal close | 200 |\n| any | modal open | Modal handlers only | 150 |\n\n## Acceptance Criteria\n\n### Routing Tests - 9 tests\n- [ ] 'r' on failed task routes to RecoveryKeys (retry)\n- [ ] 'r' on normal task routes to QuickControlKeys (redirect)\n- [ ] 'm' key routes to ModeToggle handler\n- [ ] 'M' key routes to MergeQueueView handler\n- [ ] 'q' key routes to QuitHandler\n- [ ] 'q' with running agents shows confirmation\n- [ ] ESC in modal closes modal, not handled by app\n- [ ] Keys in modal don't trigger app-level handlers\n- [ ] Unhandled keys are ignored (no error)\n\n### Priority Tests - 3 tests\n- [ ] Higher priority handler runs first\n- [ ] Only one handler runs per keypress\n- [ ] Handlers check condition before running\n\n### Context Tests - 3 tests\n- [ ] Panel focus affects navigation keys\n- [ ] Selected task affects control keys\n- [ ] Modal state affects all keys\n\n### Registration Tests - 2 tests\n- [ ] All keyboard hooks register with router\n- [ ] Handlers can be added/removed dynamically\n\n### Summary\n- [ ] 17 tests pass\n\n## Files\n- src/hooks/useKeyboardRouter.ts (NEW)\n- src/hooks/useKeyboardRouter.test.ts (NEW)\n\n## Dependencies\n- F19 Orchestration Store (ch-8j3) - provides mode/pause context\n\n## Notes\n- This router is the CENTRAL coordinator - individual key handlers depend on IT\n- All keyboard hooks should register their handlers with this router\n- Replaces multiple independent useInput() calls\n- Makes key behavior predictable and testable\n- Individual key handlers (F63a-F63z) should depend on this router","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T12:47:27.712641+03:00","created_by":"deligoez","updated_at":"2026-01-11T23:17:25.387376+03:00","closed_at":"2026-01-11T23:17:25.387376+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-89dk","depends_on_id":"ch-g3of","type":"blocks","created_at":"2026-01-11T16:16:40.231512+03:00","created_by":"deligoez"}]}
{"id":"ch-8aka","title":"FR13: Review Keyboard Handlers - Keyboard bindings for review flow","description":"## What\nKeyboard bindings for all review flow interactions.\n\n## Acceptance Criteria\n- [ ] `R` in main view with \"reviewing\" task selected → opens single task review directly\n- [ ] `R` in main view without selection → opens batch review summary\n- [ ] `R` in main view does nothing when no pending reviews\n- [ ] `Enter` in summary starts one-by-one review (first task)\n- [ ] `1-9` in summary jumps to specific task by index\n- [ ] `A` in task review approves current task\n- [ ] `R` in task review opens feedback modal\n- [ ] `X` in task review rejects task\n- [ ] `N` in task review goes to next task (wraps at end)\n- [ ] `P` in task review goes to previous task (wraps at start)\n- [ ] `Esc` cancels/backs out (modal → task, task → summary, summary → idle)\n- [ ] 11 tests pass\n\n## Files\n- src/hooks/useReviewKeys.ts\n- src/hooks/useReviewKeys.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:13:05.134998+03:00","created_by":"deligoez","updated_at":"2026-01-12T16:48:45.347837+03:00","closed_at":"2026-01-12T16:48:45.347837+03:00","close_reason":"Closed","labels":["m13-review"],"dependencies":[{"issue_id":"ch-8aka","depends_on_id":"ch-x5un","type":"blocks","created_at":"2026-01-12T15:13:05.138474+03:00","created_by":"deligoez"},{"issue_id":"ch-8aka","depends_on_id":"ch-q4nx","type":"blocks","created_at":"2026-01-12T15:13:05.140856+03:00","created_by":"deligoez"},{"issue_id":"ch-8aka","depends_on_id":"ch-cq1q","type":"blocks","created_at":"2026-01-12T15:13:05.142292+03:00","created_by":"deligoez"}]}
{"id":"ch-8dm5","title":"E2E-11: Stop Agent (x)","description":"## What\nVerify x key stops selected agent.\n\n## Tests (3 tests)\n1. Pressing x shows stop confirmation\n2. Confirming stops agent\n3. Agent tile removed from grid\n\n## Files\n- src/e2e/stop-agent.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T21:18:12.543932+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:10:30.573799+03:00","closed_at":"2026-01-12T01:10:30.573799+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-8dm5","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:18:12.546426+03:00","created_by":"deligoez"},{"issue_id":"ch-8dm5","depends_on_id":"ch-cwy","type":"blocks","created_at":"2026-01-11T21:18:12.548572+03:00","created_by":"deligoez"}]}
{"id":"ch-8ee","title":"F31: Merge Service","description":"## What\nTop-level facade that orchestrates the entire merge pipeline. Simple API for RalphLoop. Also handles worktree cleanup after successful merges.\n\n## Dependency Injection Pattern\n```typescript\ninterface MergeServiceDeps {\n  mergeQueue: MergeQueue;\n  mergeWorker: MergeWorker;\n  conflictClassifier: ConflictClassifier;\n  autoResolver: AutoResolver;\n  rebaseRetry: RebaseRetry;\n  resolverAgent: ResolverAgent;\n  humanEscalation: HumanEscalation;\n  worktreeService: WorktreeService;\n  eventEmitter: EventEmitter;\n}\n\nclass MergeService {\n  constructor(private deps: MergeServiceDeps) {}\n}\n```\n\n## Mocking Strategy\nAll dependencies are injected interfaces - create mocks for each:\n```typescript\nconst mockQueue = {\n  enqueue: vi.fn(),\n  dequeue: vi.fn(),\n  getStats: vi.fn(),\n} as unknown as MergeQueue;\n\nconst mockWorker = {\n  process: vi.fn(),\n} as unknown as MergeWorker;\n\nconst mockClassifier = {\n  classify: vi.fn(),\n} as unknown as ConflictClassifier;\n\nconst mockAutoResolver = {\n  resolve: vi.fn(),\n} as unknown as AutoResolver;\n\n// ... etc\n```\n\n## Acceptance Criteria\n\n### enqueue() - 1 test\n- [ ] Calls `deps.mergeQueue.enqueue()` with the provided MergeItem\n\n### start() / stop() - 2 tests\n- [ ] `start()` sets `isRunning=true` and begins polling queue via `deps.mergeQueue.dequeue()`\n- [ ] `stop()` sets `isRunning=false` after current `deps.mergeWorker.process()` completes\n\n### getQueueStatus() / isRunning() - 2 tests\n- [ ] `getQueueStatus()` returns result of `deps.mergeQueue.getStats()`\n- [ ] `isRunning()` returns internal running state boolean\n\n### Conflict Resolution Orchestration - 5 tests\n- [ ] On conflict, calls `deps.conflictClassifier.classify()`\n- [ ] For SIMPLE conflicts, calls `deps.autoResolver.resolve()`\n- [ ] For MEDIUM conflicts, calls `deps.rebaseRetry.rebaseAndRetry()`\n- [ ] For COMPLEX conflicts, calls `deps.resolverAgent.resolve()`\n- [ ] On all resolution failures, calls `deps.humanEscalation.escalate()`\n\n### Worktree Cleanup - 2 tests\n- [ ] On successful merge (worker returns success), calls `deps.worktreeService.remove(worktreePath)`\n- [ ] On human-resolved merge (worker returns humanResolved), calls `deps.worktreeService.remove(worktreePath)`\n\n## Test Setup Pattern\n```typescript\ndescribe('MergeService', () =\u003e {\n  let service: MergeService;\n  let mockQueue: MergeQueue;\n  let mockWorker: MergeWorker;\n  let mockClassifier: ConflictClassifier;\n  let mockAutoResolver: AutoResolver;\n  let mockRebaseRetry: RebaseRetry;\n  let mockResolverAgent: ResolverAgent;\n  let mockHumanEscalation: HumanEscalation;\n  let mockWorktree: WorktreeService;\n\n  beforeEach(() =\u003e {\n    mockQueue = { enqueue: vi.fn(), dequeue: vi.fn(), getStats: vi.fn() } as any;\n    mockWorker = { process: vi.fn() } as any;\n    mockClassifier = { classify: vi.fn() } as any;\n    mockAutoResolver = { resolve: vi.fn() } as any;\n    mockRebaseRetry = { rebaseAndRetry: vi.fn() } as any;\n    mockResolverAgent = { resolve: vi.fn() } as any;\n    mockHumanEscalation = { escalate: vi.fn() } as any;\n    mockWorktree = { remove: vi.fn() } as any;\n    \n    service = new MergeService({\n      mergeQueue: mockQueue,\n      mergeWorker: mockWorker,\n      conflictClassifier: mockClassifier,\n      autoResolver: mockAutoResolver,\n      rebaseRetry: mockRebaseRetry,\n      resolverAgent: mockResolverAgent,\n      humanEscalation: mockHumanEscalation,\n      worktreeService: mockWorktree,\n      eventEmitter: new EventEmitter(),\n    });\n  });\n});\n```\n\n## Events (implicit, not counted in tests)\n- mergeStarted, mergeCompleted, mergeFailed, conflict, escalated\n\n## Dependencies\n- F05 Worktree Remove (ch-112) - worktree cleanup\n- F24 Merge Queue (ch-glf)\n- F25 Merge Worker (ch-fe5)\n- F25b Force-Push Recovery (ch-gnf)\n- F26 Conflict Classifier (ch-7pb)\n- F27 Auto-Resolver (ch-t31)\n- F28 Rebase-Retry (ch-xn6)\n- F29 Resolver Agent (ch-9sj)\n- F30 Human Escalation (ch-26c)\n\n## Files\n- src/services/MergeService.ts\n- tests/services/MergeService.test.ts\n\n## Plan\nSee: thoughts/shared/plans/features/F31-merge-service.md\n\n**Total: 12 tests (facade wiring + conflict resolution + worktree cleanup)**","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T03:17:25.914154+03:00","created_by":"deligoez","updated_at":"2026-01-11T19:43:32.018416+03:00","closed_at":"2026-01-11T19:43:32.018416+03:00","close_reason":"Closed","labels":["m5-merge"],"dependencies":[{"issue_id":"ch-8ee","depends_on_id":"ch-glf","type":"blocks","created_at":"2026-01-10T03:17:25.916827+03:00","created_by":"deligoez"},{"issue_id":"ch-8ee","depends_on_id":"ch-fe5","type":"blocks","created_at":"2026-01-10T03:17:25.918445+03:00","created_by":"deligoez"},{"issue_id":"ch-8ee","depends_on_id":"ch-7pb","type":"blocks","created_at":"2026-01-10T03:17:25.919817+03:00","created_by":"deligoez"},{"issue_id":"ch-8ee","depends_on_id":"ch-t31","type":"blocks","created_at":"2026-01-10T03:17:25.921151+03:00","created_by":"deligoez"},{"issue_id":"ch-8ee","depends_on_id":"ch-xn6","type":"blocks","created_at":"2026-01-10T03:17:25.922525+03:00","created_by":"deligoez"},{"issue_id":"ch-8ee","depends_on_id":"ch-9sj","type":"blocks","created_at":"2026-01-10T03:17:25.923867+03:00","created_by":"deligoez"},{"issue_id":"ch-8ee","depends_on_id":"ch-26c","type":"blocks","created_at":"2026-01-10T03:17:25.925216+03:00","created_by":"deligoez"},{"issue_id":"ch-8ee","depends_on_id":"ch-112","type":"blocks","created_at":"2026-01-10T08:38:29.617668+03:00","created_by":"deligoez"},{"issue_id":"ch-8ee","depends_on_id":"ch-gnf","type":"blocks","created_at":"2026-01-11T11:46:20.915187+03:00","created_by":"deligoez"}]}
{"id":"ch-8er","title":"F91: Implementation Mode Controller","description":"## What\nImplementation mode that runs after planning/review phases complete.\nRenders the main TUI with TaskPanel + AgentGrid for semi-auto/autopilot execution.\n\n## Files\n- `src/modes/ImplementationMode.tsx`\n- `src/modes/ImplementationMode.test.tsx`\n\n## Dependencies\n- F89 (ch-eq5): App Router (routes here when ready)\n- F85 (ch-a0a): Review Loop (transitions from here)\n\n## Acceptance Criteria\n- [ ] Renders TwoColumnLayout with TaskPanel and AgentGrid\n- [ ] Displays HeaderBar with mode indicator\n- [ ] Displays FooterBar with shortcuts and stats\n- [ ] Supports semi-auto mode (user selects tasks)\n- [ ] Supports autopilot mode (automatic task selection)\n- [ ] 'p' key transitions back to Planning Mode\n- [ ] 'm' key toggles between semi-auto/autopilot (updates state.json only)\n- [ ] Mode resolution follows precedence: CLI args \u003e planning-state.chosenMode \u003e state.json mode \u003e config.json default\n- [ ] Preserves agent state on mode transitions\n- [ ] Shows summary and exit prompt when all tasks closed\n- [ ] 'q' key confirms exit if agents running\n- [ ] Handles no ready tasks: autopilot waits, semi-auto shows message\n- [ ] On critical error: pauses, shows error, allows recovery\n- [ ] 14 tests pass\n\n## Layout\n```\n+------------------------------------------------------------------+\n| CHORUS | semi-auto | * 2/3 agents | 12 tasks      | ? help       |\n+------------------------------------------------------------------+\n| TASKS                    | AGENTS (Tiling View)                   |\n|--------------------------|----------------------------------------|\n| -\u003e ch-xxx [P1] Task 1    | +---------------+---------------+      |\n|   * claude | iter 7      | | Agent 1       | Agent 2       |      |\n|                          | |               |               |      |\n| * ch-yyy [P1] Task 2     | +---------------+---------------+      |\n|   * claude | iter 3      | | [empty]       | [empty]       |      |\n|                          | +---------------+---------------+      |\n+------------------------------------------------------------------+\n| checkmark1 *2 o1 x1 | Merge: 0 | Runtime: 15m       | ? help     |\n+------------------------------------------------------------------+\n```\n\n## Exit Conditions\n- All tasks closed: Shows summary, prompts for exit\n- 'q' pressed: If agents running, confirms before exit\n- No ready tasks: Autopilot waits for tasks, semi-auto shows \"No tasks ready\"\n- Critical error: Pauses execution, shows error details, allows recovery action\n\n## Mode Precedence\n1. CLI args (--mode, --autopilot) - highest priority\n2. planning-state.json chosenMode - from review phase\n3. state.json mode - runtime toggle\n4. config.json defaultMode - lowest priority\n\n## Notes\n- This is the main operational mode (M4+ features run here)\n- Semi-auto: F17 SemiAutoController\n- Autopilot: F32 RalphLoop\n- Mode toggle: F63c (deferred)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:17:17.834479+03:00","created_by":"deligoez","updated_at":"2026-01-12T04:49:30.216377+03:00","closed_at":"2026-01-12T04:49:30.216377+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-8er","depends_on_id":"ch-eq5","type":"blocks","created_at":"2026-01-11T03:17:17.836797+03:00","created_by":"deligoez"},{"issue_id":"ch-8er","depends_on_id":"ch-a0a","type":"blocks","created_at":"2026-01-11T03:17:17.839222+03:00","created_by":"deligoez"}]}
{"id":"ch-8gf","title":"F92: Chorus Merge-User CLI - Add user branch to merge queue","description":"## What\nCLI subcommand to add user's manual work branch to the merge queue.\n\n## Context from Master Plan\n```\nUser Parallel Worktree:\n\nUsers can work manually alongside Chorus:\n\nmain branch\n    │\n    ├── .worktrees/user-feature     (user's manual work)\n    │   └── NOT managed by Chorus\n    │\n    ├── .worktrees/claude-ch-001    (agent work)\n    └── ...\n\nWhen user wants to merge their work:\n1. Option A: Pause Chorus, merge manually, resume\n2. Option B: `chorus merge-user \u003cbranch\u003e` to add to queue\n```\n\n## CLI Command\n```bash\nchorus merge-user \u003cbranch\u003e\n\n# Examples:\nchorus merge-user user-feature\nchorus merge-user feature/my-manual-work\n```\n\n## API\n```typescript\n// src/commands/mergeUser.ts\n\ninterface MergeUserOptions {\n  branch: string;\n  priority?: number;  // Default: P2 (normal priority)\n}\n\nasync function mergeUserCommand(options: MergeUserOptions): Promise\u003cvoid\u003e {\n  // 1. Validate branch exists\n  // 2. Validate branch has commits ahead of main\n  // 3. Add to merge queue with priority\n  // 4. Print confirmation\n}\n```\n\n## Behavior\n1. Validates branch exists in git\n2. Validates branch has commits to merge (ahead of main)\n3. Creates a synthetic \"user task\" entry for the merge queue\n4. Adds to MergeQueue with specified priority (default P2)\n5. Prints confirmation: \"Added 'user-feature' to merge queue (position: 3)\"\n\n## User Task Entry\n```typescript\ninterface UserMergeEntry {\n  type: 'user';\n  branch: string;\n  addedAt: Date;\n  priority: number;\n  commitCount: number;\n}\n```\n\n## Files\n- src/commands/mergeUser.ts (NEW)\n- src/commands/mergeUser.test.ts (NEW)\n\n## Acceptance Criteria\n\n### Branch Validation - 3 tests\n- [ ] Validates branch exists via `git rev-parse --verify \u003cbranch\u003e`\n- [ ] Validates branch has commits ahead via `git rev-list main..\u003cbranch\u003e --count`\n- [ ] Returns error with message if branch doesn't exist\n\n### Queue Addition - 3 tests\n- [ ] Calls MergeQueue.add() with user entry\n- [ ] Uses default priority P2 when not specified\n- [ ] Accepts --priority flag to override\n\n### Output - 2 tests\n- [ ] Prints confirmation with queue position\n- [ ] Prints commit count being merged\n\n### Edge Cases - 2 tests\n- [ ] Returns error if branch has no commits ahead\n- [ ] Returns error if same branch already in queue\n\n### Summary\n- [ ] 10 tests pass\n\n## Tests\n1. Validates branch exists\n2. Validates commits ahead of main\n3. Returns error for non-existent branch\n4. Adds to MergeQueue\n5. Uses default P2 priority\n6. Accepts --priority flag\n7. Prints queue position\n8. Prints commit count\n9. Errors on no commits ahead\n10. Errors on duplicate branch in queue\n\n## CLI Integration\n```typescript\n// In src/cli.ts\nprogram\n  .command('merge-user \u003cbranch\u003e')\n  .description('Add user branch to merge queue')\n  .option('-p, --priority \u003cn\u003e', 'Priority (0-4)', '2')\n  .action(mergeUserCommand);\n```\n\n## Notes\n- User worktrees are NOT managed by Chorus (no .chorus/ metadata)\n- This is for users who work in parallel and want to use Chorus merge queue\n- After merge, worktree cleanup is user's responsibility\n- **Deferred label filtering does NOT apply to user branches** (deferred is for Beads-managed tasks only)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T12:28:00.764108+03:00","created_by":"deligoez","updated_at":"2026-01-12T06:42:20.955204+03:00","closed_at":"2026-01-12T06:42:20.955204+03:00","close_reason":"Closed","labels":["m5-merge"],"dependencies":[{"issue_id":"ch-8gf","depends_on_id":"ch-glf","type":"blocks","created_at":"2026-01-11T12:28:00.768613+03:00","created_by":"deligoez"}]}
{"id":"ch-8j3","title":"F19: Orchestration Store - Zustand state management","description":"## DEFERRED - REPLACED BY XSTATE\n\nThis task is replaced by the XState migration (M-1 milestone).\n\n**Replacement:** FX07 (ch-vskx) - useChorusMachine hook\n\nTasks that previously depended on ch-8j3 should now depend on ch-vskx.\n\n---\n\n## Original Description\n\n## What\nZustand store for orchestration state: mode, status, current task, stats.\n\n(Original content preserved for reference)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T02:07:35.161308+03:00","created_by":"deligoez","updated_at":"2026-01-11T17:50:44.879522+03:00","closed_at":"2026-01-11T17:50:44.879522+03:00","close_reason":"wontfix","labels":["deferred","m4-orchestration"]}
{"id":"ch-8le","title":"F83b: Task Generator Service","description":"## What\nGenerate tasks from spec chunks via Plan Agent.\n\n## Files\n- `src/services/TaskGenerator.ts`\n- `src/services/TaskGenerator.test.ts`\n\n## Dependencies\n- F83a (ch-3xt): SpecChunker\n- F82 (ch-z8g): PlanAgent\n\n## Acceptance Criteria\n- [ ] `generate(chunk: Chunk)` returns tasks array\n- [ ] Uses PlanAgent to parse chunk content\n- [ ] Extracts user stories/requirements from chunk\n- [ ] Converts extracted items to task format\n- [ ] Assigns sequential IDs with configured prefix\n- [ ] Infers dependencies from context mentions\n- [ ] Sets priority based on order in spec\n- [ ] Returns empty array for chunk with no tasks\n- [ ] Reports progress per chunk processed\n- [ ] 10 tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:08:00.322148+03:00","created_by":"deligoez","updated_at":"2026-01-12T03:06:46.106571+03:00","closed_at":"2026-01-12T03:06:46.106571+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-8le","depends_on_id":"ch-3xt","type":"blocks","created_at":"2026-01-11T03:08:00.327598+03:00","created_by":"deligoez"},{"issue_id":"ch-8le","depends_on_id":"ch-z8g","type":"blocks","created_at":"2026-01-11T03:08:00.331319+03:00","created_by":"deligoez"}]}
{"id":"ch-8pne","title":"TS06: Dependency Management","description":"## What\nImplement dependency tracking and circular detection.\n\n## Files\n- `src/services/TaskStore.ts`\n- `src/services/TaskStore.test.ts`\n\n## Acceptance Criteria\n- [ ] `addDependency(taskId, dependsOnId)` adds dependency\n- [ ] `removeDependency(taskId, dependsOnId)` removes dependency\n- [ ] `getDependents(taskId)` returns tasks that depend on this one\n- [ ] `getBlockers(taskId)` returns unmet dependency tasks\n- [ ] `hasCircularDependency(taskId, newDepId)` detects cycles (DFS)\n- [ ] `addDependency` throws on circular dependency\n- [ ] When task completes, dependents become unblocked\n- [ ] Computed property `isBlocked` works correctly\n- [ ] Computed property `isReady` works correctly\n- [ ] 10 tests pass","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-13T00:13:13.840762+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:13:13.840762+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-8pne","depends_on_id":"ch-suuw","type":"blocks","created_at":"2026-01-13T00:13:13.844044+03:00","created_by":"deligoez"},{"issue_id":"ch-8pne","depends_on_id":"ch-3l5i","type":"blocks","created_at":"2026-01-13T00:22:08.22701+03:00","created_by":"deligoez"}]}
{"id":"ch-8tce","title":"E2E-54: PlanningState Integration Tests","description":"## What\nE2E tests for PlanningState persisting to .chorus/planning-state.json.\n\n## Acceptance Criteria\n- [ ] Saves planning state to JSON file\n- [ ] Loads planning state correctly\n- [ ] Handles status transitions (planning → reviewing → ready)\n- [ ] Preserves chosenMode setting\n- [ ] Returns null if no state file exists\n- [ ] 6 tests pass\n\n## Files\n- src/e2e/planning-state.e2e.test.ts\n\n## Implementation Notes\n- Use createGitRepoWithChorus() helper\n- Test state transitions save correctly\n- Verify JSON structure matches interface","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T00:08:26.328869+03:00","created_by":"deligoez","updated_at":"2026-01-12T02:11:32.669093+03:00","closed_at":"2026-01-12T02:11:32.669093+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-8tce","depends_on_id":"ch-to7","type":"blocks","created_at":"2026-01-12T00:08:48.683082+03:00","created_by":"deligoez"}]}
{"id":"ch-8vk","title":"F56a: ProgressBar Component - Horizontal progress bar with blocks","description":"## What\nHorizontal progress bar using Unicode block characters to show completion percentage.\n\n## Context from Master Plan\n```\n│ ▓▓▓▓░░░░░░ 35%    │\n```\n\n## API\n```typescript\n// src/components/ProgressBar.tsx\n\ninterface ProgressBarProps {\n  percent: number;       // 0-100\n  width?: number;        // Character width, default 10\n  showPercent?: boolean; // Show percentage text, default true\n}\n\nfunction ProgressBar({ percent, width = 10, showPercent = true }: ProgressBarProps): JSX.Element\n```\n\n## Visual Output\n- 0%:   `░░░░░░░░░░ 0%`\n- 35%:  `▓▓▓▓░░░░░░ 35%`\n- 100%: `▓▓▓▓▓▓▓▓▓▓ 100%`\n\n## Files\n- src/components/ProgressBar.tsx\n- src/components/ProgressBar.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows filled blocks (▓) for completed portion\n- [ ] Shows empty blocks (░) for remaining portion\n- [ ] Calculates correct number of filled blocks\n- [ ] Respects width prop\n- [ ] Shows percentage when showPercent=true\n- [ ] Hides percentage when showPercent=false\n- [ ] Clamps percent to 0-100 range\n- [ ] Handles negative percent (treats as 0)\n- [ ] Handles percent \u003e 100 (treats as 100)\n- [ ] Uses Ink `\u003cText color=\"green\"\u003e` for high progress (\u003e80%)\n- [ ] 10 tests pass\n\n## Tests\n1. Shows 0% with all empty blocks\n2. Shows 50% with half filled blocks\n3. Shows 100% with all filled blocks\n4. Respects custom width\n5. Shows percentage text by default\n6. Hides percentage when showPercent=false\n7. Clamps negative to 0\n8. Clamps \u003e100 to 100\n9. Uses `\u003cText color=\"green\"\u003e` for \u003e80%\n10. Calculates blocks correctly for various percents","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:48:33.051708+03:00","created_by":"deligoez","updated_at":"2026-01-11T20:13:55.179951+03:00","closed_at":"2026-01-11T20:13:55.179951+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-8vk","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:52.723758+03:00","created_by":"deligoez"}]}
{"id":"ch-8w5","title":"F58a: TaskSummaryStats Component - Count tasks by status","description":"## What\nDisplay summary counts of tasks by status (done, running, pending, blocked).\n\n## Context from Master Plan\n```\n│ Tasks: 1 done, 3 running, 1 pending, 1 blocked | Merge: 1 queued | ? help   │\n```\n\n## API\n```typescript\n// src/components/TaskSummaryStats.tsx\n\ninterface TaskSummaryStatsProps {\n  done: number;\n  running: number;\n  pending: number;\n  blocked: number;\n}\n\nfunction TaskSummaryStats({ done, running, pending, blocked }: TaskSummaryStatsProps): JSX.Element\n```\n\n## Visual Output\n```\nTasks: 1 done, 3 running, 1 pending, 1 blocked\n```\n\n## Color Specs (Ink)\n- done: color=\"green\"\n- running: color=\"blue\"\n- pending: color=\"yellow\"\n- blocked: color=\"red\"\n\n## Files\n- src/components/TaskSummaryStats.tsx\n- src/components/TaskSummaryStats.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows \"Tasks:\" prefix\n- [ ] Shows done count with \"done\" label\n- [ ] Shows running count with \"running\" label\n- [ ] Shows pending count with \"pending\" label\n- [ ] Shows blocked count with \"blocked\" label\n- [ ] Uses Ink `\u003cText color=\"green\"\u003e` for done count\n- [ ] Uses Ink `\u003cText color=\"blue\"\u003e` for running count\n- [ ] Uses Ink `\u003cText color=\"yellow\"\u003e` for pending count\n- [ ] Uses Ink `\u003cText color=\"red\"\u003e` for blocked count\n- [ ] Handles zero counts correctly (still displays them)\n\n### Summary\n- [ ] 10 tests pass\n\n## Tests\n1. Shows \"Tasks:\" prefix\n2. Shows all four categories with comma separator\n3. Green color for done count\n4. Blue color for running count\n5. Yellow color for pending count\n6. Red color for blocked count\n7. Handles zero counts (0 done, 0 running, etc.)\n8. Displays in correct order: done, running, pending, blocked\n9. Uses comma+space separator between categories\n10. Works with large numbers (100+)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:49:00.890131+03:00","created_by":"deligoez","updated_at":"2026-01-11T20:16:22.667462+03:00","closed_at":"2026-01-11T20:16:22.667462+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-8w5","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:52.924691+03:00","created_by":"deligoez"}]}
{"id":"ch-9004","title":"TS18: Migrate UI Components","description":"## What\nUpdate UI components to use Task type.\n\n## Files\n- `src/components/TaskPanel.tsx`\n- `src/modes/ImplementationMode.tsx`\n- `src/hooks/useTaskSelection.ts`\n\n## Acceptance Criteria\n- [ ] Components use Task instead of Bead\n- [ ] Props updated for new types\n- [ ] Existing E2E tests pass\n- [ ] 0 new tests (existing tests validate)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:15:48.885906+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:15:48.885906+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-9004","depends_on_id":"ch-9rnt","type":"blocks","created_at":"2026-01-13T00:15:48.887699+03:00","created_by":"deligoez"}]}
{"id":"ch-951d","title":"CHORE: Remove redundant skipped tests in intervention-menu.e2e.test.ts","description":"## What\n2 skipped tests in intervention-menu.e2e.test.ts are now covered by PTY tests.\n\n## Skipped Tests\n- line 35: \"opens intervention menu when i is pressed\"\n- line 73: \"shows correct menu options\"\n\n## Why Remove\nThese tests cannot work without TTY (cli-testing-library limitation).\nThe same functionality is now tested in intervention-menu-pty.e2e.test.ts which passes.\n\n## Acceptance Criteria\n- [ ] Remove the 2 skipped test blocks\n- [ ] Keep the \"doesn't crash\" tests (they provide value for non-TTY environments)\n- [ ] Tests still pass\n\n## Files\n- src/e2e/intervention-menu.e2e.test.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T14:21:14.401214+03:00","created_by":"deligoez","updated_at":"2026-01-12T17:53:24.775989+03:00","closed_at":"2026-01-12T17:53:24.775989+03:00","close_reason":"Closed","labels":["m9-intervention"]}
{"id":"ch-96v","title":"F63l: Priority Badge Colors","description":"## What\nAdd color-coded priority badges P0-P4 to TaskPanel.\n\n## Why\nMaster plan specifies colored priority badges:\n- P0 Critical (magenta with FLASHING animation)\n- P1 Critical (red)\n- P2 High (orange/yellow)\n- P3 Medium (yellow)\n- P4 Low (blue/dim)\n\nCurrent implementation only tests P0 without color verification.\n\n## Acceptance Criteria\n- [ ] P0 badge displayed in magenta WITH FLASHING animation\n- [ ] P1 badge displayed in red\n- [ ] P2 badge displayed in orange/yellow\n- [ ] P3 badge displayed in yellow\n- [ ] P4 badge displayed in blue/dim\n- [ ] P0 flashing animation toggles visibility on interval\n- [ ] 6 tests pass\n\n## Tests (src/components/TaskPanel.test.tsx)\n1. `P0 badge is magenta (critical)`\n2. `P0 badge has flashing animation`\n3. `P1 badge is red`\n4. `P2 badge is yellow/orange`\n5. `P3 badge is yellow`\n6. `P4 badge is blue/dim`\n\n## Files\n- src/components/TaskPanel.tsx (add colored badges)\n- src/components/TaskPanel.test.tsx (add tests)\n\n## Notes\n- P0 added as \"ultra-critical\" beyond plan's P1-P4\n- P0 MUST flash to draw attention (use setInterval for animation)\n- Colors should work in both light and dark terminals\n- Use Ink's `\u003cText color=\"magenta\"\u003e` etc.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T22:17:54.898221+03:00","created_by":"deligoez","updated_at":"2026-01-11T21:08:51.494225+03:00","closed_at":"2026-01-11T21:08:51.494225+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-96v","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:54.308978+03:00","created_by":"deligoez"}]}
{"id":"ch-999","title":"F15b: Orchestrator Timeout Management","description":"## What\nTimeout handling for the Orchestrator: prevent runaway agents and return tasks to pending.\n\n## Acceptance Criteria\n\n### Timeout Handling - 5 tests\n- [ ] Sets timeout timer when agent spawns (config.completion.taskTimeout, default 30min)\n- [ ] Kills agent process on timeout\n- [ ] Returns task to pending status on timeout via `beadsCLI.releaseTask()`\n- [ ] Emits \"timeout\" event with agentId, taskId\n- [ ] Clears timeout timer when agent exits normally\n\n### Summary\n- [ ] 5 tests pass\n\n## API\n```typescript\ninterface OrchestratorTimeoutEvents {\n  \"timeout\": (agentId: string, taskId: string) =\u003e void;\n}\n\n// Internal tracking\nprivate timeoutTimers: Map\u003cstring, NodeJS.Timeout\u003e;\n\n// Methods\nstartTimeout(agentId: string, taskId: string): void;\nclearTimeout(agentId: string): void;\nhandleTimeout(agentId: string, taskId: string): Promise\u003cvoid\u003e;\n```\n\n## Files\n- src/services/Orchestrator.ts (UPDATE)\n- src/services/Orchestrator.test.ts (UPDATE)\n\n## Notes\n- Added to existing Orchestrator class\n- Default timeout: 30 minutes (1800000ms)\n- On timeout: kill process → release task → emit event\n- Timer cleared on normal exit to prevent memory leaks\n\n## Dependencies\n- F15a (ch-0e7) - Core assignment functionality","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T23:50:48.931087+03:00","created_by":"deligoez","updated_at":"2026-01-11T20:03:35.62377+03:00","closed_at":"2026-01-11T20:03:35.62377+03:00","close_reason":"Closed","labels":["m4-orchestration"],"dependencies":[{"issue_id":"ch-999","depends_on_id":"ch-0e7","type":"blocks","created_at":"2026-01-10T23:50:48.935203+03:00","created_by":"deligoez"}]}
{"id":"ch-99jp","title":"E2E-25: Create Checkpoint (c key)","description":"## What\nE2E test for checkpoint creation with 'c' key.\n\n## Acceptance Criteria\n- [ ] Pressing 'c' creates a checkpoint\n- [ ] Success notification shows checkpoint ID\n- [ ] Checkpoint appears in undo history\n- [ ] Error shows if checkpoint fails\n- [ ] 4 tests pass\n\n## Test Cases\n1. `it('creates checkpoint when c is pressed')`\n2. `it('shows success notification with checkpoint ID')`\n3. `it('adds checkpoint to undo history')`\n4. `it('shows error notification on failure')`\n\n## Files\n- tests/e2e/create-checkpoint.test.ts\n\n## Dependencies\n- ch-0e01 (E2E Infrastructure)\n- ch-6aq (F63w Create Checkpoint Key)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:21:18.309887+03:00","created_by":"deligoez","updated_at":"2026-01-12T05:54:20.110983+03:00","closed_at":"2026-01-12T05:54:20.110983+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-99jp","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:21:18.313365+03:00","created_by":"deligoez"},{"issue_id":"ch-99jp","depends_on_id":"ch-6aq","type":"blocks","created_at":"2026-01-11T21:21:18.316862+03:00","created_by":"deligoez"}]}
{"id":"ch-9dob","title":"E2E-53: PatternsManager Integration Tests","description":"## What\nE2E tests for PatternsManager managing .chorus/PATTERNS.md.\n\n## Acceptance Criteria\n- [ ] Creates PATTERNS.md if missing\n- [ ] Adds pattern to correct category section\n- [ ] Reads existing patterns correctly\n- [ ] Handles empty file gracefully\n- [ ] Preserves file structure when appending\n- [ ] 5 tests pass\n\n## Files\n- src/e2e/patterns-manager.e2e.test.ts\n\n## Implementation Notes\n- Use createGitRepoWithChorus() helper\n- Test markdown structure preservation\n- Verify patterns appear in correct sections","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T00:08:18.479916+03:00","created_by":"deligoez","updated_at":"2026-01-12T02:09:34.880684+03:00","closed_at":"2026-01-12T02:09:34.880684+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-9dob","depends_on_id":"ch-j40","type":"blocks","created_at":"2026-01-12T00:08:48.588892+03:00","created_by":"deligoez"}]}
{"id":"ch-9fq","title":"F18a: useTaskSelection Hook - Task navigation and selection","description":"## What\nReact hook for task selection: up/down navigation, selection state, assign action.\n\n**IMPORTANT:** Task data comes from ChorusMachine (XState). Never call bd directly.\n\n## Service Dependency Pattern\n\n```typescript\n// Hook gets task data from ChorusMachine via useSelector\n// ChorusMachine context is populated by services\n// Services use BeadsCLI for all Beads access\n\n// In App.tsx (component that owns machine):\nconst [snapshot, send] = useMachine(chorusMachine);\n\n// Hook reads from machine via selectors (reactive updates):\nfunction useTaskSelection() {\n  const tasks = useSelector(actorRef, s =\u003e s.context.tasks);\n  const deferredTasks = useSelector(actorRef, s =\u003e s.context.deferredTasks);\n  // ... selection logic\n}\n```\n\n**No direct BeadsCLI access in hooks.**\nHooks read from XState machine context, which is populated by services.\n\n## API\n```typescript\ninterface UseTaskSelectionResult {\n  // Task lists (from machine context)\n  tasks: Bead[];          // Active ready tasks (excludes deferred)\n  deferredTasks: Bead[];  // Deferred tasks (for grayed display)\n  \n  // Selection state\n  selectedTaskId: string | null;\n  selectTask: (id: string) =\u003e void;\n  selectNext: () =\u003e void;\n  selectPrevious: () =\u003e void;\n  \n  // Assignment\n  canAssign: boolean;\n  assignSelected: () =\u003e Promise\u003cvoid\u003e;\n}\n\nfunction useTaskSelection(): UseTaskSelectionResult;\n```\n\n## Acceptance Criteria\n\n### Task Lists - 3 tests\n- [ ] `tasks` returns active ready tasks from machine context (excludes deferred)\n- [ ] `deferredTasks` returns deferred tasks from machine context\n- [ ] Updates when machine state changes (reactive via useSelector)\n\n### Selection - 4 tests\n- [ ] `selectTask(id)` sets selected task ID\n- [ ] `selectNext()` cycles through ready tasks (wraps at end)\n- [ ] `selectPrevious()` cycles backwards (wraps at start)\n- [ ] Navigation skips blocked AND deferred tasks\n\n### Assignment - 3 tests\n- [ ] `canAssign` returns true when idle AND task selected AND task not deferred\n- [ ] `canAssign` returns false when agent is running\n- [ ] `assignSelected()` sends SPAWN_AGENT event to machine\n\n### Summary\n- [ ] 10 tests pass\n\n## Files\n- src/hooks/useTaskSelection.ts (NEW)\n- src/hooks/useTaskSelection.test.ts (NEW)\n\n## Testing Pattern\n```typescript\n// Tests mock the machine actor\nimport { createActor } from 'xstate';\nimport { chorusMachine } from '../machines/chorus.machine';\n\nconst mockActor = createActor(chorusMachine, {\n  snapshot: {\n    context: {\n      tasks: [mockTask1, mockTask2],\n      deferredTasks: [mockDeferred1],\n    },\n    // ...\n  },\n});\n\nit('tasks excludes deferred', () =\u003e {\n  const { tasks, deferredTasks } = useTaskSelection();\n  expect(tasks).not.toContainEqual(mockDeferred1);\n  expect(deferredTasks).toContainEqual(mockDeferred1);\n});\n```\n\n## Notes\n- Uses XState selectors for reactive updates\n- Works with ChorusMachine for assignment (SPAWN_AGENT event)\n- **Deferred tasks shown grayed out in TUI but not selectable**\n- **All task data via ChorusMachine context → services → BeadsCLI pipeline**","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T02:07:14.369577+03:00","created_by":"deligoez","updated_at":"2026-01-12T06:13:45.724436+03:00","closed_at":"2026-01-12T06:13:45.724436+03:00","close_reason":"Closed","labels":["m4-orchestration"],"dependencies":[{"issue_id":"ch-9fq","depends_on_id":"ch-7gx","type":"blocks","created_at":"2026-01-10T02:07:14.372007+03:00","created_by":"deligoez"}]}
{"id":"ch-9rnt","title":"TS17: Migrate Orchestrator","description":"## What\nReplace BeadsCLI in Orchestrator.\n\n## Files\n- `src/services/Orchestrator.ts`\n- `src/services/Orchestrator.test.ts`\n\n## Acceptance Criteria\n- [ ] Uses TaskStore instead of BeadsCLI\n- [ ] All existing Orchestrator tests pass\n- [ ] 0 new tests (existing tests validate)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:15:36.215427+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:15:36.215427+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-9rnt","depends_on_id":"ch-eqkb","type":"blocks","created_at":"2026-01-13T00:15:47.824941+03:00","created_by":"deligoez"}]}
{"id":"ch-9sj","title":"F29: Resolver Agent","description":"## What\nSpawns Claude agent to resolve complex merge conflicts that can't be auto-resolved.\n\n## Testability Design\n\n**Problem:** Spawning subprocess is hard to test directly.\n\n**Solution:** Dependency injection with `AgentSpawner` interface.\n\n```typescript\ninterface AgentSpawner {\n  spawn(options: SpawnOptions): Promise\u003cAgentProcess\u003e;\n  kill(pid: number): void;\n}\n\ninterface AgentProcess {\n  pid: number;\n  stdout: Readable;\n  exitCode: Promise\u003cnumber\u003e;\n}\n\n// Production implementation\nclass CLIAgentSpawner implements AgentSpawner {\n  async spawn(options: SpawnOptions): Promise\u003cAgentProcess\u003e {\n    const child = spawn('claude', ['--prompt', options.prompt], {\n      cwd: options.cwd\n    });\n    return {\n      pid: child.pid,\n      stdout: child.stdout,\n      exitCode: new Promise(resolve =\u003e child.on('exit', resolve))\n    };\n  }\n}\n\n// Test implementation\nclass MockAgentSpawner implements AgentSpawner {\n  async spawn(options: SpawnOptions): Promise\u003cAgentProcess\u003e {\n    // Return mock process that resolves/fails as configured\n  }\n}\n```\n\n## API\n```typescript\n// src/services/ResolverAgent.ts\n\nclass ResolverAgent extends EventEmitter {\n  constructor(\n    private spawner: AgentSpawner,\n    private config: ResolverConfig,\n    private qualityRunner: QualityRunner\n  ) {\n    super();\n  }\n\n  /**\n   * Resolve conflict by spawning agent\n   * Emits: 'resolving', 'resolved', 'failed'\n   */\n  async resolve(conflict: ConflictAnalysis): Promise\u003cResolveResult\u003e\n\n  /**\n   * Build prompt with conflict context\n   */\n  buildPrompt(conflict: ConflictAnalysis): string\n\n  /**\n   * Verify no conflict markers remain\n   */\n  async verifyResolution(filePath: string): Promise\u003cboolean\u003e\n\n  /**\n   * Run quality commands after resolution\n   */\n  async runQualityCommands(): Promise\u003cQualityResult\u003e\n\n  /**\n   * Cancel running agent\n   */\n  cancel(): void\n}\n\ninterface ResolveResult {\n  success: boolean;\n  resolved: boolean;\n  needsHuman?: boolean;\n  error?: string;\n}\n```\n\n## Files\n- src/services/ResolverAgent.ts\n- src/services/AgentSpawner.ts (interface + CLIAgentSpawner)\n- tests/services/ResolverAgent.test.ts\n- tests/mocks/MockAgentSpawner.ts\n\n## Acceptance Criteria\n\n### resolve() - 6 tests\n- [ ] Calls spawner.spawn() with conflict resolution prompt\n- [ ] Returns `{ success: true, resolved: true }` when agent resolves (exit 0 + no markers)\n- [ ] Returns `{ needsHuman: true }` after maxAttempts failures\n- [ ] Emits 'resolving' event when agent starts\n- [ ] Emits 'resolved' event on successful resolution\n- [ ] Emits 'failed' event after maxAttempts failures\n\n### buildPrompt() - 2 tests\n- [ ] Includes all conflicting file contents\n- [ ] Includes conflict analysis for context\n\n### verifyResolution() - 1 test\n- [ ] Returns `true` when no conflict markers remain in file\n\n### Quality Commands Verification - 3 tests\n- [ ] After conflict resolution, runs quality commands (from config)\n- [ ] Only returns `{ success: true }` if quality commands pass\n- [ ] Returns `{ needsHuman: true }` if quality commands fail after resolution\n\n### cancel() - 1 test\n- [ ] Calls spawner.kill() with agent PID\n\n### AgentSpawner (separate unit) - 2 tests\n- [ ] CLIAgentSpawner.spawn() returns process with pid\n- [ ] CLIAgentSpawner.kill() terminates process\n\n### Summary\n- [ ] 15 tests pass\n\n## Tests\n1. resolve() calls spawner.spawn() with correct prompt\n2. resolve() returns success when agent resolves conflict\n3. resolve() escalates to human after maxAttempts\n4. resolve() emits resolving event\n5. resolve() emits resolved event\n6. resolve() emits failed event\n7. buildPrompt() includes file contents\n8. buildPrompt() includes analysis context\n9. verifyResolution() checks for conflict markers\n10. runQualityCommands() executes configured commands\n11. resolve() only succeeds if quality commands pass\n12. resolve() returns needsHuman if quality commands fail\n13. cancel() kills agent process\n14. CLIAgentSpawner.spawn() creates process\n15. CLIAgentSpawner.kill() terminates process\n\n## Notes\n- **Testable via dependency injection** - no subprocess mocking needed\n- MockAgentSpawner can simulate success, failure, timeout scenarios\n- CLIAgentSpawner is a thin wrapper, tested separately (integration test)\n- Quality commands from config ensure code still works after conflict resolution","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T03:16:59.889097+03:00","created_by":"deligoez","updated_at":"2026-01-11T19:33:50.671437+03:00","closed_at":"2026-01-11T19:33:50.671437+03:00","close_reason":"Closed","labels":["m5-merge"],"dependencies":[{"issue_id":"ch-9sj","depends_on_id":"ch-xn6","type":"blocks","created_at":"2026-01-10T03:16:59.891451+03:00","created_by":"deligoez"}]}
{"id":"ch-9t3k","title":"E2E-50: LearningStore Integration Tests","description":"## What\nE2E tests for LearningStore persisting learnings to .claude/rules/learnings.md.\n\n## Acceptance Criteria\n- [ ] Creates learnings.md if missing\n- [ ] Appends learnings with correct format (## Category, source attribution)\n- [ ] Deduplicates similar learnings (similarity \u003e 0.85)\n- [ ] Updates learnings-meta.json with hashes\n- [ ] Git commits after append (if configured)\n- [ ] 7 tests pass\n\n## Files\n- src/e2e/learning-store.e2e.test.ts\n\n## Implementation Notes\n- Use createGitRepoWithChorus() helper\n- Create .claude/rules/ directory structure\n- Test deduplication by adding similar learnings\n- Verify markdown format is correct","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T00:07:55.415723+03:00","created_by":"deligoez","updated_at":"2026-01-12T02:03:14.109334+03:00","closed_at":"2026-01-12T02:03:14.109334+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-9t3k","depends_on_id":"ch-a6h","type":"blocks","created_at":"2026-01-12T00:08:48.209535+03:00","created_by":"deligoez"}]}
{"id":"ch-9t4h","title":"E2E-26: Undo (u key)","description":"## What\nE2E test for undo functionality with 'u' key.\n\n## Acceptance Criteria\n- [ ] Pressing 'u' undoes last action\n- [ ] Shows confirmation dialog before undo\n- [ ] Restores previous state after confirm\n- [ ] Cancels undo on Escape\n- [ ] Shows error if nothing to undo\n- [ ] 5 tests pass\n\n## Test Cases\n1. `it('shows confirmation dialog when u is pressed')`\n2. `it('undoes last action on confirm')`\n3. `it('cancels undo on Escape')`\n4. `it('restores previous state after undo')`\n5. `it('shows error when nothing to undo')`\n\n## Files\n- tests/e2e/undo.test.ts\n\n## Dependencies\n- ch-0e01 (E2E Infrastructure)\n- ch-zsn (F63x Undo Key)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:21:19.220392+03:00","created_by":"deligoez","updated_at":"2026-01-12T05:55:37.209746+03:00","closed_at":"2026-01-12T05:55:37.209746+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-9t4h","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:21:19.222956+03:00","created_by":"deligoez"},{"issue_id":"ch-9t4h","depends_on_id":"ch-zsn","type":"blocks","created_at":"2026-01-11T21:21:19.226074+03:00","created_by":"deligoez"}]}
{"id":"ch-9tjq","title":"INT-01: Basic Claude CLI spawn and response","description":"## What\nIntegration test: Spawn Claude CLI and verify basic response.\n\n## Test Scenarios\n1. Spawn Claude with simple prompt → verify exit code 0\n2. Prompt: \"Output exactly: TEST_SUCCESS\" → verify output contains exact text\n3. Invalid cwd → verify error handling\n\n## Why Deterministic\n- Exact output matching (\"Output exactly: X\")\n- Exit code verification\n- Error conditions are predictable\n\n## Acceptance Criteria\n- [ ] Test spawns real Claude CLI\n- [ ] Test verifies exact output\n- [ ] Test handles errors gracefully\n- [ ] 3 tests pass\n- [ ] Timeout: 30s per test\n\n## Files\n- src/integration/claude-cli.integration.test.ts (update existing)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T14:25:23.242386+03:00","created_by":"deligoez","updated_at":"2026-01-12T14:36:39.339259+03:00","closed_at":"2026-01-12T14:36:39.339259+03:00","close_reason":"Closed","labels":["m2-agent-prep"]}
{"id":"ch-9yl","title":"F40: Learning Extractor - Parse learnings from scratchpad content","description":"## What\nParse learnings section content into structured Learning objects with scope and category.\n\n## Learning Scope (from Master Plan)\n\nEach learning item should have a scope prefix:\n\n| Scope | Prefix | Description | Triggers |\n|-------|--------|-------------|----------|\n| Local | `[LOCAL]` | Only affects this task | None |\n| Cross-cutting | `[CROSS-CUTTING]` | Affects multiple features | Plan review |\n| Architectural | `[ARCHITECTURAL]` | Fundamental design decision | Plan review + alert |\n\n**Format in scratchpad:**\n```markdown\n## Learnings\n- [LOCAL] This specific function needs memoization for performance\n- [CROSS-CUTTING] All API endpoints require rate limiting middleware\n- [ARCHITECTURAL] Use dependency injection for service instantiation\n```\n\n## Markdown Parsing Rules\n\n### Input Format\n```markdown\n## Learnings\n- [LOCAL] Learning point one\n- [CROSS-CUTTING] Learning with broader impact\n  that spans multiple lines\n\n### Performance (optional category heading)\n- [LOCAL] Performance-specific learning\n```\n\n### Parsing Rules\n1. **Scope Detection**: Look for `[LOCAL]`, `[CROSS-CUTTING]`, `[ARCHITECTURAL]` at start of bullet\n2. **Default Scope**: If no prefix found, default to `[LOCAL]`\n3. **Category Detection**: H3 headings (`### `) define optional category for following bullets\n4. **Bullet Points**: Lines starting with `- ` are individual learnings\n5. **Multi-line**: Continuation lines (indented, no bullet) append to previous learning\n6. **Blank Lines**: Ignored, don't affect parsing\n7. **No Category**: Bullets before any H3 heading get category \"general\"\n\n### Scope Detection Rules\n| Prefix | LearningScope |\n|--------|---------------|\n| `[LOCAL]` | `'local'` |\n| `[CROSS-CUTTING]` | `'cross-cutting'` |\n| `[ARCHITECTURAL]` | `'architectural'` |\n| (none) | `'local'` (default) |\n\n### Category Detection (secondary classification)\n| Heading Contains | Category |\n|------------------|----------|\n| \"performance\" | \"performance\" |\n| \"test\" | \"testing\" |\n| \"debug\" | \"debugging\" |\n| \"error\", \"exception\" | \"error-handling\" |\n| \"pattern\" | \"patterns\" |\n| (no match) | \"general\" |\n\n## API\n```typescript\n// src/services/LearningExtractor.ts\n\ntype LearningScope = 'local' | 'cross-cutting' | 'architectural';\n\ninterface Learning {\n  content: string;        // Learning text (without scope prefix)\n  scope: LearningScope;   // From prefix\n  category: string;       // From heading or 'general'\n  source: {\n    taskId: string;\n    agentType: AgentType;\n    timestamp: Date;\n  };\n}\n\nclass LearningExtractor {\n  /**\n   * Parse markdown learnings section into Learning objects\n   */\n  parse(content: string, taskId: string, agentType: AgentType): Learning[]\n\n  /**\n   * Detect scope from learning text prefix\n   * @returns { scope: LearningScope, content: string } with prefix stripped\n   */\n  detectScope(text: string): { scope: LearningScope; content: string }\n\n  /**\n   * Detect category from heading text\n   */\n  detectCategory(headingText: string): string\n\n  /**\n   * Format single learning for appending to learnings.md\n   */\n  formatForStorage(learning: Learning): string\n\n  /**\n   * Check if any learnings require plan review\n   * @returns true if any learning has scope 'cross-cutting' or 'architectural'\n   */\n  requiresPlanReview(learnings: Learning[]): boolean\n\n  /**\n   * Check if any learnings require immediate alert\n   * @returns true if any learning has scope 'architectural'\n   */\n  requiresAlert(learnings: Learning[]): boolean\n}\n```\n\n## Format Output (formatForStorage)\n```markdown\n- [CROSS-CUTTING] Learning content here\n  \u003c!-- source: ch-abc, claude, 2026-01-10T12:00:00Z, category: performance --\u003e\n```\n\n## Files\n- src/services/LearningExtractor.ts\n- tests/services/LearningExtractor.test.ts\n\n## Acceptance Criteria\n\n### parse() - 7 tests\n- [ ] `parse()` extracts each `- ` bullet as individual Learning\n- [ ] `parse()` joins multi-line bullets (indented continuation) into single learning\n- [ ] `parse()` assigns category from preceding `### ` heading\n- [ ] `parse()` assigns \"general\" category for bullets before any heading\n- [ ] `parse()` sets source.taskId, source.agentType, source.timestamp on each Learning\n- [ ] `parse()` returns empty array for empty/whitespace-only content\n- [ ] `parse()` returns empty array for content with no bullet points\n\n### detectScope() - 5 tests\n- [ ] `detectScope(\"[LOCAL] text\")` returns `{ scope: 'local', content: 'text' }`\n- [ ] `detectScope(\"[CROSS-CUTTING] text\")` returns `{ scope: 'cross-cutting', content: 'text' }`\n- [ ] `detectScope(\"[ARCHITECTURAL] text\")` returns `{ scope: 'architectural', content: 'text' }`\n- [ ] `detectScope(\"text without prefix\")` returns `{ scope: 'local', content: 'text without prefix' }`\n- [ ] `detectScope()` is case-insensitive for prefix\n\n### detectCategory() - 4 tests\n- [ ] `detectCategory()` returns \"performance\" for heading containing \"performance\"\n- [ ] `detectCategory()` returns \"testing\" for heading containing \"test\"\n- [ ] `detectCategory()` returns \"general\" for unrecognized heading\n- [ ] `detectCategory()` is case-insensitive\n\n### requiresPlanReview() / requiresAlert() - 3 tests\n- [ ] `requiresPlanReview()` returns true if any learning has scope 'cross-cutting' or 'architectural'\n- [ ] `requiresPlanReview()` returns false if all learnings are 'local'\n- [ ] `requiresAlert()` returns true only for 'architectural' scope\n\n### formatForStorage() - 1 test\n- [ ] `formatForStorage()` outputs markdown with scope prefix and attribution comment\n\n### Summary\n- [ ] 20 tests pass\n\n## Tests (20 total)\n1. parse() extracts single bullet as learning\n2. parse() extracts multiple bullets as separate learnings\n3. parse() joins multi-line bullet into one learning\n4. parse() assigns category from heading\n5. parse() assigns \"general\" for bullets before heading\n6. parse() sets source fields correctly\n7. parse() returns empty array for empty content\n8. detectScope() parses [LOCAL] prefix\n9. detectScope() parses [CROSS-CUTTING] prefix\n10. detectScope() parses [ARCHITECTURAL] prefix\n11. detectScope() defaults to local without prefix\n12. detectScope() is case-insensitive\n13. detectCategory() maps \"performance\" correctly\n14. detectCategory() maps \"testing\" correctly\n15. detectCategory() returns \"general\" for unknown\n16. detectCategory() is case-insensitive\n17. requiresPlanReview() true for cross-cutting\n18. requiresPlanReview() false for all local\n19. requiresAlert() true only for architectural\n20. formatForStorage() includes scope prefix and attribution\n\n## Notes\n- Scope prefix is PRIMARY classification (affects workflow)\n- Category from heading is SECONDARY (for organization)\n- Plan review triggered by cross-cutting/architectural learnings (F94, F95)\n- Alert triggered by architectural learnings (notify human immediately)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T10:42:43.052343+03:00","created_by":"deligoez","updated_at":"2026-01-11T19:07:22.025272+03:00","closed_at":"2026-01-11T19:07:22.025272+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-9yl","depends_on_id":"ch-uxk","type":"blocks","created_at":"2026-01-10T10:42:43.05388+03:00","created_by":"deligoez"}]}
{"id":"ch-a0a","title":"F85: Review Loop Controller","description":"## What\nIterate validation until all tasks are valid, then emit REVIEW_COMPLETE event to transition to implementation.\n\n## Architecture Change (XState v5)\n\nReview Loop emits events to ChorusMachine for state transitions:\n\n```typescript\n// Event types emitted to machine\ntype ReviewLoopEvent =\n  | { type: 'VALIDATION_STARTED'; taskCount: number }\n  | { type: 'VALIDATION_COMPLETED'; valid: number; invalid: number }\n  | { type: 'FIX_APPLIED'; fixCount: number }\n  | { type: 'REVIEW_COMPLETE'; mode: 'semi-auto' | 'autopilot'; taskCount: number }\n  | { type: 'BACK_TO_PLANNING' };\n```\n\n## Implementation\n\n```typescript\ninterface ReviewLoopOptions {\n  validator: TaskValidator;\n  fixApplier: FixApplier;\n  planningState: PlanningState;\n  config: ChorusConfig;\n  onEvent: (event: ReviewLoopEvent) =\u003e void; // Send to machine\n}\n\nexport function ReviewLoop({ options }: ReviewLoopProps) {\n  const [iteration, setIteration] = useState(1);\n  const [results, setResults] = useState\u003cValidationResult | null\u003e(null);\n  const [allValid, setAllValid] = useState(false);\n  const maxIterations = options.config.planReview?.maxIterations ?? 3;\n\n  const runValidation = async () =\u003e {\n    options.onEvent({\n      type: 'VALIDATION_STARTED',\n      taskCount: tasks.length,\n    });\n\n    const result = await options.validator.validate(tasks);\n    setResults(result);\n    setAllValid(result.invalid === 0);\n\n    options.onEvent({\n      type: 'VALIDATION_COMPLETED',\n      valid: result.valid,\n      invalid: result.invalid,\n    });\n  };\n\n  const applyFixes = async () =\u003e {\n    const fixCount = await options.fixApplier.applyAll(results.fixable);\n    \n    options.onEvent({\n      type: 'FIX_APPLIED',\n      fixCount,\n    });\n    \n    setIteration(i =\u003e i + 1);\n    await runValidation();\n  };\n\n  const selectMode = async (mode: 'semi-auto' | 'autopilot') =\u003e {\n    // 1. Save to planning-state.json FIRST\n    await options.planningState.save({\n      status: 'ready',\n      chosenMode: mode,\n    });\n\n    // 2. THEN emit event to machine\n    options.onEvent({\n      type: 'REVIEW_COMPLETE',\n      mode,\n      taskCount: tasks.length,\n    });\n  };\n\n  const backToPlan = () =\u003e {\n    options.onEvent({ type: 'BACK_TO_PLANNING' });\n  };\n\n  // ... render logic\n}\n```\n\n## XState Testing Pattern\n\n```typescript\nimport { describe, it, expect, vi } from 'vitest';\nimport { render, fireEvent, waitFor } from '@testing-library/react';\n\ndescribe('ReviewLoop - XState Event Emission', () =\u003e {\n  it('should emit VALIDATION_STARTED on mount', async () =\u003e {\n    // Arrange\n    const onEvent = vi.fn();\n    const mockValidator = { validate: vi.fn().mockResolvedValue({ valid: 5, invalid: 0 }) };\n\n    // Act\n    render(\u003cReviewLoop options={{ ...mockOptions, onEvent, validator: mockValidator }} /\u003e);\n\n    // Assert\n    await waitFor(() =\u003e {\n      expect(onEvent).toHaveBeenCalledWith({\n        type: 'VALIDATION_STARTED',\n        taskCount: expect.any(Number),\n      });\n    });\n  });\n\n  it('should emit REVIEW_COMPLETE with chosen mode', async () =\u003e {\n    // Arrange\n    const onEvent = vi.fn();\n    const mockPlanningState = { save: vi.fn().mockResolvedValue(undefined) };\n    const { getByText } = render(\n      \u003cReviewLoop options={{ \n        ...mockOptions, \n        onEvent,\n        planningState: mockPlanningState,\n        validator: mockValidatorAllValid \n      }} /\u003e\n    );\n\n    // Act - wait for validation, then select mode\n    await waitFor(() =\u003e getByText('Semi-Auto'));\n    fireEvent.click(getByText('Semi-Auto'));\n    fireEvent.click(getByText('Confirm'));\n\n    // Assert - state saved BEFORE event emitted\n    expect(mockPlanningState.save).toHaveBeenCalledWith({\n      status: 'ready',\n      chosenMode: 'semi-auto',\n    });\n    expect(onEvent).toHaveBeenCalledWith({\n      type: 'REVIEW_COMPLETE',\n      mode: 'semi-auto',\n      taskCount: expect.any(Number),\n    });\n  });\n\n  it('should emit BACK_TO_PLANNING on back action', async () =\u003e {\n    // Arrange\n    const onEvent = vi.fn();\n    const { getByText } = render(\u003cReviewLoop options={{ ...mockOptions, onEvent }} /\u003e);\n\n    // Act\n    fireEvent.click(getByText('Back to Plan'));\n\n    // Assert\n    expect(onEvent).toHaveBeenCalledWith({ type: 'BACK_TO_PLANNING' });\n  });\n\n  it('should emit FIX_APPLIED after applying fixes', async () =\u003e {\n    // Arrange\n    const onEvent = vi.fn();\n    const mockFixApplier = { applyAll: vi.fn().mockResolvedValue(3) };\n    const { getByText } = render(\n      \u003cReviewLoop options={{ ...mockOptions, onEvent, fixApplier: mockFixApplier }} /\u003e\n    );\n\n    // Act\n    await waitFor(() =\u003e getByText('Apply Fixes'));\n    fireEvent.click(getByText('Apply Fixes'));\n\n    // Assert\n    await waitFor(() =\u003e {\n      expect(onEvent).toHaveBeenCalledWith({\n        type: 'FIX_APPLIED',\n        fixCount: 3,\n      });\n    });\n  });\n\n  it('should persist state before emitting transition event', async () =\u003e {\n    // Arrange\n    const callOrder: string[] = [];\n    const onEvent = vi.fn(() =\u003e callOrder.push('event'));\n    const mockPlanningState = { \n      save: vi.fn(() =\u003e {\n        callOrder.push('save');\n        return Promise.resolve();\n      })\n    };\n    \n    const { getByText } = render(\n      \u003cReviewLoop options={{ \n        ...mockOptions, \n        onEvent,\n        planningState: mockPlanningState,\n        validator: mockValidatorAllValid \n      }} /\u003e\n    );\n\n    // Act\n    await waitFor(() =\u003e getByText('Confirm'));\n    fireEvent.click(getByText('Confirm'));\n\n    // Assert - save happens BEFORE event\n    await waitFor(() =\u003e {\n      expect(callOrder).toEqual(['save', 'event']);\n    });\n  });\n});\n```\n\n## Acceptance Criteria\n\n### Validation Loop - 5 tests\n- [ ] Runs TaskValidator on task list\n- [ ] Emits VALIDATION_STARTED before validation\n- [ ] Emits VALIDATION_COMPLETED with valid/invalid counts\n- [ ] \"Apply Fixes\" emits FIX_APPLIED event\n- [ ] \"Review Again\" increments iteration and re-validates\n\n### Iteration Tracking - 3 tests\n- [ ] Tracks and displays iteration count\n- [ ] Shows \"Iteration X/Y\" format where Y is maxIterations\n- [ ] Warns user when approaching max iterations\n\n### Mode Selection \u0026 Transition - 4 tests\n- [ ] Shows mode selection when all tasks valid\n- [ ] \"Confirm\" saves status='ready' and chosenMode to planning-state.json\n- [ ] Emits REVIEW_COMPLETE event AFTER state persisted\n- [ ] State persistence happens BEFORE event emission (order matters!)\n\n### Navigation - 3 tests\n- [ ] \"Back to Plan\" emits BACK_TO_PLANNING event\n- [ ] \"Edit Rules\" opens task-rules.md in editor\n- [ ] Changes to rules affect next validation\n\n### Summary\n- [ ] 15 tests pass\n\n## Flow with Events\n```\nValidate Tasks\n    |\n    +-- VALIDATION_STARTED event\n    |\n    +- Has Errors -\u003e Show ReviewResults\n    |                  +- Apply Fixes -\u003e FIX_APPLIED event -\u003e Re-validate\n    |                  +- Back to Plan -\u003e BACK_TO_PLANNING event\n    |\n    +- All Valid -\u003e Show Mode Selection\n                      +- Select Mode\n                           |\n                           v\n                      Save State (planning-state.json)\n                           |\n                           v\n                      REVIEW_COMPLETE event\n```\n\n## Files\n- `src/modes/ReviewLoop.tsx`\n- `tests/modes/ReviewLoop.test.tsx`\n\n## Dependencies\n- F85a (ch-5bd): ReviewResults component\n- F85b (ch-6oy): FixApplier\n- F84 (ch-2hw): TaskValidator\n- F86 (ch-to7): PlanningState (for saving state)\n\n## Implementation Notes\n- **CRITICAL:** State must be saved BEFORE emitting REVIEW_COMPLETE\n- This ensures crash recovery can restore chosen mode\n- Machine receives event and transitions INIT → IMPLEMENTATION\n- onEvent callback is provided by parent (Planning Mode Controller)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:07:38.499427+03:00","created_by":"deligoez","updated_at":"2026-01-12T03:58:54.293941+03:00","closed_at":"2026-01-12T03:58:54.293941+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-a0a","depends_on_id":"ch-5bd","type":"blocks","created_at":"2026-01-11T03:07:38.503674+03:00","created_by":"deligoez"},{"issue_id":"ch-a0a","depends_on_id":"ch-6oy","type":"blocks","created_at":"2026-01-11T03:07:38.509069+03:00","created_by":"deligoez"},{"issue_id":"ch-a0a","depends_on_id":"ch-2hw","type":"blocks","created_at":"2026-01-11T03:07:38.513445+03:00","created_by":"deligoez"},{"issue_id":"ch-a0a","depends_on_id":"ch-to7","type":"blocks","created_at":"2026-01-11T03:26:10.908243+03:00","created_by":"deligoez"}]}
{"id":"ch-a193","title":"E2E-R05: Task-Level Review Mode E2E - Label assignment affects review behavior","description":"## What\nE2E test for label-based review mode assignment.\n\n## Acceptance Criteria\n- [ ] Create task with `review:skip` label\n- [ ] Complete task, verify skips review entirely (goes straight to closed)\n- [ ] Create task with `review:per-task` label\n- [ ] Complete task, verify goes to reviewing status\n- [ ] 4 tests pass\n\n## Files\n- src/e2e/label-rules.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:14:14.596725+03:00","created_by":"deligoez","updated_at":"2026-01-12T17:15:31.444088+03:00","closed_at":"2026-01-12T17:15:31.444088+03:00","close_reason":"Closed","labels":["m13-review"],"dependencies":[{"issue_id":"ch-a193","depends_on_id":"ch-x2p1","type":"blocks","created_at":"2026-01-12T15:14:14.601339+03:00","created_by":"deligoez"},{"issue_id":"ch-a193","depends_on_id":"ch-yf1m","type":"blocks","created_at":"2026-01-12T15:14:14.606227+03:00","created_by":"deligoez"}]}
{"id":"ch-a1l6","title":"E2E-03: AgentGrid Shows Slots","description":"## What\nVerify AgentGrid shows empty slots and agent tiles.\n\n## Tests (4 tests)\n1. Shows empty slots when no agents\n2. Shows agent tile when agent running\n3. Agent tile shows task ID\n4. Agent tile shows iteration/progress\n\n## Files\n- src/e2e/agent-grid.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T21:17:46.246076+03:00","created_by":"deligoez","updated_at":"2026-01-11T22:05:25.747015+03:00","closed_at":"2026-01-11T22:05:25.747015+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-a1l6","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:17:46.248759+03:00","created_by":"deligoez"},{"issue_id":"ch-a1l6","depends_on_id":"ch-hhh","type":"blocks","created_at":"2026-01-11T21:25:08.629675+03:00","created_by":"deligoez"},{"issue_id":"ch-a1l6","depends_on_id":"ch-6rh8","type":"blocks","created_at":"2026-01-11T21:43:43.798873+03:00","created_by":"deligoez"}]}
{"id":"ch-a2zx","title":"BUG: e2e-helpers hasExited test is timing-dependent","description":"## What\nThe `hasExited` test in e2e-helpers.test.ts is skipped because it depends on process exit timing.\n\n## Skipped Test\n- `hasExited \u003e detects process exit` - waits 1000ms for process to exit, but this may not be enough\n\n## Root Cause\n- Test runs `renderApp([\"--version\"])` and waits 1000ms\n- On slower systems or under load, process may not exit in time\n- This causes flaky failures\n\n## Possible Solutions\n1. **Increase timeout** - But slows down test suite\n2. **Poll with retry** - Wait for exit with exponential backoff\n3. **Use process.on('exit')** - Event-based detection instead of polling\n\n## Acceptance Criteria\n- [ ] Test passes reliably under parallel load\n- [ ] Remove `.skip` from test method\n\n## Files\n- src/test-utils/e2e-helpers.test.ts:43","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T00:22:32.317309+03:00","created_by":"deligoez","updated_at":"2026-01-12T07:48:17.425974+03:00","closed_at":"2026-01-12T07:48:17.425974+03:00","close_reason":"Closed","labels":["m12-tui"]}
{"id":"ch-a52l","title":"TS12: Crash Recovery Service","description":"## What\nImplement crash recovery logic.\n\n## Files\n- `src/services/CrashRecovery.ts`\n- `src/services/CrashRecovery.test.ts`\n\n## Acceptance Criteria\n- [ ] `recoverOrphanedTasks(store)` finds `doing` tasks\n- [ ] Resets orphaned tasks to `todo`\n- [ ] Increments `retryCount` in execution\n- [ ] Logs `crash_recovery` event to audit\n- [ ] Returns recovery result with count and task IDs\n- [ ] 5 tests pass","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:14:41.315625+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:14:41.315625+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-a52l","depends_on_id":"ch-0qmq","type":"blocks","created_at":"2026-01-13T00:14:41.324902+03:00","created_by":"deligoez"},{"issue_id":"ch-a52l","depends_on_id":"ch-utf9","type":"blocks","created_at":"2026-01-13T00:21:31.538224+03:00","created_by":"deligoez"}]}
{"id":"ch-a555","title":"INT02: Real Agent Sprint Planning Integration Test","description":"## What\nIntegration test using real Claude agent to test sprint planning flow.\n\n## Acceptance Criteria\n- [ ] Test harness configures sprint settings\n- [ ] Real agent spawned for sprint iteration\n- [ ] Agent executes tasks from sprint backlog\n- [ ] Sprint progress tracked correctly\n- [ ] Sprint completion handled properly\n- [ ] Budget limit enforced (max 5 API calls per test)\n- [ ] Test suite skipped in CI (manual run only)\n- [ ] 3 tests pass\n\n## Notes\n- These tests use real API calls (costly and slow)\n- Run manually: `npm run test:integration -- --grep \"Sprint Planning\"`\n- Not included in `npm run test` or CI\n\n## Files\n- src/integration/real-agent-sprint.integration.test.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T16:19:17.820488+03:00","created_by":"deligoez","updated_at":"2026-01-12T18:03:08.047892+03:00","closed_at":"2026-01-12T18:03:08.047892+03:00","close_reason":"Closed","labels":["m14-integration"],"dependencies":[{"issue_id":"ch-a555","depends_on_id":"ch-ni74","type":"blocks","created_at":"2026-01-12T16:19:17.822531+03:00","created_by":"deligoez"},{"issue_id":"ch-a555","depends_on_id":"ch-p065","type":"blocks","created_at":"2026-01-12T16:19:17.824528+03:00","created_by":"deligoez"}]}
{"id":"ch-a6h","title":"F41: Learning Store - Append learnings to shared file","description":"## What\nAppend extracted learnings to .claude/rules/learnings.md with deduplication and commit.\n\n\u003e **Path Choice:** Using `.claude/rules/` allows Claude to read learnings natively without injection.\n\n## File Locations\n\n| File | Purpose |\n|------|---------|\n| `.claude/rules/learnings.md` | Human-readable learnings (git-tracked, Claude reads natively) |\n| `.claude/rules/learnings-meta.json` | Review status, dedup hashes (git-tracked) |\n\n## File Format (learnings.md)\n\n```markdown\n# Project Learnings\n\n## Performance\n- [LOCAL] mb_str_split() \u003e preg_split() for Unicode (3x faster)\n  Source: ch-001 (2026-01-09, claude)\n\n## Testing\n- [CROSS-CUTTING] Use Pest's dataset() for parameterized tests\n  Source: ch-003 (2026-01-09, claude)\n```\n\n## De-duplication Algorithm\n\n**From Master Plan:**\n\n```typescript\ninterface DeduplicationConfig {\n  algorithm: 'exact' | 'similarity';\n  threshold: number;        // 0.85 for similarity matching\n  action: 'skip' | 'merge'; // What to do with duplicates\n}\n\nconst DEFAULT_DEDUP: DeduplicationConfig = {\n  algorithm: 'similarity',\n  threshold: 0.85,\n  action: 'skip'\n};\n```\n\n**Steps:**\n1. Hash incoming: Generate SHA256 of normalized learning content\n2. Check exact match: Compare hash against `learnings-meta.json`\n3. If no exact: Run similarity check against recent learnings (last 50)\n4. If similar found: Action based on config (skip or merge)\n5. Store hash: Add to `learnings-meta.json` for future checks\n\n**Similarity Matching:**\n- Normalize text: lowercase, trimmed, stop-words removed\n- Compare against learnings from last 7 days or last 50 entries\n- Threshold 0.85 catches near-duplicates like \"add rate limiting\" vs \"implement rate limiting\"\n\n## API\n```typescript\n// src/services/LearningStore.ts\n\ninterface DeduplicationConfig {\n  algorithm: 'exact' | 'similarity';\n  threshold: number;\n  action: 'skip' | 'merge';\n}\n\nclass LearningStore {\n  constructor(\n    private repoPath: string = '.',\n    private dedupConfig: DeduplicationConfig = DEFAULT_DEDUP\n  ) {}\n\n  readonly learningsPath = '.claude/rules/learnings.md';\n  readonly metaPath = '.claude/rules/learnings-meta.json';\n\n  // Core operations\n  async append(learnings: Learning[]): Promise\u003cAppendResult\u003e;\n  async commit(taskId: string, agentType: AgentType): Promise\u003cvoid\u003e;\n  async readAll(): Promise\u003cLearning[]\u003e;\n  async getByCategory(category: string): Promise\u003cLearning[]\u003e;\n  async getByScope(scope: LearningScope): Promise\u003cLearning[]\u003e;\n  \n  // Deduplication\n  async isDuplicate(learning: Learning): Promise\u003cDuplicateCheck\u003e;\n  async calculateHash(content: string): string;\n  async checkSimilarity(content: string, existing: Learning[]): SimilarityResult | null;\n  \n  // Metadata\n  async loadMeta(): Promise\u003cLearningsMeta\u003e;\n  async saveMeta(meta: LearningsMeta): Promise\u003cvoid\u003e;\n  async markReviewed(learningId: string, reviewer: string): Promise\u003cvoid\u003e;\n  async getUnreviewed(): Promise\u003cLearning[]\u003e;\n  \n  // Initialization\n  async ensureExists(): Promise\u003cvoid\u003e;\n}\n\ninterface AppendResult {\n  added: Learning[];\n  skipped: Learning[];  // Duplicates\n  merged: Learning[];   // If action='merge'\n}\n\ninterface DuplicateCheck {\n  isDuplicate: boolean;\n  reason?: 'exact' | 'similar';\n  similarTo?: string;  // learningId\n  similarity?: number; // 0-1\n}\n```\n\n## Atomicity\n\n- `append()` writes to file + updates meta (no commit)\n- `commit()` commits both files together\n- Caller (F16a) calls: `await store.append(learnings); await store.commit(taskId, agent);`\n\n## Files\n- src/services/LearningStore.ts\n- tests/services/LearningStore.test.ts\n\n## Acceptance Criteria\n\n### Core Operations - 4 tests\n- [ ] `append()` adds formatted learnings to end of file\n- [ ] `append()` preserves existing content (reads, appends, writes)\n- [ ] `commit()` creates commit with \"learn: extract from {taskId} ({agent})\"\n- [ ] `commit()` includes both learnings.md and learnings-meta.json\n\n### Deduplication - 8 tests\n- [ ] `isDuplicate()` returns true for exact hash match\n- [ ] `isDuplicate()` returns true for similarity \u003e threshold\n- [ ] `isDuplicate()` returns false for new learning\n- [ ] `append()` skips duplicates when action='skip'\n- [ ] `append()` returns skipped learnings in result\n- [ ] `calculateHash()` normalizes content before hashing\n- [ ] `checkSimilarity()` uses Jaccard index for similarity calculation (MVP)\n- [ ] Constructor accepts configurable dedup threshold (default 0.85)\n\n### Metadata - 4 tests\n- [ ] `loadMeta()` returns LearningsMeta from JSON file\n- [ ] `saveMeta()` persists to JSON file\n- [ ] `markReviewed()` updates reviewed status in meta\n- [ ] `getUnreviewed()` returns learnings without reviewed status\n\n### Initialization - 2 tests\n- [ ] `ensureExists()` creates .claude/rules/ directory if needed\n- [ ] `ensureExists()` is idempotent\n\n### Summary\n- [ ] 18 tests pass\n\n## Notes\n- Similarity uses simple Jaccard similarity (MVP)\n- Post-MVP: Consider using embedding similarity for better matching\n- Review status used by Plan Review Trigger (F94)\n- Dedup hashes stored in learnings-meta.json\n- Claude reads .claude/rules/*.md natively - no injection needed","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T10:42:53.486064+03:00","created_by":"deligoez","updated_at":"2026-01-11T19:12:18.871465+03:00","closed_at":"2026-01-11T19:12:18.871465+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-a6h","depends_on_id":"ch-9yl","type":"blocks","created_at":"2026-01-10T10:42:53.487551+03:00","created_by":"deligoez"}]}
{"id":"ch-aap","title":"F56b: DurationDisplay Component - Format elapsed time","description":"## What\nFormat and display elapsed time from a start timestamp in human-readable format.\n\n## Context from Master Plan\n```\n│ iter 7/50 | 12m   │\n```\n\n## API\n```typescript\n// src/components/DurationDisplay.tsx\n\ninterface DurationDisplayProps {\n  startTime: number;     // Unix timestamp in ms\n  now?: number;          // Current time for testing, defaults to Date.now()\n}\n\nfunction DurationDisplay({ startTime, now }: DurationDisplayProps): JSX.Element\n```\n\n## Visual Output\n- \u003c 1 minute: `\u003c 1m`\n- 1-59 minutes: `12m`\n- 60+ minutes: `1h 15m`\n- 24+ hours: `1d 2h`\n\n## Files\n- src/components/DurationDisplay.tsx\n- src/components/DurationDisplay.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows \"\u003c 1m\" for durations under 1 minute\n- [ ] Shows \"Xm\" for minutes (1-59)\n- [ ] Shows \"Xh Ym\" for hours\n- [ ] Shows \"Xd Yh\" for days\n- [ ] Uses Ink `\u003cText dimColor\u003e` for the unit letters (m, h, d)\n- [ ] Handles future startTime (shows \"0m\")\n- [ ] Updates correctly with changing now prop\n- [ ] 7 tests pass\n\n## Tests\n1. Shows \"\u003c 1m\" for 30 seconds\n2. Shows \"1m\" for 60 seconds\n3. Shows \"12m\" for 720 seconds\n4. Shows \"1h 0m\" for 3600 seconds\n5. Shows \"1h 15m\" for 4500 seconds\n6. Shows \"1d 2h\" for 93600 seconds\n7. Handles future startTime (returns \"0m\")","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:48:34.393767+03:00","created_by":"deligoez","updated_at":"2026-01-11T20:15:12.89654+03:00","closed_at":"2026-01-11T20:15:12.89654+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-aap","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:52.823748+03:00","created_by":"deligoez"}]}
{"id":"ch-afnr","title":"BUG: E2E tests fail - app routes to init/planning mode instead of implementation","description":"## What\n106 E2E tests fail because the app routes to init or planning mode instead of implementation mode.\n\n## Root Cause\nWhen E2E tests run with renderApp(), the app:\n1. Checks for .chorus/ directory - if missing, goes to InitMode\n2. If .chorus/ exists but no saved state, goes to PlanningMode\n3. Tests expect the TUI (ImplementationMode) with task panels and agent grid\n\n## Affected Tests\n- All tests that expect to see tasks, agents, or TUI components\n- Tests using createTestProject() which only creates .beads/ not .chorus/\n\n## Evidence\n```\nError: Text \"0 tasks\" not found in output\n\n Checking project directory...\n PLANNING mode                                                Tab: switch focus\n```\n\n## Possible Solutions\n1. **Update createTestProject()** to also create .chorus/ directory\n2. **Add --mode flag support** to force implementation mode via CLI\n3. **Fix SET_MODE event** to also transition app state to implementation\n4. **Update App.tsx** to default to implementation mode in CI/test mode\n\n## Acceptance Criteria\n- [ ] E2E tests pass when using createTestProject()\n- [ ] Tests can access implementation mode TUI\n- [ ] No manual setup required for each test\n\n## Related\n- ch-211i: Fixed file watcher timing, but revealed this routing issue\n- Fresh-init tests have same issue","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T08:05:20.612242+03:00","created_by":"deligoez","updated_at":"2026-01-12T08:29:07.056565+03:00","closed_at":"2026-01-12T08:29:07.056565+03:00","close_reason":"Closed","labels":["m12-tui"]}
{"id":"ch-ah6","title":"F02a: State Types - ChorusState interface and SessionStats","description":"## What\nDefine TypeScript types for runtime state.\n\n## Implementation Note\nImplementation extends master plan with additional fields for practical orchestration:\n- `paused` (boolean) in ChorusState - for pause/resume functionality\n- `priority` (number) in MergeQueueItem - for priority-based merge ordering\n- `enqueuedAt` (timestamp) in MergeQueueItem - for FIFO ordering within same priority\n- `totalIterations` (number) in SessionStats - for session statistics\n- `startedAt` (timestamp) in ChorusState - for session start time tracking\n\n## Acceptance Criteria\n- [ ] AgentStatus is union: 'idle' | 'running' | 'paused' | 'error'\n- [ ] MergeQueueItemStatus is union: 'pending' | 'merging' | 'conflict' | 'resolving'\n- [ ] AgentState.id is required string\n- [ ] AgentState.type is 'claude' | 'codex' | 'opencode'\n- [ ] AgentState.pid is required number\n- [ ] AgentState.taskId is required string\n- [ ] AgentState.worktree is required string\n- [ ] AgentState.branch is required string\n- [ ] AgentState.iteration is required number\n- [ ] AgentState.startedAt is required number (timestamp)\n- [ ] AgentState.status is AgentStatus\n- [ ] MergeQueueItem.taskId is required string\n- [ ] MergeQueueItem.branch is required string\n- [ ] MergeQueueItem.worktree is required string\n- [ ] MergeQueueItem.priority is required number\n- [ ] MergeQueueItem.status is MergeQueueItemStatus\n- [ ] MergeQueueItem.retries is required number\n- [ ] MergeQueueItem.enqueuedAt is required number (timestamp)\n- [ ] SessionStats has tasksCompleted, tasksFailed, mergesAuto, mergesManual, totalIterations, totalRuntime (all numbers)\n- [ ] ChorusState.version is required string\n- [ ] ChorusState.sessionId is required string\n- [ ] ChorusState.startedAt is required number (timestamp)\n- [ ] ChorusState.mode is 'semi-auto' | 'autopilot'\n- [ ] ChorusState.paused is required boolean\n- [ ] ChorusState.agents is Record\u003cstring, AgentState\u003e\n- [ ] ChorusState.mergeQueue is MergeQueueItem[]\n- [ ] ChorusState.checkpoint is string | null\n- [ ] ChorusState.stats is SessionStats\n- [ ] 8 tests pass (AgentState: 3, MergeQueueItem: 2, ChorusState: 3)\n\n## Files\n- src/types/state.ts (NEW)\n\n## Implementation\n\\`\\`\\`typescript\nexport type AgentStatus = 'idle' | 'running' | 'paused' | 'error';\nexport type MergeQueueItemStatus = 'pending' | 'merging' | 'conflict' | 'resolving';\n\nexport interface AgentState {\n  id: string;\n  type: 'claude' | 'codex' | 'opencode';\n  pid: number;\n  taskId: string;\n  worktree: string;\n  branch: string;\n  iteration: number;\n  startedAt: number;\n  status: AgentStatus;\n}\n\nexport interface MergeQueueItem {\n  taskId: string;\n  branch: string;\n  worktree: string;\n  priority: number;\n  status: MergeQueueItemStatus;\n  retries: number;\n  enqueuedAt: number;\n}\n\nexport interface SessionStats {\n  tasksCompleted: number;\n  tasksFailed: number;\n  mergesAuto: number;\n  mergesManual: number;\n  totalIterations: number;\n  totalRuntime: number;\n}\n\nexport interface ChorusState {\n  version: string;\n  sessionId: string;\n  startedAt: number;\n  mode: 'semi-auto' | 'autopilot';\n  paused: boolean;\n  agents: Record\u003cstring, AgentState\u003e;\n  mergeQueue: MergeQueueItem[];\n  checkpoint: string | null;\n  stats: SessionStats;\n}\n\\`\\`\\`\n\n## Test Cases\n1. AgentState accepts object with all required fields and valid AgentStatus\n2. AgentState.type accepts only 'claude' | 'codex' | 'opencode'\n3. AgentState rejects invalid status value\n4. MergeQueueItem accepts object with all required fields and valid status\n5. MergeQueueItem rejects invalid status value\n6. SessionStats accepts object with all 6 numeric fields\n7. ChorusState accepts complete state with agents={}, mergeQueue=[], checkpoint=null\n8. ChorusState accepts complete state with populated agents and mergeQueue\n\n## Notes\n- All timestamps (startedAt, enqueuedAt) are Unix epoch milliseconds\n- ChorusState.agents uses agent.id as key\n- ChorusState.checkpoint is null when no checkpoint exists\n- ChorusState.startedAt tracks when the session began (for session duration calculation)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T01:30:38.527356+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:29:53.073021+03:00","closed_at":"2026-01-11T18:29:53.073021+03:00","close_reason":"Closed","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-ah6","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:34.549563+03:00","created_by":"deligoez"}]}
{"id":"ch-ahbp","title":"TS19b: Migrate Task Management Services","description":"## What\nUpdate task management services to use TaskStore.\n\n## Files\n- `src/services/TaskBlocker.ts`\n- `src/services/TaskUpdater.ts`\n- `src/services/DependencyResolver.ts`\n\n## Acceptance Criteria\n- [ ] TaskBlocker uses TaskStore\n- [ ] TaskUpdater uses TaskStore\n- [ ] DependencyResolver uses TaskStore\n- [ ] All existing tests pass\n- [ ] 0 new tests (existing tests validate)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:22:31.133604+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:22:31.133604+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-ahbp","depends_on_id":"ch-pe0e","type":"blocks","created_at":"2026-01-13T00:22:31.135683+03:00","created_by":"deligoez"}]}
{"id":"ch-ahq","title":"F43a: Intervention Types - Intervention interfaces and enums","description":"## What\nDefine TypeScript interfaces for human intervention system.\n\n## API\n```typescript\n// src/types/intervention.ts\n\ntype InterventionType = \n  | 'pause'\n  | 'stop_agent'\n  | 'redirect_agent'\n  | 'edit_task'\n  | 'kill_all'\n  | 'rollback'\n  | 'block_task'\n  | 'approve_merge';\n\ninterface InterventionState {\n  paused: boolean;\n  pausedAt: Date | null;\n  pendingInterventions: Intervention[];\n}\n\ninterface Intervention {\n  type: InterventionType;\n  targetAgentId?: string;\n  targetTaskId?: string;\n  timestamp: Date;\n  reason?: string;\n}\n\ninterface InterventionResult {\n  success: boolean;\n  type: InterventionType;\n  message: string;\n  affectedAgents?: string[];\n  affectedTasks?: string[];\n}\n```\n\n## Files\n- src/types/intervention.ts\n\n## Acceptance Criteria\n- [ ] `InterventionType` is union of all 8 intervention types\n- [ ] `InterventionState` has paused, pausedAt, pendingInterventions\n- [ ] `Intervention` has type, optional targets, timestamp, reason\n- [ ] `InterventionResult` has success, type, message, affected lists\n- [ ] 5 tests pass\n\n## Tests\n1. InterventionType union includes all types\n2. InterventionState has required fields\n3. Intervention has required and optional fields\n4. InterventionResult has required fields\n5. Types are exported correctly","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T10:43:19.149013+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:22:49.674693+03:00","closed_at":"2026-01-11T18:22:49.674693+03:00","close_reason":"Closed","labels":["m9-intervention"],"dependencies":[{"issue_id":"ch-ahq","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:52.204641+03:00","created_by":"deligoez"}]}
{"id":"ch-ak5","title":"F63u: Toggle Help Key (?) - Show/hide help panel","description":"## What\nKeyboard handler to toggle the help panel visibility.\n\n## Context from Master Plan\n```\nGENERAL\n?      Toggle help\n```\n\n## Shortcut\n- **?** - Toggle help panel (show/hide)\n\n## Implementation\n\n```typescript\n// src/hooks/useHelpKey.ts\n\ninterface UseHelpKeyOptions {\n  visible: boolean;\n  onToggle: () =\u003e void;\n  isDisabled?: boolean;\n}\n\nfunction useHelpKey(options: UseHelpKeyOptions) {\n  useInput((input) =\u003e {\n    if (input === '?' \u0026\u0026 !options.isDisabled) {\n      options.onToggle();\n    }\n  });\n}\n\n// Usage in App.tsx\nconst [helpVisible, setHelpVisible] = useState(false);\n\nuseHelpKey({\n  visible: helpVisible,\n  onToggle: () =\u003e setHelpVisible(!helpVisible)\n});\n\n{helpVisible \u0026\u0026 \u003cHelpPanel onClose={() =\u003e setHelpVisible(false)} /\u003e}\n```\n\n## Acceptance Criteria\n\n### Toggle Behavior - 3 tests\n- [ ] '?' key when help hidden → shows help panel\n- [ ] '?' key when help visible → hides help panel\n- [ ] ESC key inside help panel also closes it\n\n### Modal Exclusivity - 2 tests\n- [ ] No-op when intervention panel is open\n- [ ] Closes other panels when help opens (optional)\n\n### Visual - 2 tests\n- [ ] Help panel renders with all keyboard shortcuts (from F61c)\n- [ ] Help panel styled as overlay\n\n### Summary\n- [ ] 7 tests pass\n\n## Files\n- src/hooks/useHelpKey.ts (NEW)\n- src/hooks/useHelpKey.test.ts (NEW)\n\n## Dependencies\n- F61c (HelpPanel Enhanced) for the panel content\n\n## Notes\n- '?' requires Shift on most keyboards\n- Help panel shows all shortcuts grouped by category\n- Same key toggles (not separate open/close keys)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T12:44:37.964504+03:00","created_by":"deligoez","updated_at":"2026-01-12T05:03:53.83718+03:00","closed_at":"2026-01-12T05:03:53.83718+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-ak5","depends_on_id":"ch-2po","type":"blocks","created_at":"2026-01-11T12:44:37.966359+03:00","created_by":"deligoez"}]}
{"id":"ch-akb","title":"F63a: Tab Panel Switch - Switch focus between TaskPanel and AgentGrid","description":"## What\nKeyboard handler for Tab key to switch focus between TaskPanel (left) and AgentGrid (right).\n\n## Focus Architecture Note\n**Focus state is managed internally by TwoColumnLayout** - this hook just calls the toggleFocus callback exposed by TwoColumnLayout. The component owns the state, we just trigger the toggle.\n\n## Shortcut\n- **Tab** - Switch focus between panels\n\n## Implementation\n```typescript\n// src/hooks/useKeyboard.ts - uses ink's useInput\nimport { useInput } from 'ink';\n\nexport function useKeyboard(options: UseKeyboardOptions) {\n  useInput((input, key) =\u003e {\n    if (key.tab) {\n      options.onPanelSwitch?.();\n    }\n  });\n}\n\ninterface UseKeyboardOptions {\n  onPanelSwitch?: () =\u003e void;\n  // ... other options\n}\n```\n\n```typescript\n// Usage in TwoColumnLayout.tsx\n// Note: TwoColumnLayout manages focus internally, we just call its callback\n\u003cTwoColumnLayout \n  left={taskPanel}\n  right={agentGrid}\n  onToggleFocus={(newFocus) =\u003e {\n    // Parent can observe focus changes if needed\n    console.log('Focus moved to:', newFocus);\n  }}\n/\u003e\n\n// Keyboard hook calls the toggle (TwoColumnLayout handles the state change)\nuseKeyboard({\n  onPanelSwitch: () =\u003e twoColumnRef.current?.toggleFocus()\n});\n```\n\n## Behavior\n- Tab toggles focus between left (TaskPanel) and right (AgentGrid)\n- Focused panel has highlighted border (borderColor: 'cyan' vs 'gray')\n- Keyboard navigation (j/k) applies to focused panel\n\n## Files\n- src/hooks/useKeyboard.ts (UPDATE)\n- src/hooks/useKeyboard.test.ts (UPDATE)\n- src/components/TwoColumnLayout.tsx (UPDATE for focus styling)\n\n## Acceptance Criteria\n- [ ] `useInput` detects `key.tab` and calls `onPanelSwitch()`\n- [ ] Focus state toggles between 'left' and 'right'\n- [ ] Focused panel border has color=\"cyan\"\n- [ ] Unfocused panel border has color=\"gray\"\n\n### Summary\n- [ ] 4 tests pass\n\n## Test Cases\n1. Tab key calls onPanelSwitch callback\n2. Focus state toggles left-\u003eright-\u003eleft\n3. Focused panel renders with cyan border\n4. Unfocused panel renders with gray border","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T21:52:36.187319+03:00","created_by":"deligoez","updated_at":"2026-01-11T23:20:22.358106+03:00","closed_at":"2026-01-11T23:20:22.358106+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-akb","depends_on_id":"ch-73t","type":"blocks","created_at":"2026-01-10T21:52:41.338248+03:00","created_by":"deligoez"},{"issue_id":"ch-akb","depends_on_id":"ch-89dk","type":"blocks","created_at":"2026-01-11T14:37:28.063956+03:00","created_by":"deligoez"}]}
{"id":"ch-amw","title":"F57a: HeaderBar Component - Full header with all elements","description":"## What\nComplete header bar composing title, version, ModeIndicator, AgentSlotsCounter, and help hint.\n\n## Migration Note\n**This component replaces the top portion of existing StatusBar.tsx**\n- Existing: StatusBar shows \"Chorus\" + counts + quit hint\n- New: HeaderBar shows version, mode, slots, help hint\n- After implementing HeaderBar, update Layout.tsx to use HeaderBar instead of StatusBar\n\n## Context from Master Plan\n```\n┌───────────────────────────────────────────────────────────────────────────┐\n│ CHORUS v2.0                      semi-auto ● 3/50              ? for help │\n└───────────────────────────────────────────────────────────────────────────┘\n```\n\n## API\n```typescript\n// src/components/HeaderBar.tsx\n\ninterface HeaderBarProps {\n  version?: string;         // e.g., \"2.0\"\n  mode: 'semi-auto' | 'autopilot';\n  runningAgents: number;\n  maxAgents: number;\n  showHelp?: boolean;       // default true\n}\n\nfunction HeaderBar({ version, mode, runningAgents, maxAgents, showHelp = true }: HeaderBarProps): JSX.Element\n```\n\n## Visual Layout\n```\nCHORUS v2.0                      semi-auto ● 3/50              ? for help\n[title] [version]                [ModeIndicator] [AgentSlotsCounter]        [help hint]\n```\n\n## Color Specs (Ink)\n- \"CHORUS\" title: bold, color=\"cyan\"\n- Version: color=\"gray\"\n- Help hint \"? for help\": dimColor\n\n## Files\n- src/components/HeaderBar.tsx\n- src/components/HeaderBar.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows \"CHORUS\" title in bold cyan (bold, color=\"cyan\")\n- [ ] Shows version (e.g., \"v2.0\") in gray when provided\n- [ ] Renders ModeIndicator with mode prop\n- [ ] Renders AgentSlotsCounter with runningAgents and maxAgents props\n- [ ] Shows \"? for help\" hint with dimColor when showHelp=true\n- [ ] Uses flexbox with justifyContent=\"space-between\"\n- [ ] Title on left, mode/slots in center, help on right\n- [ ] Handles missing version (shows only \"CHORUS\")\n- [ ] Hides help hint when showHelp=false\n- [ ] Passes correct props to child components\n- [ ] 10 tests pass\n\n## Tests\n1. Shows \"CHORUS\" title in bold cyan\n2. Shows version in gray when provided\n3. Hides version when not provided\n4. Renders ModeIndicator with correct mode\n5. Renders AgentSlotsCounter with correct counts\n6. Shows help hint with dimColor\n7. Hides help hint when showHelp=false\n8. Uses space-between layout\n9. Passes correct props to ModeIndicator\n10. Passes correct props to AgentSlotsCounter","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:48:59.83796+03:00","created_by":"deligoez","updated_at":"2026-01-11T20:32:03.340018+03:00","closed_at":"2026-01-11T20:32:03.340018+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-amw","depends_on_id":"ch-mnd","type":"blocks","created_at":"2026-01-10T12:48:59.840343+03:00","created_by":"deligoez"},{"issue_id":"ch-amw","depends_on_id":"ch-3na","type":"blocks","created_at":"2026-01-10T12:48:59.842325+03:00","created_by":"deligoez"}]}
{"id":"ch-ap44","title":"TS10-E2E-PARALLEL: Parallel Agent Selection Tests","description":"## What\nE2E tests for parallel agent coordination.\n\n## Files\n- `src/e2e/taskstore-parallel-selection.e2e.test.ts`\n\n## Acceptance Criteria\n- [ ] Two agents claim different tasks concurrently\n- [ ] `excludeIds` prevents double-claiming\n- [ ] Race condition throws on double-claim attempt\n- [ ] 3 tests pass","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:14:15.861711+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:14:15.861711+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-ap44","depends_on_id":"ch-hlgm","type":"blocks","created_at":"2026-01-13T00:14:15.863462+03:00","created_by":"deligoez"}]}
{"id":"ch-azf","title":"F32c: RalphLoop Error Handling","description":"## What\nRalphLoop error handling: error events, error thresholds, disk full detection, recovery behavior, config-driven timeouts.\n\n## Context from Master Plan - Error Handling Matrix\n```\n│ Error                │ Detection         │ Recovery             │\n├──────────────────────┼───────────────────┼──────────────────────┤\n│ Disk full            │ ENOSPC            │ Alert, pause         │\n```\n\n## Acceptance Criteria\n\n### Error Events - 2 tests\n- [ ] `processLoop()` emits \"error\" event with Error object on assignment failure\n- [ ] `processLoop()` continues loop after error (catches, emits, continues)\n\n### Error Threshold - 3 tests\n- [ ] `processLoop()` pauses after 3 consecutive errors\n- [ ] `processLoop()` emits \"errorThreshold\" event with consecutiveErrors and lastError\n- [ ] `processLoop()` waits for `resume()` call before continuing after \"errorThreshold\"\n\n### Disk Full Handling - 3 tests\n- [ ] `processLoop()` detects ENOSPC error code from git/file operations\n- [ ] `processLoop()` emits \"diskFull\" event with error details\n- [ ] `processLoop()` auto-pauses on disk full (no resume until space freed)\n\n### Config Items - 3 tests\n- [ ] Respects `config.completion.maxIterations` (default 50)\n- [ ] Respects `config.completion.taskTimeout` (default 1800000ms = 30min)\n- [ ] Emits \"taskTimeout\" when task exceeds timeout\n\n### Summary\n- [ ] 11 tests pass\n\n## Event Specifications\n```typescript\ninterface RalphLoopErrorEvents {\n  \"error\": (error: Error) =\u003e void;\n  \"errorThreshold\": (consecutiveErrors: number, lastError: Error) =\u003e void;\n  \"diskFull\": (error: Error \u0026 { code: 'ENOSPC' }) =\u003e void;\n  \"taskTimeout\": (taskId: string, reason: 'iterations' | 'time') =\u003e void;\n}\n```\n\n## API\n```typescript\nclass RalphLoop {\n  // ... existing from F32b\n  \n  // Error state\n  private consecutiveErrors: number = 0;\n  private isPaused: boolean = false;\n  private isDiskFull: boolean = false;\n  \n  // Resume after error threshold\n  resume(): void;\n  \n  // Check if paused due to disk full\n  isDiskFullPause(): boolean;\n}\n```\n\n## Disk Full Detection\n```typescript\nprivate isDiskFullError(error: unknown): boolean {\n  if (error instanceof Error) {\n    const nodeError = error as NodeJS.ErrnoException;\n    return nodeError.code === 'ENOSPC';\n  }\n  return false;\n}\n```\n\n## Dependencies\n- F32b RalphLoop Core (ch-3pa)\n\n## Files\n- src/services/RalphLoop.ts (UPDATE)\n- src/services/RalphLoop.test.ts (UPDATE)\n\n## Notes\n- Adds to existing RalphLoop class from F32b\n- Consecutive error counter resets on success\n- Human must call resume() to continue after threshold\n- Disk full requires freeing space before resume can work\n- ENOSPC is the POSIX error code for \"No space left on device\"\n- **Deferred filtering handled in F32b via Orchestrator.getReadyTasks() - no test needed here**","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T23:51:57.87225+03:00","created_by":"deligoez","updated_at":"2026-01-12T06:50:49.079427+03:00","closed_at":"2026-01-12T06:50:49.079427+03:00","close_reason":"Closed","labels":["m7-autopilot"],"dependencies":[{"issue_id":"ch-azf","depends_on_id":"ch-3pa","type":"blocks","created_at":"2026-01-10T23:51:57.874864+03:00","created_by":"deligoez"}]}
{"id":"ch-b5x","title":"F52: Hook Types - Hook event and handler interfaces","description":"## What\nDefine TypeScript interfaces for the Chorus hooks system.\n\n## API\n```typescript\n// src/types/hooks.ts\n\ntype HookEvent = \n  | 'pre-agent-start'\n  | 'post-agent-start'\n  | 'pre-task-claim'\n  | 'post-task-claim'\n  | 'pre-iteration'\n  | 'post-iteration'\n  | 'pre-task-complete'\n  | 'post-task-complete'\n  | 'pre-merge'\n  | 'post-merge'\n  | 'on-agent-error'\n  | 'on-agent-timeout'\n  | 'on-conflict';\n\ninterface HookInput {\n  event: HookEvent;               // Always present\n\n  agent?: {\n    id: string;                   // e.g., \"claude-ch-001\"\n    type: AgentType;              // \"claude\" | \"codex\" | \"opencode\"\n    worktree: string;             // e.g., \".worktrees/claude-ch-001\"\n    pid?: number;                 // Process ID (post-start only)\n  };\n\n  task?: {\n    id: string;                   // e.g., \"ch-001\"\n    title: string;\n    status: TaskStatus;\n    priority: number;             // P1=1, P2=2, etc.\n    labels: string[];\n  };\n\n  iteration?: {\n    number: number;               // Current iteration (1-based)\n    maxIterations: number;        // Config limit\n  };\n\n  output?: {\n    stdout: string;               // Last N lines of agent output\n    stderr?: string;              // If any\n    exitCode: number;             // 0 = success\n    signal?: Signal;              // Parsed \u003cchorus\u003e...\u003c/chorus\u003e if present\n  };\n\n  merge?: {\n    branch: string;               // e.g., \"agent/claude/ch-001\"\n    targetBranch: string;         // e.g., \"main\"\n    conflictFiles?: string[];     // Only for on-conflict\n  };\n\n  error?: {\n    message: string;\n    stack?: string;\n    code?: string;\n  };\n}\n\ninterface HookOutput {\n  result: 'continue' | 'block' | 'complete';\n  message?: string;\n}\n\ninterface HookHandler {\n  event: HookEvent;\n  command: string;\n  timeout?: number;               // Override default (30000ms)\n  continueOnFailure?: boolean;    // Override default (true)\n}\n\ninterface HookConfig {\n  timeout: number;                // Default: 30000\n  retryOnError: boolean;          // Default: false\n  maxRetries: number;             // Default: 1\n  continueOnFailure: boolean;     // Default: true\n}\n```\n\n## Input Fields by Event (from Master Plan)\n\n| Hook Event | agent | task | iteration | output | merge | error |\n|------------|:-----:|:----:|:---------:|:------:|:-----:|:-----:|\n| pre-agent-start | ✓ | ✓ | - | - | - | - |\n| post-agent-start | ✓ | ✓ | - | - | - | - |\n| pre-task-claim | - | ✓ | - | - | - | - |\n| post-task-claim | ✓ | ✓ | - | - | - | - |\n| pre-iteration | ✓ | ✓ | ✓ | - | - | - |\n| post-iteration | ✓ | ✓ | ✓ | ✓ | - | - |\n| pre-task-complete | ✓ | ✓ | ✓ | ✓ | - | - |\n| post-task-complete | ✓ | ✓ | ✓ | ✓ | - | - |\n| pre-merge | ✓ | ✓ | - | - | ✓ | - |\n| post-merge | ✓ | ✓ | - | - | ✓ | - |\n| on-agent-error | ✓ | ✓ | ✓ | ✓ | - | ✓ |\n| on-agent-timeout | ✓ | ✓ | ✓ | ✓ | - | - |\n| on-conflict | ✓ | ✓ | - | - | ✓ | - |\n\n## Files\n- src/types/hooks.ts\n\n## Acceptance Criteria\n- [ ] `HookEvent` is union of all 13 event types\n- [ ] `HookInput` has event field (always required)\n- [ ] `HookInput.agent` has id, type, worktree, optional pid\n- [ ] `HookInput.task` has id, title, status, priority, labels\n- [ ] `HookInput.iteration` has number, maxIterations\n- [ ] `HookInput.output` has stdout, optional stderr, exitCode, optional signal\n- [ ] `HookInput.merge` has branch, targetBranch, optional conflictFiles\n- [ ] `HookInput.error` has message, optional stack, optional code\n- [ ] `HookOutput` has result and optional message\n- [ ] `HookHandler` has event, command, optional timeout/continueOnFailure\n- [ ] `HookConfig` has timeout, retryOnError, maxRetries, continueOnFailure\n- [ ] 11 tests pass\n\n## Tests\n1. HookEvent union includes all 13 events\n2. HookInput.agent has all fields\n3. HookInput.task has all fields including priority/labels\n4. HookInput.iteration has all fields\n5. HookInput.output has all fields including signal\n6. HookInput.merge has all fields\n7. HookInput.error has all fields\n8. HookOutput has required fields\n9. HookHandler has required and optional fields\n10. HookConfig has all fields\n11. Types are exported correctly","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T10:45:17.738244+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:31:14.965683+03:00","closed_at":"2026-01-11T18:31:14.965683+03:00","close_reason":"Closed","labels":["m11-hooks"],"dependencies":[{"issue_id":"ch-b5x","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:52.417901+03:00","created_by":"deligoez"}]}
{"id":"ch-b8l","title":"F63p: Navigation Keys (j/k/↓/↑) - List navigation in TaskPanel and AgentGrid","description":"## What\nKeyboard handlers for navigating up/down in TaskPanel and AgentGrid lists.\n\n## Context from Master Plan\n```\nNAVIGATION\nj/↓  Move down\nk/↑  Move up\n```\n\n## Shortcuts\n- **j** or **↓** - Move selection down in current panel\n- **k** or **↑** - Move selection up in current panel\n\n## Important Note\nNavigation keys (j/k) apply only to the currently focused panel.\nFocus is managed by F63a Tab Panel Switch - this hook receives isActive prop from parent to know if the panel is focused.\n\n## Implementation\n\n```typescript\n// src/hooks/useNavigationKeys.ts\n\ninterface UseNavigationKeysOptions {\n  itemCount: number;\n  selectedIndex: number;\n  onSelect: (index: number) =\u003e void;\n  isActive?: boolean;  // Only respond when panel is focused\n}\n\nfunction useNavigationKeys(options: UseNavigationKeysOptions) {\n  useInput((input, key) =\u003e {\n    if (!options.isActive) return;\n    \n    if (input === 'j' || key.downArrow) {\n      const next = Math.min(options.selectedIndex + 1, options.itemCount - 1);\n      options.onSelect(next);\n    }\n    \n    if (input === 'k' || key.upArrow) {\n      const prev = Math.max(options.selectedIndex - 1, 0);\n      options.onSelect(prev);\n    }\n  });\n}\n```\n\n## Acceptance Criteria\n\n### Down Navigation (j/↓) - 4 tests\n- [ ] `j` key increments selectedIndex by 1\n- [ ] `↓` arrow key increments selectedIndex by 1\n- [ ] Stops at last item (itemCount - 1), does not wrap\n- [ ] No-op when `isActive=false`\n\n### Up Navigation (k/↑) - 4 tests\n- [ ] `k` key decrements selectedIndex by 1\n- [ ] `↑` arrow key decrements selectedIndex by 1\n- [ ] Stops at first item (0), does not wrap\n- [ ] No-op when `isActive=false`\n\n### Edge Cases - 2 tests\n- [ ] Empty list (itemCount=0) - no navigation, no crash\n- [ ] Single item list (itemCount=1) - both keys are no-op\n\n### Summary\n- [ ] 10 tests pass\n\n## Files\n- src/hooks/useNavigationKeys.ts (NEW)\n- src/hooks/useNavigationKeys.test.ts (NEW)\n\n## Dependencies\nNone - this is a foundational hook\n\n## Notes\n- Used by TaskPanel and AgentGrid components\n- Panel focus determined by Tab key (F63a)\n- vim-style (j/k) and arrow keys both work\n- No wrap-around: reaches end = stops","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T12:43:17.384343+03:00","created_by":"deligoez","updated_at":"2026-01-11T23:22:18.264535+03:00","closed_at":"2026-01-11T23:22:18.264535+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-b8l","depends_on_id":"ch-akb","type":"blocks","created_at":"2026-01-11T14:13:26.092918+03:00","created_by":"deligoez"},{"issue_id":"ch-b8l","depends_on_id":"ch-89dk","type":"blocks","created_at":"2026-01-11T14:37:28.14887+03:00","created_by":"deligoez"}]}
{"id":"ch-bi8b","title":"TS20b: Migrate Beads Unit Tests","description":"## What\nUpdate unit tests that mock BeadsCLI.\n\n## Files to update\n- Any test file importing from `BeadsCLI` or `BeadsService`\n- Test fixtures using Bead types\n\n## Acceptance Criteria\n- [ ] All mocks use Task/TaskStore types\n- [ ] No Bead type imports remain\n- [ ] All unit tests pass\n- [ ] 0 new tests (migration task)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-13T00:16:15.254497+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:16:15.254497+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-bi8b","depends_on_id":"ch-bvgp","type":"blocks","created_at":"2026-01-13T00:16:26.733543+03:00","created_by":"deligoez"}]}
{"id":"ch-bmx","title":"F95: Plan Review Loop","description":"## What\nExecute Plan Agent review loop with early termination when no changes detected.\n\n## Why\nIterative refinement ensures all affected tasks are updated, but stops when converged.\n\n## Acceptance Criteria\n- [ ] `runPlanReviewLoop(learning, config)` executes review iterations\n- [ ] Spawns Plan Agent with review prompt (includes learning + all non-closed tasks)\n- [ ] Parses Plan Agent JSON response: `{ updates: [], redundant: [], unchanged: [] }`\n- [ ] Terminates when `updates.length === 0` (no changes in iteration)\n- [ ] Terminates when iteration count reaches `config.maxIterations`\n- [ ] Returns aggregated results from all iterations\n- [ ] Logs each iteration to session log (iteration number, changes count)\n- [ ] 8 tests pass\n\n## Interface\n```typescript\ninterface PlanReviewResult {\n  iterations: number;\n  totalUpdates: TaskUpdate[];\n  redundantTasks: string[];\n  earlyStop: boolean;\n}\n\nasync function runPlanReviewLoop(\n  learning: CategorizedLearning,\n  config: PlanReviewConfig\n): Promise\u003cPlanReviewResult\u003e;\n```\n\n## Files\n- src/services/PlanReviewLoop.ts\n- tests/services/PlanReviewLoop.test.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-11T08:44:13.148283+03:00","created_by":"deligoez","updated_at":"2026-01-12T12:23:07.093165+03:00","closed_at":"2026-01-12T12:23:07.093165+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-bmx","depends_on_id":"ch-cjf","type":"blocks","created_at":"2026-01-11T08:44:13.152682+03:00","created_by":"deligoez"},{"issue_id":"ch-bmx","depends_on_id":"ch-z8g","type":"blocks","created_at":"2026-01-11T08:44:13.155181+03:00","created_by":"deligoez"}]}
{"id":"ch-bny","title":"F63o: TUI Exit Handler (q) - Quit with confirmation and grace period","description":"## What\nKeyboard handler for 'q' key to quit TUI with confirmation dialog when agents are running.\n\n## Context from Master Plan\n```\nKeyboard Shortcuts:\n  q      Quit (confirm if agents)\n\nEdge Cases \u0026 Behaviors:\n| TUI Exit with Running Agents | Prompt: \"Kill all agents or let them continue?\" \n|                              | Grace period 30s, then force-kill |\n```\n\n## Shortcut\n- **q** - Quit TUI (with confirmation if agents running)\n\n## API\n```typescript\n// src/hooks/useExitHandler.ts\n\ninterface UseExitHandlerOptions {\n  agentStopper: AgentStopper;\n  slotManager: SlotManager;\n  onExit: () =\u003e void;\n}\n\ninterface ExitDialogState {\n  visible: boolean;\n  countdown: number;  // seconds remaining\n  action: 'pending' | 'killing' | 'waiting';\n}\n\nfunction useExitHandler(options: UseExitHandlerOptions): {\n  dialogState: ExitDialogState;\n  confirmKill: () =\u003e void;\n  confirmWait: () =\u003e void;\n  cancelExit: () =\u003e void;\n}\n```\n\n## Behavior Flow\n```\nq pressed\n    │\n    ├── No agents running? → Exit immediately\n    │\n    └── Agents running? → Show confirmation dialog\n                              │\n                              ├── [k] Kill all → stopAll() → Exit\n                              │\n                              ├── [w] Wait → Let agents finish → Exit when done\n                              │\n                              └── [ESC] Cancel → Close dialog\n                              \n                              Grace period: 30s countdown\n                              After 30s → Force kill → Exit\n```\n\n## Confirmation Dialog\n```\n┌─────────────────────────────────────────┐\n│         EXIT CHORUS?                    │\n├─────────────────────────────────────────┤\n│                                         │\n│ 2 agents are still running.             │\n│                                         │\n│ [k] Kill all agents and exit            │\n│ [w] Wait for agents to finish           │\n│ [ESC] Cancel                            │\n│                                         │\n│ Auto-kill in: 28s                       │\n└─────────────────────────────────────────┘\n```\n\n## Files\n- src/hooks/useExitHandler.ts (NEW)\n- src/hooks/useExitHandler.test.ts (NEW)\n- src/components/ExitDialog.tsx (NEW)\n- src/components/ExitDialog.test.tsx (NEW)\n\n## Acceptance Criteria\n\n### No Agents Running - 2 tests\n- [ ] 'q' key exits immediately when no agents running\n- [ ] Calls onExit() without showing dialog\n\n### Confirmation Dialog - 4 tests\n- [ ] 'q' key shows dialog when agents running\n- [ ] Dialog shows agent count\n- [ ] 'k' key calls agentStopper.stopAll() then onExit()\n- [ ] 'w' key sets action to 'waiting' (exit when agents done)\n\n### Grace Period - 3 tests\n- [ ] Countdown starts at 30 seconds\n- [ ] Countdown decrements every second\n- [ ] After countdown reaches 0, force-kills and exits\n\n### Cancel - 2 tests\n- [ ] ESC key closes dialog without exiting\n- [ ] Dialog state resets on cancel\n\n### Wait Mode - 2 tests\n- [ ] In 'waiting' mode, monitors slot manager for empty slots\n- [ ] Exits automatically when all agents finish\n\n### Summary\n- [ ] 13 tests pass\n\n## Tests\n1. q exits immediately without agents\n2. Calls onExit directly when no agents\n3. q shows dialog when agents running\n4. Dialog shows correct agent count\n5. k key kills all and exits\n6. w key sets waiting mode\n7. Countdown starts at 30\n8. Countdown decrements each second\n9. Force-kills at countdown 0\n10. ESC closes dialog\n11. State resets on cancel\n12. Waiting mode monitors slots\n13. Auto-exits when agents finish in wait mode\n\n## Notes\n- Grace period (30s) is hardcoded, could be configurable in future\n- Force-kill uses SIGKILL after SIGTERM timeout\n- Waiting mode shows different UI: \"Waiting for agents to finish...\"","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T12:28:36.317858+03:00","created_by":"deligoez","updated_at":"2026-01-12T08:39:57.664511+03:00","closed_at":"2026-01-12T08:39:57.664511+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-bny","depends_on_id":"ch-cwy","type":"blocks","created_at":"2026-01-11T12:28:36.322209+03:00","created_by":"deligoez"},{"issue_id":"ch-bny","depends_on_id":"ch-89dk","type":"blocks","created_at":"2026-01-11T14:37:28.233581+03:00","created_by":"deligoez"}]}
{"id":"ch-boum","title":"E2E-63: Merge Conflict Resolver Agent","description":"## What\nE2E tests for spawning resolver agent when auto-resolution fails.\n\n## Acceptance Criteria\n- [ ] Merge conflict detected by MergeWorker\n- [ ] Conflict classified (simple/medium/complex)\n- [ ] Resolver agent spawned with conflict context\n- [ ] Agent modifies files to resolve conflict\n- [ ] Merge re-attempted after agent completes\n- [ ] If resolver fails, escalates to human\n- [ ] Resolver respects maxIterations\n- [ ] 7 tests pass\n\n## Files\n- src/e2e/conflict-resolver.e2e.test.ts\n\n## Implementation Notes\n- Use setupMergeConflict() helper\n- Create different conflict types","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T00:39:55.173387+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:23:08.878085+03:00","closed_at":"2026-01-12T01:23:08.878085+03:00","close_reason":"Closed","labels":["m5-merge"],"dependencies":[{"issue_id":"ch-boum","depends_on_id":"ch-7pb","type":"blocks","created_at":"2026-01-12T00:39:55.17525+03:00","created_by":"deligoez"},{"issue_id":"ch-boum","depends_on_id":"ch-xn6","type":"blocks","created_at":"2026-01-12T00:39:55.177787+03:00","created_by":"deligoez"},{"issue_id":"ch-boum","depends_on_id":"ch-9sj","type":"blocks","created_at":"2026-01-12T00:39:55.180018+03:00","created_by":"deligoez"},{"issue_id":"ch-boum","depends_on_id":"ch-26c","type":"blocks","created_at":"2026-01-12T00:39:55.18218+03:00","created_by":"deligoez"}]}
{"id":"ch-bq40","title":"E2E-21: Intervention Menu (i key)","description":"## What\nE2E test for intervention menu toggle with 'i' key.\n\n## Acceptance Criteria\n- [ ] Pressing 'i' opens intervention menu modal\n- [ ] Modal shows intervention options (stop, redirect, block)\n- [ ] Pressing 'i' again closes menu\n- [ ] Pressing Escape closes menu\n- [ ] Arrow keys navigate menu options\n- [ ] Enter selects focused option\n- [ ] 6 tests pass\n\n## Test Cases\n1. `it('opens intervention menu when i is pressed')`\n2. `it('closes menu when i is pressed again')`\n3. `it('closes menu when Escape is pressed')`\n4. `it('navigates options with arrow keys')`\n5. `it('selects option with Enter')`\n6. `it('shows correct menu options')`\n\n## Files\n- tests/e2e/intervention-menu.test.ts\n\n## Dependencies\n- ch-0e01 (E2E Infrastructure)\n- ch-6n5 (F63t Intervention Menu Key)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:20:29.075372+03:00","created_by":"deligoez","updated_at":"2026-01-12T07:46:24.591449+03:00","closed_at":"2026-01-12T07:46:24.591449+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-bq40","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:20:29.078074+03:00","created_by":"deligoez"},{"issue_id":"ch-bq40","depends_on_id":"ch-6n5","type":"blocks","created_at":"2026-01-11T21:20:29.080185+03:00","created_by":"deligoez"}]}
{"id":"ch-bvgp","title":"TS20a: Migrate Beads E2E Tests","description":"## What\nMigrate or remove Beads-specific E2E tests.\n\n## Files to update/delete\n- `src/e2e/beads-cli.e2e.test.ts` → Delete or migrate to TaskStore\n- `src/e2e/fresh-init.e2e.test.ts` → Update for TaskStore\n- Any test using `createTestProject()` with Beads\n\n## Acceptance Criteria\n- [ ] E2E tests use TaskStore instead of Beads\n- [ ] `createTestProject()` creates `.chorus/` structure\n- [ ] All E2E tests pass\n- [ ] 0 new tests (migration task)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-13T00:16:14.08517+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:16:14.08517+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-bvgp","depends_on_id":"ch-1x96","type":"blocks","created_at":"2026-01-13T00:16:14.086914+03:00","created_by":"deligoez"}]}
{"id":"ch-c2p","title":"F59e: AgentTile Composed - Complete agent tile component","description":"## What\nComplete AgentTile composing header, progress, and output sections.\n\n## Context from Master Plan\n```\n┌───────────────────┐\n│ CLAUDE (ch-001)   │\n│ iter 7/50 | 12m   │\n│ ▓▓▓▓░░░░░░ 35%    │\n│                   │\n│ Reading auth...   │\n│ $ npm test        │\n│ ✓ 47 tests passed │\n└───────────────────┘\n```\n\n## API\n```typescript\n// src/components/AgentTile.tsx\n\ninterface AgentTileProps {\n  agent: {\n    id: string;\n    type: 'claude' | 'codex' | 'opencode';\n    taskId: string;\n    status: 'running' | 'idle' | 'paused' | 'error';\n    iteration: number;\n    maxIterations: number;\n    startTime: number;\n    statusText?: string;\n    lastCommand?: string;\n    testResult?: { passed: number; failed: number; };\n  };\n  isSelected?: boolean;\n  width?: number;\n}\n\nfunction AgentTile({ agent, isSelected = false, width }: AgentTileProps): JSX.Element\n```\n\n## Border Specs (Ink)\n- Default: borderStyle=\"single\", borderColor=\"gray\"\n- Selected: borderStyle=\"double\", borderColor=\"cyan\"\n- Error status: borderColor=\"red\" (regardless of selected)\n\n## Files\n- src/components/AgentTile.tsx\n- src/components/AgentTile.test.tsx\n\n## Acceptance Criteria\n- [ ] Composes AgentTileHeader with agent.type, agent.taskId, agent.status\n- [ ] Composes AgentTileProgress with iteration, maxIterations, startTime\n- [ ] Composes AgentTileOutput with statusText, lastCommand, testResult\n- [ ] Has single gray border by default (borderStyle=\"single\", borderColor=\"gray\")\n- [ ] Has double cyan border when selected (borderStyle=\"double\", borderColor=\"cyan\")\n- [ ] Shows \"starting...\" when iteration=0 (passed to AgentTileOutput.statusText)\n- [ ] Has red border when status='error' (borderColor=\"red\")\n- [ ] Respects width prop for box sizing\n- [ ] Passes correct props to child components\n- [ ] 9 tests pass\n\n## Tests\n1. Renders AgentTileHeader with correct props\n2. Renders AgentTileProgress with correct props\n3. Renders AgentTileOutput with correct props\n4. Has single gray border by default\n5. Has double cyan border when selected\n6. Shows \"starting...\" when iteration=0\n7. Has red border when status='error'\n8. Handles missing optional fields (statusText, lastCommand, testResult)\n9. Respects width prop","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:49:58.609321+03:00","created_by":"deligoez","updated_at":"2026-01-11T20:28:12.50742+03:00","closed_at":"2026-01-11T20:28:12.50742+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-c2p","depends_on_id":"ch-j0z","type":"blocks","created_at":"2026-01-10T12:49:58.611565+03:00","created_by":"deligoez"},{"issue_id":"ch-c2p","depends_on_id":"ch-7ki","type":"blocks","created_at":"2026-01-10T12:50:18.171974+03:00","created_by":"deligoez"},{"issue_id":"ch-c2p","depends_on_id":"ch-49w","type":"blocks","created_at":"2026-01-10T12:50:18.263337+03:00","created_by":"deligoez"}]}
{"id":"ch-c3q","title":"F97: Plan Review Integration","description":"## What\nIntegrate Plan Review into post-task-complete flow.\n\n## Why\nPlan Review should automatically trigger after task completion when cross-cutting learnings are discovered.\n\n## Acceptance Criteria\n- [ ] Hooks into post-task-complete event\n- [ ] Extracts and categorizes learning from completed task\n- [ ] Checks if review should trigger (via F94)\n- [ ] Runs review loop if triggered (via F95)\n- [ ] Applies updates to open tasks immediately\n- [ ] Queues updates for in_progress tasks (via F96)\n- [ ] Logs complete pipeline to session log\n- [ ] Gracefully handles errors at each stage\n- [ ] 10 tests pass\n\n## Flow\n```\npost-task-complete hook\n    ↓\nextractLearnings() → categorizeLearning()\n    ↓\nshouldTriggerReview()?\n    ↓ yes\nrunPlanReviewLoop()\n    ↓\nFor each update:\n├── Task open? → applyUpdate() immediately\n└── Task in_progress? → queue for next iteration\n```\n\n## Files\n- src/services/PlanReviewIntegration.ts\n- tests/services/PlanReviewIntegration.test.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-11T08:44:38.904688+03:00","created_by":"deligoez","updated_at":"2026-01-12T12:35:13.278703+03:00","closed_at":"2026-01-12T12:35:13.278703+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-c3q","depends_on_id":"ch-dka","type":"blocks","created_at":"2026-01-11T08:44:38.909092+03:00","created_by":"deligoez"},{"issue_id":"ch-c3q","depends_on_id":"ch-nn6","type":"blocks","created_at":"2026-01-11T08:44:38.911902+03:00","created_by":"deligoez"},{"issue_id":"ch-c3q","depends_on_id":"ch-wc53","type":"blocks","created_at":"2026-01-12T08:59:07.867968+03:00","created_by":"deligoez"}]}
{"id":"ch-c8j","title":"F49: Iteration Rollback - Undo last N agent iterations","description":"## What\nRollback last N iterations of an agent's work (Level 1 rollback).\n\n## Key Definition: What is an \"Iteration\"?\n\nAn **iteration** = one complete agent run (spawn → completion/retry).\n\n**Iteration Boundary Detection:**\n\nThe key challenge is identifying which commits belong to which iteration. Two approaches:\n\n**Approach 1: State-Based (Preferred)**\n- Store iteration start commit hash in state when agent spawns\n- `ChorusState.agents[id].iterations: { number: number; startCommit: string }[]`\n- On spawn: Record current HEAD as iteration start\n- To find iteration N commits: commits between iteration N startCommit and iteration N-1 startCommit\n\n**Approach 2: Time-Based (Fallback)**  \n- Store iteration start timestamp in state\n- Use `git log --after={timestamp} --before={next_timestamp}` to find commits\n- Less precise (timestamp drift) but simpler if commit tracking fails\n\n**Implementation chooses Approach 1:**\n- F02c (State Agent) must track iteration start commits\n- This task queries state to find boundaries\n\n**Example:**\n```\nIteration 1: startCommit=abc123, 3 commits [ch-abc]\nIteration 2: startCommit=def456, 2 commits [ch-abc] (retry)\nIteration 3: startCommit=ghi789, 1 commit [ch-abc] (success)\n```\n\n`rollback(worktree, taskId, 1)` undoes commits from ghi789 to HEAD (1 commit).\n\n## API\n```typescript\n// src/services/IterationRollback.ts\n\nclass IterationRollback {\n  constructor(private stateService: StateService) {}\n\n  /**\n   * Undo last N iterations for an agent\n   * Finds commits between iteration boundaries from state\n   * Uses git reset --soft to undo commits\n   * @param worktreePath Path to agent's worktree\n   * @param taskId Task ID to identify agent and commits (e.g., \"ch-abc\")\n   * @param iterations Number of iterations to undo (default: 1)\n   */\n  async rollback(\n    worktreePath: string,\n    taskId: string,\n    iterations?: number\n  ): Promise\u003cRollbackResult\u003e\n\n  /**\n   * Count commits for specific task in worktree\n   * Uses `git log --grep=\"[taskId]\" --oneline | wc -l`\n   */\n  async getTaskCommitCount(worktreePath: string, taskId: string): Promise\u003cnumber\u003e\n\n  /**\n   * Find commits belonging to a task\n   * Uses `git log --grep=\"[taskId]\" --format=%H`\n   * Returns commit hashes in reverse chronological order\n   */\n  async findTaskCommits(worktreePath: string, taskId: string): Promise\u003cstring[]\u003e\n\n  /**\n   * Get commits from specific iteration\n   * Reads iteration boundaries from state (startCommit per iteration)\n   * Returns commits between this iteration's startCommit and previous\n   */\n  async findIterationCommits(\n    worktreePath: string,\n    taskId: string,\n    iterationNumber: number\n  ): Promise\u003cstring[]\u003e\n\n  /**\n   * Get iteration boundaries from state\n   * Returns array of { number, startCommit } for the task's agent\n   */\n  async getIterationBoundaries(taskId: string): Promise\u003cArray\u003c{\n    number: number;\n    startCommit: string;\n  }\u003e\u003e\n}\n```\n\n## Files\n- src/services/IterationRollback.ts\n- tests/services/IterationRollback.test.ts\n\n## Acceptance Criteria\n- [ ] `rollback()` finds commits with `[taskId]` marker in message\n- [ ] `rollback()` queries state for iteration boundaries (startCommit per iteration)\n- [ ] `rollback()` runs `git reset --soft` to undo commits in last N iterations\n- [ ] `rollback()` returns RollbackResult with reverted commit hashes\n- [ ] `rollback()` fails gracefully if no commits found\n- [ ] `getTaskCommitCount()` counts commits with task marker\n- [ ] `findTaskCommits()` returns hashes in reverse chronological order\n- [ ] `findIterationCommits()` uses startCommit from state to identify boundaries\n- [ ] `getIterationBoundaries()` reads from ChorusState.agents[id].iterations\n- [ ] 9 tests pass\n\n## Tests\n1. rollback() finds commits by task ID marker\n2. rollback() reads iteration boundaries from state\n3. rollback() resets correct commits for last iteration\n4. rollback() handles multi-iteration rollback (N \u003e 1)\n5. rollback() handles no matching commits\n6. getTaskCommitCount() counts correctly\n7. findTaskCommits() returns reverse chronological order\n8. findIterationCommits() respects state-based boundaries\n9. getIterationBoundaries() returns correct data from state\n\n## Dependencies\n- F02c (State Agent): Must track `iterations: Array\u003c{ number, startCommit }\u003e` per agent\n- F07 (Prompt Builder): Ensures commits have `[ch-xxx]` suffix\n\n## Notes\n- Commit message format: `\u003ctype\u003e: \u003cdescription\u003e [ch-xxx]`\n- Iteration boundaries stored in state (set by orchestrator on spawn)\n- Worktree context: all operations happen in agent's worktree, not main repo\n- F48 (Checkpointer) handles SESSION checkpoints, this handles ITERATION rollback\n\nLabels: [m10-rollback]","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T10:44:38.327782+03:00","created_by":"deligoez","updated_at":"2026-01-11T22:50:39.242535+03:00","closed_at":"2026-01-11T22:50:39.242535+03:00","close_reason":"Closed","labels":["m10-rollback"],"dependencies":[{"issue_id":"ch-c8j","depends_on_id":"ch-2r5","type":"blocks","created_at":"2026-01-10T10:44:38.329783+03:00","created_by":"deligoez"},{"issue_id":"ch-c8j","depends_on_id":"ch-cg0","type":"blocks","created_at":"2026-01-11T13:30:43.179178+03:00","created_by":"deligoez"}]}
{"id":"ch-ce6s","title":"INT-03: Agent lifecycle with worktree","description":"## What\nIntegration test: Full agent lifecycle with git worktree.\n\n## Test Scenarios (in temp git repo)\n1. Create worktree for task → verify branch created\n2. Agent makes change in worktree → verify commit in worktree\n3. Agent completes → verify TASK_COMPLETE signal parsed\n4. Cleanup worktree → verify branch/directory removed\n\n## Setup\n```typescript\n// Create temp git repo\nconst repoDir = createTempGitRepo();\n// Initialize with a file\nexecSync('git init \u0026\u0026 git add . \u0026\u0026 git commit -m \"init\"', { cwd: repoDir });\n```\n\n## Why Deterministic\n- Git operations are deterministic\n- File changes are exact\n- Signal format is defined\n\n## Acceptance Criteria\n- [ ] Creates isolated temp git repo\n- [ ] Worktree created correctly\n- [ ] Agent commit appears in worktree\n- [ ] TASK_COMPLETE signal detected\n- [ ] Cleanup removes worktree\n- [ ] 4 tests pass\n\n## Files\n- src/integration/agent-lifecycle.integration.test.ts (create)\n- src/test-utils/git-fixtures.ts (create if needed)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T14:25:44.075224+03:00","created_by":"deligoez","updated_at":"2026-01-12T14:42:31.875118+03:00","closed_at":"2026-01-12T14:42:31.875118+03:00","close_reason":"Closed","labels":["m3-task-mgmt"],"dependencies":[{"issue_id":"ch-ce6s","depends_on_id":"ch-qf06","type":"blocks","created_at":"2026-01-12T14:25:44.078667+03:00","created_by":"deligoez"}]}
{"id":"ch-cg0","title":"F02c: State Agent Ops - Add/update/remove agents","description":"## What\nManage agent entries in ChorusState.agents with CRUD operations and iteration tracking.\n\n## Implementation Note\n`AgentState.status` is an implementation addition for tracking agent lifecycle states (idle/running/paused/error). This enables the TUI to show agent status and the orchestrator to manage agent lifecycle.\n\n## Acceptance Criteria\n\n### CRUD Operations - 5 tests\n- [ ] `addAgent(agent)` adds AgentState to state.agents\n- [ ] `addAgent(agent)` throws if agent with same ID exists\n- [ ] `updateAgent(id, partial)` modifies existing agent\n- [ ] `removeAgent(id)` deletes agent from state\n- [ ] `getAgent(id)` returns agent or undefined\n\n### Iteration Management - 5 tests\n- [ ] `startIteration(id)` records current HEAD commit as iteration startCommit\n- [ ] `startIteration(id)` increments iteration number and returns new count\n- [ ] `startIteration(id)` appends to agent.iterations array: `{ number, startCommit }`\n- [ ] `getIterations(id)` returns agent.iterations array\n- [ ] `startIteration(id)` throws if agent doesn't exist\n\n### Status Updates - 2 tests\n- [ ] `setStatus(id, status)` updates agent.status\n- [ ] `getRunningAgents()` returns agents with status='running'\n\n### Summary\n- [ ] 12 tests pass\n\n## Files\n- src/services/StateService.ts (UPDATE - add agent methods)\n- src/services/StateService.test.ts (UPDATE)\n\n## API\n```typescript\ninterface IterationRecord {\n  number: number;\n  startCommit: string;\n}\n\nclass StateService {\n  // Agent operations\n  addAgent(agent: AgentState): void;\n  updateAgent(id: string, partial: Partial\u003cAgentState\u003e): void;\n  removeAgent(id: string): void;\n  getAgent(id: string): AgentState | undefined;\n  \n  // Iteration (for F49: Iteration Rollback)\n  startIteration(id: string): number;  // Records HEAD commit, returns iteration number\n  getIterations(id: string): IterationRecord[];\n  \n  // Status\n  setStatus(id: string, status: AgentStatus): void;\n  getRunningAgents(): AgentState[];\n}\n```\n\n## Error Handling\n- `addAgent()` throws `DuplicateAgentError` if ID already exists\n- `startIteration()` throws `AgentNotFoundError` if agent doesn't exist\n- `updateAgent()` and `removeAgent()` are no-op if agent doesn't exist (idempotent)\n\n## Note on Iterations\nF49 (Iteration Rollback) depends on tracking iteration boundaries via startCommit.\nThe orchestrator calls `startIteration(agentId)` when spawning an agent, which:\n1. Records current git HEAD as the iteration's startCommit\n2. Increments and returns the iteration number\n3. Appends to agent.iterations array for rollback reference","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T01:30:50.982849+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:59:14.700903+03:00","closed_at":"2026-01-11T18:59:14.700903+03:00","close_reason":"Closed","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-cg0","depends_on_id":"ch-ah6","type":"blocks","created_at":"2026-01-10T01:30:50.984583+03:00","created_by":"deligoez"},{"issue_id":"ch-cg0","depends_on_id":"ch-81x","type":"blocks","created_at":"2026-01-10T01:37:13.386589+03:00","created_by":"deligoez"}]}
{"id":"ch-cjf","title":"F94: Plan Review Trigger","description":"## What\nDetect when to trigger Plan Review based on learning scope and config.\n\n## Why\nOnly cross-cutting/architectural learnings should trigger expensive Plan Agent reviews.\n\n## Acceptance Criteria\n- [ ] `shouldTriggerReview(learning, config)` returns boolean\n- [ ] Respects `planReview.enabled` config\n- [ ] Respects `planReview.triggerOn` array (which scopes trigger)\n- [ ] Returns false for LOCAL learnings\n- [ ] Returns true for CROSS_CUTTING when configured\n- [ ] Returns true for ARCHITECTURAL when configured\n- [ ] Logs trigger decision to session log\n- [ ] 7 tests pass\n\n## Interface\n```typescript\ninterface PlanReviewConfig {\n  enabled: boolean;\n  maxIterations: number;\n  triggerOn: LearningScope[];\n  autoApply: 'none' | 'minor' | 'all';\n  requireApproval: string[];\n}\n\nfunction shouldTriggerReview(\n  learning: CategorizedLearning,\n  config: PlanReviewConfig\n): boolean;\n```\n\n## Files\n- src/services/PlanReviewTrigger.ts\n- tests/services/PlanReviewTrigger.test.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-11T08:43:50.83146+03:00","created_by":"deligoez","updated_at":"2026-01-12T10:37:31.535248+03:00","closed_at":"2026-01-12T10:37:31.535248+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-cjf","depends_on_id":"ch-sm8","type":"blocks","created_at":"2026-01-11T08:43:50.835831+03:00","created_by":"deligoez"},{"issue_id":"ch-cjf","depends_on_id":"ch-sro","type":"blocks","created_at":"2026-01-11T08:43:50.838523+03:00","created_by":"deligoez"}]}
{"id":"ch-clju","title":"F64d: Full TUI Integration - End-to-end TUI application test","description":"## What\nEnd-to-end integration tests for the complete TUI application.\n\n## Scope\nTests the entire TUI app as a user would experience it:\n1. App startup and initial render\n2. User interactions via keyboard\n3. State changes and visual updates\n4. Modal workflows\n5. Error handling\n\n## Test Scenarios\n\n### 1. Startup Flow\n```\n1. Launch app with mock orchestrator\n2. Verify HeaderBar shows correct initial state\n3. Verify TaskPanel shows ready tasks\n4. Verify AgentGrid shows empty slots\n5. Verify FooterBar shows stats\n```\n\n### 2. Task Workflow\n```\n1. Navigate to task with j/k\n2. Spawn agent with 's'\n3. Verify agent appears in grid\n4. Verify task status updates\n5. Wait for completion (mocked)\n6. Verify stats update in footer\n```\n\n### 3. Intervention Workflow\n```\n1. Start agent on task\n2. Press 'i' to open intervention\n3. Press 'x' to stop\n4. Confirm agent stopped\n5. ESC to close panel\n```\n\n### 4. Help Workflow\n```\n1. Press '?' to open help\n2. Verify all shortcuts displayed\n3. Press '?' again to close\n4. Verify app responsive again\n```\n\n## Acceptance Criteria\n\n### Startup Tests - 4 tests\n- [ ] App renders without crash\n- [ ] All layout components visible\n- [ ] Initial state correct (mode, slots, tasks)\n- [ ] Keyboard handlers active\n\n### Navigation Flow Tests - 4 tests\n- [ ] j/k navigates task list\n- [ ] Tab switches panel focus\n- [ ] 1-9 quick selects tasks\n- [ ] Selection visual feedback works\n\n### Agent Lifecycle Tests - 5 tests\n- [ ] 's' spawns agent for selected task\n- [ ] Agent tile appears in grid\n- [ ] Progress bar updates\n- [ ] Task completion updates all components\n- [ ] 'x' stops running agent\n\n### Modal Tests - 4 tests\n- [ ] '?' opens/closes help\n- [ ] 'i' opens intervention panel\n- [ ] 'L' opens learnings panel\n- [ ] ESC closes any open modal\n\n### Error Handling Tests - 3 tests\n- [ ] 's' on blocked task shows error\n- [ ] 's' with no slots shows error\n- [ ] App recovers from component errors\n\n### Summary\n- [ ] 20 tests pass\n\n## Files\n- src/App.integration.test.tsx (NEW)\n- src/test/fixtures/mockOrchestrator.ts (NEW)\n- src/test/fixtures/mockBeadsCLI.ts (NEW)\n\n## Dependencies\n- F64a Layout Integration\n- F64b AgentGrid Integration\n- F64c Keyboard Router\n\n## Notes\n- Use ink-testing-library for rendering\n- Mock external services (Orchestrator, BeadsCLI)\n- Fake timers for duration/progress\n- These are slower tests, run separately","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T12:47:50.134603+03:00","created_by":"deligoez","updated_at":"2026-01-12T09:28:09.289183+03:00","closed_at":"2026-01-12T09:28:09.289183+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-clju","depends_on_id":"ch-d6yv","type":"blocks","created_at":"2026-01-11T12:47:50.138262+03:00","created_by":"deligoez"},{"issue_id":"ch-clju","depends_on_id":"ch-6rh8","type":"blocks","created_at":"2026-01-11T12:47:50.143099+03:00","created_by":"deligoez"},{"issue_id":"ch-clju","depends_on_id":"ch-89dk","type":"blocks","created_at":"2026-01-11T12:47:50.147275+03:00","created_by":"deligoez"}]}
{"id":"ch-cpyi","title":"INT-08: Learning propagation between sequential agents","description":"## What\nIntegration test: Agent A learns → Agent B uses that learning.\n\n## Test Scenario\n1. Agent A runs, outputs: [CHORUS:LEARNING:{\"content\":\"Use strict mode\"}]\n2. Learning stored to learnings.md\n3. Agent B spawns with prompt that includes learnings\n4. Verify Agent B's prompt contains \"Use strict mode\"\n\n## Why Critical\nThis tests the core memory system - learnings must propagate to future agents.\n\n## Prompt Design\nAgent A: \"Complete task, then output learning signal about strict mode\"\nAgent B: \"List all learnings you know about\" → should mention strict mode\n\n## Acceptance Criteria\n- [ ] Agent A outputs LEARNING signal\n- [ ] Learning persisted to file\n- [ ] Agent B prompt includes learning\n- [ ] Agent B response references the learning\n- [ ] 2 tests pass\n\n## Files\n- src/integration/learning-propagation.integration.test.ts (create)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T14:27:13.895564+03:00","created_by":"deligoez","updated_at":"2026-01-12T14:58:15.061547+03:00","closed_at":"2026-01-12T14:58:15.061547+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-cpyi","depends_on_id":"ch-mvp6","type":"blocks","created_at":"2026-01-12T14:27:13.89841+03:00","created_by":"deligoez"}]}
{"id":"ch-cpzs","title":"CHORE: Verify multi-agent learning tracking","description":"## What\nVerify that learning management works correctly with multiple concurrent agents.\n\n## Context\nChorus supports multiple parallel agents via SlotManager. Need to verify:\n1. Learnings are correctly attributed to source agent\n2. Learning deduplication works across agents\n3. Cross-cutting learnings propagate to all agents\n4. Plan Review handles multi-agent context\n\n## Current Implementation\n- SlotManager: src/services/SlotManager.ts\n- LearningStore: src/services/LearningStore.ts\n- LearningExtractor: src/services/LearningExtractor.ts\n- PlanReviewIntegration: src/services/PlanReviewIntegration.ts\n\n## Acceptance Criteria\n- [ ] Verify LearningSource tracks agentId correctly\n- [ ] Test learning deduplication with multiple agents\n- [ ] Verify cross-cutting learning injection to all agents\n- [ ] Add E2E test for multi-agent learning flow\n- [ ] 4 tests pass\n\n## Files\n- src/services/LearningStore.ts\n- src/services/PlanReviewIntegration.ts\n- tests/e2e/multi-agent-learning.e2e.test.ts (create)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T13:29:58.634068+03:00","created_by":"deligoez","updated_at":"2026-01-12T13:52:17.726213+03:00","closed_at":"2026-01-12T13:52:17.726213+03:00","close_reason":"Closed","labels":["m8-memory"]}
{"id":"ch-cq1q","title":"FR12: Task List Navigation - Navigate task list with j/k keys","description":"## What\nAdd j/k keyboard navigation to task list in ImplementationMode.\n\n## Acceptance Criteria\n- [ ] `j` key moves selection down in task list\n- [ ] `k` key moves selection up in task list\n- [ ] Selection wraps at boundaries (top → bottom, bottom → top)\n- [ ] Selection updates `selectedTaskId` state\n- [ ] Navigation disabled when modal open (intervention, review)\n- [ ] TaskPanel highlights selected task with `►` indicator\n- [ ] 6 tests pass\n\n## Files\n- src/modes/ImplementationMode.tsx\n- src/hooks/useNavigationKeys.ts (existing)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:10:57.644743+03:00","created_by":"deligoez","updated_at":"2026-01-12T16:09:34.813436+03:00","closed_at":"2026-01-12T16:09:34.813436+03:00","close_reason":"Closed","labels":["m13-review"]}
{"id":"ch-cu1","title":"F32d: RalphLoop Deadlock Detection","description":"## What\nRalphLoop safeguards: max tasks limit, progress detection, stuck agent detection.\n\n## Acceptance Criteria\n\n### Max Tasks Safeguard - 2 tests\n- [ ] `processLoop()` stops after maxTotalTasks processed (configurable, default 100)\n- [ ] `processLoop()` emits \"maxTasksReached\" event when limit hit\n\n### Progress Detection - 2 tests\n- [ ] `processLoop()` stops if no progress for idleTimeout ms (default 60000)\n- [ ] `processLoop()` emits \"idleTimeout\" event with timeout value\n\n### Stuck Agent Detection - 2 tests\n- [ ] `processLoop()` emits \"stuckAgent\" event after 5 iterations with 0 git commits across all agents\n- [ ] `processLoop()` continues after stuckAgent event (warning only, doesn't stop)\n\n### Summary\n- [ ] 6 tests pass\n\n## Event Specifications\n```typescript\ninterface RalphLoopSafeguardEvents {\n  \"maxTasksReached\": (count: number) =\u003e void;\n  \"idleTimeout\": (timeoutMs: number) =\u003e void;\n  \"stuckAgent\": (agentId: string, iterationsWithoutCommit: number) =\u003e void;\n}\n```\n\n## Configuration\n```typescript\ninterface RalphLoopSafeguardConfig {\n  maxTotalTasks: number;      // default: 100\n  idleTimeout: number;        // default: 60000 (ms)\n  stuckIterationThreshold: number;  // default: 5\n}\n```\n\n## Files\n- src/services/RalphLoop.ts (UPDATE)\n- src/services/RalphLoop.test.ts (UPDATE)\n\n## Notes\n- maxTotalTasks: Hard limit per session (prevents runaway)\n- idleTimeout: Detects when loop is stuck with no progress\n- stuckAgent: Warning for agent making no commits (potential infinite loop)\n\n## Dependencies\n- F32b (ch-3pa) - Core processing loop","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T23:51:50.392823+03:00","created_by":"deligoez","updated_at":"2026-01-11T00:05:42.090266+03:00","closed_at":"2026-01-11T00:05:42.090266+03:00","close_reason":"Closed","labels":["m7-autopilot"],"dependencies":[{"issue_id":"ch-cu1","depends_on_id":"ch-3pa","type":"blocks","created_at":"2026-01-10T23:51:50.396882+03:00","created_by":"deligoez"}]}
{"id":"ch-cwy","title":"F44: Agent Stop - Kill agent and stash worktree changes","description":"## What\nStop a specific agent, stash its worktree changes, return task to pending.\n\n## API\n\\`\\`\\`typescript\n// src/services/AgentStopper.ts\n\nclass AgentStopper {\n  constructor(\n    private slotManager: SlotManager,\n    private beadsCLI: BeadsCLI\n  ) {}\n\n  /**\n   * Stop specific agent by ID\n   * - Kill agent process\n   * - Stash worktree changes (git stash in worktree dir)\n   * - Return task to pending via beadsCLI.releaseTask()\n   */\n  async stopAgent(agentId: string): Promise\u003cInterventionResult\u003e\n\n  /**\n   * Stop agent working on a specific task\n   * - Find agent via slotManager.getAgentForTask()\n   * - If found, call stopAgent()\n   * - Returns null if no agent working on task\n   */\n  async stopAgentByTask(taskId: string): Promise\u003cInterventionResult | null\u003e\n\n  /**\n   * Get agent working on a task (if any)\n   */\n  getAgentForTask(taskId: string): AgentSlot | null\n\n  /**\n   * Stop all agents (emergency - KILL ALL Ctrl+C)\n   * - Kill all agent processes\n   * - Stash all worktree changes\n   * - All tasks to pending\n   * - Worktrees preserved (not deleted)\n   */\n  async stopAll(): Promise\u003cInterventionResult\u003e\n\n  /**\n   * Stash changes in agent's worktree\n   * Uses git stash in the worktree directory\n   */\n  async stashWorktreeChanges(worktreePath: string): Promise\u003cvoid\u003e\n}\n\\`\\`\\`\n\n## Files\n- src/services/AgentStopper.ts\n- tests/services/AgentStopper.test.ts\n\n## Acceptance Criteria\n- [ ] \\`stopAgent()\\` kills the agent process (process.kill or SIGTERM)\n- [ ] \\`stopAgent()\\` stashes uncommitted changes via git stash\n- [ ] \\`stopAgent()\\` calls beadsCLI.releaseTask() to return task to pending\n- [ ] \\`stopAgent()\\` releases the slot in SlotManager\n- [ ] \\`stopAgent()\\` returns error if agent not found\n- [ ] \\`stopAgentByTask()\\` returns null if no agent on task\n- [ ] \\`stopAgentByTask()\\` calls stopAgent() if agent found\n- [ ] \\`getAgentForTask()\\` queries SlotManager correctly\n- [ ] \\`stopAll()\\` stops all running agents\n- [ ] \\`stopAll()\\` returns affected agents count in result\n- [ ] \\`stashWorktreeChanges()\\` runs git stash in worktree directory\n- [ ] \\`stashWorktreeChanges()\\` handles no changes gracefully\n- [ ] 12 tests pass\n\n## Tests\n1. stopAgent() kills process\n2. stopAgent() stashes changes\n3. stopAgent() calls releaseTask()\n4. stopAgent() releases slot\n5. stopAgent() errors for unknown agent\n6. stopAgentByTask() returns null when no agent\n7. stopAgentByTask() stops agent when found\n8. getAgentForTask() returns slot when found\n9. getAgentForTask() returns null when not found\n10. stopAll() stops all agents\n11. stashWorktreeChanges() creates stash\n12. stashWorktreeChanges() handles no changes","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T10:43:39.672942+03:00","created_by":"deligoez","updated_at":"2026-01-11T23:01:57.679464+03:00","closed_at":"2026-01-11T23:01:57.679464+03:00","close_reason":"Closed","labels":["m9-intervention"],"dependencies":[{"issue_id":"ch-cwy","depends_on_id":"ch-ahq","type":"blocks","created_at":"2026-01-10T10:43:39.674465+03:00","created_by":"deligoez"},{"issue_id":"ch-cwy","depends_on_id":"ch-i9i","type":"blocks","created_at":"2026-01-10T10:43:39.675677+03:00","created_by":"deligoez"},{"issue_id":"ch-cwy","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-10T12:14:12.921751+03:00","created_by":"deligoez"}]}
{"id":"ch-d65q","title":"E2E-67: Pattern Extraction \u0026 Approval","description":"## What\nE2E tests for pattern suggestion, approval, and PATTERNS.md update.\n\n## Acceptance Criteria\n- [ ] Learning Categorizer identifies CROSS-CUTTING patterns\n- [ ] Pattern suggestion saved to pending-patterns.json\n- [ ] Pattern expires after 7 days if not approved\n- [ ] User approval adds to PATTERNS.md\n- [ ] Auto-approval for low-risk patterns\n- [ ] Approved pattern injected into agent prompts\n- [ ] Pattern rejection logged with reason\n- [ ] 8 tests pass\n\n## Files\n- src/e2e/pattern-workflow.e2e.test.ts\n\n## Implementation Notes\n- Use temp directory for PATTERNS.md\n- Test approval and rejection flows","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T00:40:38.02497+03:00","created_by":"deligoez","updated_at":"2026-01-12T12:48:05.249417+03:00","closed_at":"2026-01-12T12:48:05.249417+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-d65q","depends_on_id":"ch-sm8","type":"blocks","created_at":"2026-01-12T00:40:38.028145+03:00","created_by":"deligoez"},{"issue_id":"ch-d65q","depends_on_id":"ch-j40","type":"blocks","created_at":"2026-01-12T00:40:38.03063+03:00","created_by":"deligoez"},{"issue_id":"ch-d65q","depends_on_id":"ch-c3q","type":"blocks","created_at":"2026-01-12T00:40:38.032708+03:00","created_by":"deligoez"}]}
{"id":"ch-d6yv","title":"F64a: Layout Integration - HeaderBar + TwoColumnLayout + FooterBar","description":"## What\nIntegration tests verifying the main layout components work together correctly.\n\n## Components Under Test\n- F57a HeaderBar (ch-amw)\n- F61a TwoColumnLayout (ch-73t)\n- F57b FooterBar (ch-nvo)\n\n## Integration Scenarios\n\n### 1. Full Layout Render\n```\n┌─────────────────────────────────────────────────────────┐\n│ HeaderBar                                               │\n├─────────────────────────────────────────────────────────┤\n│ TwoColumnLayout                                         │\n│  ┌─────────────────────┬───────────────────────────────┤\n│  │ Left (TaskPanel)    │ Right (AgentGrid)             │\n│  │                     │                               │\n│  └─────────────────────┴───────────────────────────────┤\n├─────────────────────────────────────────────────────────┤\n│ FooterBar                                               │\n└─────────────────────────────────────────────────────────┘\n```\n\n### 2. Responsive Behavior\n- Terminal resize → layout adjusts\n- Small terminal → single column fallback\n- Large terminal → full two-column layout\n\n### 3. Data Flow\n- State changes propagate to all components\n- HeaderBar reflects mode/agent count\n- FooterBar reflects task stats\n\n## Acceptance Criteria\n\n### Render Tests - 4 tests\n- [ ] All three components render without error\n- [ ] Components maintain correct vertical order\n- [ ] No overlapping or clipping between components\n- [ ] Layout fills available terminal height\n\n### Responsive Tests - 3 tests\n- [ ] Wide terminal (\u003e120 cols) shows two columns\n- [ ] Narrow terminal (\u003c80 cols) shows single column\n- [ ] Terminal resize triggers re-layout\n\n### State Propagation Tests - 4 tests\n- [ ] Mode change in store updates HeaderBar\n- [ ] Agent spawn/stop updates HeaderBar counter\n- [ ] Task status change updates FooterBar stats\n- [ ] Merge queue change updates FooterBar indicator\n\n### Focus Tests - 2 tests\n- [ ] Tab switches focus visual between left/right panels\n- [ ] Focused panel has visual indicator (border color)\n\n### Summary\n- [ ] 13 tests pass\n\n## Files\n- src/components/Layout.integration.test.tsx (NEW)\n\n## Dependencies\n- F57a HeaderBar\n- F61a TwoColumnLayout\n- F57b FooterBar\n\n## Notes\n- Integration tests use ink-testing-library\n- Mock terminal dimensions for responsive tests\n- Use OrchestrationStore for state propagation tests","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T12:47:24.697593+03:00","created_by":"deligoez","updated_at":"2026-01-11T21:57:14.883156+03:00","closed_at":"2026-01-11T21:57:14.883156+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-d6yv","depends_on_id":"ch-amw","type":"blocks","created_at":"2026-01-11T12:47:24.701575+03:00","created_by":"deligoez"},{"issue_id":"ch-d6yv","depends_on_id":"ch-73t","type":"blocks","created_at":"2026-01-11T12:47:24.704876+03:00","created_by":"deligoez"},{"issue_id":"ch-d6yv","depends_on_id":"ch-nvo","type":"blocks","created_at":"2026-01-11T12:47:24.706995+03:00","created_by":"deligoez"}]}
{"id":"ch-ddk","title":"F45: Agent Redirect - Reassign agent to different task","description":"## What\nRedirect a running agent to work on a different task.\n\n**IMPORTANT:** All Beads access via BeadsCLI. Never call bd directly.\n\n## Context from Master Plan\n```\n3. REDIRECT AGENT (r)\n   - Assign current agent to different task\n   - Current task goes back to pending\n   - Useful when agent stuck on wrong approach\n```\n\n## API\n```typescript\n// src/services/AgentRedirector.ts\n\nclass AgentRedirector {\n  constructor(\n    private agentStopper: AgentStopper,\n    private beadsCLI: BeadsCLI,\n    private orchestrator: Orchestrator\n  ) {}\n\n  /**\n   * Redirect agent to new task\n   * - Stop current work via AgentStopper (stash changes, release task)\n   * - Claim new task via BeadsCLI.claimTask()\n   * - Restart agent with new task via Orchestrator.spawnAgentForTask()\n   * - REUSES the same agent slot (does NOT spawn fresh agent)\n   * @returns InterventionResult with old and new task IDs\n   * @throws If validation fails or any step fails\n   */\n  async redirect(agentId: string, newTaskId: string): Promise\u003cInterventionResult\u003e\n\n  /**\n   * Validate redirect is possible\n   * Checks:\n   * 1. Agent exists and is running (via SlotManager through AgentStopper)\n   * 2. New task status is \"open\" (not \"in_progress\" or \"closed\")\n   * 3. New task has no unsatisfied blocking dependencies\n   * 4. New task does NOT have \"deferred\" label\n   */\n  async canRedirect(agentId: string, newTaskId: string): Promise\u003cboolean\u003e\n}\n```\n\n## InterventionResult Interface\n```typescript\ninterface InterventionResult {\n  success: boolean;\n  action: \"redirect\";\n  affectedTasks: {\n    released: string;   // Old task ID returned to pending\n    claimed: string;    // New task ID now assigned to agent\n  };\n  agentId: string;\n  timestamp: Date;\n}\n```\n\n## Files\n- src/services/AgentRedirector.ts (NEW)\n- tests/services/AgentRedirector.test.ts (NEW)\n\n## Acceptance Criteria\n\n### redirect() - 9 tests\n- [ ] `redirect()` calls agentStopper.stopAgent(agentId) first\n- [ ] `redirect()` calls beadsCLI.getTask(newTaskId) to verify task state\n- [ ] `redirect()` fails with error if task status is not \"open\"\n- [ ] `redirect()` fails with error if task has blocking dependencies\n- [ ] `redirect()` fails with error if task has \"deferred\" label\n- [ ] `redirect()` calls beadsCLI.claimTask(newTaskId) after validation\n- [ ] `redirect()` calls orchestrator.spawnAgentForTask(agentId, newTaskId)\n- [ ] `redirect()` returns InterventionResult with both old and new task IDs\n- [ ] `redirect()` reuses same agent slot (does NOT spawn fresh agent)\n\n### canRedirect() - 5 tests\n- [ ] `canRedirect()` returns false if agent not found in SlotManager\n- [ ] `canRedirect()` returns false if agent not running (status != \"running\")\n- [ ] `canRedirect()` returns false if task status is \"in_progress\"\n- [ ] `canRedirect()` returns false if task has \"deferred\" label\n- [ ] `canRedirect()` returns true when agent running AND task open AND not deferred\n\n### Summary\n- [ ] 14 tests pass\n\n## Test Cases\n1. redirect() stops current work via agentStopper\n2. redirect() validates task is open via beadsCLI.getTask\n3. redirect() fails for in_progress task\n4. redirect() fails for blocked task\n5. redirect() fails for deferred task\n6. redirect() claims new task after validation\n7. redirect() spawns agent for new task\n8. redirect() returns InterventionResult with both task IDs\n9. redirect() reuses same agent slot, does NOT spawn fresh agent\n10. canRedirect() returns false for unknown agent\n11. canRedirect() returns false for non-running agent\n12. canRedirect() returns false for in_progress task\n13. canRedirect() returns false for deferred task\n14. canRedirect() returns true for valid redirect\n\n## Notes\n- **Deferred check is explicit in both redirect() and canRedirect()**\n- **All Beads operations via BeadsCLI dependency injection**\n- **AgentStopper handles stashing changes and releasing old task**\n- **Agent slot reuse: redirect() MUST pass the SAME agentId to orchestrator, verifying slot is reused**","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T10:43:50.867286+03:00","created_by":"deligoez","updated_at":"2026-01-11T23:06:48.568326+03:00","closed_at":"2026-01-11T23:06:48.568326+03:00","close_reason":"Closed","labels":["m9-intervention"],"dependencies":[{"issue_id":"ch-ddk","depends_on_id":"ch-cwy","type":"blocks","created_at":"2026-01-10T10:43:50.868803+03:00","created_by":"deligoez"},{"issue_id":"ch-ddk","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-10T10:43:50.869973+03:00","created_by":"deligoez"},{"issue_id":"ch-ddk","depends_on_id":"ch-0e7","type":"blocks","created_at":"2026-01-10T12:08:31.917833+03:00","created_by":"deligoez"}]}
{"id":"ch-dff","title":"F63j: Task Failed Status Indicator","description":"## What\nAdd `failed` status to BeadStatus type and TaskPanel indicator.\n\n## Why\nMaster plan specifies `✗ failed` indicator for tasks needing attention, but current implementation only has `tombstone`.\n\n## Acceptance Criteria\n- [ ] `BeadStatus` type includes `'failed'`\n- [ ] TaskPanel shows `✗` for failed tasks (red color)\n- [ ] Failed status distinct from blocked (`⊗`)\n- [ ] 3 tests pass\n\n## Tests (src/components/TaskPanel.test.tsx)\n1. `shows ✗ for failed tasks`\n2. `failed indicator is red colored`\n3. `failed status is distinct from blocked`\n\n## Files\n- src/types/bead.ts (add 'failed' to BeadStatus)\n- src/components/TaskPanel.tsx (add failed indicator)\n- src/components/TaskPanel.test.tsx (add tests)\n\n## Notes\n- `tombstone` may remain for soft-deleted tasks\n- `failed` = task attempted but needs attention","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T22:17:33.495969+03:00","created_by":"deligoez","updated_at":"2026-01-11T21:05:57.717624+03:00","closed_at":"2026-01-11T21:05:57.717624+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-dff","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:54.121003+03:00","created_by":"deligoez"}]}
{"id":"ch-di6","title":"F46c-a: Intervention Panel - Main Mode","description":"## What\nTUI modal component for intervention: main mode with agent list and initial keybindings.\n\n## API\n```typescript\n// src/components/InterventionPanel.tsx\n\ntype PanelMode = \n  | 'main' \n  | 'stop-select' \n  | 'redirect-select' \n  | 'redirect-task' \n  | 'edit-select' \n  | 'block-select';\n\ninterface InterventionPanelProps {\n  visible: boolean;\n  onClose: () =\u003e void;\n  onFocusAgent?: (agentId: string) =\u003e void;\n}\n\nfunction InterventionPanel({ visible, onClose, onFocusAgent }: InterventionPanelProps): JSX.Element | null\n```\n\n## Acceptance Criteria\n\n### Visibility - 2 tests\n- [ ] Panel renders when `visible=true`\n- [ ] Panel returns null when `visible=false`\n\n### Agent List Display - 3 tests\n- [ ] Gets active agents from OrchestrationStore via useStore()\n- [ ] Displays agent list with: type, taskId, iteration, duration\n- [ ] Shows action keybindings with descriptions in 'main' mode\n\n### Main Mode Keybindings - 5 tests\n- [ ] 'p' key toggles pause via PauseHandler.togglePause()\n- [ ] Number keys (1-9) call onFocusAgent with correct agentId\n- [ ] 'x' key transitions to 'stop-select' mode\n- [ ] 'r' key transitions to 'redirect-select' mode\n- [ ] ESC calls onClose()\n\n### Styling - 1 test\n- [ ] Panel styled as modal overlay (Box with borderStyle='round')\n\n### Summary\n- [ ] 11 tests pass\n\n## Files\n- src/components/InterventionPanel.tsx (NEW)\n- src/components/InterventionPanel.test.tsx (NEW)\n\n## Notes\n- Uses ink's useInput hook with `isActive: visible`\n- Mode state management: starts at 'main'\n- Other modes implemented in F46c-b, F46c-c, F46c-d","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:07:58.830452+03:00","created_by":"deligoez","updated_at":"2026-01-12T07:22:07.797672+03:00","closed_at":"2026-01-12T07:22:07.797672+03:00","close_reason":"Closed","labels":["m9-intervention"],"dependencies":[{"issue_id":"ch-di6","depends_on_id":"ch-ahq","type":"blocks","created_at":"2026-01-10T12:07:58.832997+03:00","created_by":"deligoez"},{"issue_id":"ch-di6","depends_on_id":"ch-fna","type":"blocks","created_at":"2026-01-10T12:07:58.834828+03:00","created_by":"deligoez"},{"issue_id":"ch-di6","depends_on_id":"ch-cwy","type":"blocks","created_at":"2026-01-10T12:07:58.836384+03:00","created_by":"deligoez"},{"issue_id":"ch-di6","depends_on_id":"ch-ddk","type":"blocks","created_at":"2026-01-10T12:07:58.837878+03:00","created_by":"deligoez"},{"issue_id":"ch-di6","depends_on_id":"ch-sb7","type":"blocks","created_at":"2026-01-10T12:07:58.839363+03:00","created_by":"deligoez"},{"issue_id":"ch-di6","depends_on_id":"ch-xe8","type":"blocks","created_at":"2026-01-10T12:07:58.840874+03:00","created_by":"deligoez"},{"issue_id":"ch-di6","depends_on_id":"ch-vskx","type":"blocks","created_at":"2026-01-11T15:27:37.686045+03:00","created_by":"deligoez"}]}
{"id":"ch-djom","title":"F96c: In-Progress Update Severity Classification","description":"## What\nClassify queued updates by severity (minor/major/redundant) for smarter handling.\n\n## Why\nDifferent update types may warrant different responses - minor updates can wait silently, major changes might need user attention.\n\n## Acceptance Criteria\n- [ ] `classifyUpdateSeverity(update)` returns 'minor' | 'major' | 'redundant'\n- [ ] add_criteria → minor\n- [ ] update_description with scope change → major\n- [ ] markRedundant → redundant\n- [ ] Severity stored in queue alongside update\n- [ ] 5 tests pass\n\n## Deferred Reason\nMVP uses simple queue without classification. This enables future TUI notifications.\n\n## Files\n- src/services/UpdateSeverityClassifier.ts\n- tests/services/UpdateSeverityClassifier.test.ts","status":"deferred","priority":3,"issue_type":"task","created_at":"2026-01-12T09:08:59.749049+03:00","created_by":"deligoez","updated_at":"2026-01-12T12:23:16.299027+03:00","labels":["deferred","m8-memory"],"dependencies":[{"issue_id":"ch-djom","depends_on_id":"ch-dka","type":"blocks","created_at":"2026-01-12T09:08:59.756841+03:00","created_by":"deligoez"}]}
{"id":"ch-djpg","title":"F63-merge-view: Merge Queue View Key (M) - Show merge queue panel","description":"## What\nHandle 'M' (uppercase) key to show merge queue panel.\n\n## Acceptance Criteria\n- [ ] 'M' opens merge queue panel overlay\n- [ ] Shows queued items with status (pending, merging, conflict)\n- [ ] Shows current merge progress if active\n- [ ] ESC closes panel\n- [ ] 5 tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T13:05:32.621505+03:00","created_by":"deligoez","updated_at":"2026-01-11T14:01:54.195149+03:00","closed_at":"2026-01-11T14:01:54.195149+03:00","close_reason":"Duplicate of ch-0fwe (F63-merge-view: Merge Queue View Key)","labels":["m12-tui"]}
{"id":"ch-djvl","title":"E2E-44: MergeService Integration Tests","description":"## What\nEnd-to-end tests for MergeService using real git operations.\n\n## Why\nMerge operations are critical and heavily mocked. Need real tests for:\n- Actual merge behavior with conflicts\n- Rebase operations\n- Force-push recovery scenarios\n- Conflict detection\n\n## Tests (10 tests)\n\n### Basic Merge (3 tests)\n1. Merges clean branch into main\n2. Detects and reports merge conflict\n3. Aborts merge on conflict\n\n### Rebase (3 tests)\n4. Rebases branch onto main\n5. Detects rebase conflict\n6. Aborts rebase on conflict\n\n### Conflict Classification (2 tests)\n7. Classifies trivial conflict (whitespace, imports)\n8. Classifies semantic conflict (logic changes)\n\n### Recovery (2 tests)\n9. Recovers from failed merge state\n10. Handles force-push scenario\n\n## Files\n- src/e2e/merge-service.e2e.test.ts (NEW)\n\n## Dependencies\n- ch-fqh0 (git-fixtures.ts)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-11T23:37:54.944694+03:00","created_by":"deligoez","updated_at":"2026-01-11T23:53:26.650652+03:00","closed_at":"2026-01-11T23:53:26.650652+03:00","close_reason":"MergeService E2E tests - 10 tests","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-djvl","depends_on_id":"ch-fqh0","type":"blocks","created_at":"2026-01-11T23:37:54.94661+03:00","created_by":"deligoez"}]}
{"id":"ch-djwb","title":"E2E-36: Keyboard Shortcut Help","description":"## What\nE2E test for keyboard shortcut help display.\n\n## Acceptance Criteria\n- [ ] Help panel shows all shortcuts by category\n- [ ] Categories: Navigation, Task, Agent, App\n- [ ] Shortcuts show key + description\n- [ ] Context-sensitive hints in footer\n- [ ] 4 tests pass\n\n## Test Cases\n1. `it('shows shortcuts grouped by category')`\n2. `it('displays all navigation shortcuts')`\n3. `it('displays all task shortcuts')`\n4. `it('footer shows context-sensitive hints')`\n\n## Files\n- tests/e2e/keyboard-help.test.ts\n\n## Dependencies\n- ch-0e01 (E2E Infrastructure)\n- ch-2po (F61c HelpPanel Enhanced)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:22:11.018234+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:06:57.537159+03:00","closed_at":"2026-01-12T01:06:57.537159+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-djwb","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:22:11.020576+03:00","created_by":"deligoez"},{"issue_id":"ch-djwb","depends_on_id":"ch-2po","type":"blocks","created_at":"2026-01-11T21:22:11.022442+03:00","created_by":"deligoez"}]}
{"id":"ch-dka","title":"F96: Task Updater","description":"## What\nApply Plan Review changes to Beads tasks based on config approval settings.\n\n## Why\nChanges need to be applied to actual tasks in Beads, respecting auto-apply and approval rules.\n\n## Acceptance Criteria\n\n### Core functionality - 9 tests\n- [ ] `applyTaskUpdates(result, config)` processes review results\n- [ ] Auto-applies changes matching `config.autoApply` level\n- [ ] Queues changes requiring approval (based on `config.requireApproval`)\n- [ ] `applyUpdate(update)` modifies task via BeadsCLI\n- [ ] `markRedundant(taskId)` closes task with \"redundant\" label\n- [ ] Preserves original task description in update commit message\n- [ ] Returns summary: `{ applied: [], pending: [], queued: [] }`\n\n### In-Progress Task Handling - 3 tests\n- [ ] `isTaskInProgress(taskId)` checks if task has running agent\n- [ ] In-progress task updates are queued to `.chorus/pending-task-updates.json`\n- [ ] `getQueuedUpdates(taskId)` returns pending updates for a task\n\n### Summary\n- [ ] 12 tests pass\n\n## Interface\n```typescript\ninterface ApplyResult {\n  applied: TaskUpdate[];\n  pending: TaskUpdate[];  // Needs user approval\n  queued: TaskUpdate[];   // Queued for in_progress tasks\n  failed: { update: TaskUpdate; error: string }[];\n}\n\nasync function applyTaskUpdates(\n  result: PlanReviewResult,\n  config: PlanReviewConfig\n): Promise\u003cApplyResult\u003e;\n\nasync function isTaskInProgress(taskId: string): Promise\u003cboolean\u003e;\nasync function getQueuedUpdates(taskId: string): Promise\u003cTaskUpdate[]\u003e;\n```\n\n## Auto-Apply Levels\n- `none`: Queue all changes for approval\n- `minor`: Auto-apply add_criteria, queue others\n- `all`: Auto-apply everything except redundant marking\n\n## Files\n- src/services/TaskUpdater.ts\n- tests/services/TaskUpdater.test.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-11T08:44:27.036252+03:00","created_by":"deligoez","updated_at":"2026-01-12T12:27:29.133653+03:00","closed_at":"2026-01-12T12:27:29.133653+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-dka","depends_on_id":"ch-bmx","type":"blocks","created_at":"2026-01-11T08:44:27.039785+03:00","created_by":"deligoez"}]}
{"id":"ch-dmmv","title":"INT-04: Multi-agent parallel execution","description":"## What\nIntegration test: Multiple agents working in parallel on separate tasks.\n\n## Test Scenarios\n1. Spawn 2 agents in parallel → each creates different file\n   - Agent 1: \"Create agent1.txt with: AGENT_1_OUTPUT\"\n   - Agent 2: \"Create agent2.txt with: AGENT_2_OUTPUT\"\n   - Verify both files exist with correct content\n\n2. Agents in separate worktrees\n   - Task A in worktree-a → creates file-a.txt\n   - Task B in worktree-b → creates file-b.txt\n   - Verify no cross-contamination\n\n3. Sequential completion order\n   - Start agents with different response times\n   - Verify each completes independently\n\n## Why Deterministic\n- Separate output files per agent\n- No shared state between agents\n- Exact content verification\n\n## Acceptance Criteria\n- [ ] 2 agents run in parallel\n- [ ] Each agent creates its own file\n- [ ] No cross-contamination between worktrees\n- [ ] Both agents complete successfully\n- [ ] 3 tests pass\n\n## Files\n- src/integration/multi-agent.integration.test.ts (create)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T14:25:52.830395+03:00","created_by":"deligoez","updated_at":"2026-01-12T14:45:06.784489+03:00","closed_at":"2026-01-12T14:45:06.784489+03:00","close_reason":"Closed","labels":["m6-parallelism"],"dependencies":[{"issue_id":"ch-dmmv","depends_on_id":"ch-ce6s","type":"blocks","created_at":"2026-01-12T14:25:52.834725+03:00","created_by":"deligoez"}]}
{"id":"ch-dzz","title":"F13: Task Closer - Mark tasks as closed via bd CLI","description":"## What\nClose completed tasks and manage task status via bd CLI (extends BeadsCLI from F12).\n\n## Acceptance Criteria\n- [ ] `closeTask(id, comment?)` runs `bd close \u003cid\u003e`\n- [ ] `closeTask()` supports optional comment via `--comment`\n- [ ] `closeTask()` throws on bd error\n- [ ] `reopenTask(id)` changes status back to open\n- [ ] `getTaskStatus(id)` returns current status string\n- [ ] `getTaskStatus(id)` returns null for invalid task\n- [ ] `getInProgressTasks()` returns array of in_progress tasks\n- [ ] `getClosedTasks()` returns array of closed tasks\n- [ ] 8 tests pass\n\n## Files\n- src/services/BeadsCLI.ts (UPDATE - add methods)\n- tests/services/BeadsCLI.test.ts (UPDATE - add tests)\n\n## Plan\nSee: thoughts/shared/plans/features/F13-task-closer.md\n\n## Notes\n- Extends BeadsCLI from F12\n- Use `bd close` (not `bd update --status=closed`)\n- reopenTask for false completion recovery\n- Use --json flag for structured output","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T01:39:07.662362+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:39:09.621864+03:00","closed_at":"2026-01-11T18:39:09.621864+03:00","close_reason":"Closed","labels":["m3-task-mgmt"],"dependencies":[{"issue_id":"ch-dzz","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-10T01:39:40.054514+03:00","created_by":"deligoez"}]}
{"id":"ch-e47h","title":"BUG: Add tests for PlanningDialog component","description":"## What\nPlanningDialog component has no unit tests.\n\n## Current State\n- src/components/PlanningDialog.tsx exists\n- No corresponding test file\n\n## Why\nDialog components should have basic rendering tests.\n\n## Acceptance Criteria\n- [ ] PlanningDialog.test.tsx exists\n- [ ] Tests cover rendering when open\n- [ ] Tests cover rendering when closed (null)\n- [ ] Tests verify keyboard shortcuts shown\n- [ ] 4 tests pass\n\n## Files\n- src/components/PlanningDialog.tsx\n- src/components/PlanningDialog.test.tsx (create)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T13:29:29.507429+03:00","created_by":"deligoez","updated_at":"2026-01-12T14:06:41.943537+03:00","closed_at":"2026-01-12T14:06:41.943537+03:00","close_reason":"Closed","labels":["m0-planning"]}
{"id":"ch-e7f","title":"F18b: TaskPanel Selection UI - Visual selection in TUI","description":"## What\nUpdate TaskPanel to show selection highlight, Enter key assignment, status icons.\n\n## Acceptance Criteria\n\n### Visual Selection - 3 tests\n- [ ] Selected task has blue background highlight\n- [ ] Arrow indicator (◀) shown on selected task\n- [ ] Shows \"Press Enter to assign\" when canAssign is true\n\n### Keyboard Handling - 3 tests\n- [ ] Up arrow calls selectPrevious\n- [ ] Down arrow calls selectNext\n- [ ] Enter key triggers assignSelected when canAssign\n\n### Status Display - 3 tests\n- [ ] Shows status icons per task (🔄 for in_progress)\n- [ ] Shows blocker count for blocked tasks\n- [ ] Shows ready/blocked counts in footer\n\n### Components - 3 tests\n- [ ] TaskRow component with highlight + status renders correctly\n- [ ] getStatusColor() returns correct color for each status\n- [ ] getStatusIcon() returns correct icon for each status\n\n### Summary\n- [ ] 12 tests pass\n\n## Files\n- src/components/TaskPanel.tsx (UPDATE)\n- src/components/TaskRow.tsx (NEW)\n- src/components/TaskPanel.test.tsx (UPDATE)\n\n## Notes\n- Uses useInput from Ink for keyboard\n- Selection state from useTaskSelection hook","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T02:07:21.76659+03:00","created_by":"deligoez","updated_at":"2026-01-12T06:17:08.561623+03:00","closed_at":"2026-01-12T06:17:08.561623+03:00","close_reason":"Closed","labels":["m4-orchestration"],"dependencies":[{"issue_id":"ch-e7f","depends_on_id":"ch-9fq","type":"blocks","created_at":"2026-01-10T02:07:21.768899+03:00","created_by":"deligoez"}]}
{"id":"ch-eq5","title":"F89: App Router - Mode Selection and Routing","description":"## What\nMain application entry point that uses ChorusMachine state for routing, NOT direct state management.\n\n## Architecture Change (XState v5)\n\n**CRITICAL:** App Router reads from and dispatches to ChorusMachine. It does NOT manage routing state directly.\n\n```typescript\n// OLD (Direct state management) - DO NOT USE\nconst [mode, setMode] = useState('init');\nconst onModeTransition = (newMode) =\u003e setMode(newMode);\n\n// NEW (XState-based routing) - CORRECT\nconst { snapshot, send } = useChorusMachine();\nconst currentMode = selectCurrentMode(snapshot);\n// Routing is determined by machine state, not local state\n```\n\n## XState Integration\n\nMachine state determines which mode to render:\n\n```typescript\n// Machine states map to modes:\n// snapshot.matches('init') → InitMode\n// snapshot.matches('planning') → PlanningMode\n// snapshot.matches('review') → ReviewLoop\n// snapshot.matches('implementation') → ImplementationMode\n\nconst selectCurrentMode = (snapshot): AppMode =\u003e {\n  if (snapshot.matches('init')) return 'init';\n  if (snapshot.matches('planning')) return 'planning';\n  if (snapshot.matches('review')) return 'review';\n  if (snapshot.matches('implementation')) return 'implementation';\n  return 'init'; // fallback\n};\n```\n\n## Implementation\n\n```typescript\nimport { useChorusMachine } from './hooks/useChorusMachine';\nimport { useSelector } from '@xstate/react';\n\nexport function App({ cliArgs }: AppProps) {\n  const { actorRef, send } = useChorusMachine();\n  const currentMode = useSelector(actorRef, selectCurrentMode);\n  \n  // CLI override check on mount\n  useEffect(() =\u003e {\n    if (cliArgs?.command === 'init') {\n      send({ type: 'FORCE_INIT' });\n    } else if (cliArgs?.command === 'plan') {\n      send({ type: 'FORCE_PLANNING' });\n    } else if (cliArgs?.mode) {\n      send({ type: 'SET_MODE', mode: cliArgs.mode });\n    }\n  }, [cliArgs, send]);\n\n  // Route based on machine state\n  switch (currentMode) {\n    case 'init':\n      return \u003cInitMode onEvent={(e) =\u003e send(e)} /\u003e;\n    case 'planning':\n      return \u003cPlanningMode onEvent={(e) =\u003e send(e)} /\u003e;\n    case 'review':\n      return \u003cReviewLoop onEvent={(e) =\u003e send(e)} /\u003e;\n    case 'implementation':\n      return \u003cImplementationMode onEvent={(e) =\u003e send(e)} /\u003e;\n  }\n}\n```\n\n## Event Types for App Router\n\n```typescript\ntype AppRouterEvent =\n  // CLI overrides\n  | { type: 'FORCE_INIT' }\n  | { type: 'FORCE_PLANNING' }\n  | { type: 'SET_MODE'; mode: 'semi-auto' | 'autopilot' }\n  \n  // State detection\n  | { type: 'INIT_REQUIRED' }           // .chorus/ not found\n  | { type: 'INIT_COMPLETE' }           // .chorus/ created, config saved\n  | { type: 'PLANNING_COMPLETE' }       // Tasks created\n  | { type: 'REVIEW_COMPLETE'; mode }   // Validation passed, mode chosen\n  \n  // Recovery\n  | { type: 'RESTORE_STATE' };          // Restore from planning-state.json\n```\n\n## XState Testing Pattern\n\n```typescript\nimport { createActor } from 'xstate';\nimport { render, waitFor } from '@testing-library/react';\nimport { describe, it, expect, vi } from 'vitest';\n\ndescribe('App Router - XState Integration', () =\u003e {\n  it('should render InitMode when machine is in init state', () =\u003e {\n    // Arrange\n    const actor = createActor(chorusMachine);\n    actor.start();\n    // Machine starts in 'init' state when .chorus/ doesn't exist\n\n    // Act\n    const { getByTestId } = render(\n      \u003cChorusProvider actor={actor}\u003e\n        \u003cApp cliArgs={{}} /\u003e\n      \u003c/ChorusProvider\u003e\n    );\n\n    // Assert\n    expect(getByTestId('init-mode')).toBeDefined();\n  });\n\n  it('should dispatch FORCE_INIT when CLI command is init', () =\u003e {\n    // Arrange\n    const actor = createActor(chorusMachine);\n    actor.start();\n    const sendSpy = vi.spyOn(actor, 'send');\n\n    // Act\n    render(\n      \u003cChorusProvider actor={actor}\u003e\n        \u003cApp cliArgs={{ command: 'init' }} /\u003e\n      \u003c/ChorusProvider\u003e\n    );\n\n    // Assert\n    expect(sendSpy).toHaveBeenCalledWith({ type: 'FORCE_INIT' });\n  });\n\n  it('should transition to planning after INIT_COMPLETE', async () =\u003e {\n    // Arrange\n    const actor = createActor(chorusMachine);\n    actor.start();\n\n    // Act\n    actor.send({ type: 'INIT_COMPLETE' });\n\n    // Assert\n    expect(actor.getSnapshot().matches('planning')).toBe(true);\n  });\n\n  it('should read planning-state.json to restore mode', async () =\u003e {\n    // Arrange\n    const mockPlanningState = {\n      status: 'ready',\n      chosenMode: 'autopilot',\n    };\n    vi.mock('./services/PlanningState', () =\u003e ({\n      load: vi.fn().mockResolvedValue(mockPlanningState),\n    }));\n    const actor = createActor(chorusMachine);\n    actor.start();\n\n    // Act - machine should restore from planning-state\n    actor.send({ type: 'RESTORE_STATE' });\n\n    // Assert\n    await waitFor(() =\u003e {\n      expect(actor.getSnapshot().matches('implementation')).toBe(true);\n      expect(actor.getSnapshot().context.mode).toBe('autopilot');\n    });\n  });\n\n  it('should honor CLI mode over planning-state.json', async () =\u003e {\n    // Arrange\n    const mockPlanningState = { status: 'ready', chosenMode: 'autopilot' };\n    const actor = createActor(chorusMachine);\n    actor.start();\n\n    // Act - CLI says semi-auto, planning-state says autopilot\n    render(\n      \u003cChorusProvider actor={actor}\u003e\n        \u003cApp cliArgs={{ mode: 'semi-auto' }} /\u003e\n      \u003c/ChorusProvider\u003e\n    );\n\n    // Assert - CLI wins\n    expect(actor.getSnapshot().context.mode).toBe('semi-auto');\n  });\n});\n```\n\n## Acceptance Criteria\n\n### Machine State Routing - 4 tests\n- [ ] Renders InitMode when `snapshot.matches('init')`\n- [ ] Renders PlanningMode when `snapshot.matches('planning')`\n- [ ] Renders ReviewLoop when `snapshot.matches('review')`\n- [ ] Renders ImplementationMode when `snapshot.matches('implementation')`\n\n### CLI Override Events - 4 tests\n- [ ] 'chorus init' dispatches FORCE_INIT event\n- [ ] 'chorus plan' dispatches FORCE_PLANNING event\n- [ ] --mode flag dispatches SET_MODE event\n- [ ] CLI mode overrides planning-state.json chosenMode\n\n### State Restoration - 3 tests\n- [ ] On mount, checks .chorus/ existence and dispatches INIT_REQUIRED if missing\n- [ ] Reads planning-state.json and dispatches RESTORE_STATE\n- [ ] Handles corrupted/missing planning-state.json gracefully (defaults to planning)\n\n### Event Propagation - 3 tests\n- [ ] Passes onEvent callback to child modes\n- [ ] Child mode events are forwarded to machine via send()\n- [ ] State transitions happen via machine, not local state\n\n### Summary\n- [ ] 14 tests pass\n\n## Flow with Events\n```\nStart\n  │\n  ├─ Check CLI command/flags\n  │   'chorus init' → dispatch FORCE_INIT\n  │   'chorus plan' → dispatch FORCE_PLANNING\n  │   --mode=\u003cmode\u003e → dispatch SET_MODE\n  │\n  ├─ If no CLI override:\n  │   │\n  │   ├─ Check .chorus/ exists?\n  │   │   No → dispatch INIT_REQUIRED\n  │   │   Yes ↓\n  │   │\n  │   ├─ Load planning-state.json\n  │   │   dispatch RESTORE_STATE with loaded state\n  │   │\n  │   └─ Machine transitions to correct state\n  │\n  └─ Render based on machine state (useSelector)\n```\n\n## Files\n- `src/App.tsx`\n- `tests/App.test.tsx`\n\n## Dependencies\n- FX07 (ch-vskx): useChorusMachine hook\n- F80 (ch-m9y): Init Mode Controller\n- F81 (ch-o5z): Planning Mode Controller\n- F86 (ch-to7): Planning State Persistence\n\n## Implementation Notes\n- App Router is STATELESS - it reads from machine\n- Mode transitions are machine events, not setState calls\n- Machine handles all business logic for transitions\n- App just renders the right component based on machine state\n- CLI precedence: CLI flag \u003e planning-state.json \u003e config.json \u003e default","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:16:39.139858+03:00","created_by":"deligoez","updated_at":"2026-01-12T04:24:19.339121+03:00","closed_at":"2026-01-12T04:24:19.339121+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-eq5","depends_on_id":"ch-m9y","type":"blocks","created_at":"2026-01-11T03:16:39.144413+03:00","created_by":"deligoez"},{"issue_id":"ch-eq5","depends_on_id":"ch-o5z","type":"blocks","created_at":"2026-01-11T03:16:39.147295+03:00","created_by":"deligoez"},{"issue_id":"ch-eq5","depends_on_id":"ch-to7","type":"blocks","created_at":"2026-01-11T03:16:39.149173+03:00","created_by":"deligoez"}]}
{"id":"ch-eqkb","title":"TS16: BeadsCLI Adapter","description":"## What\nCreate adapter for gradual migration.\n\n## Files\n- `src/services/TaskStoreAdapter.ts`\n- `src/services/TaskStoreAdapter.test.ts`\n\n## Acceptance Criteria\n- [ ] Implements BeadsCLI interface using TaskStore\n- [ ] `claimTask()` calls `store.claim()`\n- [ ] `getReadyTasks()` calls `store.ready()`\n- [ ] `closeTask()` calls `store.complete()`\n- [ ] Maps Bead ↔ Task types\n- [ ] 5 tests pass","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:15:35.316205+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:15:35.316205+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-eqkb","depends_on_id":"ch-i3bp","type":"blocks","created_at":"2026-01-13T00:15:35.319358+03:00","created_by":"deligoez"}]}
{"id":"ch-er9f","title":"TS13-E2E: Crash Recovery E2E Tests","description":"## What\nComprehensive E2E tests for all crash recovery scenarios.\n\n## Files\n- `src/e2e/taskstore-recovery.e2e.test.ts`\n\n## Acceptance Criteria\n- [ ] Orphaned `doing` task is reset to `todo` on startup\n- [ ] Multiple orphaned tasks are all recovered\n- [ ] `retryCount` is incremented correctly\n- [ ] `crash_recovery` event is logged to audit\n- [ ] Recovery context includes audit log content\n- [ ] Recovery context detects worktree with uncommitted changes\n- [ ] Recovery context has correct instruction message\n- [ ] Task without previous attempts returns no recovery context\n- [ ] Second crash increments retryCount to 2\n- [ ] 9 tests pass","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:14:53.879384+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:14:53.879384+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-er9f","depends_on_id":"ch-lf1g","type":"blocks","created_at":"2026-01-13T00:15:02.023089+03:00","created_by":"deligoez"}]}
{"id":"ch-eyd","title":"F42: Learning Injector - Inject relevant learnings into prompts","description":"## What\nInject relevant learnings into agent prompts (for non-Claude agents).\n\n## API\n```typescript\n// src/services/LearningInjector.ts\n\nclass LearningInjector {\n  constructor(private learningStore: LearningStore) {}\n\n  /**\n   * Get relevant learnings for a task based on labels/keywords\n   * @param task Task to find relevant learnings for\n   * @param limit Max number of learnings to include\n   * @returns Formatted markdown string of relevant learnings\n   */\n  async getRelevantLearnings(task: BeadsTask, limit?: number): Promise\u003cstring\u003e\n\n  /**\n   * Build prompt section with learnings\n   * @returns Markdown section \"# Relevant Learnings\\n...\"\n   */\n  async buildLearningsSection(task: BeadsTask): Promise\u003cstring\u003e\n\n  /**\n   * Check if agent needs learnings injected (non-Claude)\n   */\n  needsInjection(agentType: AgentType): boolean\n}\n```\n\n## Files\n- src/services/LearningInjector.ts\n- tests/services/LearningInjector.test.ts\n\n## Acceptance Criteria\n- [ ] `getRelevantLearnings()` returns learnings matching task labels\n- [ ] `getRelevantLearnings()` respects limit parameter\n- [ ] `getRelevantLearnings()` returns empty string if no matches\n- [ ] `buildLearningsSection()` formats as markdown section\n- [ ] `needsInjection()` returns false for 'claude'\n- [ ] `needsInjection()` returns true for 'codex', 'opencode'\n- [ ] 6 tests pass\n\n## Tests\n1. getRelevantLearnings() matches by task labels\n2. getRelevantLearnings() respects limit\n3. getRelevantLearnings() returns empty for no matches\n4. buildLearningsSection() formats correctly\n5. needsInjection() returns false for claude\n6. needsInjection() returns true for other agents","status":"deferred","priority":1,"issue_type":"task","created_at":"2026-01-10T10:43:03.709956+03:00","created_by":"deligoez","updated_at":"2026-01-12T12:23:02.607765+03:00","labels":["deferred","m8-memory"],"dependencies":[{"issue_id":"ch-eyd","depends_on_id":"ch-a6h","type":"blocks","created_at":"2026-01-10T10:43:03.711498+03:00","created_by":"deligoez"}]}
{"id":"ch-ez8y","title":"INT-05: End-to-end task completion workflow","description":"## What\nIntegration test: Complete workflow from task to merge.\n\n## Test Scenario\n```\n1. Create task in .beads/issues.jsonl\n2. Agent claims task → worktree created\n3. Agent executes: \"Create solution.txt with: TASK_SOLVED\"\n4. Agent signals: TASK_COMPLETE\n5. Quality check passes (file exists)\n6. Merge to main branch\n7. Verify solution.txt in main\n8. Cleanup worktree\n```\n\n## Setup\n- Temp git repo with .beads/issues.jsonl\n- Simple task: \"Create solution.txt with exact content\"\n- Quality command: \"test -f solution.txt\"\n\n## Why Deterministic\n- Exact file content\n- Binary quality check (file exists or not)\n- Git merge is deterministic\n\n## Acceptance Criteria\n- [ ] Task loaded from .beads\n- [ ] Agent spawned with task context\n- [ ] Agent creates expected file\n- [ ] TASK_COMPLETE detected\n- [ ] Quality check passes\n- [ ] Merge to main succeeds\n- [ ] File appears in main branch\n- [ ] 1 comprehensive test passes\n\n## Files\n- src/integration/e2e-workflow.integration.test.ts (create)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T14:26:03.364362+03:00","created_by":"deligoez","updated_at":"2026-01-12T14:49:47.771566+03:00","closed_at":"2026-01-12T14:49:47.771566+03:00","close_reason":"Closed","labels":["m4-orchestration"],"dependencies":[{"issue_id":"ch-ez8y","depends_on_id":"ch-dmmv","type":"blocks","created_at":"2026-01-12T14:26:03.368412+03:00","created_by":"deligoez"}]}
{"id":"ch-f58w","title":"F63-quit: Quit Key (q) - Exit application with confirmation","description":"## What\nHandle 'q' key to quit TUI application.\n\n## Acceptance Criteria\n- [ ] 'q' key triggers quit confirmation if agents running\n- [ ] Shows dialog: \"N agents running. Quit anyway? [y/N]\"\n- [ ] 'y' confirms and exits\n- [ ] 'N' or ESC cancels\n- [ ] Immediate quit if no agents running\n- [ ] 5 tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T13:05:31.550464+03:00","created_by":"deligoez","updated_at":"2026-01-11T14:01:55.513439+03:00","closed_at":"2026-01-11T14:01:55.513439+03:00","close_reason":"Duplicate of ch-oifw (F63-quit: Quit Key)","labels":["m12-tui"]}
{"id":"ch-fe5","title":"F25: Merge Worker","description":"## What\nPerforms git merge operations. Dequeues from MergeQueue and attempts merge.\n\n## Git Mocking Strategy\n\nUses dependency injection with `GitService` interface for testability:\n\n```typescript\ninterface GitService {\n  merge(branch: string): Promise\u003cGitMergeResult\u003e;\n  abortMerge(): Promise\u003cvoid\u003e;\n  getConflictFiles(): Promise\u003cstring[]\u003e;\n}\n\n// Production: uses child_process.exec\nclass RealGitService implements GitService { ... }\n\n// Tests: returns predetermined results\nclass MockGitService implements GitService {\n  private mergeResult: GitMergeResult;\n  setMergeResult(result: GitMergeResult): void;\n  merge(): Promise\u003cGitMergeResult\u003e;\n}\n\n// Constructor injection\nclass MergeWorker {\n  constructor(\n    private queue: MergeQueue,\n    private git: GitService = new RealGitService()\n  ) {}\n}\n```\n\n### Test Setup Pattern\n```typescript\nconst mockGit = new MockGitService();\nconst worker = new MergeWorker(queue, mockGit);\n\n// Test clean merge\nmockGit.setMergeResult({ success: true, merged: true });\n\n// Test conflict\nmockGit.setMergeResult({ \n  success: false, \n  hasConflict: true,\n  conflictFiles: ['src/index.ts'] \n});\n\n// Test git error\nmockGit.setMergeResult({ success: false, error: 'fatal: not a git repository' });\n```\n\n## Acceptance Criteria\n\n### merge() - 7 tests\n- [ ] Emits 'mergeStart' event at beginning of merge()\n- [ ] Returns `{ success: true, merged: true }` when `mockGit` returns clean merge\n- [ ] Returns `{ hasConflict: true }` when `mockGit` indicates conflict\n- [ ] `conflictFiles` contains array from `mockGit.getConflictFiles()`\n- [ ] Emits 'mergeSuccess' event on `success: true`\n- [ ] Emits 'mergeConflict' event on `hasConflict: true`\n- [ ] Emits 'mergeError' event when `mockGit.merge()` throws\n\n### abort() - 2 tests\n- [ ] Calls `mockGit.abortMerge()` once\n- [ ] Sets `isMerging` to false after abort completes\n\n### isMerging() - 1 test\n- [ ] Returns `true` after merge() called, before promise resolves\n\n### Summary\n- [ ] 10 tests pass\n\n## Files\n- src/services/GitService.ts (interface + RealGitService)\n- src/services/MergeWorker.ts\n- tests/services/MergeWorker.test.ts\n- tests/mocks/MockGitService.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T03:16:18.292224+03:00","created_by":"deligoez","updated_at":"2026-01-11T19:23:41.3875+03:00","closed_at":"2026-01-11T19:23:41.3875+03:00","close_reason":"Closed","labels":["m5-merge"],"dependencies":[{"issue_id":"ch-fe5","depends_on_id":"ch-glf","type":"blocks","created_at":"2026-01-10T03:16:18.294889+03:00","created_by":"deligoez"}]}
{"id":"ch-feeq","title":"E2E-13: Mode Toggle (m)","description":"## What\nVerify m key toggles between modes.\n\n## Tests (3 tests)\n1. Pressing m toggles mode\n2. Mode indicator updates\n3. Mode persists after operations\n\n## Files\n- src/e2e/mode-toggle.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T21:18:25.265476+03:00","created_by":"deligoez","updated_at":"2026-01-12T05:11:33.066383+03:00","closed_at":"2026-01-12T05:11:33.066383+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-feeq","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:18:25.267827+03:00","created_by":"deligoez"},{"issue_id":"ch-feeq","depends_on_id":"ch-3ji","type":"blocks","created_at":"2026-01-11T21:18:25.26987+03:00","created_by":"deligoez"},{"issue_id":"ch-feeq","depends_on_id":"ch-mnd","type":"blocks","created_at":"2026-01-11T21:25:08.967175+03:00","created_by":"deligoez"}]}
{"id":"ch-fhxb","title":"FR07: Feedback Injection - Inject feedback into agent prompt","description":"## What\nInject review feedback into agent prompt for redo tasks.\n\n## Acceptance Criteria\n- [ ] `injectFeedback(prompt, feedback)` prepends feedback section to prompt\n- [ ] Includes quick issues as bullet points\n- [ ] Includes custom feedback as blockquote\n- [ ] Includes iteration number in header\n- [ ] Returns original prompt when feedback is empty (no history)\n- [ ] Returns original prompt when feedback is `null`\n- [ ] 6 tests pass\n\n## Files\n- src/services/FeedbackInjector.ts\n- src/services/FeedbackInjector.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:12:28.965563+03:00","created_by":"deligoez","updated_at":"2026-01-12T15:49:33.833393+03:00","closed_at":"2026-01-12T15:49:33.833393+03:00","close_reason":"Closed","labels":["m13-review"],"dependencies":[{"issue_id":"ch-fhxb","depends_on_id":"ch-lv0w","type":"blocks","created_at":"2026-01-12T15:12:28.968485+03:00","created_by":"deligoez"},{"issue_id":"ch-fhxb","depends_on_id":"ch-wk8","type":"blocks","created_at":"2026-01-12T15:12:28.970467+03:00","created_by":"deligoez"}]}
{"id":"ch-fjdz","title":"E2E-09: Spawn Agent (s)","description":"## What\nVerify s key spawns agent for selected task.\n\n## Tests (4 tests)\n1. Pressing s spawns new agent\n2. Agent tile appears in grid\n3. Agent slots counter increments\n4. Task shows agent assignment\n\n## Files\n- src/e2e/spawn-agent.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T21:18:12.358926+03:00","created_by":"deligoez","updated_at":"2026-01-12T05:32:22.86784+03:00","closed_at":"2026-01-12T05:32:22.86784+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-fjdz","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:18:12.36222+03:00","created_by":"deligoez"},{"issue_id":"ch-fjdz","depends_on_id":"ch-p3c","type":"blocks","created_at":"2026-01-11T21:18:12.365972+03:00","created_by":"deligoez"}]}
{"id":"ch-fna","title":"F43b: Pause Handler - Pause and resume orchestration","description":"## What\nHandle pause/resume of orchestration - stop spawning new tasks while allowing current agents to finish.\n\n## API\n```typescript\n// src/services/PauseHandler.ts\n\nclass PauseHandler {\n  constructor(private orchestrator: Orchestrator) {}\n\n  /**\n   * Pause orchestration\n   * - Stop spawning new agents\n   * - Current agents continue to next checkpoint\n   * - Preserve all state\n   */\n  async pause(): Promise\u003cInterventionResult\u003e\n\n  /**\n   * Resume orchestration\n   * - Enable spawning new agents\n   * - Continue from paused state\n   */\n  async resume(): Promise\u003cInterventionResult\u003e\n\n  /**\n   * Check if orchestration is paused\n   */\n  isPaused(): boolean\n\n  /**\n   * Get pause duration if paused\n   */\n  getPauseDuration(): number | null\n}\n```\n\n## Files\n- src/services/PauseHandler.ts\n- tests/services/PauseHandler.test.ts\n\n## Acceptance Criteria\n- [ ] `pause()` sets paused state to true\n- [ ] `pause()` records pausedAt timestamp\n- [ ] `pause()` calls orchestrator.setPaused(true) to stop agent spawning\n- [ ] `pause()` returns InterventionResult with success=true\n- [ ] `resume()` sets paused state to false\n- [ ] `resume()` clears pausedAt\n- [ ] `resume()` calls orchestrator.setPaused(false) to enable spawning\n- [ ] `isPaused()` returns correct boolean\n- [ ] `getPauseDuration()` returns ms since pause or null\n- [ ] 9 tests pass\n\n## Tests\n1. pause() sets paused to true\n2. pause() records timestamp\n3. pause() calls orchestrator.setPaused(true)\n4. pause() is idempotent (double pause OK)\n5. resume() sets paused to false\n6. resume() calls orchestrator.setPaused(false)\n7. resume() when not paused returns success\n8. isPaused() returns correct state\n9. getPauseDuration() calculates correctly","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T10:43:29.087701+03:00","created_by":"deligoez","updated_at":"2026-01-11T22:59:06.263266+03:00","closed_at":"2026-01-11T22:59:06.263266+03:00","close_reason":"Closed","labels":["m9-intervention"],"dependencies":[{"issue_id":"ch-fna","depends_on_id":"ch-ahq","type":"blocks","created_at":"2026-01-10T10:43:29.089184+03:00","created_by":"deligoez"},{"issue_id":"ch-fna","depends_on_id":"ch-0e7","type":"blocks","created_at":"2026-01-10T10:43:29.090362+03:00","created_by":"deligoez"}]}
{"id":"ch-fqh0","title":"E2E-41: WorktreeService Integration Tests","description":"## What\nEnd-to-end tests for WorktreeService using real git operations.\n\n## Why\nCurrent unit tests mock all git/fs operations. Need real integration tests to verify:\n- Git worktree behavior across different git versions\n- Actual file system operations\n- Branch creation/deletion\n- Worktree list parsing with real git output\n\n## Tests (12 tests)\n\n### Setup/Teardown\n1. Creates temporary git repository with initial commit\n2. Cleans up all worktrees and temp dirs after tests\n\n### create() E2E (4 tests)\n3. Creates worktree in .worktrees/ directory\n4. Creates branch with agent/type/taskId pattern\n5. Creates .agent/scratchpad.md in worktree\n6. Fails if worktree already exists\n\n### remove() E2E (3 tests)\n7. Removes worktree directory\n8. Deletes merged branch with deleteBranch: true\n9. Keeps unmerged branch (no error)\n\n### list() E2E (2 tests)\n10. Lists all agent worktrees (excludes main)\n11. Returns empty array for no worktrees\n\n### Query E2E (2 tests)\n12. exists() returns true for existing worktree\n13. getInfo() returns headSha from real git\n\n### Edge Case (1 test)\n14. Works with worktree containing uncommitted changes\n\n## Files\n- src/test-utils/git-fixtures.ts (NEW)\n- src/e2e/worktree-service.e2e.test.ts (NEW)\n\n## Dependencies\n- Requires git CLI available\n- Uses real temporary directories","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-11T23:35:10.453686+03:00","created_by":"deligoez","updated_at":"2026-01-11T23:53:26.574057+03:00","closed_at":"2026-01-11T23:53:26.574057+03:00","close_reason":"WorktreeService E2E tests - 13 tests","labels":["m12-tui"]}
{"id":"ch-frrs","title":"FR16: Review Persistence - Persist review region state across restarts","description":"## What\nPersist review region state to survive app restarts.\n\n## Acceptance Criteria\n- [ ] Save pending reviews list to `.chorus/state.json` (review section)\n- [ ] Save current review index to state\n- [ ] Restore review state on app start\n- [ ] Clear state when all reviews completed (pendingReviews empty)\n- [ ] Handle missing state file gracefully (start fresh)\n- [ ] Handle corrupt state file gracefully (start fresh, log warning)\n- [ ] 6 tests pass\n\n## Files\n- src/services/ReviewPersistence.ts\n- src/services/ReviewPersistence.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:13:06.770704+03:00","created_by":"deligoez","updated_at":"2026-01-12T16:51:20.473823+03:00","closed_at":"2026-01-12T16:51:20.473823+03:00","close_reason":"Closed","labels":["m13-review"],"dependencies":[{"issue_id":"ch-frrs","depends_on_id":"ch-ooiw","type":"blocks","created_at":"2026-01-12T15:13:06.772877+03:00","created_by":"deligoez"},{"issue_id":"ch-frrs","depends_on_id":"ch-134l","type":"blocks","created_at":"2026-01-12T15:13:06.774542+03:00","created_by":"deligoez"}]}
{"id":"ch-fts","title":"F101b: TUI Planning Trigger","description":"## What\nTUI component for manually triggering incremental planning via keyboard shortcut.\n\n## Acceptance Criteria\n- [ ] `PlanningTrigger` React component exists\n- [ ] Displays spec progress in status bar: \"📝 Spec: 3/5\"\n- [ ] `P` shortcut triggers planning (if draft sections exist)\n- [ ] `Shift+P` shortcut forces planning (even if above threshold)\n- [ ] Shows \"✅ All planned\" when no draft sections\n- [ ] Disables P when no draft sections (shows tooltip)\n- [ ] Opens PlanningDialog when triggered\n- [ ] Dialog shows current status (ready tasks, threshold, next section)\n- [ ] Dialog has [P] Plan Next, [A] Plan All Remaining, [C] Cancel buttons\n- [ ] Integrates with F98 Incremental Planning Trigger for actual planning\n- [ ] 10 tests pass\n\n## Keyboard Shortcuts\n| Shortcut | Action | Condition |\n|----------|--------|-----------|\n| P | Plan more tasks | If spec has untasked sections |\n| Shift+P | Force plan | Always enabled |\n\n## Files\n- src/components/PlanningTrigger.tsx\n- src/components/PlanningDialog.tsx\n- tests/components/PlanningTrigger.test.tsx","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T09:18:11.975307+03:00","created_by":"deligoez","updated_at":"2026-01-12T10:25:04.08294+03:00","closed_at":"2026-01-12T10:25:04.08294+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-fts","depends_on_id":"ch-z8g","type":"blocks","created_at":"2026-01-11T13:44:36.394841+03:00","created_by":"deligoez"},{"issue_id":"ch-fts","depends_on_id":"ch-yhq","type":"blocks","created_at":"2026-01-11T14:01:52.322002+03:00","created_by":"deligoez"},{"issue_id":"ch-fts","depends_on_id":"ch-2yp","type":"blocks","created_at":"2026-01-11T14:01:52.391714+03:00","created_by":"deligoez"}]}
{"id":"ch-g2h","title":"F42b: Learnings Panel - TUI component to view shared learnings","description":"## What\nTUI component to display shared learnings from .agent/learnings.md.\n\n## Keyboard\n- `L` key toggles LearningsPanel overlay\n\n## API\n```typescript\n// src/components/LearningsPanel.tsx\n\ninterface LearningsPanelProps {\n  isVisible: boolean;\n  onClose: () =\u003e void;\n}\n\nfunction LearningsPanel({ isVisible, onClose }: LearningsPanelProps): JSX.Element | null\n\n// Shows:\n// - List of learnings grouped by category\n// - Source attribution (task ID, agent, date)\n// - Category filter/navigation\n```\n\n## Files\n- src/components/LearningsPanel.tsx (NEW)\n- src/hooks/useLearningsPanel.ts (NEW)\n- tests/components/LearningsPanel.test.tsx (NEW)\n\n## Acceptance Criteria\n- [ ] Renders overlay when isVisible=true\n- [ ] Returns null when isVisible=false\n- [ ] Groups learnings by category (## headings)\n- [ ] Shows source attribution for each learning\n- [ ] Calls onClose when ESC pressed\n- [ ] Scrollable when many learnings\n- [ ] 6 tests pass\n\n## Tests\n1. Renders when isVisible=true\n2. Returns null when isVisible=false\n3. Groups learnings by category\n4. Shows source attribution\n5. ESC key calls onClose\n6. Handles empty learnings gracefully","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T11:46:29.619228+03:00","created_by":"deligoez","updated_at":"2026-01-12T05:57:39.697807+03:00","closed_at":"2026-01-12T05:57:39.697807+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-g2h","depends_on_id":"ch-a6h","type":"blocks","created_at":"2026-01-10T11:46:29.621385+03:00","created_by":"deligoez"}]}
{"id":"ch-g3of","title":"FX09: TUI Machine - Focus, modal, and selection state management","description":"## What\n**Minimal** TUI region as parallel sub-machine within ChorusMachine, managing only **behavior-affecting** UI state.\n\n## Key Principle: Minimal TUI Region\n\nTUI region only contains state that **affects behavior** (keyboard routing, modal blocking):\n\n```typescript\n// INCLUDE in machine (affects behavior)\ntui: {\n  type: 'parallel',\n  states: {\n    focus: {  // Keyboard routing depends on this\n      initial: 'agentGrid',\n      states: { agentGrid: {}, taskPanel: {} }\n    },\n    modal: {  // Keyboard routing depends on this\n      initial: 'closed',\n      states: { closed: {}, help: {}, intervention: {}, confirm: {} }\n    }\n  }\n}\n\n// EXCLUDE from machine (pure UI, kept in React)\n// - Scroll position\n// - Hover states\n// - Animation frames\n// - Input focus (DOM level)\n// - Expanded/collapsed sections\n```\n\n## Architecture\n\n```\n┌─────────────────────────────────────────────────────────────────┐\n│                   MINIMAL TUI REGION                             │\n│                     type: 'parallel'                             │\n├─────────────────────────────────────────────────────────────────┤\n│  ┌─────────────┐  ┌─────────────┐                               │\n│  │    focus    │  │    modal    │                               │\n│  │  taskPanel  │  │   closed    │                               │\n│  │  agentGrid  │  │   help      │                               │\n│  │             │  │ intervention│                               │\n│  │             │  │  confirm    │                               │\n│  │             │  │  learnings  │                               │\n│  │             │  │  logs       │                               │\n│  │             │  │  settings   │                               │\n│  └─────────────┘  └─────────────┘                               │\n│                                                                  │\n│  Selection state: Moved to ChorusMachine context                │\n│  (selectedTaskId, selectedAgentId)                              │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n**Note:** Selection removed from TUI parallel states - it's context, not a state node.\n\n## TUI Context (part of ChorusMachineContext)\n\n```typescript\ninterface TUIContext {\n  // Selection (simple context, not state nodes)\n  selectedTaskId: string | null;\n  selectedAgentId: string | null;\n  \n  // Navigation indices\n  taskIndex: number;\n  agentIndex: number;\n  \n  // Confirm dialog payload\n  pendingConfirm?: {\n    action: 'quit' | 'stop_agent' | 'block_task';\n    payload?: unknown;\n  };\n}\n```\n\n## TUI Events\n\n```typescript\ntype TUIEvent =\n  // Focus\n  | { type: 'FOCUS_TASK_PANEL' }\n  | { type: 'FOCUS_AGENT_GRID' }\n  | { type: 'TOGGLE_FOCUS' }\n\n  // Modals\n  | { type: 'OPEN_HELP' }\n  | { type: 'OPEN_INTERVENTION' }\n  | { type: 'OPEN_LOGS'; agentId: string }\n  | { type: 'OPEN_LEARNINGS' }\n  | { type: 'OPEN_CONFIRM'; action: ConfirmAction }\n  | { type: 'OPEN_SETTINGS' }\n  | { type: 'CLOSE_MODAL' }\n\n  // Selection (updates context, not state)\n  | { type: 'SELECT_TASK'; taskId: string }\n  | { type: 'SELECT_AGENT'; agentId: string }\n  | { type: 'SELECT_NEXT' }\n  | { type: 'SELECT_PREV' }\n  | { type: 'CLEAR_SELECTION' };\n```\n\n## XState Testing Pattern\n\n```typescript\nimport { createActor } from 'xstate';\nimport { describe, it, expect } from 'vitest';\nimport { chorusMachine } from './chorus.machine';\n\ndescribe('TUI Region', () =\u003e {\n  describe('focus states', () =\u003e {\n    it('starts with agentGrid focused', () =\u003e {\n      // Arrange\n      const actor = createActor(chorusMachine);\n      actor.start();\n      \n      // Assert\n      expect(actor.getSnapshot().matches({ tui: { focus: 'agentGrid' } })).toBe(true);\n    });\n\n    it('TOGGLE_FOCUS switches between panels', () =\u003e {\n      // Arrange\n      const actor = createActor(chorusMachine);\n      actor.start();\n      \n      // Act\n      actor.send({ type: 'TOGGLE_FOCUS' });\n      \n      // Assert\n      expect(actor.getSnapshot().matches({ tui: { focus: 'taskPanel' } })).toBe(true);\n    });\n  });\n\n  describe('modal states', () =\u003e {\n    it('OPEN_HELP transitions to help modal', () =\u003e {\n      const actor = createActor(chorusMachine);\n      actor.start();\n      \n      actor.send({ type: 'OPEN_HELP' });\n      \n      expect(actor.getSnapshot().matches({ tui: { modal: 'help' } })).toBe(true);\n    });\n\n    it('CLOSE_MODAL returns to closed', () =\u003e {\n      const actor = createActor(chorusMachine);\n      actor.start();\n      actor.send({ type: 'OPEN_HELP' });\n      \n      actor.send({ type: 'CLOSE_MODAL' });\n      \n      expect(actor.getSnapshot().matches({ tui: { modal: 'closed' } })).toBe(true);\n    });\n  });\n\n  describe('keyboard routing guards', () =\u003e {\n    it('blocks navigation keys when modal is open', () =\u003e {\n      const actor = createActor(chorusMachine);\n      actor.start();\n      actor.send({ type: 'OPEN_HELP' });\n      \n      // SELECT_NEXT should be ignored when modal open\n      const before = actor.getSnapshot().context.taskIndex;\n      actor.send({ type: 'SELECT_NEXT' });\n      const after = actor.getSnapshot().context.taskIndex;\n      \n      expect(after).toBe(before); // No change\n    });\n  });\n});\n```\n\n## Acceptance Criteria\n\n### Focus States - 3 tests\n- [ ] Initial focus is 'agentGrid' (changed from taskPanel)\n- [ ] TOGGLE_FOCUS switches between taskPanel and agentGrid\n- [ ] FOCUS_TASK_PANEL/FOCUS_AGENT_GRID set specific focus\n\n### Modal States - 4 tests\n- [ ] Initial modal state is 'closed'\n- [ ] OPEN_* events transition to corresponding modal state\n- [ ] CLOSE_MODAL transitions back to 'closed'\n- [ ] Only one modal can be open at a time (modal is NOT parallel)\n\n### Selection Context - 3 tests\n- [ ] Initial selection is null for both taskId and agentId\n- [ ] SELECT_TASK updates context.selectedTaskId via assign action\n- [ ] SELECT_AGENT updates context.selectedAgentId via assign action\n\n### Keyboard Routing Guards - 4 tests\n- [ ] Navigation keys only work when modal.closed (guard: isModalClosed)\n- [ ] ESC always triggers CLOSE_MODAL from any modal\n- [ ] Modal-specific shortcuts only work in that modal\n- [ ] Confirmation dialog blocks all other keys\n\n### Summary\n- [ ] 14 tests pass\n\n## Files\n- src/machines/chorus.machine.ts (UPDATE - add TUI region)\n- src/types/xstate.types.ts (UPDATE - add TUI types)\n- tests/machines/tui.region.test.ts (CREATE - isolated TUI tests)\n\n## Dependencies\n- FX03 (Root Machine) - TUI region added to parallel regions","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-11T15:56:50.790464+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:13:11.769563+03:00","closed_at":"2026-01-11T18:13:11.769563+03:00","close_reason":"Closed","labels":["m-1-xstate"],"dependencies":[{"issue_id":"ch-g3of","depends_on_id":"ch-kjae","type":"blocks","created_at":"2026-01-11T15:56:50.793951+03:00","created_by":"deligoez"}]}
{"id":"ch-g6z","title":"F20: useOrchestration Hook - TUI orchestration integration","description":"## What\nReact hook for TUI components to interact with ChorusMachine orchestration.\n\n## Architecture Change (XState v5)\n\n**CRITICAL:** This hook wraps `useChorusMachine` from FX07, NOT Zustand stores.\n\n```typescript\n// OLD (Zustand) - DO NOT USE\nconst { state, dispatch } = useOrchestrationStore();\n\n// NEW (XState) - CORRECT\nconst { snapshot, send, actorRef } = useChorusMachine();\nconst orchestrationState = useSelector(actorRef, selectOrchestration);\n```\n\n## Implementation\n\n```typescript\nimport { useChorusMachine } from './useChorusMachine';\nimport { useSelector } from '@xstate/react';\n\n// Selectors for performance (avoid re-renders)\nconst selectOrchestration = (snapshot) =\u003e ({\n  status: snapshot.matches({ orchestration: 'running' }) ? 'running' \n        : snapshot.matches({ orchestration: 'paused' }) ? 'paused' \n        : 'idle',\n  isPaused: snapshot.matches({ orchestration: 'paused' }),\n  isRunning: snapshot.matches({ orchestration: 'running' }),\n  mode: snapshot.context.mode,\n  agents: snapshot.context.agents,\n  stats: snapshot.context.stats,\n});\n\nexport function useOrchestration() {\n  const { actorRef, send } = useChorusMachine();\n  const state = useSelector(actorRef, selectOrchestration);\n\n  return {\n    // State (read-only)\n    ...state,\n\n    // Actions (send events to machine)\n    startTask: (taskId: string) =\u003e send({ type: 'SPAWN_AGENT', taskId }),\n    stopAgent: (agentId: string) =\u003e send({ type: 'STOP_AGENT', agentId }),\n    pause: () =\u003e send({ type: 'PAUSE' }),\n    resume: () =\u003e send({ type: 'RESUME' }),\n    setMode: (mode: 'semi-auto' | 'autopilot') =\u003e send({ type: 'SET_MODE', mode }),\n  };\n}\n```\n\n## XState Testing Pattern\n\n```typescript\nimport { renderHook, act } from '@testing-library/react';\nimport { createActor } from 'xstate';\nimport { chorusMachine } from '../machines/chorus.machine';\n\n// Test wrapper that provides actor context\nconst createWrapper = (actor) =\u003e ({ children }) =\u003e (\n  \u003cChorusProvider actor={actor}\u003e\n    {children}\n  \u003c/ChorusProvider\u003e\n);\n\ndescribe('useOrchestration', () =\u003e {\n  it('should return orchestration status from machine', () =\u003e {\n    // Arrange\n    const actor = createActor(chorusMachine);\n    actor.start();\n    const wrapper = createWrapper(actor);\n\n    // Act\n    const { result } = renderHook(() =\u003e useOrchestration(), { wrapper });\n\n    // Assert\n    expect(result.current.status).toBe('idle');\n    expect(result.current.isPaused).toBe(false);\n  });\n\n  it('should send PAUSE event to machine', () =\u003e {\n    // Arrange\n    const actor = createActor(chorusMachine);\n    actor.start();\n    const sendSpy = vi.spyOn(actor, 'send');\n    const wrapper = createWrapper(actor);\n    const { result } = renderHook(() =\u003e useOrchestration(), { wrapper });\n\n    // Act\n    act(() =\u003e {\n      result.current.pause();\n    });\n\n    // Assert\n    expect(sendSpy).toHaveBeenCalledWith({ type: 'PAUSE' });\n  });\n\n  it('should send SPAWN_AGENT event on startTask', () =\u003e {\n    // Arrange\n    const actor = createActor(chorusMachine);\n    actor.start();\n    const sendSpy = vi.spyOn(actor, 'send');\n    const wrapper = createWrapper(actor);\n    const { result } = renderHook(() =\u003e useOrchestration(), { wrapper });\n\n    // Act\n    act(() =\u003e {\n      result.current.startTask('ch-001');\n    });\n\n    // Assert\n    expect(sendSpy).toHaveBeenCalledWith({ \n      type: 'SPAWN_AGENT', \n      taskId: 'ch-001' \n    });\n  });\n\n  it('should use selector for performance (no re-render on unrelated changes)', () =\u003e {\n    // Arrange\n    const actor = createActor(chorusMachine);\n    actor.start();\n    const wrapper = createWrapper(actor);\n    const renderCount = vi.fn();\n\n    const { result, rerender } = renderHook(() =\u003e {\n      renderCount();\n      return useOrchestration();\n    }, { wrapper });\n\n    const initialRenderCount = renderCount.mock.calls.length;\n\n    // Act - send event that changes mergeQueue but not orchestration\n    act(() =\u003e {\n      actor.send({ type: 'ENQUEUE_MERGE', taskId: 'task-1', branch: 'feat/x' });\n    });\n    rerender();\n\n    // Assert - should not re-render for unrelated state change\n    // (Note: actual behavior depends on selector implementation)\n    expect(result.current.status).toBe('idle'); // orchestration unchanged\n  });\n\n  it('should reflect mode change after SET_MODE event', () =\u003e {\n    // Arrange\n    const actor = createActor(chorusMachine);\n    actor.start();\n    const wrapper = createWrapper(actor);\n    const { result } = renderHook(() =\u003e useOrchestration(), { wrapper });\n\n    // Act\n    act(() =\u003e {\n      result.current.setMode('autopilot');\n    });\n\n    // Assert\n    expect(result.current.mode).toBe('autopilot');\n  });\n\n  it('should reflect agents array after SPAWN_AGENT', async () =\u003e {\n    // Arrange\n    const actor = createActor(chorusMachine);\n    actor.start();\n    const wrapper = createWrapper(actor);\n    const { result, rerender } = renderHook(() =\u003e useOrchestration(), { wrapper });\n\n    // Act\n    act(() =\u003e {\n      actor.send({ type: 'SPAWN_AGENT', taskId: 'ch-001' });\n    });\n    rerender();\n\n    // Assert\n    expect(result.current.agents).toHaveLength(1);\n  });\n});\n```\n\n## Acceptance Criteria\n\n### State Exposure - 3 tests\n- [ ] Returns `status` ('idle' | 'running' | 'paused') from machine state\n- [ ] Returns `isPaused` and `isRunning` booleans\n- [ ] Returns `mode`, `agents`, `stats` from machine context\n\n### Action Helpers - 4 tests\n- [ ] `startTask(taskId)` sends SPAWN_AGENT event\n- [ ] `stopAgent(agentId)` sends STOP_AGENT event\n- [ ] `pause()` sends PAUSE event\n- [ ] `resume()` sends RESUME event\n- [ ] `setMode(mode)` sends SET_MODE event\n\n### Performance - 2 tests\n- [ ] Uses useSelector for efficient re-rendering\n- [ ] Does not re-render on unrelated state changes\n\n### Summary\n- [ ] 9 tests pass\n\n## Files\n- src/hooks/useOrchestration.ts (CREATE)\n- tests/hooks/useOrchestration.test.tsx (CREATE)\n\n## Dependencies\n- FX07 (React Integration) - provides useChorusMachine and ChorusProvider\n\n## Implementation Notes\n- This is a WRAPPER around useChorusMachine for orchestration-specific needs\n- Components can use useChorusMachine directly for full access\n- Selectors should be memoized for performance","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T02:07:43.468053+03:00","created_by":"deligoez","updated_at":"2026-01-12T06:23:34.924619+03:00","closed_at":"2026-01-12T06:23:34.924619+03:00","close_reason":"Closed","labels":["m4-orchestration"],"dependencies":[{"issue_id":"ch-g6z","depends_on_id":"ch-0e7","type":"blocks","created_at":"2026-01-10T02:07:43.470457+03:00","created_by":"deligoez"},{"issue_id":"ch-g6z","depends_on_id":"ch-lhm","type":"blocks","created_at":"2026-01-10T02:07:43.47217+03:00","created_by":"deligoez"},{"issue_id":"ch-g6z","depends_on_id":"ch-7gx","type":"blocks","created_at":"2026-01-10T02:07:43.47353+03:00","created_by":"deligoez"},{"issue_id":"ch-g6z","depends_on_id":"ch-999","type":"blocks","created_at":"2026-01-10T23:51:05.756721+03:00","created_by":"deligoez"},{"issue_id":"ch-g6z","depends_on_id":"ch-vskx","type":"blocks","created_at":"2026-01-11T15:27:37.904939+03:00","created_by":"deligoez"}]}
{"id":"ch-gd10","title":"BUG: Fix Node.js DEP0190 deprecation warnings","description":"## What\nNode.js 22+ shows DEP0190 deprecation warnings:\n`DeprecationWarning: Passing args to a child process with shell option true can lead to security vulnerabilities, as the arguments are not escaped, only joined with spaces`\n\n## Root Cause\nUsing `shell: true` with an args array in execa or child_process. The shell option expects a single command string, not separate args.\n\n## Acceptance Criteria\n- [ ] Identify all occurrences of `shell: true` with args\n- [ ] Refactor to either use shell: false or single command string\n- [ ] No DEP0190 warnings in test output\n- [ ] 0 deprecation warnings in test suite\n\n## Files to Check\n- src/services/ (all service files using execa)\n- src/e2e/ (E2E test files)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T08:54:48.329667+03:00","created_by":"deligoez","updated_at":"2026-01-12T09:43:47.384856+03:00","closed_at":"2026-01-12T09:43:47.384856+03:00","close_reason":"Closed","labels":["bug"]}
{"id":"ch-gk7","title":"F62b: TaskIterationDisplay Component - Show agent iteration on task","description":"## What\nComponent to display agent iteration information on a task in the task list.\n\n## Context from Master Plan\n```\n│ → ch-001 [P1] Implement auth   │\n│   ● claude | iter 7            │\n```\n\n## API\n```typescript\n// src/components/TaskIterationDisplay.tsx\n\ninterface TaskIterationDisplayProps {\n  agentType: 'claude' | 'codex' | 'opencode';\n  iteration: number;\n}\n\nfunction TaskIterationDisplay({ agentType, iteration }: TaskIterationDisplayProps): JSX.Element\n```\n\n## Visual Output\n```\n  ● claude | iter 7\n```\n\n## Files\n- src/components/TaskIterationDisplay.tsx\n- src/components/TaskIterationDisplay.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows agent type in lowercase\n- [ ] Shows iteration count with \"iter\" prefix\n- [ ] Uses pipe separator\n- [ ] Uses green dot for running indicator\n- [ ] Has proper indentation (matches task list)\n- [ ] Uses dimColor for the separator\n- [ ] 6 tests pass\n\n## Tests\n1. Shows agent type lowercase\n2. Shows \"iter X\" format\n3. Uses pipe separator\n4. Shows green dot indicator\n5. Has proper indentation\n6. Uses correct styling","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:51:47.383036+03:00","created_by":"deligoez","updated_at":"2026-01-11T21:04:34.037054+03:00","closed_at":"2026-01-11T21:04:34.037054+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-gk7","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:53.827827+03:00","created_by":"deligoez"}]}
{"id":"ch-glf","title":"F24: Merge Queue","description":"## What\nPriority queue for pending merge operations with dependency ordering, priority boost, and retry tracking.\n\n## Acceptance Criteria\n\n### enqueue() - 4 tests\n- [ ] `enqueue()` adds item to queue\n- [ ] Items sorted by priority boost (P0:+200 \u003e P1:+100 \u003e P2:+50 \u003e P3:+10 \u003e P4:+0)\n- [ ] Same priority items sorted by enqueuedAt (FIFO)\n- [ ] Sets `status: 'waiting_dependency'` if item has unmerged dependencies\n\n### dequeue() - 5 tests\n- [ ] `dequeue()` returns highest priority item with `status: 'ready'`\n- [ ] `dequeue()` skips items with `status: 'waiting_dependency'`\n- [ ] `dequeue()` returns `null` when queue empty\n- [ ] `dequeue()` sets returned item as `status: 'processing'`\n- [ ] `dequeue()` updates `waiting_dependency` to `ready` when deps merge\n\n### deferToEnd() - 2 tests\n- [ ] Moves conflicted item to end of queue\n- [ ] Increments retry count on item\n\n### markCompleted() - 2 tests\n- [ ] Clears `processing`, increments `stats.completed`\n- [ ] Triggers dependency check for waiting items (notify dependents)\n\n### markFailed() - 2 tests\n- [ ] Clears `processing`, increments `stats.failed`\n- [ ] Returns `{ needsEscalation: true }` after 3 retries\n\n### getStats() - 1 test\n- [ ] Returns accurate pending/processing/completed/failed/waiting counts\n\n### Summary\n- [ ] 16 tests pass\n\n## Priority Boost Values (from Master Plan)\n\n| Priority | Flag | Boost | Description |\n|----------|------|-------|-------------|\n| P0 | `-p 0` | +200 | Blocker - must fix immediately |\n| P1 | `-p 1` | +100 | Critical - urgent |\n| P2 | `-p 2` | +50 | High - important |\n| P3 | `-p 3` | +10 | Medium - normal (default) |\n| P4 | `-p 4` | +0 | Low - FIFO only |\n\n**Queue Score Calculation:**\n```typescript\nconst score = (item: MergeItem) =\u003e {\n  const priorityBoost = PRIORITY_BOOST[item.priority]; // P0:200, P1:100, etc.\n  const ageBonus = Date.now() - item.enqueuedAt; // older items get slight boost\n  return priorityBoost * 1000 + ageBonus;\n};\n```\n\n## Dependency Wait Behavior (from Master Plan)\n\nWhen task ch-002 depends on ch-001:\n\n```\n1. ch-002 completes before ch-001\n2. ch-002 enters queue with status: 'waiting_dependency'\n3. TUI shows: \"ch-002 waiting on ch-001 merge\"\n4. When ch-001 merges successfully:\n   a. ch-002 status changes to 'ready'\n   b. ch-002 rebases onto new main (handled by MergeWorker)\n   c. ch-002 proceeds to merge\n5. If ch-001 merge fails: ch-002 stays waiting, alert user\n```\n\n## Merge Ordering Rules\n1. **DEPENDENCY ORDER** (highest priority): If B depends on A, A merges first\n2. **PRIORITY BOOST**: P0 \u003e P1 \u003e P2 \u003e P3 \u003e P4 with specific boost values\n3. **FIFO** within same effective priority\n4. **CONFLICT DEFERRAL**: Failed items go to end, max 3 retries\n\n## Interface\n```typescript\ntype MergeItemStatus = 'ready' | 'waiting_dependency' | 'processing';\n\ninterface MergeItem {\n  taskId: string;\n  branch: string;\n  worktree: string;\n  priority: 0 | 1 | 2 | 3 | 4;\n  enqueuedAt: number;\n  status: MergeItemStatus;\n  dependencies: string[];  // taskIds this depends on\n  retryCount: number;\n}\n\ninterface QueueStats {\n  pending: number;      // ready items\n  waiting: number;      // waiting_dependency items\n  processing: number;\n  completed: number;\n  failed: number;\n}\n\nconst PRIORITY_BOOST: Record\u003cnumber, number\u003e = {\n  0: 200,\n  1: 100,\n  2: 50,\n  3: 10,\n  4: 0,\n};\n```\n\n## Files\n- src/services/MergeQueue.ts\n- tests/services/MergeQueue.test.ts\n\n## Notes\n- Queue is in-memory (not persisted)\n- Dependency check happens on markCompleted() to notify waiting items\n- TUI integration via events for \"waiting on\" display","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T03:16:04.345671+03:00","created_by":"deligoez","updated_at":"2026-01-11T19:19:43.530513+03:00","closed_at":"2026-01-11T19:19:43.530513+03:00","close_reason":"Closed","labels":["m5-merge"],"dependencies":[{"issue_id":"ch-glf","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:51.987006+03:00","created_by":"deligoez"}]}
{"id":"ch-glq","title":"F04: Worktree Create - git worktree add for isolation","description":"## What\nCreate isolated git worktrees for agent task execution.\n\n## Acceptance Criteria\n\n### create() - 8 tests\n- [ ] Runs: `git worktree add .worktrees/{agent}-{task} -b agent/{agent}/{task} main`\n- [ ] Creates `.worktrees/` directory if it doesn't exist\n- [ ] Creates `.agent/` directory in worktree\n- [ ] Copies scratchpad template from `.chorus/templates/scratchpad.md` to `{worktree}/.agent/scratchpad.md`\n- [ ] Substitutes `{task_id}` placeholder in scratchpad template with actual task ID\n- [ ] Returns `WorktreeInfo` with path, branch, agentType, taskId\n- [ ] Throws `WorktreeExistsError` if worktree already exists for agent+task\n- [ ] Throws `GitError` if git worktree command fails (non-zero exit)\n\n### Scratchpad Template (from Master Plan)\n**Template Source:** `.chorus/templates/scratchpad.md`\n**Destination:** `{worktree}/.agent/scratchpad.md`\n\n**Why separate locations?**\n- Template lives in `.chorus/` (project config, git-tracked)\n- Instance lives in worktree's `.agent/` (per-agent, gitignored in worktree)\n- Each agent gets a fresh copy with task ID substituted\n\n**Template Content** (`.chorus/templates/scratchpad.md`):\n```markdown\n# Task Scratchpad: {task_id}\n\n## Notes\n\u003c!-- Agent writes discoveries, observations, decisions here --\u003e\n\n## Learnings\n\u003c!-- Patterns discovered that should be shared with other agents --\u003e\n\u003c!-- Use category prefixes: [LOCAL], [CROSS-CUTTING], [ARCHITECTURAL] --\u003e\n\n## Blockers\n\u003c!-- If stuck, document the issue and what you've tried --\u003e\n```\n\n### Fallback Behavior - 1 test\n- [ ] Uses built-in default template if `.chorus/templates/scratchpad.md` doesn't exist\n\n### Query Methods - 4 tests\n- [ ] `exists(agentType, taskId)` returns `true` if `.worktrees/{agent}-{task}` directory exists\n- [ ] `exists(agentType, taskId)` returns `false` if directory doesn't exist\n- [ ] `getPath(agentType, taskId)` returns absolute path: `{projectDir}/.worktrees/{agent}-{task}`\n- [ ] `getBranch(agentType, taskId)` returns branch name: `agent/{agent}/{task}`\n\n### list() - 1 test\n- [ ] `list()` parses `git worktree list --porcelain` and returns array of `WorktreeInfo`\n\n### Summary\n- [ ] 14 tests pass\n\n## Files\n- src/services/WorktreeService.ts (NEW)\n- tests/services/WorktreeService.test.ts (NEW)\n\n## Interface\n```typescript\ninterface WorktreeInfo {\n  path: string;      // .worktrees/claude-ch-a1b2\n  branch: string;    // agent/claude/ch-a1b2\n  agentType: string;\n  taskId: string;\n}\n\nclass WorktreeExistsError extends Error {}\nclass GitError extends Error {}\n\nclass WorktreeService {\n  constructor(projectDir: string);\n  \n  async create(agentType: string, taskId: string): Promise\u003cWorktreeInfo\u003e;\n  exists(agentType: string, taskId: string): boolean;\n  getPath(agentType: string, taskId: string): string;\n  getBranch(agentType: string, taskId: string): string;\n  list(): WorktreeInfo[];\n  \n  // Internal\n  private loadTemplate(): string;\n  private applyTemplateSubstitutions(template: string, taskId: string): string;\n}\n```\n\n## Git Worktree List Parsing\n`git worktree list --porcelain` output format:\n```\nworktree /path/to/.worktrees/claude-ch-a1b2\nHEAD abc123def456\nbranch refs/heads/agent/claude/ch-a1b2\n\nworktree /path/to/.worktrees/cursor-ch-x1y2\nHEAD def789abc012\nbranch refs/heads/agent/cursor/ch-x1y2\n```\n\nParse into WorktreeInfo by:\n1. Extract path from `worktree` line\n2. Extract branch from `branch` line (strip `refs/heads/`)\n3. Parse agentType and taskId from branch name pattern\n\n## Built-in Default Template (fallback)\n```markdown\n# Task Scratchpad: {task_id}\n\n## Notes\n\n## Learnings\n\n## Blockers\n```\n\n## Test Cases (14 total)\n1. create() runs git worktree add command correctly\n2. create() creates .worktrees/ directory if missing\n3. create() creates .agent/ directory in worktree\n4. create() copies template from .chorus/templates/scratchpad.md\n5. create() substitutes {task_id} in template\n6. create() returns correct WorktreeInfo\n7. create() throws WorktreeExistsError if already exists\n8. create() throws GitError on git command failure\n9. create() uses fallback template if .chorus/templates/scratchpad.md missing\n10. exists() returns true for existing worktree\n11. exists() returns false for non-existent worktree\n12. getPath() returns correct absolute path\n13. getBranch() returns correct branch name\n14. list() parses git worktree list output correctly\n\n## Notes\n- Worktree path: `.worktrees/` at project root (per Decision #17)\n- Template path: `.chorus/templates/scratchpad.md`\n- Instance path: `{worktree}/.agent/scratchpad.md`","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T01:31:03.217127+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:41:08.891883+03:00","closed_at":"2026-01-11T18:41:08.891883+03:00","close_reason":"Closed","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-glq","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:34.740019+03:00","created_by":"deligoez"}]}
{"id":"ch-gnf","title":"F25b: Force-Push Recovery","description":"## What\nDetect and recover from force-pushes to main branch during merge operations.\n\n## Context from Master Plan\n\n**Force-Push Recovery (line 1754-1760):**\n```\n5. FORCE-PUSH RECOVERY\n   If main branch is force-pushed during merge:\n   - Detect via git fetch + ref comparison\n   - Pull latest main\n   - Rebase agent branch onto new main\n   - Retry merge from beginning\n   - After 2 force-push recoveries: pause and alert user\n```\n\n## Detection Strategy\n\n```typescript\n// Before merge attempt\nconst mainRefBefore = await git.getRef('refs/heads/main');\n\n// Attempt merge...\nconst mergeResult = await mergeWorker.merge(item);\n\n// If merge fails with specific errors\nif (mergeResult.error?.includes('fetch first') || \n    mergeResult.error?.includes('non-fast-forward')) {\n  \n  // Fetch and check if main changed\n  await git.fetch('origin', 'main');\n  const mainRefAfter = await git.getRef('refs/heads/main');\n  \n  if (mainRefBefore !== mainRefAfter) {\n    // Force-push detected!\n    return { forcePushDetected: true };\n  }\n}\n```\n\n## API\n\n```typescript\n// src/services/ForcePushRecovery.ts\n\ninterface ForcePushRecoveryDeps {\n  git: GitService;\n  rebaseRetry: RebaseRetry;\n}\n\ninterface RecoveryResult {\n  success: boolean;\n  recovered: boolean;\n  recoveryCount: number;\n  needsPause?: boolean;  // true after 2 recoveries\n  error?: string;\n}\n\nclass ForcePushRecovery {\n  private recoveryCount: Map\u003cstring, number\u003e = new Map();\n  \n  constructor(private deps: ForcePushRecoveryDeps) {}\n  \n  /**\n   * Detect if main was force-pushed\n   */\n  async detectForcePush(beforeRef: string): Promise\u003cboolean\u003e\n  \n  /**\n   * Recover from force-push: fetch, rebase, prepare for retry\n   * @returns RecoveryResult with needsPause=true after 2 recoveries\n   */\n  async recover(taskId: string, branch: string): Promise\u003cRecoveryResult\u003e\n  \n  /**\n   * Get current recovery count for a task\n   */\n  getRecoveryCount(taskId: string): number\n  \n  /**\n   * Reset recovery count (after successful merge)\n   */\n  resetRecoveryCount(taskId: string): void\n}\n```\n\n## Acceptance Criteria\n\n### detectForcePush() - 3 tests\n- [ ] Returns `true` when main ref changed after fetch\n- [ ] Returns `false` when main ref unchanged\n- [ ] Returns `false` on fetch error (conservative)\n\n### recover() - 5 tests\n- [ ] Fetches latest main via `git.fetch('origin', 'main')`\n- [ ] Rebases branch onto new main via `rebaseRetry.rebase()`\n- [ ] Returns `{ success: true, recovered: true }` on successful rebase\n- [ ] Increments recoveryCount for taskId\n- [ ] Returns `{ needsPause: true }` after 2 recoveries for same task\n\n### getRecoveryCount() / resetRecoveryCount() - 2 tests\n- [ ] `getRecoveryCount()` returns current count (0 if never recovered)\n- [ ] `resetRecoveryCount()` clears count to 0\n\n### Summary\n- [ ] 10 tests pass\n\n## Integration with MergeWorker\n\n```typescript\n// In MergeWorker.process()\nasync process(item: MergeItem): Promise\u003cMergeResult\u003e {\n  const mainRefBefore = await this.git.getRef('refs/heads/main');\n  \n  const result = await this.attemptMerge(item);\n  \n  if (!result.success \u0026\u0026 this.looksLikeForcePush(result.error)) {\n    const forcePushed = await this.forcePushRecovery.detectForcePush(mainRefBefore);\n    \n    if (forcePushed) {\n      const recovery = await this.forcePushRecovery.recover(item.taskId, item.branch);\n      \n      if (recovery.needsPause) {\n        this.emit('forcePushPause', { taskId: item.taskId, recoveries: 2 });\n        return { success: false, paused: true, reason: 'force_push_limit' };\n      }\n      \n      if (recovery.success) {\n        // Retry merge from beginning\n        return this.process(item);\n      }\n    }\n  }\n  \n  return result;\n}\n```\n\n## Files\n- src/services/ForcePushRecovery.ts\n- tests/services/ForcePushRecovery.test.ts\n\n## Notes\n- Max 2 force-push recoveries per task before pausing\n- Pause triggers TUI alert for human attention\n- Recovery count reset on successful merge\n- Conservative: if detection fails, assume no force-push","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T11:46:14.992861+03:00","created_by":"deligoez","updated_at":"2026-01-11T19:37:01.616102+03:00","closed_at":"2026-01-11T19:37:01.616102+03:00","close_reason":"Closed","labels":["m5-merge"],"dependencies":[{"issue_id":"ch-gnf","depends_on_id":"ch-fe5","type":"blocks","created_at":"2026-01-11T11:46:14.995118+03:00","created_by":"deligoez"}]}
{"id":"ch-gzhj","title":"CHORE: Zustand Test Cleanup","description":"## What\nRemove deprecated Zustand store tests after XState migration is complete.\n\n## Why\n- Zustand stores (agentStore, beadsStore) are replaced by XState machines\n- Their tests are no longer valid\n- Keeps test suite clean and focused\n\n## Files to Delete\n- src/stores/agentStore.test.ts\n- src/stores/beadsStore.test.ts\n\n## Files to Keep (Update to AAA pattern)\n- src/services/BeadsService.test.ts\n- src/services/BeadsParser.test.ts\n- src/services/AgentManager.test.ts (may need XState updates)\n\n## Acceptance Criteria\n- [ ] agentStore.test.ts deleted\n- [ ] beadsStore.test.ts deleted\n- [ ] Remaining service tests updated to AAA pattern (// Arrange, // Act, // Assert comments)\n- [ ] All tests pass after cleanup\n- [ ] 0 Zustand imports in test files\n\n## Notes\n- Only execute AFTER FX08 (Migration Bridge) is complete\n- Verify no component depends on Zustand stores before deletion","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T16:36:36.450556+03:00","created_by":"deligoez","updated_at":"2026-01-12T10:14:02.343453+03:00","closed_at":"2026-01-12T10:14:02.343453+03:00","close_reason":"Deleted deprecated Zustand store test files and unused beadsStore.ts. AAA comments for service tests deferred - tests already structured correctly.","labels":["m-1-xstate"],"dependencies":[{"issue_id":"ch-gzhj","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T16:36:36.456259+03:00","created_by":"deligoez"}]}
{"id":"ch-h0s","title":"F80c: Quality Commands Manager Service","description":"## What\nManage quality commands (add, remove, toggle, execute).\n\n## Files\n- `src/services/QualityCommandsManager.ts`\n- `src/services/QualityCommandsManager.test.ts`\n\n## Acceptance Criteria\n- [ ] `add(name: string, command: string, required: boolean)` adds command to list\n- [ ] `remove(index: number)` removes command at index\n- [ ] `remove()` throws if index out of bounds\n- [ ] `toggle(index: number)` toggles required/optional\n- [ ] `reorder(from: number, to: number)` changes execution order\n- [ ] `runAll()` executes all commands in order, returns results array\n- [ ] `runRequired()` executes only required commands\n- [ ] `runAll()` stops on first required command failure\n- [ ] `runAll()` continues on optional command failure\n- [ ] Returns `{ name, success, output, duration }` for each command\n- [ ] 10 tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:05:35.472689+03:00","created_by":"deligoez","updated_at":"2026-01-11T22:30:26.679349+03:00","closed_at":"2026-01-11T22:30:26.679349+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-h0s","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:13.524141+03:00","created_by":"deligoez"}]}
{"id":"ch-h1n6","title":"E2E-05: Task Operations","description":"## What\nE2E tests for task creation, marking done, and blocking.\n\n## Tests (8 tests)\n\n### New Task\n1. 'n' opens new task dialog\n2. Can enter task title\n3. Task appears in TaskPanel after creation\n\n### Mark Done\n4. 'd' marks selected task as done\n5. Task shows ✓ indicator\n6. Task stats update in footer\n\n### Block Task\n7. 'b' blocks selected task\n8. Task shows ⊗ indicator with blocker info\n\n## Files\n- src/e2e/task-operations.e2e.test.ts (NEW)\n\n## Depends On\n- ch-kxpd: E2E Infrastructure\n- ch-im6: New Task Key\n- ch-02h: Manual Done Key\n- ch-sb7: Task Block","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-11T21:15:58.789435+03:00","created_by":"deligoez","updated_at":"2026-01-11T21:23:25.103466+03:00","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-h1n6","depends_on_id":"ch-kxpd","type":"blocks","created_at":"2026-01-11T21:15:58.792094+03:00","created_by":"deligoez"},{"issue_id":"ch-h1n6","depends_on_id":"ch-im6","type":"blocks","created_at":"2026-01-11T21:15:58.796782+03:00","created_by":"deligoez"},{"issue_id":"ch-h1n6","depends_on_id":"ch-02h","type":"blocks","created_at":"2026-01-11T21:15:58.798697+03:00","created_by":"deligoez"},{"issue_id":"ch-h1n6","depends_on_id":"ch-sb7","type":"blocks","created_at":"2026-01-11T21:15:58.800348+03:00","created_by":"deligoez"}],"deleted_at":"2026-01-11T21:23:25.103466+03:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"ch-h91e","title":"BUG: Add tests for PendingPatternStore service","description":"## What\nPendingPatternStore service has no unit tests.\n\n## Current State\n- src/services/PendingPatternStore.ts exists\n- No corresponding test file\n\n## Why\nPattern storage for approval workflow needs test coverage.\n\n## Acceptance Criteria\n- [ ] PendingPatternStore.test.ts exists\n- [ ] Tests cover add() method\n- [ ] Tests cover remove() method\n- [ ] Tests cover getPending() with expiry filtering\n- [ ] Tests cover getCount()\n- [ ] Tests cover createSuggestion static method\n- [ ] 6 tests pass\n\n## Files\n- src/services/PendingPatternStore.ts\n- src/services/PendingPatternStore.test.ts (create)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T13:29:22.185655+03:00","created_by":"deligoez","updated_at":"2026-01-12T13:58:50.704073+03:00","closed_at":"2026-01-12T13:58:50.704073+03:00","close_reason":"Closed","labels":["m8-memory"]}
{"id":"ch-hhh","title":"F60a: AgentGrid Component - Tiling grid layout for agents","description":"## What\nTiling grid layout for displaying multiple agent tiles.\n\n## Context from Master Plan\n```\n│ │ CLAUDE (ch-001)   │ CODEX (ch-002)    │  │\n│ │ iter 7/50 | 12m   │ iter 3/50 | 5m    │  │\n│ │ ▓▓▓▓░░░░░░        │ ▓▓░░░░░░░░        │  │\n│ │                   │                   │  │\n│ │ GLM (ch-003)      │ [empty slot]      │  │\n│ │ iter 1/50 | 1m    │                   │  │\n│ │ ▓░░░░░░░░░        │                   │  │\n```\n\n## API\n```typescript\n// src/components/AgentGrid.tsx\n\ninterface AgentGridProps {\n  agents: Agent[];\n  maxSlots: number;\n  selectedIndex?: number;\n  gridConfig: GridConfig;  // from useAgentGrid\n}\n\nfunction AgentGrid({ agents, maxSlots, selectedIndex, gridConfig }: AgentGridProps): JSX.Element\n```\n\n## Files\n- src/components/AgentGrid.tsx\n- src/components/AgentGrid.test.tsx\n\n## Acceptance Criteria\n- [ ] Renders agents using AgentTile component with correct props\n- [ ] Renders EmptySlot for unused slots (maxSlots - agents.length)\n- [ ] Passes isSelected=true to AgentTile at selectedIndex\n- [ ] Fills slots left-to-right, top-to-bottom order\n- [ ] Uses gridConfig.columns for grid layout\n- [ ] Uses gridConfig.tileWidth for tile sizing\n- [ ] All tiles have equal width from gridConfig.tileWidth\n- [ ] Shows correct number of empty slots\n- [ ] Handles zero agents (shows all empty slots)\n- [ ] Handles agents.length \u003e maxSlots (renders only maxSlots)\n- [ ] 11 tests pass\n\n## Tests\n1. Renders AgentTile for each agent\n2. Renders multiple agents in grid layout\n3. Renders EmptySlot for unused slots\n4. Passes isSelected=true to selected AgentTile\n5. Fills left-to-right, top-to-bottom\n6. Uses gridConfig.columns for layout\n7. Uses gridConfig.tileWidth for sizing\n8. Handles zero agents (all EmptySlot)\n9. Truncates if agents.length \u003e maxSlots\n10. Grid wraps at column boundary\n11. Passes correct agent props to AgentTile","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:50:49.783081+03:00","created_by":"deligoez","updated_at":"2026-01-11T20:30:33.310811+03:00","closed_at":"2026-01-11T20:30:33.310811+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-hhh","depends_on_id":"ch-c2p","type":"blocks","created_at":"2026-01-10T12:50:49.785309+03:00","created_by":"deligoez"},{"issue_id":"ch-hhh","depends_on_id":"ch-if9","type":"blocks","created_at":"2026-01-10T12:50:49.78722+03:00","created_by":"deligoez"},{"issue_id":"ch-hhh","depends_on_id":"ch-70p","type":"blocks","created_at":"2026-01-10T12:51:52.806665+03:00","created_by":"deligoez"}]}
{"id":"ch-hlgm","title":"TS10-E2E: Selection E2E Tests","description":"## What\nE2E tests for intelligent selection.\n\n## Files\n- `src/e2e/taskstore-selection.e2e.test.ts`\n\n## Acceptance Criteria\n- [ ] Selection prefers unblocking tasks\n- [ ] Selection continues series (same tag)\n- [ ] Selection respects `next` tag override\n- [ ] Selection focuses on milestone completion\n- [ ] 4 tests pass","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:14:02.833957+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:14:02.833957+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-hlgm","depends_on_id":"ch-i3bp","type":"blocks","created_at":"2026-01-13T00:14:14.836899+03:00","created_by":"deligoez"}]}
{"id":"ch-hobt","title":"TS04-E2E: Lifecycle E2E Tests","description":"## What\nE2E tests for task lifecycle.\n\n## Files\n- `src/e2e/taskstore-lifecycle.e2e.test.ts`\n\n## Acceptance Criteria\n- [ ] Lifecycle state persists across TaskStore restarts\n- [ ] Claim → complete → reopen cycle works\n- [ ] Claim → fail → reopen cycle works\n- [ ] Invalid transitions return proper errors\n- [ ] 4 tests pass","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:12:57.124075+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:12:57.124075+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-hobt","depends_on_id":"ch-3oot","type":"blocks","created_at":"2026-01-13T00:12:57.129042+03:00","created_by":"deligoez"}]}
{"id":"ch-hvjc","title":"E2E-S03: Sprint Stats E2E - Verify stats are saved","description":"## What\nE2E test for sprint statistics storage.\n\n## Acceptance Criteria\n- [ ] Complete a sprint with 2 tasks (1 success, 1 fail)\n- [ ] Verify stats file created in `.chorus/sprints/`\n- [ ] Verify stats contain correct counts (completed: 1, failed: 1)\n- [ ] Verify per-task stats present with timing and result\n- [ ] 4 tests pass\n\n## Files\n- src/e2e/sprint-stats.e2e.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T15:14:21.75466+03:00","created_by":"deligoez","updated_at":"2026-01-12T17:35:30.606878+03:00","closed_at":"2026-01-12T17:35:30.606878+03:00","close_reason":"Closed","labels":["m13b-sprint"],"dependencies":[{"issue_id":"ch-hvjc","depends_on_id":"ch-pbv0","type":"blocks","created_at":"2026-01-12T15:14:21.757628+03:00","created_by":"deligoez"}]}
{"id":"ch-i3bp","title":"TS10: TaskStore selectNext Integration","description":"## What\nIntegrate TaskSelector into TaskStore.\n\n## Files\n- `src/services/TaskStore.ts`\n- `src/services/TaskStore.test.ts`\n\n## Acceptance Criteria\n- [ ] `selectNext(context?)` calls TaskSelector with current tasks\n- [ ] `excludeIds` parameter filters out specified tasks\n- [ ] Returns best ready task or undefined\n- [ ] 4 tests pass","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:14:01.602594+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:14:01.602594+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-i3bp","depends_on_id":"ch-kflz","type":"blocks","created_at":"2026-01-13T00:14:01.606335+03:00","created_by":"deligoez"}]}
{"id":"ch-i9ci","title":"E2E-19: Block Task (b)","description":"## What\nVerify b key blocks task.\n\n## Tests (2 tests)\n1. Pressing b blocks task\n2. Task shows ⊗ with blocker\n\n## Files\n- src/e2e/block-task.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T21:18:38.642083+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:02:44.547698+03:00","closed_at":"2026-01-12T01:02:44.547698+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-i9ci","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:18:38.643438+03:00","created_by":"deligoez"},{"issue_id":"ch-i9ci","depends_on_id":"ch-sb7","type":"blocks","created_at":"2026-01-11T21:18:38.645359+03:00","created_by":"deligoez"}]}
{"id":"ch-i9i","title":"F22: Agent Slot Manager","description":"## What\nManage available slots for parallel agent execution. Track and enforce maxParallel limits.\n\n## Acceptance Criteria\n\n### getAvailable() - 2 tests\n- [ ] `getAvailable()` returns `maxParallel` when no slots acquired\n- [ ] `getAvailable()` decreases by 1 for each acquired slot\n\n### getCapacity() / getInUse() - 2 tests\n- [ ] `getCapacity()` returns `maxParallel` (immutable)\n- [ ] `getInUse()` returns count of acquired slots\n\n### acquire() - 2 tests\n- [ ] `acquire()` returns `true` and decrements available\n- [ ] `acquire()` returns `false` when available === 0\n\n### release() - 2 tests\n- [ ] `release()` increments available count\n- [ ] `release()` throws Error when `inUse === 0`\n\n### Implicit (no dedicated tests)\n- `hasAvailable()` = `getAvailable() \u003e 0` (trivial wrapper)\n- `reset()` = sets `acquired = 0` (test/recovery utility)\n\n## Files\n- src/services/SlotManager.ts\n- tests/services/SlotManager.test.ts\n\n## Plan\nSee: thoughts/shared/plans/features/F22-slot-manager.md\n\n**Total: 8 tests**","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T03:16:03.109131+03:00","created_by":"deligoez","updated_at":"2026-01-11T19:16:24.144277+03:00","closed_at":"2026-01-11T19:16:24.144277+03:00","close_reason":"Closed","labels":["m6-parallelism"],"dependencies":[{"issue_id":"ch-i9i","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:51.884648+03:00","created_by":"deligoez"}]}
{"id":"ch-iaru","title":"FR11: Feedback Modal - Redo feedback form","description":"## What\nModal form for submitting redo feedback with options.\n\n## Acceptance Criteria\n- [ ] Shows task title and iteration count in header\n- [ ] Quick issues checkboxes (1-5 toggle with number keys)\n- [ ] Custom feedback text input (multi-line, ~5 lines visible)\n- [ ] Redo options radio group (keep changes/fresh start/reset to checkpoint)\n- [ ] Priority change radio group (same/bump to P0/lower to P2)\n- [ ] Enter submits, Esc cancels\n- [ ] Form validation: at least one issue or custom feedback required\n- [ ] 8 tests pass\n\n## Files\n- src/components/FeedbackModal.tsx\n- src/components/FeedbackModal.test.tsx","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:13:04.133743+03:00","created_by":"deligoez","updated_at":"2026-01-12T16:39:03.019275+03:00","closed_at":"2026-01-12T16:39:03.019275+03:00","close_reason":"Closed","labels":["m13-review"],"dependencies":[{"issue_id":"ch-iaru","depends_on_id":"ch-lv0w","type":"blocks","created_at":"2026-01-12T15:13:04.142612+03:00","created_by":"deligoez"},{"issue_id":"ch-iaru","depends_on_id":"ch-q4nx","type":"blocks","created_at":"2026-01-12T15:13:04.144698+03:00","created_by":"deligoez"}]}
{"id":"ch-iel","title":"F06: Worktree Query - List and get worktree info","description":"## What\nQuery worktree details and bulk operations to complete WorktreeService.\n\n## Acceptance Criteria\n\n### getInfo() - 4 tests\n- [ ] Returns `WorktreeInfo` with all fields populated including `headSha`\n- [ ] `headSha` retrieved via `git rev-parse HEAD` in worktree directory\n- [ ] Throws `WorktreeNotFoundError` if worktree doesn't exist\n- [ ] Returns correct agentType and taskId parsed from path/branch\n\n### removeAll() - 3 tests\n- [ ] Calls `remove()` for each worktree returned by `list()`\n- [ ] Skips worktrees that aren't agent worktrees (no agent/ branch prefix)\n- [ ] With `force: true`, passes force option to each remove() call\n\n### Edge Case - 1 test\n- [ ] removeAll() on empty worktree list completes without error (no-op)\n\n### Summary\n- [ ] 8 tests pass\n\n## Files\n- src/services/WorktreeService.ts (extend)\n- tests/services/WorktreeService.test.ts (extend)\n\n## Interface\n```typescript\ninterface WorktreeInfo {\n  path: string;      // /abs/path/.worktrees/claude-ch-a1b2\n  branch: string;    // agent/claude/ch-a1b2\n  agentType: string; // claude\n  taskId: string;    // ch-a1b2\n  headSha?: string;  // abc123def456 (only from getInfo())\n}\n\n// Add to WorktreeService class:\n\nasync getInfo(agentType: string, taskId: string): Promise\u003cWorktreeInfo\u003e;\n\nasync removeAll(options?: { force?: boolean }): Promise\u003cvoid\u003e;\n```\n\n## Implementation Notes\n\n### getInfo() Flow\n1. Check worktree exists via exists() - throw WorktreeNotFoundError if not\n2. Get path via getPath() - returns `.worktrees/{agentType}-{taskId}`\n3. Get branch via getBranch()\n4. Run `git -C {path} rev-parse HEAD` to get headSha\n5. Return complete WorktreeInfo object\n\n### removeAll() Flow\n1. Call list() to get all worktrees\n2. Filter to agent worktrees (branch starts with `agent/`)\n3. For each, call remove() with options.force if set\n4. If list is empty, return immediately (no-op)\n\n### Agent Worktree Detection\nA worktree is an agent worktree if:\n- Branch matches pattern: `agent/{agentType}/{taskId}`\n- OR path matches pattern: `.worktrees/{agentType}-{taskId}`\n\nNon-agent worktrees (main worktree, manual worktrees) should be skipped.\n\n## Test Cases (8 total)\n1. getInfo() returns complete WorktreeInfo with headSha\n2. getInfo() retrieves headSha via git rev-parse\n3. getInfo() throws WorktreeNotFoundError for non-existent worktree\n4. getInfo() correctly parses agentType and taskId\n5. removeAll() removes all agent worktrees\n6. removeAll() skips non-agent worktrees (main, manual)\n7. removeAll() with force: true passes force to remove()\n8. removeAll() completes successfully with empty worktree list\n\n## Prerequisite Methods (from F04 \u0026 F05)\nThis task assumes these methods are already implemented:\n- From F04: create(), exists(), getPath(), getBranch(), list()\n- From F05: remove(), isBranchMerged(), prune()\n\n## Notes\n- Worktree path: `.worktrees/` at project root (per Decision #17)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T01:31:17.922621+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:47:21.744241+03:00","closed_at":"2026-01-11T18:47:21.744241+03:00","close_reason":"Closed","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-iel","depends_on_id":"ch-112","type":"blocks","created_at":"2026-01-10T01:31:17.924367+03:00","created_by":"deligoez"}]}
{"id":"ch-iepk","title":"FR08: Review Status Bar - Show pending review count and notifications","description":"## What\nStatus bar component showing pending review count and auto-approve notifications.\n\n## Acceptance Criteria\n- [ ] Shows \"REVIEW PENDING │ N tasks │ Press [R] to review\" when N \u003e 0\n- [ ] For per-task mode tasks: status bar flashes/pulses to draw attention\n- [ ] Hidden when no pending reviews (N = 0)\n- [ ] Updates count reactively when reviews added/removed\n- [ ] Shows auto-approve notification (fades after 3s)\n- [ ] Auto-approve notification shows task ID, title, reason\n- [ ] 6 tests pass\n\n## Files\n- src/components/ReviewStatusBar.tsx\n- src/components/ReviewStatusBar.test.tsx","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:12:29.850303+03:00","created_by":"deligoez","updated_at":"2026-01-12T16:26:38.699515+03:00","closed_at":"2026-01-12T16:26:38.699515+03:00","close_reason":"Closed","labels":["m13-review"],"dependencies":[{"issue_id":"ch-iepk","depends_on_id":"ch-ooiw","type":"blocks","created_at":"2026-01-12T15:12:29.85423+03:00","created_by":"deligoez"}]}
{"id":"ch-if9","title":"F59a: EmptySlot Component - Placeholder for unused agent slot","description":"## What\nPlaceholder component shown when an agent slot is unused.\n\n## Context from Master Plan\n```\n│ [empty slot]      │\n```\n\n## API\n```typescript\n// src/components/EmptySlot.tsx\n\ninterface EmptySlotProps {\n  width?: number;\n}\n\nfunction EmptySlot({ width }: EmptySlotProps): JSX.Element\n```\n\n## Visual Output\n```\n┌───────────────────┐\n│                   │\n│   [empty slot]    │\n│                   │\n└───────────────────┘\n```\n\n## Files\n- src/components/EmptySlot.tsx\n- src/components/EmptySlot.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows \"[empty slot]\" text\n- [ ] Text is centered horizontally and vertically\n- [ ] Text uses dimColor (Ink's dimColor prop)\n- [ ] Has single border style (borderStyle=\"single\")\n- [ ] Border uses gray color (borderColor=\"gray\")\n- [ ] Respects width prop for box sizing\n- [ ] 6 tests pass\n\n## Tests\n1. Shows \"[empty slot]\" text\n2. Text is centered\n3. Uses dimColor for text\n4. Has single border style\n5. Border uses gray color\n6. Respects width prop","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:49:26.136012+03:00","created_by":"deligoez","updated_at":"2026-01-11T20:18:39.165548+03:00","closed_at":"2026-01-11T20:18:39.165548+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-if9","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:53.126138+03:00","created_by":"deligoez"}]}
{"id":"ch-im6","title":"F63d: New Task (n) - Create new task via TUI","description":"## What\nKeyboard handler for 'n' key to create a new task via TUI input.\n\n## Shortcut\n- **n** - Open new task dialog\n\n## Implementation\n```typescript\n// src/hooks/useKeyboard.ts\nimport { useInput } from 'ink';\n\nexport function useKeyboard(options: UseKeyboardOptions) {\n  useInput((input, key) =\u003e {\n    if (input === 'n') {\n      options.onNewTask?.();\n    }\n  });\n}\n\ninterface UseKeyboardOptions {\n  onNewTask?: () =\u003e void;\n}\n```\n\n```typescript\n// NewTaskDialog.tsx\ninterface NewTaskDialogProps {\n  isOpen: boolean;\n  onSubmit: (title: string) =\u003e Promise\u003cvoid\u003e;\n  onCancel: () =\u003e void;\n}\n\nexport function NewTaskDialog({ isOpen, onSubmit, onCancel }: NewTaskDialogProps) {\n  const [title, setTitle] = useState('');\n  const [error, setError] = useState\u003cstring | null\u003e(null);\n  \n  useInput((input, key) =\u003e {\n    if (key.escape) onCancel();\n    if (key.return \u0026\u0026 title) {\n      onSubmit(title).catch(e =\u003e setError(e.message));\n    }\n  });\n  \n  if (!isOpen) return null;\n  // ... render input and error\n}\n```\n\n## Behavior\n- Pressing 'n' opens a task creation dialog/input\n- User enters task title via TextInput\n- Escape cancels dialog, Enter submits\n- Task created via BeadsCLI.createTask() method\n- TaskPanel refreshes to show new task\n- Shows error message if task creation fails\n\n## Implementation Note\nUses `BeadsCLI.createTask()` service method, not direct shell command. This ensures proper error handling and type safety.\n\n## Files\n- src/hooks/useKeyboard.ts (UPDATE)\n- src/hooks/useKeyboard.test.ts (UPDATE)\n- src/components/NewTaskDialog.tsx (NEW)\n- src/components/NewTaskDialog.test.tsx (NEW)\n\n## Acceptance Criteria\n- [ ] `useInput` detects 'n' and calls `onNewTask()`\n- [ ] NewTaskDialog renders when isOpen=true\n- [ ] Escape key calls `onCancel()`\n- [ ] Enter key with non-empty title calls `onSubmit(title)`\n- [ ] Enter key with empty title does nothing\n- [ ] `onSubmit` calls BeadsCLI.createTask() method\n- [ ] Shows error message when `onSubmit` rejects\n\n### Summary\n- [ ] 7 tests pass\n\n## Tests\n1. 'n' key calls onNewTask callback\n2. Dialog renders when isOpen=true, hidden when false\n3. Escape calls onCancel\n4. Enter with title calls onSubmit(title)\n5. Enter with empty title does not call onSubmit\n6. onSubmit calls BeadsCLI.createTask with title\n7. Shows error when task creation fails","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T21:53:28.785701+03:00","created_by":"deligoez","updated_at":"2026-01-12T05:44:45.575013+03:00","closed_at":"2026-01-12T05:44:45.575013+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-im6","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:53.932236+03:00","created_by":"deligoez"}]}
{"id":"ch-irl","title":"F46c-d: Intervention Panel - Edit Task","description":"## What\nIntervention Panel edit-select mode: spawn bd edit subprocess and notify on completion.\n\n## Mode Flow\n```\nMain mode:\n  [e] → mode = 'edit-select'\n\nedit-select mode:\n  Shows: \"Select task to edit: [1] bd-001 [2] bd-002\"\n  [1-9] → spawns `bd edit \u003ctaskId\u003e` → waits for exit → taskEditor.notifyTaskEdited()\n  [ESC] → mode = 'main'\n```\n\n## Acceptance Criteria\n\n### Mode Transition - 1 test\n- [ ] 'e' key in main mode transitions to 'edit-select' mode\n\n### Edit Select Mode - 2 tests\n- [ ] edit-select mode shows task selection prompt\n- [ ] Number key spawns `bd edit \u003ctaskId\u003e` subprocess\n\n### Subprocess Handling - 2 tests\n- [ ] Waits for bd edit subprocess to exit\n- [ ] After bd edit closes, calls taskEditor.notifyTaskEdited(taskId)\n\n### Summary\n- [ ] 5 tests pass\n\n## Files\n- src/components/InterventionPanel.tsx (UPDATE)\n- src/components/InterventionPanel.test.tsx (UPDATE)\n\n## Notes\n- Uses child_process.spawn for bd edit\n- bd edit opens default editor ($EDITOR)\n- After edit, agent may need restart (handled by taskEditor)\n\n## Dependencies\n- F46c-a (ch-di6) - Main mode and base component","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T23:52:38.149647+03:00","created_by":"deligoez","updated_at":"2026-01-11T00:05:44.722109+03:00","closed_at":"2026-01-11T00:05:44.722109+03:00","close_reason":"Closed","labels":["m9-intervention"],"dependencies":[{"issue_id":"ch-irl","depends_on_id":"ch-di6","type":"blocks","created_at":"2026-01-10T23:52:38.152699+03:00","created_by":"deligoez"}]}
{"id":"ch-iru","title":"F100a: Spec Section Collapser","description":"## What\nCollapses tasked sections in spec files using HTML details/summary tags.\n\n## Acceptance Criteria\n- [ ] `SpecSectionCollapser` class exists\n- [ ] `collapseSection(specPath, heading, taskIds)` wraps section in \u003cdetails\u003e\n- [ ] Preserves original content inside collapsed section\n- [ ] Adds task IDs to summary: \"→ ch-001, ch-002 (click to expand)\"\n- [ ] Changes emoji from 📋 to ✅ in heading\n- [ ] Appends (TASKED) to heading after emoji change\n- [ ] `expandSection(specPath, heading)` removes \u003cdetails\u003e wrapper\n- [ ] `isCollapsed(specPath, heading)` returns true if section is collapsed\n- [ ] Does not modify draft sections\n- [ ] Handles nested content correctly\n- [ ] 9 tests pass\n\n## Example Output\n```markdown\n## ✅ 1. Overview (TASKED)\n\n\u003cdetails\u003e\n\u003csummary\u003e→ ch-001, ch-002 (click to expand)\u003c/summary\u003e\n\nOriginal spec content preserved for reference...\n\n\u003c/details\u003e\n```\n\n## Files\n- src/services/SpecSectionCollapser.ts\n- tests/services/SpecSectionCollapser.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T09:17:21.696861+03:00","created_by":"deligoez","updated_at":"2026-01-12T07:04:19.154933+03:00","closed_at":"2026-01-12T07:04:19.154933+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-iru","depends_on_id":"ch-2yp","type":"blocks","created_at":"2026-01-11T09:17:21.699355+03:00","created_by":"deligoez"}]}
{"id":"ch-is0i","title":"E2E-S02: Sprint Progress E2E - Sprint completes, tasks in reviewing","description":"## What\nE2E test for sprint completion flow.\n\n## Acceptance Criteria\n- [ ] Start sprint with 2 simple tasks (mock agent)\n- [ ] Wait for completion\n- [ ] Verify tasks in \"reviewing\" status\n- [ ] Verify sprint progress bar hidden after completion\n- [ ] 4 tests pass\n\n## Files\n- src/e2e/sprint-progress.e2e.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T15:14:20.4913+03:00","created_by":"deligoez","updated_at":"2026-01-12T17:42:44.685552+03:00","closed_at":"2026-01-12T17:42:44.685552+03:00","close_reason":"Closed","labels":["m13b-sprint"],"dependencies":[{"issue_id":"ch-is0i","depends_on_id":"ch-pjge","type":"blocks","created_at":"2026-01-12T15:14:20.494767+03:00","created_by":"deligoez"}]}
{"id":"ch-iucm","title":"TS11-E2E: File Watcher E2E Tests","description":"## What\nE2E tests for file watching.\n\n## Files\n- `src/e2e/taskstore-watcher.e2e.test.ts`\n\n## Acceptance Criteria\n- [ ] External file edit triggers reload\n- [ ] New tasks from external edit are available\n- [ ] 2 tests pass","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-13T00:14:29.542131+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:14:29.542131+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-iucm","depends_on_id":"ch-oylf","type":"blocks","created_at":"2026-01-13T00:14:40.516207+03:00","created_by":"deligoez"}]}
{"id":"ch-j0z","title":"F59b: AgentTileHeader - Agent type, task ID, status icon","description":"## What\nTop section of AgentTile showing agent type, task ID, and status indicator.\n\n## Context from Master Plan\n```\n│ CLAUDE (ch-001)   │\n```\n\n## API\n```typescript\n// src/components/AgentTileHeader.tsx\n\ninterface AgentTileHeaderProps {\n  agentType: 'claude' | 'codex' | 'opencode';\n  taskId: string;\n  status: 'running' | 'idle' | 'paused' | 'error';\n}\n\nfunction AgentTileHeader({ agentType, taskId, status }: AgentTileHeaderProps): JSX.Element\n```\n\n## Visual Output\n- `● CLAUDE (ch-001)` - green dot for running\n- `○ CODEX (ch-002)` - gray dot for idle\n- `⏸ OPENCODE (ch-003)` - yellow for paused\n- `✗ CLAUDE (ch-001)` - red for error\n\n## Status Icon Colors (Ink)\n- running: color=\"green\", icon=\"●\"\n- idle: color=\"gray\", icon=\"○\"\n- paused: color=\"yellow\", icon=\"⏸\"\n- error: color=\"red\", icon=\"✗\"\n\n## Files\n- src/components/AgentTileHeader.tsx\n- src/components/AgentTileHeader.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows agent type in UPPERCASE (bold)\n- [ ] Shows task ID in parentheses after type\n- [ ] Shows green \"●\" for running status (color=\"green\")\n- [ ] Shows gray \"○\" for idle status (color=\"gray\")\n- [ ] Shows yellow \"⏸\" for paused status (color=\"yellow\")\n- [ ] Shows red \"✗\" for error status (color=\"red\")\n- [ ] Status icon appears before agent type\n- [ ] 7 tests pass\n\n## Tests\n1. Shows CLAUDE uppercase and bold\n2. Shows (ch-xxx) task ID format\n3. Shows green dot for running\n4. Shows gray dot for idle\n5. Shows yellow pause for paused\n6. Shows red X for error\n7. Status icon appears before agent type","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:49:27.267029+03:00","created_by":"deligoez","updated_at":"2026-01-11T20:20:04.463163+03:00","closed_at":"2026-01-11T20:20:04.463163+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-j0z","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:53.226049+03:00","created_by":"deligoez"}]}
{"id":"ch-j1gz","title":"E2E-37: Terminal Resize","description":"## What\nE2E test for terminal resize handling.\n\n## Acceptance Criteria\n- [ ] UI reflows on terminal resize\n- [ ] Panels adjust width proportionally\n- [ ] Text truncation updates correctly\n- [ ] No crash on very small terminal\n- [ ] 4 tests pass\n\n## Test Cases\n1. `it('reflows UI on resize')`\n2. `it('adjusts panel widths')`\n3. `it('updates text truncation')`\n4. `it('handles minimum size gracefully')`\n\n## Files\n- tests/e2e/terminal-resize.test.ts\n\n## Dependencies\n- ch-0e01 (E2E Infrastructure)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:22:34.342279+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:55:49.41671+03:00","closed_at":"2026-01-12T01:55:49.41671+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-j1gz","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:22:34.345541+03:00","created_by":"deligoez"}]}
{"id":"ch-j321","title":"FX02: XState Types - Events, context, and input type definitions","description":"## What\nDefine all TypeScript types for XState machines: context, events, input, output.\n\n## Acceptance Criteria\n- [ ] `ChorusMachineContext` interface defined\n- [ ] `ChorusMachineEvent` discriminated union defined\n- [ ] `AgentMachineContext` interface defined\n- [ ] `AgentMachineEvent` discriminated union defined\n- [ ] `ChorusMachineInput` interface defined\n- [ ] `AgentMachineInput` interface defined\n- [ ] All types exported from barrel\n- [ ] 8 tests pass\n\n## Tests\n1. ChorusMachineContext has required fields\n2. ChorusMachineEvent covers all events (SPAWN_AGENT, STOP_AGENT, PAUSE, RESUME, etc.)\n3. AgentMachineContext has required fields\n4. AgentMachineEvent covers all events (START, ITERATION_DONE, COMPLETE, FAIL, etc.)\n5. ChorusMachineInput has config field\n6. AgentMachineInput has taskId and parentRef fields\n7. Event types are discriminated (type field)\n8. Context types are JSON-serializable (no functions)\n\n## Files\n- src/types/xstate.types.ts\n- src/types/index.ts (updated exports)\n\n## Dependencies\n- FX01 (XState Setup)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-11T15:26:05.090583+03:00","created_by":"deligoez","updated_at":"2026-01-11T17:53:02.007934+03:00","closed_at":"2026-01-11T17:53:02.007934+03:00","close_reason":"Closed","labels":["m-1-xstate"],"dependencies":[{"issue_id":"ch-j321","depends_on_id":"ch-lxxb","type":"blocks","created_at":"2026-01-11T15:26:05.094199+03:00","created_by":"deligoez"}]}
{"id":"ch-j40","title":"F88: PATTERNS.md Manager Service","description":"## What\nRead/write/update cross-agent patterns file for shared learnings.\n\n## Files\n- `src/services/PatternsManager.ts`\n- `src/services/PatternsManager.test.ts`\n\n## Acceptance Criteria\n- [ ] `read()` returns parsed patterns from `.chorus/PATTERNS.md`\n- [ ] `read()` returns empty patterns object if file doesn't exist\n- [ ] `write(patterns: Patterns)` writes patterns to file\n- [ ] `addPattern(category: string, pattern: string)` appends to category\n- [ ] `addPattern()` creates category section if it doesn't exist\n- [ ] `getPatternsByCategory(category: string)` returns filtered patterns\n- [ ] `getPatternsByCategory()` returns empty array for non-existent category\n- [ ] Preserves markdown formatting (headers, bullets, code blocks)\n- [ ] 8 tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:04:42.638268+03:00","created_by":"deligoez","updated_at":"2026-01-11T22:25:20.150561+03:00","closed_at":"2026-01-11T22:25:20.150561+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-j40","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:13.337974+03:00","created_by":"deligoez"}]}
{"id":"ch-j64o","title":"E2E-12: Redirect Agent (r)","description":"## What\nVerify r key redirects agent to new task.\n\n## Tests (2 tests)\n1. Pressing r opens task selection\n2. Selecting task reassigns agent\n\n## Files\n- src/e2e/redirect-agent.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T21:18:12.630438+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:12:12.592667+03:00","closed_at":"2026-01-12T01:12:12.592667+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-j64o","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:18:12.631695+03:00","created_by":"deligoez"},{"issue_id":"ch-j64o","depends_on_id":"ch-ddk","type":"blocks","created_at":"2026-01-11T21:18:12.633465+03:00","created_by":"deligoez"}]}
{"id":"ch-j7p4","title":"E2E-45: ConfigService Integration Tests","description":"## What\nE2E tests for ConfigService with real file system operations.\n\n## Acceptance Criteria\n- [ ] `loadConfig()` reads config from real .chorus/config.json\n- [ ] `loadConfig()` returns defaults if file doesn't exist\n- [ ] `saveConfig()` writes valid JSON to disk\n- [ ] `saveConfig()` creates .chorus/ directory if missing\n- [ ] Config validation rejects invalid values\n- [ ] 6 tests pass\n\n## Files\n- src/e2e/config-service.e2e.test.ts\n\n## Implementation Notes\n- Use createGitRepoWithChorus() helper from git-fixtures.ts\n- Test real file read/write, not mocked\n- Verify file contents after save","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T00:07:11.700159+03:00","created_by":"deligoez","updated_at":"2026-01-12T00:53:42.609666+03:00","closed_at":"2026-01-12T00:53:42.609666+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-j7p4","depends_on_id":"ch-sro","type":"blocks","created_at":"2026-01-12T00:08:47.734106+03:00","created_by":"deligoez"},{"issue_id":"ch-j7p4","depends_on_id":"ch-y43","type":"blocks","created_at":"2026-01-12T00:08:47.828755+03:00","created_by":"deligoez"}]}
{"id":"ch-jbe","title":"F03c: Non-Claude CLI Detection","description":"## What\nExtend InitPrerequisites to detect non-Claude agent CLIs (codex, opencode).\n\n**Status:** DEFERRED - Will implement when non-Claude agent support is needed.\n\n## Why\nNon-Claude agents (codex, opencode) require their CLIs to be available.\nThis task adds detection for these additional agents.\n\n## Acceptance Criteria\n\n### detectAgentCLIs() - 4 tests\n- [ ] Returns array of available agent types including codex, opencode\n- [ ] Returns only 'claude' if others not found\n- [ ] Detects codex CLI when present\n- [ ] Detects opencode CLI when present\n\n### Summary\n- [ ] 4 tests pass\n\n## Types Extension\n```typescript\ninterface PrerequisiteResult {\n  // Existing fields...\n  agents: AgentType[];  // NEW: array of available agents\n}\n```\n\n## Files\n- src/services/InitPrerequisites.ts (UPDATE)\n- src/services/InitPrerequisites.test.ts (UPDATE)\n\n## Tests\n1. detectAgentCLIs() returns ['claude'] when others missing\n2. detectAgentCLIs() includes 'codex' when available\n3. detectAgentCLIs() includes 'opencode' when available\n4. detectAgentCLIs() returns all three when all present","status":"deferred","priority":2,"issue_type":"task","created_at":"2026-01-10T22:43:47.138462+03:00","created_by":"deligoez","updated_at":"2026-01-12T12:23:16.265736+03:00","labels":["deferred","m1-infrastructure"],"dependencies":[{"issue_id":"ch-jbe","depends_on_id":"ch-0z7","type":"blocks","created_at":"2026-01-10T22:43:47.143596+03:00","created_by":"deligoez"}]}
{"id":"ch-jgiw","title":"INT-09: Ralph iteration - retry until success","description":"## What\nIntegration test: Task fails first iteration, succeeds on retry (Ralph pattern).\n\n## Test Scenario\n1. Task: \"Create valid.json with valid JSON\"\n2. Iteration 1: Agent creates invalid JSON (simulated by quality check fail)\n3. Quality check fails → iteration 2 triggered\n4. Iteration 2: Agent fixes → creates valid JSON\n5. Quality check passes → task complete\n\n## Why Atomic\nSingle test for retry mechanism. Does not test learning or multi-agent.\n\n## Setup\n- Quality command: \"node -e 'JSON.parse(require(\\\"fs\\\").readFileSync(\\\"valid.json\\\"))'\"\n- This fails if JSON invalid, passes if valid\n\n## Acceptance Criteria\n- [ ] First iteration fails quality check\n- [ ] Second iteration triggered\n- [ ] Second iteration passes\n- [ ] Task marked complete\n- [ ] 1 test pass\n\n## Files\n- src/integration/ralph-iteration.integration.test.ts (create)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T14:27:23.838473+03:00","created_by":"deligoez","updated_at":"2026-01-12T15:00:42.240021+03:00","closed_at":"2026-01-12T15:00:42.240021+03:00","close_reason":"Closed","labels":["m7-autopilot"],"dependencies":[{"issue_id":"ch-jgiw","depends_on_id":"ch-ez8y","type":"blocks","created_at":"2026-01-12T14:27:23.842913+03:00","created_by":"deligoez"}]}
{"id":"ch-jinc","title":"E2E-32: Active Agent Display","description":"## What\nE2E test for active agent iteration display on tasks.\n\n## Acceptance Criteria\n- [ ] TaskIterationDisplay shows when agent is working\n- [ ] Shows agent type (claude/aider/codex)\n- [ ] Shows current iteration number\n- [ ] Updates as iteration progresses\n- [ ] 4 tests pass\n\n## Test Cases\n1. `it('shows iteration display for active task')`\n2. `it('displays correct agent type')`\n3. `it('shows current iteration number')`\n4. `it('updates iteration number on progress')`\n\n## Files\n- tests/e2e/active-agent-display.test.ts\n\n## Dependencies\n- ch-0e01 (E2E Infrastructure)\n- ch-gk7 (F62b TaskIterationDisplay)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:21:50.958197+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:47:54.214934+03:00","closed_at":"2026-01-12T01:47:54.214934+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-jinc","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:21:50.960243+03:00","created_by":"deligoez"},{"issue_id":"ch-jinc","depends_on_id":"ch-gk7","type":"blocks","created_at":"2026-01-11T21:21:50.961891+03:00","created_by":"deligoez"}]}
{"id":"ch-jnkx","title":"E2E-R02: Batch Review Flow E2E - Review multiple tasks end-to-end","description":"## What\nE2E test for batch review workflow.\n\n## Acceptance Criteria\n- [ ] Create project with 3 tasks in \"reviewing\" status\n- [ ] Press R, verify summary shows 3 tasks\n- [ ] Navigate with N/P through tasks\n- [ ] Approve first, redo second (with feedback), reject third\n- [ ] Verify all statuses updated correctly (closed, open, blocked)\n- [ ] 6 tests pass\n\n## Files\n- src/e2e/batch-review.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:13:52.210508+03:00","created_by":"deligoez","updated_at":"2026-01-12T17:05:16.577428+03:00","closed_at":"2026-01-12T17:05:16.577428+03:00","close_reason":"Closed","labels":["m13-review"],"dependencies":[{"issue_id":"ch-jnkx","depends_on_id":"ch-x5un","type":"blocks","created_at":"2026-01-12T15:13:52.213469+03:00","created_by":"deligoez"},{"issue_id":"ch-jnkx","depends_on_id":"ch-q4nx","type":"blocks","created_at":"2026-01-12T15:13:52.216182+03:00","created_by":"deligoez"}]}
{"id":"ch-jx9","title":"F63s: Start Autopilot Key (a) - Switch to autopilot mode","description":"## What\nKeyboard handler to start autopilot mode from semi-auto mode.\n\n## Context from Master Plan\n```\nMODE CONTROL\na    Start autopilot\n```\n\n## Shortcut\n- **a** - Start autopilot mode\n\n## Implementation\n\n```typescript\n// src/hooks/useModeKeys.ts\n\ninterface UseModeKeysOptions {\n  currentMode: 'semi-auto' | 'autopilot';\n  orchestrationStore: OrchestrationStore;\n  onModeChange?: (newMode: 'semi-auto' | 'autopilot') =\u003e void;\n}\n\nfunction useModeKeys(options: UseModeKeysOptions) {\n  useInput((input) =\u003e {\n    if (input === 'a' \u0026\u0026 options.currentMode === 'semi-auto') {\n      options.orchestrationStore.setMode('autopilot');\n      options.onModeChange?.('autopilot');\n    }\n  });\n}\n```\n\n## Acceptance Criteria\n\n### Start Autopilot - 3 tests\n- [ ] 'a' key in semi-auto mode switches to autopilot\n- [ ] Updates OrchestrationStore mode state\n- [ ] Shows confirmation: \"Autopilot mode started\"\n\n### Mode Validation - 2 tests\n- [ ] No-op when already in autopilot mode\n- [ ] No-op when orchestration is paused\n\n### Visual Feedback - 2 tests\n- [ ] ModeIndicator updates to show \"autopilot\" with yellow dot\n- [ ] RalphLoop starts automatically (begins spawning agents)\n\n### Summary\n- [ ] 7 tests pass\n\n## Files\n- src/hooks/useModeKeys.ts (NEW or extend existing)\n- src/hooks/useModeKeys.test.ts (NEW)\n\n## Dependencies\n- F19 (OrchestrationStore) for mode state\n\n## Notes\n- Autopilot = RalphLoop takes over spawning decisions\n- User can still pause/intervene in autopilot\n- 'm' key toggles between modes (F63c - deferred)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T12:43:58.710778+03:00","created_by":"deligoez","updated_at":"2026-01-12T06:30:22.061115+03:00","closed_at":"2026-01-12T06:30:22.061115+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-jx9","depends_on_id":"ch-5tj","type":"blocks","created_at":"2026-01-11T14:01:46.27277+03:00","created_by":"deligoez"},{"issue_id":"ch-jx9","depends_on_id":"ch-vskx","type":"blocks","created_at":"2026-01-11T15:27:38.229305+03:00","created_by":"deligoez"}]}
{"id":"ch-jxp","title":"F51: Session Recovery - Recover from crash via state.json","description":"## What\nRecover Chorus state after a crash using persisted state.json.\n\n## PID Check Implementation\n\n**OS-dependent: Uses `kill -0 \u003cpid\u003e` to check process existence.**\n\n```typescript\nasync function processExists(pid: number): Promise\u003cboolean\u003e {\n  try {\n    // kill -0 checks existence without sending signal\n    // Works on Linux, macOS, WSL\n    await exec(`kill -0 ${pid}`);\n    return true;  // Process exists\n  } catch (error) {\n    // Permission denied (EACCES) → treat as \"process exists\" (conservative)\n    if (error.code === 'EACCES' || error.message?.includes('EACCES')) {\n      return true;\n    }\n    // ESRCH (no such process) → process doesn't exist\n    return false;\n  }\n}\n```\n\n**Error handling:**\n- Permission denied (EACCES) → treat as \"process exists\" (conservative)\n- ESRCH (no such process) → treat as \"process doesn't exist\"\n- exec() throws other error → log error, skip this agent, continue recovery\n\n**Fallback for Windows (not in MVP):**\n- Would need `tasklist /FI \"PID eq ${pid}\"`\n- Deferred to post-MVP\n\n## API\n```typescript\ninterface RecoveryResult {\n  recovered: boolean;\n  restoredTasks: string[];\n  cleanedWorktrees: string[];\n  resumedMergeItems: number;\n  errors: string[];  // Includes PID check failures\n}\n\nclass SessionRecovery {\n  constructor(\n    private stateService: StateService,\n    private mergeService: MergeService\n  ) {}\n\n  async needsRecovery(): Promise\u003cboolean\u003e;\n  async recover(): Promise\u003cRecoveryResult\u003e;\n  async resumeMergeQueue(): Promise\u003cnumber\u003e;\n  async handleAgentCrash(agentId: string): Promise\u003cvoid\u003e;\n  async handleWorktreeBroken(worktreePath: string): Promise\u003cvoid\u003e;\n  async handleOrphanedWorktree(worktreePath: string): Promise\u003cvoid\u003e;\n  \n  // Internal helper\n  private async processExists(pid: number): Promise\u003cboolean\u003e;\n}\n```\n\n## Acceptance Criteria\n\n### needsRecovery() - 2 tests\n- [ ] Returns `true` if state.json has agents with running status\n- [ ] Returns `false` for clean/empty state\n\n### recover() - 5 tests\n- [ ] Loads persisted state from state.json\n- [ ] Kills orphan processes (checks if PID exists, kills if still running)\n- [ ] Logs error and continues if PID check fails\n- [ ] Returns crashed agent tasks to pending via beadsCLI\n- [ ] Returns RecoveryResult with restoredTasks, cleanedWorktrees, errors\n\n### processExists() - 3 tests\n- [ ] Returns true when process is running (kill -0 succeeds)\n- [ ] Returns false when process doesn't exist (kill -0 fails with ESRCH)\n- [ ] Returns true when permission denied (EACCES) - conservative approach\n\n### resumeMergeQueue() - 2 tests\n- [ ] Re-enqueues pending items from state.mergeQueue\n- [ ] Skips items already processed\n\n### Handle Scenarios - 3 tests\n- [ ] `handleAgentCrash()` stashes worktree changes, returns task to pending\n- [ ] `handleWorktreeBroken()` removes broken worktree (force)\n- [ ] `handleOrphanedWorktree()` removes worktree not in state\n\n### Summary\n- [ ] 15 tests pass\n\n## Recovery Flow\n```typescript\nasync recover(): Promise\u003cRecoveryResult\u003e {\n  const state = await this.stateService.load();\n  const result: RecoveryResult = { \n    recovered: false, \n    restoredTasks: [], \n    cleanedWorktrees: [], \n    resumedMergeItems: 0,\n    errors: [] \n  };\n  \n  // 1. Kill orphan processes\n  for (const [id, agent] of Object.entries(state.agents)) {\n    try {\n      const exists = await this.processExists(agent.pid);\n      if (!exists) {\n        // Process gone - clean up state\n        await this.beadsCLI.updateTask(agent.taskId, { status: 'open' });\n        result.restoredTasks.push(agent.taskId);\n        delete state.agents[id];\n      } else {\n        // Process still running - kill it\n        process.kill(agent.pid, 'SIGTERM');\n        await this.beadsCLI.updateTask(agent.taskId, { status: 'open' });\n        result.restoredTasks.push(agent.taskId);\n        delete state.agents[id];\n      }\n    } catch (error) {\n      result.errors.push(`Failed to check/kill PID ${agent.pid}: ${error.message}`);\n      // Continue with other agents\n    }\n  }\n  \n  // 2. Resume merge queue\n  result.resumedMergeItems = await this.resumeMergeQueue();\n  \n  // 3. Save cleaned state\n  await this.stateService.save(state);\n  result.recovered = true;\n  \n  return result;\n}\n```\n\n## Files\n- src/services/SessionRecovery.ts\n- src/services/SessionRecovery.test.ts\n\n## Notes\n- MVP: Unix-like systems only (Linux, macOS, WSL)\n- Windows support deferred to post-MVP\n- Recovery is best-effort: errors are logged but don't stop recovery","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T10:45:01.661567+03:00","created_by":"deligoez","updated_at":"2026-01-11T22:57:14.028838+03:00","closed_at":"2026-01-11T22:57:14.028838+03:00","close_reason":"Closed","labels":["m10-rollback"],"dependencies":[{"issue_id":"ch-jxp","depends_on_id":"ch-2r5","type":"blocks","created_at":"2026-01-10T10:45:01.663431+03:00","created_by":"deligoez"},{"issue_id":"ch-jxp","depends_on_id":"ch-81x","type":"blocks","created_at":"2026-01-10T10:45:01.664656+03:00","created_by":"deligoez"},{"issue_id":"ch-jxp","depends_on_id":"ch-112","type":"blocks","created_at":"2026-01-10T10:48:19.707944+03:00","created_by":"deligoez"},{"issue_id":"ch-jxp","depends_on_id":"ch-8ee","type":"blocks","created_at":"2026-01-10T11:13:15.217574+03:00","created_by":"deligoez"}]}
{"id":"ch-jzki","title":"E2E-05: Help Panel Toggle (?)","description":"## What\nVerify ? key toggles help panel.\n\n## Tests (3 tests)\n1. Pressing ? shows help panel\n2. Help panel shows all 8 categories\n3. Pressing ? again hides help panel\n\n## Files\n- src/e2e/help-toggle.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T21:18:00.098544+03:00","created_by":"deligoez","updated_at":"2026-01-12T05:16:29.835037+03:00","closed_at":"2026-01-12T05:16:29.835037+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-jzki","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:18:00.101485+03:00","created_by":"deligoez"},{"issue_id":"ch-jzki","depends_on_id":"ch-ak5","type":"blocks","created_at":"2026-01-11T21:18:00.10544+03:00","created_by":"deligoez"},{"issue_id":"ch-jzki","depends_on_id":"ch-2po","type":"blocks","created_at":"2026-01-11T21:24:33.796002+03:00","created_by":"deligoez"}]}
{"id":"ch-k3d","title":"F10: Quality Command Runner","description":"## What\nRun quality commands (test, lint, typecheck) and capture results (passed/failed, output, duration).\n\n## Acceptance Criteria\n\n### Single Command Execution - 7 tests\n- [ ] Constructor takes projectDir\n- [ ] `run(command, cwd?)` executes single command via shell\n- [ ] Returns `passed: true` for exit code 0\n- [ ] Returns `passed: false` for non-zero exit code\n- [ ] Captures stdout and stderr in output\n- [ ] Tracks execution duration (ms)\n- [ ] `runWithTimeout(command, cwd?, timeout?)` supports timeout and returns exit code 124 on timeout\n\n### Multiple Quality Commands - 6 tests\n- [ ] `runQualityCommands(commands: QualityCommand[])` executes all commands in order\n- [ ] Returns array of `{ name, success, output, duration }` for each command\n- [ ] Stops execution on first required command failure\n- [ ] Continues execution on optional command failure\n- [ ] `runRequiredOnly(commands: QualityCommand[])` executes only required=true commands\n- [ ] Returns aggregated `allPassed` boolean in result\n\n### Summary\n- [ ] 13 tests pass\n\n## Files\n- src/services/QualityCommandRunner.ts (NEW)\n- src/services/QualityCommandRunner.test.ts (NEW)\n\n## Types\n```typescript\ninterface QualityCommand {\n  name: string;\n  command: string;\n  required: boolean;\n  order: number;\n}\n\ninterface CommandResult {\n  name: string;\n  success: boolean;\n  output: string;\n  duration: number;\n  exitCode: number;\n}\n\ninterface QualityRunResult {\n  results: CommandResult[];\n  allPassed: boolean;\n  firstFailure?: string;  // name of first failed command\n  totalDuration: number;\n}\n```\n\n## Test Cases\n1. Constructor stores projectDir\n2. run() executes single command via shell and returns result\n3. run() returns passed=true for exit code 0\n4. run() returns passed=false for non-zero exit code\n5. run() captures stdout and stderr in output\n6. run() tracks execution duration in milliseconds\n7. runWithTimeout() kills process and returns exit code 124 on timeout\n8. runQualityCommands() executes all commands in order\n9. runQualityCommands() returns per-command results\n10. runQualityCommands() stops on first required failure\n11. runQualityCommands() continues on optional failure\n12. runRequiredOnly() executes only required commands\n13. runQualityCommands() returns aggregated allPassed result\n\n## Notes\n- Quality Command Runner is generic - can run any shell command\n- Caller (F15 Orchestrator) reads config and passes qualityCommands\n- Uses `sh -c` to run command (supports pipes)\n- Default timeout: 5 minutes (300000ms)\n- Handles ALL quality commands: test, lint, typecheck, etc.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T01:38:49.692278+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:34:17.478148+03:00","closed_at":"2026-01-11T18:34:17.478148+03:00","close_reason":"Closed","labels":["m3-task-mgmt"],"dependencies":[{"issue_id":"ch-k3d","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:35.01612+03:00","created_by":"deligoez"}]}
{"id":"ch-k9y","title":"F48: Checkpointer - Create and restore git tag checkpoints","description":"## What\nCreate and manage git tag checkpoints for rollback.\n\n## Context from Master Plan\n```\nAutomatic checkpoints (configured in config.json under \"checkpoints\"):\n\n1. BEFORE AUTOPILOT START (checkpoints.beforeAutopilot: true)\n   git tag chorus-checkpoint-{timestamp}\n\n2. BEFORE MAJOR MERGE (checkpoints.beforeMerge: true)\n   git tag pre-merge-{task-id}\n\n3. PERIODIC (checkpoints.periodic: N)\n   Every N completed tasks (0 = disabled)\n\nDefault: all enabled, periodic every 5 tasks\n```\n\n## Tag Format by Type\n\n| Checkpoint Type | Tag Format | Example |\n|-----------------|------------|---------|\n| autopilot_start | `chorus-checkpoint-{timestamp}` | `chorus-checkpoint-1704931200` |\n| periodic | `chorus-checkpoint-{timestamp}` | `chorus-checkpoint-1704934800` |\n| pre_merge | `pre-merge-{task-id}` | `pre-merge-ch-abc` |\n\n## API\n```typescript\n// src/services/Checkpointer.ts\n\nclass Checkpointer {\n  constructor(private config: CheckpointConfig) {}\n\n  /**\n   * Create a checkpoint tag\n   * Tag format depends on type:\n   * - autopilot_start/periodic: chorus-checkpoint-{timestamp}\n   * - pre_merge: pre-merge-{task-id}\n   * @param type Type of checkpoint\n   * @param taskId Required for pre_merge checkpoints\n   */\n  async create(type: Checkpoint['type'], taskId?: string): Promise\u003cCheckpoint\u003e\n\n  /**\n   * Restore to a checkpoint (Level 4 rollback)\n   * Runs: git reset --hard {tag}\n   * @param checkpointId Checkpoint to restore to\n   * @returns List of affected task IDs (tasks after checkpoint)\n   */\n  async restore(checkpointId: string): Promise\u003cstring[]\u003e\n\n  /**\n   * List all checkpoints\n   * Reads from git tags matching checkpoint patterns\n   */\n  async list(): Promise\u003cCheckpoint[]\u003e\n\n  /**\n   * Delete old checkpoints (keep last N)\n   * Deletes both git tags and metadata\n   */\n  async prune(keepCount: number): Promise\u003cnumber\u003e\n\n  /**\n   * Check if checkpoint should be created (based on config)\n   */\n  shouldCreate(type: Checkpoint['type']): boolean\n\n  /**\n   * Generate tag name based on type\n   */\n  private generateTagName(type: Checkpoint['type'], taskId?: string): string\n}\n```\n\n## shouldCreate() Logic\n\n```typescript\nshouldCreate(type: Checkpoint['type']): boolean {\n  if (!this.config.enabled) return false;  // Master switch\n  \n  switch (type) {\n    case 'autopilot_start':\n      return this.config.beforeAutopilot;\n    case 'pre_merge':\n      return this.config.beforeMerge;\n    case 'periodic':\n      return this.config.periodic \u003e 0;\n  }\n}\n```\n\n## Files\n- src/services/Checkpointer.ts\n- tests/services/Checkpointer.test.ts\n\n## Acceptance Criteria\n\n### create() - 5 tests\n- [ ] `create('autopilot_start')` creates tag `chorus-checkpoint-{timestamp}`\n- [ ] `create('periodic')` creates tag `chorus-checkpoint-{timestamp}`\n- [ ] `create('pre_merge', 'ch-abc')` creates tag `pre-merge-ch-abc`\n- [ ] `create()` stores checkpoint metadata in state\n- [ ] `create()` throws error if tag already exists (duplicate prevention)\n\n### restore() - 2 tests\n- [ ] `restore()` runs `git reset --hard {tag}`\n- [ ] `restore()` returns affected task IDs (commits after checkpoint)\n\n### list() and prune() - 2 tests\n- [ ] `list()` returns all checkpoints from git tags\n- [ ] `prune()` deletes oldest checkpoints, keeps last N\n\n### shouldCreate() - 4 tests\n- [ ] `shouldCreate()` returns false when config.enabled=false (master switch)\n- [ ] `shouldCreate('autopilot_start')` respects config.beforeAutopilot\n- [ ] `shouldCreate('pre_merge')` respects config.beforeMerge\n- [ ] `shouldCreate('periodic')` returns true only when config.periodic \u003e 0\n\n### Summary\n- [ ] 13 tests pass\n\n## Tests\n1. create(autopilot_start) uses chorus-checkpoint-{timestamp} format\n2. create(periodic) uses chorus-checkpoint-{timestamp} format\n3. create(pre_merge, taskId) uses pre-merge-{task-id} format\n4. create() stores metadata in state\n5. create() throws on duplicate tag\n6. restore() runs git reset --hard\n7. restore() returns affected task IDs\n8. list() returns checkpoints from git tags\n9. prune() keeps last N checkpoints\n10. shouldCreate() returns false when enabled=false\n11. shouldCreate(autopilot_start) respects beforeAutopilot config\n12. shouldCreate(pre_merge) respects beforeMerge config\n13. shouldCreate(periodic) returns true only when periodic \u003e 0\n\n## Notes\n- Checkpoint metadata stored in .chorus/checkpoints.json\n- Git tags are the source of truth for checkpoint existence\n- restore() is Level 4 rollback (Full Session)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T10:44:27.200102+03:00","created_by":"deligoez","updated_at":"2026-01-11T22:44:52.361306+03:00","closed_at":"2026-01-11T22:44:52.361306+03:00","close_reason":"Closed","labels":["m10-rollback"],"dependencies":[{"issue_id":"ch-k9y","depends_on_id":"ch-2r5","type":"blocks","created_at":"2026-01-10T10:44:27.201667+03:00","created_by":"deligoez"}]}
{"id":"ch-kakj","title":"TS03: JSONL Persistence","description":"## What\nImplement JSONL file reading and writing with atomic writes.\n\n## Files\n- `src/services/TaskStore.ts`\n- `src/services/TaskStore.test.ts`\n\n## Acceptance Criteria\n- [ ] `load()` reads tasks from `.chorus/tasks.jsonl`\n- [ ] `flush()` writes tasks to JSONL (append-only for new/updated)\n- [ ] Atomic write: temp file → rename\n- [ ] Creates `.chorus/` directory if not exists\n- [ ] Handles empty/missing file gracefully\n- [ ] Parse JSONL to Task (snake_case → camelCase)\n- [ ] Serialize Task to JSONL (camelCase → snake_case)\n- [ ] 6 tests pass","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-13T00:12:30.481287+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:34:17.682814+03:00","closed_at":"2026-01-13T00:34:17.682814+03:00","close_reason":"Closed","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-kakj","depends_on_id":"ch-16xu","type":"blocks","created_at":"2026-01-13T00:12:30.484407+03:00","created_by":"deligoez"}]}
{"id":"ch-kf7a","title":"E2E-02: Layout \u0026 Component Rendering","description":"## What\nE2E tests verifying TUI layout renders correctly with all components visible.\n\n## Tests (8 tests)\n\n### Header Rendering\n1. Shows \"CHORUS\" title in header\n2. Shows mode indicator (semi-auto/autopilot)\n3. Shows agent slots counter (X/Y format)\n\n### Layout Structure\n4. Shows two-column layout (TaskPanel + AgentGrid)\n5. Shows footer bar with task stats\n6. Shows merge queue indicator in footer\n\n### Help Panel\n7. Pressing '?' shows help panel\n8. Pressing '?' again hides help panel\n\n## Files\n- src/e2e/layout.e2e.test.ts (NEW)\n\n## Depends On\n- ch-kxpd: E2E Infrastructure\n- ch-d6yv: Layout Integration (must be complete first)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-11T21:15:31.931725+03:00","created_by":"deligoez","updated_at":"2026-01-11T21:23:24.91964+03:00","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-kf7a","depends_on_id":"ch-kxpd","type":"blocks","created_at":"2026-01-11T21:15:31.933807+03:00","created_by":"deligoez"}],"deleted_at":"2026-01-11T21:23:24.91964+03:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"ch-kflz","title":"TS09: Task Selector","description":"## What\nImplement intelligent task selection algorithm.\n\n## Files\n- `src/services/TaskSelector.ts`\n- `src/services/TaskSelector.test.ts`\n\n## Acceptance Criteria\n- [ ] `selectNextTask(tasks, context?)` returns best task\n- [ ] User hint bonus: +200 for `next` tag\n- [ ] Dependency unblocking bonus: +100 per stuck dependent\n- [ ] Milestone focus bonus: +30 per same-milestone task completed\n- [ ] Series continuation bonus: +25 per shared tag with last task\n- [ ] Atomicity bonus: +50 for tasks with no dependencies\n- [ ] Preferred tags bonus: +10 per matching tag\n- [ ] FIFO fallback: oldest task wins ties\n- [ ] Returns undefined if no ready tasks\n- [ ] 10 tests pass","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:13:48.256764+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:13:48.256764+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-kflz","depends_on_id":"ch-8pne","type":"blocks","created_at":"2026-01-13T00:13:48.25953+03:00","created_by":"deligoez"}]}
{"id":"ch-kjae","title":"FX03: Root Machine (ChorusMachine) - Main state machine with parallel regions","description":"## What\nImplement the root ChorusMachine with parallel regions for orchestration, merge queue, and monitoring.\n\n## Acceptance Criteria\n- [ ] Machine uses `setup()` for type safety\n- [ ] `type: 'parallel'` with 3 regions: orchestration, mergeQueue, monitoring\n- [ ] Orchestration region has states: idle, running, paused\n- [ ] MergeQueue region has states: empty, pending, processing, conflict\n- [ ] Monitoring region has states: active, degraded\n- [ ] App-level states: INIT, PLANNING, REVIEW, IMPLEMENTATION\n- [ ] Guards for state transitions defined\n- [ ] Actions for side effects defined\n- [ ] 12 tests pass\n\n## Tests\n1. Machine initializes in INIT state\n2. CONFIG_COMPLETE transitions INIT → PLANNING\n3. PLAN_APPROVED transitions PLANNING → REVIEW\n4. REVIEW_PASSED transitions REVIEW → IMPLEMENTATION\n5. TRIGGER_PLANNING transitions back to PLANNING\n6. Parallel regions run independently\n7. PAUSE event sets orchestration to paused\n8. RESUME event sets orchestration to running\n9. SET_MODE updates context.mode\n10. SPAWN_AGENT adds to context.agents (spawns child)\n11. STOP_AGENT removes from context.agents (stops child)\n12. Machine context is JSON-serializable\n\n## Files\n- src/machines/chorus.machine.ts\n\n## Dependencies\n- FX02 (XState Types)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-11T15:26:16.896057+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:04:10.03746+03:00","closed_at":"2026-01-11T18:04:10.03746+03:00","close_reason":"Closed","labels":["m-1-xstate"],"dependencies":[{"issue_id":"ch-kjae","depends_on_id":"ch-j321","type":"blocks","created_at":"2026-01-11T15:26:16.900103+03:00","created_by":"deligoez"}]}
{"id":"ch-kmn","title":"F03b-2: Init Scaffold - Beads and Templates","description":"## What\nInitialize Beads, create template files, update gitignore, and orchestrate full initialization.\n\n## Acceptance Criteria\n\n### initBeads() - 3 tests\n- [ ] Runs \\`bd init\\` when \\`.beads/\\` directory does not exist\n- [ ] Skips \\`bd init\\` when \\`.beads/\\` directory already exists\n- [ ] Throws \\`BeadsInitError\\` if \\`bd init\\` command fails (non-zero exit)\n\n### createAgentsMd() - 2 tests\n- [ ] Creates \\`AGENTS.md\\` with template content when file does not exist\n- [ ] Skips creation when \\`AGENTS.md\\` already exists (preserves user content)\n\n### createTaskRulesMd() - 2 tests\n- [ ] Creates \\`.chorus/task-rules.md\\` with default validation rules template\n- [ ] Skips creation when file already exists\n\n### createPatternsMd() - 2 tests\n- [ ] Creates \\`.chorus/PATTERNS.md\\` with empty category sections template\n- [ ] Skips creation when file already exists\n\n### createPlanAgentPrompt() - 2 tests\n- [ ] Creates \\`.chorus/prompts/plan-agent.md\\` with plan agent system prompt\n- [ ] Skips creation when file already exists\n\n### createImplAgentPrompt() - 2 tests\n- [ ] Creates \\`.chorus/prompts/impl-agent.md\\` with implementation agent system prompt\n- [ ] Skips creation when file already exists\n\n### updateGitignore() - 5 tests\n- [ ] Appends \\`.worktrees/\\` to \\`.gitignore\\` if not present\n- [ ] Appends \\`.chorus/state.json\\` to \\`.gitignore\\` if not present\n- [ ] Appends \\`.agent/scratchpad.md\\` to \\`.gitignore\\` if not present\n- [ ] Does not duplicate entries already in \\`.gitignore\\`\n- [ ] Creates \\`.gitignore\\` if file does not exist\n\n### initialize() - orchestration - 5 tests\n- [ ] Calls steps in order: prerequisites → directories → detect → initBeads → templates → updateGitignore → writeConfig\n- [ ] Returns \\`InitResult\\` with \\`createdPaths\\` listing all new paths\n- [ ] Returns \\`InitResult\\` with \\`config\\` containing detected + default settings\n- [ ] Returns \\`InitResult\\` with \\`detectedSettings\\` from detectProjectSettings()\n- [ ] Throws \\`PrerequisiteError\\` if any prerequisite check fails (from F03a)\n\n### Summary\n- [ ] 23 tests pass\n\n## Types\n\\`\\`\\`typescript\ninterface InitOptions {\n  agents: AgentType[];\n  defaultAgent?: AgentType;\n  maxParallel?: number;\n  interactive?: boolean;\n}\n\ninterface InitResult {\n  createdPaths: string[];\n  config: ChorusConfig;\n  detectedSettings: DetectedSettings;\n}\n\nclass BeadsInitError extends Error {\n  constructor(message: string, public exitCode: number) {\n    super(message);\n  }\n}\n\nclass PrerequisiteError extends Error {\n  constructor(message: string, public missing: MissingPrerequisite[]) {\n    super(message);\n  }\n}\n\\`\\`\\`\n\n## task-rules.md Template\n\\`\\`\\`markdown\n# Task Validation Rules\n\n## Built-in Rules (always active)\n- Tasks must be atomic (single responsibility)\n- Tasks must be testable (no vague language)\n- Tasks must have explicit test count\n\n## Configurable Limits\nmax_criteria: 10\nmax_description_length: 500\n\n## Forbidden Words\n- \"works correctly\"\n- \"handles properly\"\n- \"as expected\"\n\\`\\`\\`\n\n## PATTERNS.md Template\n\\`\\`\\`markdown\n# Cross-Agent Patterns\n\n## Successful Approaches\n\u003c!-- Add patterns that worked well --\u003e\n\n## Failures to Avoid\n\u003c!-- Add patterns that caused problems --\u003e\n\n## Code Conventions\n\u003c!-- Add project-specific conventions --\u003e\n\\`\\`\\`\n\n## AGENTS.md Template\n\\`\\`\\`markdown\n# Agents\n\nThis file documents agent behaviors for AI coding assistants.\n\n## Chorus\n\nThis project uses Chorus for multi-agent orchestration.\nSee \\`.chorus/\\` for configuration.\n\\`\\`\\`\n\n## impl-agent.md Template\n\\`\\`\\`markdown\n# Implementation Agent\n\nYou are an implementation agent for Chorus multi-agent orchestration.\n\n## Your Context\n- Working in an isolated git worktree\n- Task details are in your scratchpad\n- Use TDD: write tests first, then implement\n\n## Signals\nWhen done, output: \u003cchorus\u003eCOMPLETE\u003c/chorus\u003e\nOn blocker, output: \u003cchorus\u003eBLOCKED: reason\u003c/chorus\u003e\nIf you need clarification, output: \u003cchorus\u003eNEEDS_HELP: what you need\u003c/chorus\u003e\n\\`\\`\\`\n\n## Files\n- src/services/InitScaffold.ts (UPDATE - add to existing)\n- src/services/InitScaffold.test.ts (UPDATE)\n\n## Dependencies\n- F03b-1 (ch-mdj) - Directories and detection\n- F01c (ch-y43) - Config save","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T23:50:12.602823+03:00","created_by":"deligoez","updated_at":"2026-01-12T02:36:12.871991+03:00","closed_at":"2026-01-12T02:36:12.871991+03:00","close_reason":"Closed","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-kmn","depends_on_id":"ch-mdj","type":"blocks","created_at":"2026-01-10T23:50:12.605402+03:00","created_by":"deligoez"},{"issue_id":"ch-kmn","depends_on_id":"ch-y43","type":"blocks","created_at":"2026-01-10T23:50:12.607472+03:00","created_by":"deligoez"}]}
{"id":"ch-kn0h","title":"TS07: Tag Operations","description":"## What\nImplement tag management.\n\n## Files\n- `src/services/TaskStore.ts`\n- `src/services/TaskStore.test.ts`\n\n## Acceptance Criteria\n- [ ] `addTag(taskId, tag)` adds tag if not present\n- [ ] `removeTag(taskId, tag)` removes tag\n- [ ] `getTags()` returns all unique tags across tasks\n- [ ] Tags are case-sensitive\n- [ ] 4 tests pass","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:13:30.395487+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:13:30.395487+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-kn0h","depends_on_id":"ch-3oot","type":"blocks","created_at":"2026-01-13T00:21:27.188723+03:00","created_by":"deligoez"}]}
{"id":"ch-kns","title":"F63m: Task Recovery Keys (r, R, X, +)","description":"## What\nKeyboard handlers for recovering failed/timeout tasks in TUI.\n\n## Context from Master Plan\n\n**FAILED Recovery:**\n- Press `r` on failed task → Task returns to PENDING, worktree preserved\n- Press `e` to edit task description → Then retry (handled by F46c-d)\n- Press `R` to rollback → Reverts commits, task → PENDING\n- Press `X` (Shift+x) to cleanup worktree → Removes worktree, task stays FAILED\n\n**TIMEOUT Recovery:**\n- Press `r` on timed-out task → Fresh iteration counter, retry\n- Press `e` to simplify task → Break into smaller tasks (handled by F46c-d)\n- Press `+` to increase maxIterations for this task\n\n## Shortcuts\n- **r** - Retry task (clear failure state, return to PENDING)\n- **R** - Rollback task (revert commits, return to PENDING)\n- **X** - Cleanup worktree (remove worktree, keep FAILED status)\n- **+** - Increase maxIterations for selected task\n\n## Acceptance Criteria\n\n### Retry Key (r) - 4 tests\n- [ ] Only active when selected task has `failed=true` or `timeout=true` custom field\n- [ ] Clears custom fields via `bd update \u003cid\u003e --custom failed= --custom timeout=`\n- [ ] Resets iteration counter in state\n- [ ] Shows confirmation: \"Task ch-xxx returned to pending\"\n\n### Rollback Key (R) - 5 tests\n- [ ] Only active when selected task has `failed=true` and has commits\n- [ ] Calls IterationRollback.rollback() from F49\n- [ ] Clears custom fields after rollback\n- [ ] Shows confirmation: \"Rolled back N commits for ch-xxx\"\n- [ ] R on task with no commits shows \"No commits to rollback\"\n\n### Cleanup Key (X) - 4 tests\n- [ ] Only active when selected task has `failed=true` or `timeout=true`\n- [ ] Calls WorktreeService.remove() with force: true\n- [ ] Shows confirmation: \"Worktree cleaned for ch-xxx\"\n- [ ] X on task without worktree shows \"No worktree to clean\"\n\n### Increase Iterations Key (+) - 3 tests\n- [ ] Only active when selected task has `timeout=true`\n- [ ] Updates task-specific maxIterations in state (+5 default)\n- [ ] Shows confirmation: \"Max iterations increased to N for ch-xxx\"\n\n### Key State Management - 3 tests\n- [ ] Keys disabled (no-op) when no task selected\n- [ ] Keys disabled when selected task is not failed/timeout\n- [ ] 19 tests pass\n\n## Implementation\n\n```typescript\n// src/hooks/useRecoveryKeys.ts\n\ninterface UseRecoveryKeysOptions {\n  selectedTask: Task | null;\n  beadsCLI: BeadsCLI;\n  iterationRollback: IterationRollback;\n  worktreeService: WorktreeService;\n  onTaskRecovered?: (taskId: string) =\u003e void;\n}\n\nfunction useRecoveryKeys(options: UseRecoveryKeysOptions) {\n  useInput((input, key) =\u003e {\n    const task = options.selectedTask;\n    if (!task) return;\n    \n    const isFailed = task.custom?.failed === 'true';\n    const isTimeout = task.custom?.timeout === 'true';\n    \n    if (input === 'r' \u0026\u0026 (isFailed || isTimeout)) {\n      // Retry: clear flags, return to pending\n    }\n    \n    if (input === 'R' \u0026\u0026 isFailed) {\n      // Rollback: revert commits, then retry\n      // Check for commits first, show \"No commits to rollback\" if none\n    }\n    \n    if (input === 'X' \u0026\u0026 (isFailed || isTimeout)) {\n      // Cleanup: remove worktree only\n      // Check for worktree first, show \"No worktree to clean\" if none\n    }\n    \n    if (input === '+' \u0026\u0026 isTimeout) {\n      // Increase maxIterations\n    }\n  });\n}\n```\n\n## Files\n- src/hooks/useRecoveryKeys.ts (NEW)\n- src/hooks/useRecoveryKeys.test.ts (NEW)\n\n## Dependencies\n- F12 (BeadsCLI) for custom field updates\n- F49 (IterationRollback) for rollback\n- F05 (WorktreeService) for cleanup\n\n## Notes\n- These keys work on TaskPanel selected task\n- Keys show visual feedback via toast/status message\n- Rollback requires worktree to exist (check first)\n- `+` increments by 5 iterations (configurable)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T11:35:48.367334+03:00","created_by":"deligoez","updated_at":"2026-01-12T05:23:25.873676+03:00","closed_at":"2026-01-12T05:23:25.873676+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-kns","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-11T11:35:55.069622+03:00","created_by":"deligoez"},{"issue_id":"ch-kns","depends_on_id":"ch-c8j","type":"blocks","created_at":"2026-01-11T11:35:55.164787+03:00","created_by":"deligoez"},{"issue_id":"ch-kns","depends_on_id":"ch-112","type":"blocks","created_at":"2026-01-11T11:35:55.255221+03:00","created_by":"deligoez"},{"issue_id":"ch-kns","depends_on_id":"ch-89dk","type":"blocks","created_at":"2026-01-11T14:37:28.3197+03:00","created_by":"deligoez"}]}
{"id":"ch-kwbe","title":"E2E-27: Fullscreen Agent (f key)","description":"## What\nE2E test for fullscreen agent view with 'f' key.\n\n## Acceptance Criteria\n- [ ] Pressing 'f' expands selected agent to fullscreen\n- [ ] Agent output takes entire main area\n- [ ] Header shows agent name prominently\n- [ ] Pressing 'f' again exits fullscreen\n- [ ] Pressing Escape exits fullscreen\n- [ ] 5 tests pass\n\n## Test Cases\n1. `it('expands agent to fullscreen when f is pressed')`\n2. `it('agent output fills main area')`\n3. `it('shows agent name in header')`\n4. `it('exits fullscreen when f pressed again')`\n5. `it('exits fullscreen with Escape')`\n\n## Files\n- tests/e2e/fullscreen-agent.test.ts\n\n## Dependencies\n- ch-0e01 (E2E Infrastructure)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:21:20.528295+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:38:06.558772+03:00","closed_at":"2026-01-12T01:38:06.558772+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-kwbe","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:21:20.531339+03:00","created_by":"deligoez"}]}
{"id":"ch-kxpd","title":"E2E-01: Test Infrastructure Setup","description":"## What\nSet up E2E testing infrastructure using cli-testing-library for real terminal testing.\n\n## Why\nCurrent tests use ink-testing-library which only tests component rendering.\nE2E tests will verify actual keyboard input, terminal output, and user flows.\n\n## Acceptance Criteria\n- [ ] Install cli-testing-library as dev dependency\n- [ ] Create test helper utilities in src/test-utils/e2e.ts\n- [ ] Helper to spawn chorus CLI process\n- [ ] Helper to wait for specific output text\n- [ ] Helper to simulate keyboard sequences\n- [ ] Verify basic render test works\n- [ ] 3 tests pass (infrastructure smoke tests)\n\n## Files\n- package.json (add cli-testing-library)\n- src/test-utils/e2e.ts (NEW)\n- src/test-utils/e2e.test.ts (NEW)\n\n## API\n\\`\\`\\`typescript\n// src/test-utils/e2e.ts\nexport async function renderApp(): Promise\u003cRenderResult\u003e;\nexport async function waitForText(result: RenderResult, text: string): Promise\u003cvoid\u003e;\nexport async function pressKey(result: RenderResult, key: string): Promise\u003cvoid\u003e;\nexport async function pressKeys(result: RenderResult, keys: string[]): Promise\u003cvoid\u003e;\n\\`\\`\\`\n\n## Tests\n1. Can spawn and render chorus CLI\n2. Can find text in output\n3. Can simulate keyboard input\n\n## Notes\n- Alternative: node-pty for complex scenarios\n- Consider timeout handling for async operations","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-11T21:15:20.749621+03:00","created_by":"deligoez","updated_at":"2026-01-11T21:23:24.860885+03:00","labels":["m12-tui"],"deleted_at":"2026-01-11T21:23:24.860885+03:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"ch-kyx","title":"F63g: Grid Settings (g) - Open agent grid configuration","description":"## What\nKeyboard handler for 'g' key to open grid configuration dialog.\n\n## Shortcut\n- **g** - Open/close grid settings dialog (toggle behavior)\n\n## Implementation\n```typescript\n// src/hooks/useKeyboard.ts\nimport { useInput } from 'ink';\n\nexport function useKeyboard(options: UseKeyboardOptions) {\n  useInput((input, key) =\u003e {\n    if (input === 'g') {\n      options.onGridSettings?.();\n    }\n  });\n}\n\ninterface UseKeyboardOptions {\n  onGridSettings?: () =\u003e void;\n}\n```\n\n```typescript\n// GridSettingsDialog.tsx\ntype GridLayout = 'auto' | '1x1' | '2x2' | '2x3' | '1x4';\n\ninterface GridSettingsDialogProps {\n  isOpen: boolean;\n  currentLayout: GridLayout;\n  onSelect: (layout: GridLayout) =\u003e void;\n  onCancel: () =\u003e void;\n}\n\nexport function GridSettingsDialog({ isOpen, currentLayout, onSelect, onCancel }) {\n  const [selected, setSelected] = useState(currentLayout);\n  const layouts: GridLayout[] = ['auto', '1x1', '2x2', '2x3', '1x4'];\n  \n  useInput((input, key) =\u003e {\n    if (input === 'g') onCancel();  // Toggle: g closes if open\n    if (key.escape) onCancel();\n    if (key.return) onSelect(selected);\n    if (key.upArrow) setSelected(prev =\u003e /* previous option */);\n    if (key.downArrow) setSelected(prev =\u003e /* next option */);\n  });\n}\n```\n\n## Behavior\n- Pressing 'g' opens grid configuration dialog\n- Pressing 'g' again while dialog is open closes it (toggle)\n- Options: auto, 1x1, 2x2, 2x3, 1x4\n- Arrow keys navigate, Enter selects, Escape cancels\n- Selection updates useAgentGrid config and persists to config.json\n\n## Files\n- src/hooks/useKeyboard.ts (UPDATE)\n- src/hooks/useKeyboard.test.ts (UPDATE)\n- src/components/GridSettingsDialog.tsx (NEW)\n- src/components/GridSettingsDialog.test.tsx (NEW)\n\n## Acceptance Criteria\n- [ ] `useInput` detects 'g' and calls `onGridSettings()`\n- [ ] Dialog renders layout options when isOpen=true\n- [ ] Pressing 'g' while dialog is open closes it (toggle behavior)\n- [ ] Current layout is visually highlighted\n- [ ] Up/Down arrow keys change selected option\n- [ ] Enter calls `onSelect(selectedLayout)`\n- [ ] Escape calls `onCancel()`\n- [ ] Saves selected layout to config.json tui.agentGrid field\n- [ ] 8 tests pass\n\n## Tests\n1. 'g' key calls onGridSettings callback\n2. Dialog renders all layout options\n3. 'g' key in open dialog calls onCancel (toggle)\n4. Current layout shows highlighted style\n5. Arrow keys navigate between options\n6. Enter calls onSelect with selected layout\n7. Escape calls onCancel\n8. onSelect persists layout to config.json","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T21:54:26.60091+03:00","created_by":"deligoez","updated_at":"2026-01-12T05:49:59.686909+03:00","closed_at":"2026-01-12T05:49:59.686909+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-kyx","depends_on_id":"ch-70p","type":"blocks","created_at":"2026-01-10T21:54:31.889685+03:00","created_by":"deligoez"}]}
{"id":"ch-l8p9","title":"E2E-35: Concurrent Operations","description":"## What\nE2E test for handling multiple concurrent operations.\n\n## Acceptance Criteria\n- [ ] Multiple agents update outputs simultaneously\n- [ ] Task list updates while agents run\n- [ ] Status bar counts update in real-time\n- [ ] No visual glitches during rapid updates\n- [ ] 4 tests pass\n\n## Test Cases\n1. `it('handles multiple agent outputs')`\n2. `it('updates task list during agent work')`\n3. `it('status bar counts are accurate')`\n4. `it('no flicker during rapid updates')`\n\n## Files\n- tests/e2e/concurrent-operations.test.ts\n\n## Dependencies\n- ch-0e01 (E2E Infrastructure)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:22:09.756344+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:53:47.987859+03:00","closed_at":"2026-01-12T01:53:47.987859+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-l8p9","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:22:09.759307+03:00","created_by":"deligoez"}]}
{"id":"ch-lbe7","title":"FX10: RalphLoop Machine - Autopilot state machine for autonomous operation","description":"## What\nRalphLoop (autopilot) as an XState child actor, not standalone EventEmitter.\n\n## Architecture\n\nRalphLoop is spawned from ChorusMachine when autopilot mode is activated:\n\n```\n┌─────────────────────────────────────────────────────────────────┐\n│                    RALPHLOOP MACHINE                             │\n│                     (Child Actor)                                │\n├─────────────────────────────────────────────────────────────────┤\n│                                                                  │\n│  ┌────────┐    START    ┌─────────┐                             │\n│  │  idle  │────────────►│ running │◄──────┐                     │\n│  └────────┘             └────┬────┘       │                     │\n│       ▲                      │            │                     │\n│       │ STOP           PAUSE │      RESUME│                     │\n│       │                      ▼            │                     │\n│       │                ┌──────────┐       │                     │\n│       └────────────────│  paused  │───────┘                     │\n│                        └────┬─────┘                             │\n│                             │                                   │\n│              ┌──────────────┼──────────────┐                    │\n│              │ ERROR        │ STUCK        │ DISK_FULL          │\n│              ▼              ▼              ▼                    │\n│        ┌──────────┐  ┌──────────┐  ┌──────────┐                │\n│        │errorHalt │  │  stuck   │  │ diskFull │                │\n│        └──────────┘  └──────────┘  └──────────┘                │\n│                                                                  │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n## RalphLoop Context\n\n```typescript\ninterface RalphLoopContext {\n  // Parent reference\n  parentRef: AnyActorRef;\n  \n  // Error tracking\n  consecutiveErrors: number;\n  errorThreshold: number; // default: 3\n  \n  // Stuck detection\n  lastCommitTimes: Map\u003cstring, number\u003e; // agentId → lastCommitTs\n  stuckThreshold: number; // default: 300000 (5 min)\n  \n  // Disk monitoring\n  minDiskSpaceMB: number; // default: 500\n  \n  // Stats\n  tasksAssigned: number;\n  tasksCompleted: number;\n  startedAt: number;\n}\n```\n\n## RalphLoop Events\n\n```typescript\ntype RalphLoopEvent =\n  | { type: 'START' }\n  | { type: 'STOP' }\n  | { type: 'PAUSE' }\n  | { type: 'RESUME' }\n  | { type: 'TASK_ASSIGNED'; taskId: string }\n  | { type: 'TASK_COMPLETED'; taskId: string }\n  | { type: 'ERROR'; error: Error }\n  | { type: 'AGENT_COMMITTED'; agentId: string; commitHash: string }\n  | { type: 'STUCK_AGENT_DETECTED'; agentId: string }\n  | { type: 'DISK_FULL' }\n  | { type: 'DISK_CLEARED' };\n```\n\n## XState Testing Pattern\n\n```typescript\nimport { createActor } from 'xstate';\nimport { describe, it, expect, vi } from 'vitest';\n\ndescribe('RalphLoopMachine', () =\u003e {\n  it('should transition from idle to running on START', () =\u003e {\n    // Arrange\n    const actor = createActor(ralphLoopMachine, {\n      input: { parentRef: mockParentRef }\n    });\n    actor.start();\n\n    // Act\n    actor.send({ type: 'START' });\n\n    // Assert\n    expect(actor.getSnapshot().value).toBe('running');\n  });\n\n  it('should halt after errorThreshold consecutive errors', () =\u003e {\n    // Arrange\n    const actor = createActor(ralphLoopMachine, {\n      input: { parentRef: mockParentRef, errorThreshold: 2 }\n    });\n    actor.start();\n    actor.send({ type: 'START' });\n\n    // Act\n    actor.send({ type: 'ERROR', error: new Error('test') });\n    actor.send({ type: 'ERROR', error: new Error('test') });\n\n    // Assert\n    expect(actor.getSnapshot().value).toBe('errorHalt');\n    expect(actor.getSnapshot().context.consecutiveErrors).toBe(2);\n  });\n\n  it('should detect stuck agent after stuckThreshold', async () =\u003e {\n    // Arrange\n    vi.useFakeTimers();\n    const actor = createActor(ralphLoopMachine, {\n      input: { parentRef: mockParentRef, stuckThreshold: 5000 }\n    });\n    actor.start();\n    actor.send({ type: 'START' });\n    actor.send({ type: 'TASK_ASSIGNED', taskId: 'task-1' });\n\n    // Act - advance time past threshold\n    await vi.advanceTimersByTimeAsync(6000);\n\n    // Assert\n    expect(actor.getSnapshot().value).toBe('stuck');\n    vi.useRealTimers();\n  });\n\n  it('should send RALPHLOOP_HALTED to parent on error halt', () =\u003e {\n    // Arrange\n    const parentSend = vi.fn();\n    const mockParent = { send: parentSend };\n    const actor = createActor(ralphLoopMachine, {\n      input: { parentRef: mockParent, errorThreshold: 1 }\n    });\n    actor.start();\n    actor.send({ type: 'START' });\n\n    // Act\n    actor.send({ type: 'ERROR', error: new Error('test') });\n\n    // Assert\n    expect(parentSend).toHaveBeenCalledWith({\n      type: 'RALPHLOOP_HALTED',\n      reason: 'errorThreshold'\n    });\n  });\n});\n```\n\n## Acceptance Criteria\n\n### State Transitions - 5 tests\n- [ ] Initial state is 'idle'\n- [ ] START transitions idle → running\n- [ ] STOP transitions any → idle\n- [ ] PAUSE transitions running → paused\n- [ ] RESUME transitions paused → running\n\n### Error Handling - 3 tests\n- [ ] ERROR increments consecutiveErrors\n- [ ] Transitions to errorHalt when consecutiveErrors \u003e= errorThreshold\n- [ ] TASK_COMPLETED resets consecutiveErrors to 0\n\n### Stuck Detection - 3 tests\n- [ ] AGENT_COMMITTED updates lastCommitTimes map\n- [ ] Detects stuck agent after stuckThreshold without commit\n- [ ] STUCK_AGENT_DETECTED transitions to stuck state\n\n### Disk Monitoring - 2 tests\n- [ ] DISK_FULL transitions to diskFull state\n- [ ] DISK_CLEARED transitions diskFull → running\n\n### Parent Communication - 3 tests\n- [ ] Sends RALPHLOOP_HALTED on errorHalt entry\n- [ ] Sends RALPHLOOP_STUCK on stuck entry\n- [ ] Sends RALPHLOOP_DISK_FULL on diskFull entry\n\n### Summary\n- [ ] 16 tests pass\n\n## Files\n- src/machines/ralphloop.machine.ts (CREATE)\n- tests/machines/ralphloop.machine.test.ts (CREATE)\n\n## Dependencies\n- FX07 (React Integration) - for useActor hook in TUI\n\n## Implementation Notes\n- Spawned via: `spawn(ralphLoopMachine, { input: {...} })`\n- Entry actions use `sendTo(context.parentRef, event)` for parent comms\n- Stuck detection uses setInterval in 'running' state (invoke service)\n- Disk check is periodic action in 'running' state","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-11T16:16:08.798988+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:19:28.823077+03:00","closed_at":"2026-01-11T18:19:28.823077+03:00","close_reason":"Closed","labels":["m-1-xstate"],"dependencies":[{"issue_id":"ch-lbe7","depends_on_id":"ch-vskx","type":"blocks","created_at":"2026-01-11T16:16:08.802618+03:00","created_by":"deligoez"}]}
{"id":"ch-lczo","title":"E2E-14: Start Autopilot (a)","description":"## What\nVerify a key starts autopilot mode.\n\n## Tests (2 tests)\n1. Pressing a switches to autopilot\n2. Mode indicator shows autopilot\n\n## Files\n- src/e2e/start-autopilot.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T21:18:25.354104+03:00","created_by":"deligoez","updated_at":"2026-01-12T06:32:47.496002+03:00","closed_at":"2026-01-12T06:32:47.496002+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-lczo","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:18:25.355435+03:00","created_by":"deligoez"},{"issue_id":"ch-lczo","depends_on_id":"ch-jx9","type":"blocks","created_at":"2026-01-11T21:18:25.357851+03:00","created_by":"deligoez"}]}
{"id":"ch-lf1g","title":"TS13: Recovery Context Injection","description":"## What\nImplement audit log injection for recovered tasks.\n\n## Files\n- `src/services/CrashRecovery.ts`\n- `src/services/CrashRecovery.test.ts`\n\n## Acceptance Criteria\n- [ ] `getRecoveryContext(taskId, store)` checks retryCount\n- [ ] Returns undefined if no previous attempts\n- [ ] Reads audit log from `.chorus/audit/{id}.jsonl`\n- [ ] Checks worktree for uncommitted changes\n- [ ] Returns RecoveryContext with instruction message\n- [ ] 5 tests pass","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:14:52.456379+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:14:52.456379+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-lf1g","depends_on_id":"ch-a52l","type":"blocks","created_at":"2026-01-13T00:14:52.458136+03:00","created_by":"deligoez"},{"issue_id":"ch-lf1g","depends_on_id":"ch-vsxe","type":"blocks","created_at":"2026-01-13T00:21:32.448785+03:00","created_by":"deligoez"}]}
{"id":"ch-lhm","title":"F16b: Completion Handler - Retry and failure logic","description":"## What\nHandle retry logic, failure cases, blocked state, and agent crashes.\n\n## Acceptance Criteria\n\n### handleAgentExit() - No Signal Path - 3 tests\n- [ ] Returns `{ action: 'retry' }` when no completion signal and iteration \u003c max\n- [ ] Returns `{ action: 'retry' }` when tests fail (even with signal) and iteration \u003c max\n- [ ] Returns `{ action: 'failed' }` when no signal and iteration \u003e= max\n\n### handleAgentExit() - Blocked Path - 2 tests\n- [ ] Returns `{ action: 'blocked', reason }` when BLOCKED signal detected\n- [ ] Sets task custom field via `bd update \u003cid\u003e --status=open --custom blocked=true`\n\n### handleAgentExit() - Needs Help Path - 3 tests\n- [ ] Returns `{ action: 'needs_help', question }` when NEEDS_HELP signal detected\n- [ ] Returns `{ action: 'needs_help', question }` when NEEDS_HUMAN signal detected (same behavior as NEEDS_HELP)\n- [ ] Sets task custom field via `bd update \u003cid\u003e --status=open --custom needsHelp=true`\n\n### handleAgentExit() - Crash Path - 2 tests\n- [ ] Returns `{ action: 'failed', reason: 'crash' }` on non-zero exit code\n- [ ] Sets task custom field via `bd update \u003cid\u003e --status=open --custom failed=true`\n\n### handleAgentExit() - Timeout Path - 2 tests\n- [ ] Returns `{ action: 'timeout' }` when timeout signal received\n- [ ] Sets task custom field via `bd update \u003cid\u003e --status=open --custom timeout=true`\n\n### handleRetry() - 4 tests\n- [ ] Emits \"retry\" event with { taskId, iteration }\n- [ ] Increments iteration count in agentStore\n- [ ] Respects `config.completion.maxIterations`\n- [ ] Clears custom fields via `bd update \u003cid\u003e --custom failed= --custom timeout= --custom blocked= --custom needsHelp=`\n\n### handleMaxReached() - 2 tests\n- [ ] Returns `{ action: 'failed', reason: 'max_iterations' }` when at limit\n- [ ] Emits \"failed\" event with taskId and iteration count\n\n### Summary\n- [ ] 18 tests pass\n\n## Beads Custom Field Tracking\n\n**CRITICAL:** Chorus extends Beads statuses with custom fields:\n\n| Chorus State | Beads Status | Custom Field | Command |\n|--------------|--------------|--------------|---------|\n| PENDING | `open` | - | Default |\n| IN_PROGRESS | `in_progress` | - | Normal |\n| CLOSED | `closed` | - | Normal |\n| BLOCKED | `open` | `blocked: true` | `bd update \u003cid\u003e --status=open --custom blocked=true` |\n| NEEDS_HELP | `open` | `needsHelp: true` | `bd update \u003cid\u003e --status=open --custom needsHelp=true` |\n| NEEDS_HUMAN | `open` | `needsHelp: true` | `bd update \u003cid\u003e --status=open --custom needsHelp=true` |\n| FAILED | `open` | `failed: true` | `bd update \u003cid\u003e --status=open --custom failed=true` |\n| TIMEOUT | `open` | `timeout: true` | `bd update \u003cid\u003e --status=open --custom timeout=true` |\n\n**Note:** NEEDS_HUMAN and NEEDS_HELP trigger identical behavior - both set `needsHelp: true` custom field.\n\n**On retry, clear all failure custom fields:**\n```bash\nbd update ch-xxx --custom failed= --custom timeout= --custom blocked= --custom needsHelp=\n```\n\n## Exit Decision Tree (Priority Order)\n\n**CRITICAL: Conditions are checked in this EXACT order. First match wins.**\n\n```\nhandleAgentExit(exitCode, signal, testsPass, iteration, maxIterations):\n\n  1. CRASH CHECK (highest priority)\n     if exitCode !== 0:\n       → { action: 'failed', reason: 'crash' }\n       → bd update \u003cid\u003e --status=open --custom failed=true\n       (non-zero exit = agent crashed, nothing else matters)\n\n  2. BLOCKED CHECK\n     if signal === 'BLOCKED':\n       → { action: 'blocked', reason: signal.reason }\n       → bd update \u003cid\u003e --status=open --custom blocked=true\n       (agent explicitly signaled blocked state)\n\n  3. NEEDS HELP CHECK\n     if signal === 'NEEDS_HELP' || signal === 'NEEDS_HUMAN':\n       → { action: 'needs_help', question: signal.payload }\n       → bd update \u003cid\u003e --status=open --custom needsHelp=true\n       (agent needs clarification - TUI shows question, waits for user)\n\n  4. TIMEOUT CHECK\n     if signal === 'TIMEOUT':\n       → { action: 'timeout' }\n       → bd update \u003cid\u003e --status=open --custom timeout=true\n\n  5. SUCCESS CHECK\n     if signal === 'COMPLETE' \u0026\u0026 testsPass === true:\n       → delegate to F16a success handler\n       (this is the happy path)\n\n  6. MAX ITERATIONS CHECK\n     if iteration \u003e= maxIterations:\n       → { action: 'failed', reason: 'max_iterations' }\n       → bd update \u003cid\u003e --status=open --custom failed=true\n       (exhausted retries)\n\n  7. RETRY (default)\n     → { action: 'retry' }\n     → clear custom fields before retry\n     (covers: no signal, tests failed, incomplete work)\n```\n\n## Exit Handling Matrix\n\n| Priority | Exit Code | Signal | Tests | Action | Reason | Custom Field |\n|----------|-----------|--------|-------|--------|--------|--------------|\n| 1 | != 0 | any | any | failed | crash | failed=true |\n| 2 | 0 | BLOCKED | any | blocked | signal.reason | blocked=true |\n| 3 | 0 | NEEDS_HELP | any | needs_help | signal.payload | needsHelp=true |\n| 3 | 0 | NEEDS_HUMAN | any | needs_help | signal.payload | needsHelp=true |\n| 4 | 0 | TIMEOUT | any | timeout | - | timeout=true |\n| 5 | 0 | COMPLETE | pass | → F16a | success | - |\n| 6 | 0 | any | any | failed | max_iterations (if at limit) | failed=true |\n| 7 | 0 | any | any | retry | default | clear all |\n\n## Mode-Specific Behavior\n\n**BLOCKED:**\n- Semi-auto: Agent stops, user decides next action via TUI\n- Autopilot: Agent freed, task stays BLOCKED, picks next ready task\n\n**NEEDS_HELP / NEEDS_HUMAN:**\n- Both modes: Agent pauses, TUI displays question to user\n- User provides answer → agent resumes with context\n- User can also: skip, block, or stop agent\n- Both signals trigger identical behavior (NEEDS_HUMAN is alias for NEEDS_HELP)\n\n## Files\n- src/services/CompletionHandler.ts (UPDATE)\n- tests/services/CompletionHandler.test.ts (UPDATE)\n\n## Notes\n- Does NOT respawn agent (Orchestrator handles retry)\n- Events allow loose coupling with Orchestrator\n- BLOCKED/NEEDS_HELP/NEEDS_HUMAN reason extracted from signal content\n- Keep worktree on crash/failed/timeout for debugging\n- Custom fields enable TUI to show correct status indicators","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T02:06:51.093896+03:00","created_by":"deligoez","updated_at":"2026-01-11T20:01:11.890843+03:00","closed_at":"2026-01-11T20:01:11.890843+03:00","close_reason":"Closed","labels":["m4-orchestration"],"dependencies":[{"issue_id":"ch-lhm","depends_on_id":"ch-7jw","type":"blocks","created_at":"2026-01-10T02:06:51.096495+03:00","created_by":"deligoez"}]}
{"id":"ch-lqp6","title":"BUG: FooterBar not integrated into main app Layout","description":"## What\nFooterBar component exists but is not integrated into the main app Layout.\nThe app currently uses StatusBar which shows simple counts, not detailed task stats.\n\n## Current State\n- FooterBar component exists at src/components/FooterBar.tsx\n- Layout.tsx uses StatusBar, not FooterBar\n- E2E-04 tests can't pass because FooterBar isn't visible\n\n## Fix Required\n- Replace or add FooterBar in app.tsx or Layout.tsx\n- Compute task stats (done, running, pending, blocked) from beads\n- Show merge queue indicator\n\n## Acceptance Criteria\n- [ ] FooterBar visible in main app\n- [ ] Task stats (done/running/pending/blocked) calculated from beads\n- [ ] Merge queue indicator shows correctly\n- [ ] E2E-04 tests pass after integration\n\n## Blocks\n- ch-xhsx (E2E-04: FooterBar Shows Stats)\n\n## Files\n- src/app.tsx\n- src/components/Layout.tsx\n- src/components/FooterBar.tsx","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T22:07:13.620829+03:00","created_by":"deligoez","updated_at":"2026-01-11T22:14:34.645579+03:00","closed_at":"2026-01-11T22:14:34.645579+03:00","close_reason":"Closed","labels":["m12-tui"]}
{"id":"ch-lr1k","title":"E2E-07: Panels \u0026 Views","description":"## What\nE2E tests for help panel, intervention menu, logs, and other views.\n\n## Tests (12 tests)\n\n### Help Panel\n1. '?' shows help panel with all shortcuts\n2. Help panel shows 8 categories\n3. '?' closes help panel\n\n### Intervention Menu\n4. 'i' opens intervention panel\n5. Can navigate intervention options\n6. ESC closes intervention panel\n\n### Logs Panel\n7. 'l' shows agent logs panel\n8. Logs scroll with j/k keys\n\n### Learnings Panel\n9. 'L' shows learnings panel\n10. Can navigate learnings\n\n### Merge Queue View\n11. 'M' shows merge queue panel\n12. Shows queued/merging/conflict counts\n\n## Files\n- src/e2e/panels.e2e.test.ts (NEW)\n\n## Depends On\n- ch-kxpd: E2E Infrastructure\n- ch-ak5: Toggle Help Key\n- ch-6n5: Intervention Menu Key\n- ch-555: View Logs Key\n- ch-u5j: View Learnings Key\n- ch-0fwe: Merge Queue View Key","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-11T21:16:18.290032+03:00","created_by":"deligoez","updated_at":"2026-01-11T21:23:25.230485+03:00","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-lr1k","depends_on_id":"ch-kxpd","type":"blocks","created_at":"2026-01-11T21:16:18.292485+03:00","created_by":"deligoez"},{"issue_id":"ch-lr1k","depends_on_id":"ch-ak5","type":"blocks","created_at":"2026-01-11T21:16:18.296439+03:00","created_by":"deligoez"},{"issue_id":"ch-lr1k","depends_on_id":"ch-6n5","type":"blocks","created_at":"2026-01-11T21:16:18.298498+03:00","created_by":"deligoez"},{"issue_id":"ch-lr1k","depends_on_id":"ch-555","type":"blocks","created_at":"2026-01-11T21:16:18.300886+03:00","created_by":"deligoez"},{"issue_id":"ch-lr1k","depends_on_id":"ch-u5j","type":"blocks","created_at":"2026-01-11T21:16:18.302393+03:00","created_by":"deligoez"},{"issue_id":"ch-lr1k","depends_on_id":"ch-0fwe","type":"blocks","created_at":"2026-01-11T21:16:18.303829+03:00","created_by":"deligoez"}],"deleted_at":"2026-01-11T21:23:25.230485+03:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"ch-lu60","title":"E2E-04: Agent Operations","description":"## What\nE2E tests for agent spawning, assignment, and stopping.\n\n## Tests (8 tests)\n\n### Spawn Agent\n1. 's' spawns new agent for selected task\n2. Agent tile appears in AgentGrid\n3. Agent shows \"starting...\" status initially\n4. Agent slots counter increments\n\n### Assign Task\n5. Enter assigns selected task to idle agent\n6. Task shows agent iteration display\n7. Agent tile shows task ID\n\n### Stop Agent\n8. 'x' stops selected agent with confirmation\n\n## Files\n- src/e2e/agent-operations.e2e.test.ts (NEW)\n\n## Depends On\n- ch-kxpd: E2E Infrastructure\n- ch-p3c: Spawn Agent Key\n- ch-ukl: Assign Task Key\n- ch-cwy: Agent Stop","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-11T21:15:49.933412+03:00","created_by":"deligoez","updated_at":"2026-01-11T21:23:25.041622+03:00","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-lu60","depends_on_id":"ch-kxpd","type":"blocks","created_at":"2026-01-11T21:15:49.935873+03:00","created_by":"deligoez"},{"issue_id":"ch-lu60","depends_on_id":"ch-p3c","type":"blocks","created_at":"2026-01-11T21:15:49.938501+03:00","created_by":"deligoez"},{"issue_id":"ch-lu60","depends_on_id":"ch-ukl","type":"blocks","created_at":"2026-01-11T21:15:49.940203+03:00","created_by":"deligoez"},{"issue_id":"ch-lu60","depends_on_id":"ch-cwy","type":"blocks","created_at":"2026-01-11T21:15:49.941757+03:00","created_by":"deligoez"}],"deleted_at":"2026-01-11T21:23:25.041622+03:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"ch-lv0w","title":"FR06: Feedback Storage - Save and load feedback history per task","description":"## What\nSave and load feedback history from .chorus/feedback/ directory.\n\n## Acceptance Criteria\n- [ ] `saveFeedback(taskId, entry)` appends to history array in `.chorus/feedback/{taskId}.json`\n- [ ] Creates `.chorus/feedback/` directory if not exists\n- [ ] `loadFeedback(taskId)` returns full `TaskFeedback` with history array\n- [ ] `loadFeedback(taskId)` returns `null` for non-existent file\n- [ ] Preserves existing history when appending new entry\n- [ ] 6 tests pass\n\n## Files\n- src/services/FeedbackStorage.ts\n- src/services/FeedbackStorage.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:11:23.249465+03:00","created_by":"deligoez","updated_at":"2026-01-12T15:27:25.369462+03:00","closed_at":"2026-01-12T15:27:25.369462+03:00","close_reason":"Closed","labels":["m13-review"],"dependencies":[{"issue_id":"ch-lv0w","depends_on_id":"ch-zjlr","type":"blocks","created_at":"2026-01-12T15:11:23.252397+03:00","created_by":"deligoez"}]}
{"id":"ch-lxxb","title":"FX01: XState Setup - Package installation and tsconfig","description":"## What\nInstall XState v5 and configure TypeScript for actor model support.\n\n## Acceptance Criteria\n- [ ] `xstate` v5.x installed\n- [ ] `@xstate/react` installed\n- [ ] tsconfig.json updated for XState (strict mode)\n- [ ] 4 tests pass\n\n## Tests\n1. `xstate` package is importable\n2. `@xstate/react` package is importable\n3. TypeScript compiles XState machine definition\n4. Simple machine can be created and started\n\n## Files\n- package.json\n- tsconfig.json\n- src/machines/index.ts (barrel export)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-11T15:25:53.417697+03:00","created_by":"deligoez","updated_at":"2026-01-11T17:48:16.437208+03:00","closed_at":"2026-01-11T17:48:16.437208+03:00","close_reason":"Closed","labels":["m-1-xstate"]}
{"id":"ch-m18w","title":"BUG: Enable intervention menu E2E tests","description":"## What\n5 intervention menu E2E tests are skipped because feature not wired up.\n\n## Current State\nSkipped tests:\n- src/e2e/intervention-menu.e2e.test.ts:35 - opens menu when i pressed\n- src/e2e/intervention-menu.e2e.test.ts:73 - shows correct menu options\n- src/e2e/intervention-menu-pty.e2e.test.ts:44 - opens menu when i pressed\n- src/e2e/intervention-menu-pty.e2e.test.ts:60 - shows correct menu options\n- src/e2e/intervention-menu-pty.e2e.test.ts:78 - closes with Escape\n\n## Problem\nIntervention menu keyboard handler not connected to UI.\n\n## Acceptance Criteria\n- [ ] Wire up useInterventionKey hook to ImplementationMode\n- [ ] InterventionPanel opens on 'i' key\n- [ ] Menu shows correct options\n- [ ] Escape closes menu\n- [ ] Remove .skip from all 5 tests\n- [ ] 5 tests pass\n\n## Files\n- src/e2e/intervention-menu.e2e.test.ts\n- src/e2e/intervention-menu-pty.e2e.test.ts\n- src/hooks/useInterventionKey.ts\n- src/modes/ImplementationMode.tsx","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T13:36:19.273485+03:00","created_by":"deligoez","updated_at":"2026-01-12T14:15:32.793896+03:00","closed_at":"2026-01-12T14:15:32.793896+03:00","close_reason":"Intervention panel wired up, TTY detection fixed, 6 PTY tests pass","labels":["m9-intervention"]}
{"id":"ch-m6sn","title":"FR15: Review Config - Config file integration for review settings","description":"## What\nAdd review configuration to ChorusConfig and integrate with config file.\n\n## Acceptance Criteria\n- [ ] Adds `review: ReviewConfig` to `ChorusConfig` interface\n- [ ] `getDefaultConfig()` includes review defaults (defaultMode: 'batch', autoApprove enabled)\n- [ ] Config loads from `.chorus/config.json` with review section\n- [ ] Config validates review schema (rejects invalid values)\n- [ ] 4 tests pass\n\n## Files\n- src/types/config.ts\n- src/services/ConfigService.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:11:24.547759+03:00","created_by":"deligoez","updated_at":"2026-01-12T15:34:01.542396+03:00","closed_at":"2026-01-12T15:34:01.542396+03:00","close_reason":"Closed","labels":["m13-review"],"dependencies":[{"issue_id":"ch-m6sn","depends_on_id":"ch-zjlr","type":"blocks","created_at":"2026-01-12T15:11:24.550396+03:00","created_by":"deligoez"}]}
{"id":"ch-m9dg","title":"E2E-08: Quick Select (1-9)","description":"## What\nVerify 1-9 keys quick select tasks.\n\n## Tests (3 tests)\n1. Pressing 1 selects first task\n2. Pressing 5 selects fifth task\n3. Invalid number (\u003etask count) is no-op\n\n## Files\n- src/e2e/quick-select.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T21:18:00.366404+03:00","created_by":"deligoez","updated_at":"2026-01-12T00:53:14.169917+03:00","closed_at":"2026-01-12T00:53:14.169917+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-m9dg","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:18:00.368835+03:00","created_by":"deligoez"},{"issue_id":"ch-m9dg","depends_on_id":"ch-4ow","type":"blocks","created_at":"2026-01-11T21:18:00.372619+03:00","created_by":"deligoez"}]}
{"id":"ch-m9p7","title":"E2E-18: Mark Done (d)","description":"## What\nVerify d key marks task done.\n\n## Tests (3 tests)\n1. Pressing d marks task done\n2. Task shows ✓ indicator\n3. Footer stats update\n\n## Files\n- src/e2e/mark-done.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T21:18:38.554805+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:00:25.728381+03:00","closed_at":"2026-01-12T01:00:25.728381+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-m9p7","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:18:38.556241+03:00","created_by":"deligoez"},{"issue_id":"ch-m9p7","depends_on_id":"ch-02h","type":"blocks","created_at":"2026-01-11T21:18:38.558158+03:00","created_by":"deligoez"}]}
{"id":"ch-m9y","title":"F80: Init Mode Controller","description":"## What\nOrchestrate the 5-step init flow (prerequisites, wizard steps, save config).\n\n## Files\n- `src/modes/InitMode.tsx`\n- `src/modes/InitMode.test.tsx`\n\n## Dependencies\n- F80a (ch-06m): ProjectDetector\n- F80b (ch-4ba): ConfigWizard (Steps 2-4)\n- F80c (ch-h0s): QualityCommandsManager\n- F80d (ch-uwx): Plan Review Config Wizard (Step 5)\n- F87 (ch-73s): SessionLogger\n- F03b-1 (ch-mdj): InitScaffold (directories and templates)\n\n## 5-Step Init Flow\n```\nStep 1/5: Prerequisites Check  → This controller (before wizard)\nStep 2/5: Project Detection    → ConfigWizard (F80b)\nStep 3/5: Quality Commands     → ConfigWizard (F80b)\nStep 4/5: Task Validation Rules → ConfigWizard (F80b)\nStep 5/5: Plan Review Config   → PlanReviewConfigWizard (F80d)\n```\n\n## Acceptance Criteria\n\n### First-Run Detection\n- [ ] Checks if `.chorus/` exists\n- [ ] Shows error and exits if `.chorus/` already exists\n\n### Step 1/5: Prerequisites Check\n- [ ] Displays \"Step 1/5\" in header\n- [ ] Checks git repository initialized\n- [ ] Checks Node.js version (\u003e= 20)\n- [ ] Checks Beads CLI (bd) installed\n- [ ] Checks Claude Code CLI found\n- [ ] Shows checkmarks for each passed check\n- [ ] Blocks progress if any prerequisite fails\n\n### Orchestration\n- [ ] Calls ProjectDetector (F80a) for initial detection\n- [ ] Renders ConfigWizard (F80b) for Steps 2-4\n- [ ] Renders PlanReviewConfigWizard (F80d) for Step 5\n- [ ] Logs init events via SessionLogger\n\n### Finalization\n- [ ] Calls InitScaffold.createDirectories() to create `.chorus/` structure\n- [ ] Calls InitScaffold.createPlanningFiles() for templates\n- [ ] Saves `config.json` with user choices\n- [ ] Emits `onComplete()` callback when finished\n\n### Non-Interactive Mode (--yes flag)\n- [ ] Accepts `--yes` CLI flag to skip all prompts\n- [ ] Uses detected/default values for all wizard steps\n- [ ] Runs all prerequisite checks (errors if any fail)\n- [ ] Creates `.chorus/` with defaults\n- [ ] Saves config.json with defaults\n- [ ] Completes without user interaction\n\n### Tests\n- [ ] 18 tests pass (12 interactive + 6 non-interactive mode)\n\n## Flow\n```\nStart InitMode\n    │\n    ├─ Check .chorus/ exists? → Yes → Show error, exit\n    │\n    └─ No ↓\n         │\n         ├─ Step 1/5: Prerequisites check\n         │   ├─ git ✓\n         │   ├─ node ✓\n         │   ├─ bd ✓\n         │   └─ claude ✓\n         │\n         ├─ Detect project (F80a ProjectDetector)\n         │\n         ├─ Interactive Mode (default):\n         │   ├─ Render ConfigWizard (F80b) - Steps 2-4\n         │   │   ├─ Step 2/5: Project Detection\n         │   │   ├─ Step 3/5: Quality Commands\n         │   │   └─ Step 4/5: Task Validation Rules\n         │   │\n         │   └─ Render PlanReviewConfigWizard (F80d) - Step 5\n         │       └─ Step 5/5: Plan Review Config\n         │\n         ├─ Non-Interactive Mode (--yes):\n         │   └─ Use detected/default values (skip wizards)\n         │\n         ├─ On wizard complete:\n         │   ├─ createDirectories() via F03b-1\n         │   ├─ createPlanningFiles() via F03b-1\n         │   └─ Save config.json with wizard output\n         │\n         └─ onComplete() → App Router transitions to Planning Mode\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:05:46.225073+03:00","created_by":"deligoez","updated_at":"2026-01-12T02:55:54.485039+03:00","closed_at":"2026-01-12T02:55:54.485039+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-m9y","depends_on_id":"ch-06m","type":"blocks","created_at":"2026-01-11T03:05:46.228726+03:00","created_by":"deligoez"},{"issue_id":"ch-m9y","depends_on_id":"ch-4ba","type":"blocks","created_at":"2026-01-11T03:05:46.232752+03:00","created_by":"deligoez"},{"issue_id":"ch-m9y","depends_on_id":"ch-h0s","type":"blocks","created_at":"2026-01-11T03:05:46.235127+03:00","created_by":"deligoez"},{"issue_id":"ch-m9y","depends_on_id":"ch-73s","type":"blocks","created_at":"2026-01-11T03:05:46.237208+03:00","created_by":"deligoez"},{"issue_id":"ch-m9y","depends_on_id":"ch-mdj","type":"blocks","created_at":"2026-01-11T03:26:56.601709+03:00","created_by":"deligoez"},{"issue_id":"ch-m9y","depends_on_id":"ch-uwx","type":"blocks","created_at":"2026-01-11T08:45:52.190881+03:00","created_by":"deligoez"}]}
{"id":"ch-mdj","title":"F03b-1: Init Scaffold - Directories and Detection","description":"## What\nCreate Chorus directory structure with all Planning Phase files.\n\n## Files\n- src/services/InitScaffold.ts (NEW)\n- src/services/InitScaffold.test.ts (NEW)\n\n## Full Directory Structure\n\\`\\`\\`\n.chorus/\n├── config.json              # Main config (created by F01c)\n├── task-rules.md            # Task validation rules\n├── PATTERNS.md              # Cross-agent patterns\n├── planning-state.json      # Planning progress\n├── pending-patterns.json    # Pattern suggestions awaiting review\n├── session-log.jsonl        # Session history (append-only)\n├── state.json               # Runtime state (created at runtime, gitignored)\n├── templates/               # Template files\n│   └── scratchpad.md        # Copied to worktree on agent spawn\n├── specs/                   # Living spec documents\n│   ├── spec-progress.json   # Tracks spec sections and their states\n│   └── archive/             # Completed specs (never in agent context)\n├── hooks/                   # Auto-discovered hooks\n└── prompts/                 # Agent prompts\n    ├── plan-agent.md        # Plan agent system prompt\n    └── impl-agent.md        # Implementation agent system prompt\n\n.worktrees/                  # Git worktrees directory (at project root, gitignored)\n└── {agent}-{task-id}/       # e.g., claude-ch-001\n    └── .agent/              # Per-agent directory (gitignored)\n        └── scratchpad.md    # Session notes\n\n.agent/                      # Project-level learnings directory (at root)\n└── learnings.md             # Cross-session learnings (shared by all agents)\n\\`\\`\\`\n\n## Path Decisions\n- **Worktrees**: `.worktrees/` at project root (per master plan)\n- **Project learnings**: `.agent/` at project root (for project-level learnings shared across sessions)\n- **Agent scratchpads**: Created in each worktree at `.agent/scratchpad.md`\n\n## Acceptance Criteria\n\n### createDirectories() - 10 tests\n- [ ] Creates \\`.chorus/\\` directory if not exists\n- [ ] Creates \\`.chorus/hooks/\\` directory if not exists\n- [ ] Creates \\`.chorus/prompts/\\` directory if not exists\n- [ ] Creates \\`.chorus/templates/\\` directory if not exists\n- [ ] Creates \\`.chorus/specs/\\` directory if not exists\n- [ ] Creates \\`.chorus/specs/archive/\\` directory if not exists\n- [ ] Creates \\`.worktrees/\\` directory at project root if not exists\n- [ ] Creates \\`.agent/\\` directory with \\`learnings.md\\` template (empty markdown file)\n- [ ] Creates empty \\`.chorus/session-log.jsonl\\` file\n- [ ] Skips creation if directories already exist (idempotent)\n\n### createPlanningFiles() - 7 tests\n- [ ] Creates \\`.chorus/planning-state.json\\` with empty state template\n- [ ] Creates \\`.chorus/task-rules.md\\` with default rules template\n- [ ] Creates \\`.chorus/PATTERNS.md\\` with empty template sections\n- [ ] Creates \\`.chorus/pending-patterns.json\\` with empty array \\`[]\\`\n- [ ] Creates \\`.chorus/specs/spec-progress.json\\` with empty object \\`{}\\`\n- [ ] Creates \\`.chorus/templates/scratchpad.md\\` with scratchpad template\n- [ ] Creates \\`.chorus/prompts/impl-agent.md\\` with implementation agent prompt template\n\n### detectProjectSettings() - 8 tests\n- [ ] Returns \\`{testCommand: \"npm test\"}\\` when \\`package.json\\` has \\`scripts.test\\`\n- [ ] Returns \\`{testCommand: \"pytest\"}\\` when \\`pyproject.toml\\` exists with \\`[tool.pytest]\\`\n- [ ] Returns \\`{testCommand: \"go test ./...\"}\\` when \\`go.mod\\` exists\n- [ ] Returns \\`{buildCommand: \"npm run build\"}\\` when \\`package.json\\` has \\`scripts.build\\`\n- [ ] Returns \\`{projectType: \"node\"}\\` when \\`package.json\\` exists\n- [ ] Returns \\`{projectType: \"python\"}\\` when \\`pyproject.toml\\` exists (no package.json)\n- [ ] Returns \\`{projectType: \"go\"}\\` when \\`go.mod\\` exists (no package.json/pyproject.toml)\n- [ ] Returns \\`{projectType: \"unknown\", testCommand: undefined}\\` when no project files found\n\n### Summary\n- [ ] 25 tests pass\n\n## Types\n\\`\\`\\`typescript\ntype ProjectType = 'node' | 'python' | 'go' | 'unknown';\n\ninterface DetectedSettings {\n  testCommand?: string;\n  buildCommand?: string;\n  projectType: ProjectType;\n}\n\\`\\`\\`\n\n## Template Contents\n\n### scratchpad.md template\n\\`\\`\\`markdown\n# Scratchpad\n\n## Current Task\nTask ID: {taskId}\n\n## Notes\n\u003c!-- Working notes, decisions, blockers --\u003e\n\n## Files Modified\n\u003c!-- Track files changed during this task --\u003e\n\\`\\`\\`\n\n### impl-agent.md template\n\\`\\`\\`markdown\n# Implementation Agent\n\nYou are an implementation agent for Chorus multi-agent orchestration.\n\n## Your Context\n- Working in an isolated git worktree\n- Task details are in your scratchpad\n- Use TDD: write tests first, then implement\n\n## Signals\nWhen done, output: \u003cchorus\u003eCOMPLETE\u003c/chorus\u003e\nOn blocker, output: \u003cchorus\u003eBLOCKED: reason\u003c/chorus\u003e\nIf you need clarification, output: \u003cchorus\u003eNEEDS_HELP: what you need\u003c/chorus\u003e\n\\`\\`\\`\n\n### pending-patterns.json template\n\\`\\`\\`json\n[]\n\\`\\`\\`\n\n### spec-progress.json template\n\\`\\`\\`json\n{}\n\\`\\`\\`\n\n## Detection Priority\nWhen multiple project files exist, detect in this order:\n1. \\`package.json\\` → node (highest priority)\n2. \\`pyproject.toml\\` → python\n3. \\`go.mod\\` → go\n4. None → unknown","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T11:20:13.868585+03:00","created_by":"deligoez","updated_at":"2026-01-12T02:31:20.639091+03:00","closed_at":"2026-01-12T02:31:20.639091+03:00","close_reason":"Closed","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-mdj","depends_on_id":"ch-0z7","type":"blocks","created_at":"2026-01-10T11:20:13.870803+03:00","created_by":"deligoez"},{"issue_id":"ch-mdj","depends_on_id":"ch-y43","type":"blocks","created_at":"2026-01-10T11:20:13.872568+03:00","created_by":"deligoez"}]}
{"id":"ch-mkz","title":"F46c-c: Intervention Panel - Redirect Flow","description":"## What\nIntervention Panel redirect modes: agent selection, then task selection for redirect.\n\n## Mode Flow\n```\nMain mode:\n  [r] → mode = 'redirect-select'\n\nredirect-select mode:\n  Shows: \"Select agent to redirect: [1] claude [2] codex\"\n  [1-9] → selectedAgentId = agentId, mode = 'redirect-task'\n  [ESC] → mode = 'main'\n\nredirect-task mode:\n  Shows: \"Select new task: [1] bd-001 [2] bd-002\"\n  [1-9] → agentRedirector.redirect(selectedAgentId, taskId) → mode = 'main'\n  [ESC] → mode = 'redirect-select'\n```\n\n## Acceptance Criteria\n\n### Redirect Select Mode - 2 tests\n- [ ] redirect-select mode shows agent selection prompt with numbers\n- [ ] Number key in redirect-select stores agentId and transitions to redirect-task\n\n### Redirect Task Mode - 2 tests\n- [ ] redirect-task mode shows task selection prompt with numbers\n- [ ] Number key in redirect-task calls agentRedirector.redirect() and returns to main\n\n### Summary\n- [ ] 4 tests pass\n\n## Files\n- src/components/InterventionPanel.tsx (UPDATE)\n- src/components/InterventionPanel.test.tsx (UPDATE)\n\n## Dependencies\n- F46c-a (ch-di6) - Main mode and base component","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T23:52:43.767515+03:00","created_by":"deligoez","updated_at":"2026-01-12T07:39:15.53274+03:00","closed_at":"2026-01-12T07:39:15.53274+03:00","close_reason":"Closed","labels":["m9-intervention"],"dependencies":[{"issue_id":"ch-mkz","depends_on_id":"ch-di6","type":"blocks","created_at":"2026-01-10T23:52:43.771419+03:00","created_by":"deligoez"}]}
{"id":"ch-mnd","title":"F55a: ModeIndicator Component - Display operating mode with colored dot","description":"## What\nSimple component to display the current operating mode (semi-auto/autopilot) with a colored indicator dot.\n\n## Context from Master Plan\n```\nCHORUS v2.0                      semi-auto ● 3/50              ? for help\n```\n\n## API\n```typescript\n// src/components/ModeIndicator.tsx\n\ninterface ModeIndicatorProps {\n  mode: 'semi-auto' | 'autopilot';\n}\n\nfunction ModeIndicator({ mode }: ModeIndicatorProps): JSX.Element\n```\n\n## Visual Output\n- semi-auto: `semi-auto ●` (green dot via Ink `\u003cText color=\"green\"\u003e`)\n- autopilot: `autopilot ●` (yellow dot via Ink `\u003cText color=\"yellow\"\u003e`)\n\n## Files\n- src/components/ModeIndicator.tsx\n- src/components/ModeIndicator.test.tsx\n\n## Acceptance Criteria\n- [ ] Renders \"semi-auto\" text when mode='semi-auto'\n- [ ] Renders \"autopilot\" text when mode='autopilot'\n- [ ] Shows green dot (●) via `\u003cText color=\"green\"\u003e` for semi-auto mode\n- [ ] Shows yellow dot (●) via `\u003cText color=\"yellow\"\u003e` for autopilot mode\n- [ ] Handles undefined mode gracefully (shows \"unknown\" with gray dot)\n- [ ] Handles invalid mode string gracefully (shows \"unknown\" with gray dot)\n- [ ] Mode text and dot have correct spacing (single space between)\n- [ ] 8 tests pass\n\n## Tests\n1. Renders \"semi-auto\" text when mode='semi-auto'\n2. Renders \"autopilot\" text when mode='autopilot'\n3. Shows green dot for semi-auto\n4. Shows yellow dot for autopilot\n5. Handles undefined mode gracefully (shows \"unknown\")\n6. Handles invalid mode string gracefully (shows \"unknown\")\n7. Text and dot have correct spacing\n8. Shows gray dot for unknown mode","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:48:07.102964+03:00","created_by":"deligoez","updated_at":"2026-01-11T20:11:12.39667+03:00","closed_at":"2026-01-11T20:11:12.39667+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-mnd","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:52.521454+03:00","created_by":"deligoez"}]}
{"id":"ch-mpl","title":"F08: Signal Parser - Parse \u003cchorus\u003e signals from output","description":"## What\nParse \u003cchorus\u003e signals from agent output to detect completion, blocking, and other states.\n\n## Acceptance Criteria\n- [ ] parse() returns ParseResult with first signal found\n- [ ] parseAll() returns array of all signals in output\n- [ ] hasSignal() checks for specific signal type\n- [ ] isComplete() returns true for COMPLETE signal\n- [ ] isBlocked() returns true for BLOCKED signal\n- [ ] getProgress() returns number (0-100) or null\n- [ ] getReason() extracts reason from BLOCKED/NEEDS_HELP\n- [ ] Finds signal anywhere in output (not just end)\n- [ ] 10 tests pass\n\n## Files\n- src/types/signal.ts (NEW)\n- src/services/SignalParser.ts (NEW)\n- tests/services/SignalParser.test.ts (NEW)\n\n## API\n```typescript\ntype SignalType = 'COMPLETE' | 'BLOCKED' | 'NEEDS_HELP' | 'PROGRESS' | 'RESOLVED' | 'NEEDS_HUMAN';\n\ninterface Signal {\n  type: SignalType;\n  payload: string | null;\n  raw: string;\n}\n\ninterface ParseResult {\n  signal: Signal | null;\n  hasSignal: boolean;\n}\n\nclass SignalParser {\n  parse(output: string): ParseResult;\n  parseAll(output: string): Signal[];\n  hasSignal(output: string, type: SignalType): boolean;\n  isComplete(output: string): boolean;\n  isBlocked(output: string): boolean;\n  getProgress(output: string): number | null;\n  getReason(output: string): string | null;\n}\n```\n\n## Test Cases\n1. parse() returns COMPLETE signal\n2. parse() returns BLOCKED with reason\n3. parse() returns NEEDS_HELP with question\n4. parse() returns PROGRESS with percentage\n5. parse() returns null for no signal\n6. parse() finds signal in middle of output\n7. parseAll() finds multiple signals\n8. parseAll() returns empty for no signals\n9. isComplete() returns true for COMPLETE\n10. getProgress() clamps value to 0-100","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T01:38:13.856983+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:32:55.741317+03:00","closed_at":"2026-01-11T18:32:55.741317+03:00","close_reason":"Closed","labels":["m2-agent-prep"],"dependencies":[{"issue_id":"ch-mpl","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:34.832521+03:00","created_by":"deligoez"}]}
{"id":"ch-mu56","title":"E2E-06: Mode \u0026 Control","description":"## What\nE2E tests for mode switching, pause/resume, and quit.\n\n## Tests (10 tests)\n\n### Mode Toggle\n1. 'm' toggles between semi-auto and autopilot\n2. Mode indicator updates in header\n3. Mode persists after operations\n\n### Autopilot\n4. 'a' starts autopilot mode\n5. Agents spawn automatically in autopilot\n\n### Pause/Resume\n6. Space pauses orchestration\n7. Paused agents show ⏸ indicator\n8. Space again resumes orchestration\n\n### Quit\n9. 'q' shows quit confirmation\n10. Confirming 'q' exits application\n\n## Files\n- src/e2e/mode-control.e2e.test.ts (NEW)\n\n## Depends On\n- ch-kxpd: E2E Infrastructure\n- ch-3ji: Mode Toggle Key\n- ch-jx9: Start Autopilot Key\n- ch-2gt: Pause/Resume Key\n- ch-bny: TUI Exit Handler","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-11T21:16:07.501155+03:00","created_by":"deligoez","updated_at":"2026-01-11T21:23:25.165935+03:00","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-mu56","depends_on_id":"ch-kxpd","type":"blocks","created_at":"2026-01-11T21:16:07.503977+03:00","created_by":"deligoez"},{"issue_id":"ch-mu56","depends_on_id":"ch-3ji","type":"blocks","created_at":"2026-01-11T21:16:07.505718+03:00","created_by":"deligoez"},{"issue_id":"ch-mu56","depends_on_id":"ch-jx9","type":"blocks","created_at":"2026-01-11T21:16:07.5076+03:00","created_by":"deligoez"},{"issue_id":"ch-mu56","depends_on_id":"ch-2gt","type":"blocks","created_at":"2026-01-11T21:16:07.509711+03:00","created_by":"deligoez"},{"issue_id":"ch-mu56","depends_on_id":"ch-bny","type":"blocks","created_at":"2026-01-11T21:16:07.511388+03:00","created_by":"deligoez"}],"deleted_at":"2026-01-11T21:23:25.165935+03:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"ch-mvp6","title":"INT-07: Learnings extraction and storage","description":"## What\nIntegration test: Learnings are extracted from Claude output and stored.\n\n## Test Scenario\n1. Agent outputs learning signal during task\n2. LearningStore extracts and persists\n3. Next agent prompt includes learning\n4. Verify learning appears in .claude/rules/learnings.md\n\n## Prompt Design\n```\nComplete task, then output this signal:\n[CHORUS:LEARNING:{\"content\":\"Always check null before accessing\",\"category\":\"defensive\"}]\n```\n\n## Why Deterministic\n- Exact learning content in prompt\n- File-based storage verification\n- Learning format is specified\n\n## Acceptance Criteria\n- [ ] Agent outputs LEARNING signal\n- [ ] LearningStore persists to file\n- [ ] Learning appears in learnings.md\n- [ ] Deduplication works (same learning not added twice)\n- [ ] 3 tests pass\n\n## Files\n- src/integration/learnings.integration.test.ts (create)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T14:26:25.021218+03:00","created_by":"deligoez","updated_at":"2026-01-12T14:55:53.871766+03:00","closed_at":"2026-01-12T14:55:53.871766+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-mvp6","depends_on_id":"ch-1ag3","type":"blocks","created_at":"2026-01-12T14:26:25.02463+03:00","created_by":"deligoez"}]}
{"id":"ch-mxyt","title":"TS15b: Audit Log Compression","description":"## What\nImplement audit log compression on task completion.\n\n## Files\n- `src/services/AuditLog.ts`\n- `src/services/AuditLog.test.ts`\n\n## Acceptance Criteria\n- [ ] `archiveAuditLog(taskId)` compresses log to `.jsonl.gz`\n- [ ] Original `.jsonl` file is deleted after compression\n- [ ] Does nothing if log file doesn't exist\n- [ ] Compression uses gzip format\n- [ ] TaskStore `complete()` and `fail()` call `archiveAuditLog()`\n- [ ] 5 tests pass","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:15:14.684697+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:15:14.684697+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-mxyt","depends_on_id":"ch-vsxe","type":"blocks","created_at":"2026-01-13T00:15:24.091403+03:00","created_by":"deligoez"},{"issue_id":"ch-mxyt","depends_on_id":"ch-3oot","type":"blocks","created_at":"2026-01-13T00:21:33.393164+03:00","created_by":"deligoez"}]}
{"id":"ch-mzi3","title":"FX08: Migration Bridge - Zustand to XState adapter","description":"## What\nCreate compatibility layer for gradual migration from Zustand stores to XState.\n\n## Acceptance Criteria\n- [ ] `createXStateAdapter(machine)` provides Zustand-like API\n- [ ] `getState()` returns current context\n- [ ] `subscribe(listener)` watches state changes\n- [ ] Existing components can use adapter without refactoring\n- [ ] 4 tests pass\n\n## Tests\n1. getState returns machine context\n2. subscribe fires on state change\n3. Multiple subscribers supported\n4. Unsubscribe works correctly\n\n## Files\n- src/services/xstate-adapter.ts\n\n## Notes\nThis is a temporary bridge - components should migrate to useChorusMachine hook.\nAfter M-1, components will be updated to use XState directly.\n\n## Dependencies\n- FX07 (React Integration)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-11T15:27:07.161157+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:17:10.040968+03:00","closed_at":"2026-01-11T18:17:10.040968+03:00","close_reason":"Closed","labels":["m-1-xstate"],"dependencies":[{"issue_id":"ch-mzi3","depends_on_id":"ch-vskx","type":"blocks","created_at":"2026-01-11T15:27:07.163159+03:00","created_by":"deligoez"}]}
{"id":"ch-n364","title":"E2E-42: BeadsCLI Integration Tests","description":"## What\nEnd-to-end tests for BeadsCLI using real bd commands.\n\n## Why\nCurrent unit tests mock execa. Need real integration tests to verify:\n- bd CLI command execution\n- Task status updates\n- Task creation/closing\n- Label operations\n\n## Tests (8 tests)\n\n### bd list (2 tests)\n1. Lists tasks from real .beads/issues.jsonl\n2. Returns empty for no tasks\n\n### bd show (2 tests)\n3. Shows task details\n4. Returns error for non-existent task\n\n### bd update (2 tests)\n5. Updates task status\n6. Updates task priority\n\n### bd close (2 tests)\n7. Closes task successfully\n8. Returns error for already closed task\n\n## Files\n- src/e2e/beads-cli.e2e.test.ts (NEW)\n\n## Dependencies\n- ch-fqh0 (git-fixtures.ts shared)\n- Requires bd CLI available","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T23:35:20.886082+03:00","created_by":"deligoez","updated_at":"2026-01-11T23:53:26.724085+03:00","closed_at":"2026-01-11T23:53:26.724085+03:00","close_reason":"BeadsCLI E2E tests - 6 passing, 6 skipped","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-n364","depends_on_id":"ch-fqh0","type":"blocks","created_at":"2026-01-11T23:35:20.887924+03:00","created_by":"deligoez"}]}
{"id":"ch-n6d","title":"F53: Hook Registry - Register and manage hook handlers","description":"## What\nRegistry for hook handlers - register, unregister, list hooks, and load from directory/config.\n\n## API\n```typescript\n// src/services/HookRegistry.ts\n\nclass HookRegistry {\n  constructor(private config?: HookConfig) {}\n\n  // Core registration\n  register(handler: HookHandler): void;\n  unregister(event: HookEvent, command: string): void;\n  getHandlers(event: HookEvent): HookHandler[];\n  hasHandlers(event: HookEvent): boolean;\n  clear(): void;\n\n  // Loading\n  async loadFromDirectory(hooksDir: string): Promise\u003cvoid\u003e;\n  async loadFromConfig(config: ChorusConfig): Promise\u003cvoid\u003e;\n  \n  // Validation\n  validateEvent(eventName: string): boolean;\n\n  // Per-hook config\n  getHandlerConfig(handler: HookHandler): HookConfig;\n}\n```\n\n## Hook Loading Methods\n\n### Method 1: Auto-Discovery (Default)\n```\n.chorus/hooks/\n├── pre-agent-start.sh      # Executable script\n├── post-task-complete.sh   # Named by event\n└── on-conflict.sh\n```\n- Filename (before extension) must match HookEvent\n- Must be executable (`chmod +x`)\n- Root level only (no subdirectories)\n\n### Method 2: Explicit Config\n```json\n// In .chorus/config.json\n{\n  \"hooks\": {\n    \"post-task-complete\": \".chorus/hooks/extract-learnings.sh\",\n    \"pre-merge\": [\n      \".chorus/hooks/validate-branch.sh\",\n      \".chorus/hooks/notify-slack.sh\"\n    ]\n  }\n}\n```\n\n### Method 3: Per-Hook Config Override\n```json\n{\n  \"hooks\": {\n    \"pre-merge\": {\n      \"command\": \".chorus/hooks/validate-branch.sh\",\n      \"timeout\": 60000,\n      \"continueOnFailure\": false\n    }\n  }\n}\n```\n\n**Precedence:** Explicit config \u003e Auto-discovery (for same event)\n\n## Valid HookEvent Names (13 total)\n```typescript\ntype HookEvent = \n  | 'pre-agent-start' | 'post-agent-start'\n  | 'pre-task-claim' | 'post-task-claim'\n  | 'pre-iteration' | 'post-iteration'\n  | 'pre-task-complete' | 'post-task-complete'\n  | 'pre-merge' | 'post-merge'\n  | 'on-agent-error' | 'on-agent-timeout' | 'on-conflict';\n```\n\n## Files\n- src/services/HookRegistry.ts\n- tests/services/HookRegistry.test.ts\n\n## Acceptance Criteria\n\n### Core Registration - 6 tests\n- [ ] `register()` adds handler to internal Map\u003cHookEvent, HookHandler[]\u003e\n- [ ] `register()` allows multiple handlers per event\n- [ ] `unregister()` removes handler by command match\n- [ ] `getHandlers()` returns handlers array (empty if none)\n- [ ] `hasHandlers()` returns correct boolean\n- [ ] `clear()` removes all handlers\n\n### Event Validation - 3 tests\n- [ ] `validateEvent()` returns true for valid HookEvent enum values\n- [ ] `validateEvent()` returns false for invalid event names\n- [ ] `loadFromDirectory()` calls validateEvent() before registering\n\n### Auto-Discovery - 7 tests\n- [ ] `loadFromDirectory()` reads root-level executable files\n- [ ] `loadFromDirectory()` skips non-executable files\n- [ ] `loadFromDirectory()` skips subdirectories\n- [ ] `loadFromDirectory()` extracts event from filename (before first dot)\n- [ ] `loadFromDirectory()` ignores invalid event names with warning\n- [ ] `register()` validates command file exists before adding\n- [ ] `register()` validates command is executable (chmod check)\n\n### Explicit Config - 4 tests\n- [ ] `loadFromConfig()` loads single command per event\n- [ ] `loadFromConfig()` loads array of commands per event\n- [ ] `loadFromConfig()` loads per-hook config override (timeout, continueOnFailure)\n- [ ] `loadFromConfig()` overrides auto-discovered handlers for same event\n\n### Per-Hook Config - 2 tests\n- [ ] `getHandlerConfig()` returns handler-specific config when set\n- [ ] `getHandlerConfig()` returns default config when no override\n\n### Summary\n- [ ] 22 tests pass\n\n## Tests\n1. register() adds handler to map\n2. register() allows multiple handlers per event\n3. unregister() removes handler by command\n4. getHandlers() returns handlers array\n5. hasHandlers() returns correct boolean\n6. clear() removes all handlers\n7. validateEvent() returns true for valid HookEvent\n8. validateEvent() returns false for invalid event\n9. loadFromDirectory() validates event names before registering\n10. loadFromDirectory() reads executable files\n11. loadFromDirectory() skips non-executable files\n12. loadFromDirectory() skips subdirectories\n13. loadFromDirectory() extracts event from filename\n14. loadFromDirectory() warns on invalid event names\n15. register() validates file exists before adding\n16. register() validates file is executable\n17. loadFromConfig() loads single command\n18. loadFromConfig() loads array of commands\n19. loadFromConfig() loads per-hook config\n20. loadFromConfig() overrides auto-discovered\n21. getHandlerConfig() returns handler-specific config\n22. getHandlerConfig() returns default config","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T10:45:28.086391+03:00","created_by":"deligoez","updated_at":"2026-01-12T02:21:57.023291+03:00","closed_at":"2026-01-12T02:21:57.023291+03:00","close_reason":"Closed","labels":["m11-hooks"],"dependencies":[{"issue_id":"ch-n6d","depends_on_id":"ch-b5x","type":"blocks","created_at":"2026-01-10T10:45:28.087917+03:00","created_by":"deligoez"}]}
{"id":"ch-n8kk","title":"TS16a: Init Prefix Wizard","description":"## What\nImplement init wizard for task ID configuration.\n\n## Files\n- `src/modes/InitMode.tsx` (or relevant init file)\n- `src/services/TaskIdConfig.ts`\n- `src/services/TaskIdConfig.test.ts`\n\n## Acceptance Criteria\n- [ ] Init prompts for project name\n- [ ] `suggestPrefix(projectName)` generates prefix from name\n- [ ] User can accept or override suggested prefix\n- [ ] Init prompts for ID format (simple/padded)\n- [ ] Init prompts for padding width (if padded)\n- [ ] Config saved to `.chorus/config.json`\n- [ ] 6 tests pass","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:15:25.044142+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:15:25.044142+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-n8kk","depends_on_id":"ch-kakj","type":"blocks","created_at":"2026-01-13T00:15:25.047427+03:00","created_by":"deligoez"}]}
{"id":"ch-nf8x","title":"INT01: Real Agent Review Integration Test","description":"## What\nIntegration test using real Claude agent to test full review flow end-to-end.\n\n## Acceptance Criteria\n- [ ] Test harness spawns actual Claude agent (not mocked)\n- [ ] Agent completes a simple task (e.g., add comment to file)\n- [ ] Review flow triggered automatically\n- [ ] Test verifies task appears in pending reviews\n- [ ] Test verifies approve action sends to merge queue\n- [ ] Test verifies redo action with feedback triggers re-run\n- [ ] Budget limit enforced (max 3 API calls per test)\n- [ ] Test suite skipped in CI (manual run only)\n- [ ] 4 tests pass\n\n## Notes\n- These tests use real API calls (costly and slow)\n- Run manually: `npm run test:integration -- --grep \"Real Agent\"`\n- Not included in `npm run test` or CI\n\n## Files\n- src/integration/real-agent-review.integration.test.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T16:18:59.794505+03:00","created_by":"deligoez","updated_at":"2026-01-12T18:00:17.470948+03:00","closed_at":"2026-01-12T18:00:17.470948+03:00","close_reason":"Closed","labels":["m14-integration"],"dependencies":[{"issue_id":"ch-nf8x","depends_on_id":"ch-pznq","type":"blocks","created_at":"2026-01-12T16:18:59.798617+03:00","created_by":"deligoez"},{"issue_id":"ch-nf8x","depends_on_id":"ch-a193","type":"blocks","created_at":"2026-01-12T16:18:59.803492+03:00","created_by":"deligoez"},{"issue_id":"ch-nf8x","depends_on_id":"ch-yn74","type":"blocks","created_at":"2026-01-12T16:18:59.809609+03:00","created_by":"deligoez"}]}
{"id":"ch-nggj","title":"F63z: App-Level Control Keys (x, r, e, b) - Quick actions without intervention menu","description":"## What\nApp-level keyboard handlers for agent/task control actions that work without opening intervention menu.\n\n## Context from Master Plan\n```\nAGENT CONTROL                   TASK MANAGEMENT\nx      Stop selected agent      e      Edit task\nr      Redirect agent           b      Block task\n```\n\n## Key Conflict Resolution\n\nThese keys have multiple behaviors depending on context:\n\n| Key | In InterventionPanel (F46c) | At App Level (this task) | On Failed Task (F63m) |\n|-----|-----------------------------|--------------------------|-----------------------|\n| x   | Select agent to stop        | Stop agent on selected task | - |\n| r   | Select agent to redirect    | Redirect agent on selected task | **Retry task** |\n| e   | Edit task dialog            | Open edit for selected task | - |\n| b   | Block selected task         | Block selected task | - |\n\n**Key insight:** 'r' is context-dependent:\n- Failed/timeout task selected → 'r' = retry (handled by F63m)\n- Normal task selected → 'r' = redirect (this task)\n\n## Shortcuts\n- **x** - Stop agent working on selected task\n- **r** - Redirect agent (or retry if task failed - see F63m)\n- **e** - Edit selected task\n- **b** - Block selected task\n\n## Implementation\n\n```typescript\n// src/hooks/useQuickControlKeys.ts\n\ninterface UseQuickControlKeysOptions {\n  selectedTask: Task | null;\n  agentStopper: AgentStopper;\n  interventionPanel: {\n    open: (mode: 'redirect-select' | 'edit-select' | 'block-select') =\u003e void;\n  };\n  beadsCLI: BeadsCLI;\n  onAction?: (action: string, taskId: string) =\u003e void;\n}\n\nfunction useQuickControlKeys(options: UseQuickControlKeysOptions) {\n  useInput((input) =\u003e {\n    const task = options.selectedTask;\n    if (!task) return;\n    \n    // Check if F63m should handle 'r' (failed/timeout task)\n    const isFailed = task.custom?.failed === 'true';\n    const isTimeout = task.custom?.timeout === 'true';\n    \n    switch (input) {\n      case 'x':\n        // Stop agent working on this task (if any)\n        if (task.status === 'in_progress') {\n          options.agentStopper.stopByTask(task.id);\n          options.onAction?.('stop', task.id);\n        }\n        break;\n        \n      case 'r':\n        // Skip if failed/timeout - F63m handles retry\n        if (isFailed || isTimeout) return;\n        // Redirect agent to different task\n        if (task.status === 'in_progress') {\n          options.interventionPanel.open('redirect-select');\n        }\n        break;\n        \n      case 'e':\n        // Edit task - opens external editor via bd edit\n        options.interventionPanel.open('edit-select');\n        break;\n        \n      case 'b':\n        // Block task\n        if (task.status === 'open' || task.status === 'in_progress') {\n          options.beadsCLI.labelAdd(task.id, 'blocked');\n          options.onAction?.('block', task.id);\n        }\n        break;\n    }\n  });\n}\n```\n\n## Acceptance Criteria\n\n### Stop Key (x) - 3 tests\n- [ ] 'x' on in_progress task stops its agent\n- [ ] 'x' on open/closed task is no-op\n- [ ] Shows confirmation: \"Agent stopped for ch-xxx\"\n\n### Redirect Key (r) - 3 tests\n- [ ] 'r' on in_progress task opens intervention panel in redirect mode\n- [ ] 'r' on failed/timeout task does nothing (F63m handles)\n- [ ] 'r' on open/closed task is no-op\n\n### Edit Key (e) - 2 tests\n- [ ] 'e' on any task opens edit dialog\n- [ ] Edit opens `bd edit \u003cid\u003e` externally\n\n### Block Key (b) - 3 tests\n- [ ] 'b' on open task adds 'blocked' label\n- [ ] 'b' on in_progress task stops agent AND blocks\n- [ ] 'b' on already blocked task is no-op\n\n### Context Check - 2 tests\n- [ ] All keys no-op when no task selected\n- [ ] All keys no-op when modal is open\n\n### Summary\n- [ ] 13 tests pass\n\n## Files\n- src/hooks/useQuickControlKeys.ts (NEW)\n- src/hooks/useQuickControlKeys.test.ts (NEW)\n\n## Dependencies\n- F46c-a (InterventionPanel) for modal modes\n- F63m (Recovery Keys) - 'r' defers to F63m for failed tasks\n- F44 (AgentStopper) for stop action\n\n## Notes\n- These are \"quick\" versions of intervention panel actions\n- For more control (e.g., select which agent), use 'i' to open full intervention panel\n- 'r' context: normal task = redirect, failed task = retry (F63m)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T12:46:14.345602+03:00","created_by":"deligoez","updated_at":"2026-01-12T08:54:03.693718+03:00","closed_at":"2026-01-12T08:54:03.693718+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-nggj","depends_on_id":"ch-di6","type":"blocks","created_at":"2026-01-11T12:46:14.34788+03:00","created_by":"deligoez"},{"issue_id":"ch-nggj","depends_on_id":"ch-kns","type":"blocks","created_at":"2026-01-11T14:01:39.984273+03:00","created_by":"deligoez"},{"issue_id":"ch-nggj","depends_on_id":"ch-cwy","type":"blocks","created_at":"2026-01-11T14:01:40.884794+03:00","created_by":"deligoez"},{"issue_id":"ch-nggj","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-11T14:01:41.963663+03:00","created_by":"deligoez"},{"issue_id":"ch-nggj","depends_on_id":"ch-89dk","type":"blocks","created_at":"2026-01-11T14:37:28.405522+03:00","created_by":"deligoez"}]}
{"id":"ch-ni74","title":"SP06: Sprint Keyboard Handlers - Keyboard bindings for sprint","description":"## What\nKeyboard bindings for sprint planning.\n\n## Acceptance Criteria\n- [ ] `Shift+S` opens sprint planning panel\n- [ ] Does nothing when sprint already running (guard)\n- [ ] Esc cancels planning (returns to main view)\n- [ ] 4 tests pass\n\n## Files\n- src/hooks/useSprintKeys.ts\n- src/hooks/useSprintKeys.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T15:13:22.618642+03:00","created_by":"deligoez","updated_at":"2026-01-12T17:49:28.638759+03:00","closed_at":"2026-01-12T17:49:28.638759+03:00","close_reason":"Closed","labels":["m13b-sprint"],"dependencies":[{"issue_id":"ch-ni74","depends_on_id":"ch-tw4j","type":"blocks","created_at":"2026-01-12T15:13:22.620786+03:00","created_by":"deligoez"}]}
{"id":"ch-nkb5","title":"E2E-66: TUI Full Integration","description":"## What\nE2E tests for TUI keyboard routing and modal state machine.\n\n## Acceptance Criteria\n- [ ] Tab key routes correctly based on focus state\n- [ ] j/k navigation selects tasks/agents correctly\n- [ ] 1-9 quick select keys work\n- [ ] ? opens help modal, ESC closes it\n- [ ] Ctrl+C confirms quit, shows confirmation modal\n- [ ] Modal state prevents keyboard routing (guards)\n- [ ] Multiple modals don't stack incorrectly\n- [ ] Focus state updates with Tab\n- [ ] Selection state preserved during task updates\n- [ ] All keyboard shortcuts documented in help\n- [ ] 12 tests pass\n\n## Files\n- src/e2e/tui-integration.e2e.test.ts\n\n## Implementation Notes\n- Use renderApp() and sendKeys() helpers\n- Test each keyboard shortcut\n- Verify modal open/close states","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T00:40:26.775434+03:00","created_by":"deligoez","updated_at":"2026-01-12T09:34:02.508499+03:00","closed_at":"2026-01-12T09:34:02.508499+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-nkb5","depends_on_id":"ch-g3of","type":"blocks","created_at":"2026-01-12T00:40:26.777249+03:00","created_by":"deligoez"},{"issue_id":"ch-nkb5","depends_on_id":"ch-89dk","type":"blocks","created_at":"2026-01-12T00:40:26.779562+03:00","created_by":"deligoez"},{"issue_id":"ch-nkb5","depends_on_id":"ch-b8l","type":"blocks","created_at":"2026-01-12T00:40:26.781637+03:00","created_by":"deligoez"},{"issue_id":"ch-nkb5","depends_on_id":"ch-ak5","type":"blocks","created_at":"2026-01-12T00:40:26.783705+03:00","created_by":"deligoez"},{"issue_id":"ch-nkb5","depends_on_id":"ch-clju","type":"blocks","created_at":"2026-01-12T00:40:26.785745+03:00","created_by":"deligoez"}]}
{"id":"ch-nn6","title":"F54: Hook Runner - Execute hooks and handle responses","description":"## What\nExecute hook handlers with retry support and process their JSON input/output.\n\n## API\n```typescript\n// src/services/HookRunner.ts\n\nclass HookRunner {\n  constructor(\n    private registry: HookRegistry,\n    private defaultConfig: HookConfig = DEFAULT_HOOK_CONFIG\n  ) {}\n\n  /**\n   * Run all handlers for an event\n   * Returns combined result (block \u003e complete \u003e continue)\n   */\n  async run(event: HookEvent, input: Omit\u003cHookInput, 'event'\u003e): Promise\u003cHookOutput\u003e;\n\n  /**\n   * Run single handler with retry support\n   */\n  async runHandler(handler: HookHandler, input: HookInput): Promise\u003cHookOutput\u003e;\n\n  /**\n   * Check if any hook blocked/completed\n   */\n  isBlocked(outputs: HookOutput[]): boolean;\n  isComplete(outputs: HookOutput[]): boolean;\n}\n```\n\n## Hook Config (from Master Plan)\n\n```typescript\nconst DEFAULT_HOOK_CONFIG: HookConfig = {\n  timeout: 30000,           // 30 seconds\n  retryOnError: false,      // Don't retry by default\n  maxRetries: 1,            // 1 retry if enabled\n  continueOnFailure: true   // Continue operation if hook fails\n};\n```\n\n## Implementation Details\n\n### Timeout Handling\nUse Node.js `child_process.execFile` with timeout option:\n\n```typescript\nimport { execFile } from 'child_process';\nimport { promisify } from 'util';\n\nconst execFileAsync = promisify(execFile);\n\nasync executeHandler(handler: HookHandler, input: HookInput, timeout: number): Promise\u003cHookOutput\u003e {\n  const { stdout } = await execFileAsync(handler.command, [], {\n    input: JSON.stringify(input),\n    timeout,        // Built-in timeout in ms\n    maxBuffer: 1024 * 1024,\n    encoding: 'utf8'\n  });\n  return this.parseOutput(stdout);\n}\n```\n\nWhen timeout is exceeded, `execFile` throws an error with `error.killed = true` and `error.signal = 'SIGTERM'`.\n\n### JSON Parse Error Handling\n```typescript\nparseOutput(stdout: string): HookOutput {\n  try {\n    const output = JSON.parse(stdout.trim());\n    // Validate required fields\n    if (!output.result || !['continue', 'block', 'complete'].includes(output.result)) {\n      throw new HookOutputError('Invalid result field');\n    }\n    return output;\n  } catch (error) {\n    // Log parse details for debugging\n    console.error(`[HookRunner] Failed to parse hook output as JSON`);\n    console.error(`[HookRunner] stdout (first 500 chars): ${stdout.slice(0, 500)}`);\n    console.error(`[HookRunner] Parse error: ${error.message}`);\n    throw new HookOutputError(`Invalid JSON output: ${error.message}`);\n  }\n}\n```\n\n## Retry Logic\n\nWhen `retryOnError: true`:\n```\nAttempt 1 → fails → wait 1s → Attempt 2 → fails → give up\n```\n\n```typescript\nasync runWithRetry(handler, input, config): Promise\u003cHookOutput\u003e {\n  let lastError: Error | null = null;\n  const attempts = config.retryOnError ? config.maxRetries + 1 : 1;\n\n  for (let i = 0; i \u003c attempts; i++) {\n    try {\n      return await this.executeHandler(handler, input, config.timeout);\n    } catch (error) {\n      lastError = error;\n      if (i \u003c attempts - 1) {\n        await sleep(1000); // 1s backoff between retries\n      }\n    }\n  }\n\n  // All attempts failed\n  if (config.continueOnFailure) {\n    return { result: 'continue' };\n  }\n  throw lastError;\n}\n```\n\n## Error Handling Matrix\n\n| Scenario | continueOnFailure=true | continueOnFailure=false |\n|----------|------------------------|-------------------------|\n| Hook times out | Log, return continue | Throw HookTimeoutError |\n| Hook exits non-zero | Log, return continue | Throw HookExecutionError |\n| Hook returns invalid JSON | Log, return continue | Throw HookOutputError |\n| Hook returns `block` | Return block (intentional) | Return block (intentional) |\n\n## Output Combination\n\nWhen multiple handlers for same event:\n```typescript\ncombineOutputs(outputs: HookOutput[]): HookOutput {\n  // Priority: block \u003e complete \u003e continue\n  if (outputs.some(o =\u003e o.result === 'block')) {\n    const blocker = outputs.find(o =\u003e o.result === 'block');\n    return { result: 'block', message: blocker?.message };\n  }\n  if (outputs.some(o =\u003e o.result === 'complete')) {\n    return { result: 'complete' };\n  }\n  return { result: 'continue' };\n}\n```\n\n## Files\n- src/services/HookRunner.ts\n- tests/services/HookRunner.test.ts\n\n## Acceptance Criteria\n\n### Core Execution - 6 tests\n- [ ] `run()` executes all handlers from registry\n- [ ] `run()` passes HookInput as JSON via stdin\n- [ ] `run()` parses HookOutput from stdout JSON\n- [ ] `run()` uses execFile timeout option (not AbortController)\n- [ ] `run()` returns `{result:'continue'}` when no handlers\n- [ ] `run()` combines outputs (block \u003e complete \u003e continue)\n\n### Retry Logic - 4 tests\n- [ ] `runHandler()` retries on error when retryOnError=true\n- [ ] `runHandler()` waits 1s between retries\n- [ ] `runHandler()` respects maxRetries limit\n- [ ] `runHandler()` does NOT retry when retryOnError=false\n\n### Error Handling - 6 tests\n- [ ] continueOnFailure=true: returns continue on timeout\n- [ ] continueOnFailure=true: returns continue on non-zero exit\n- [ ] continueOnFailure=true: logs JSON parse error with stdout preview then returns continue\n- [ ] continueOnFailure=false: throws HookTimeoutError\n- [ ] continueOnFailure=false: throws HookExecutionError\n- [ ] continueOnFailure=false: throws HookOutputError\n\n### Helper Methods - 2 tests\n- [ ] `isBlocked()` returns correct boolean\n- [ ] `isComplete()` returns correct boolean\n\n### Summary\n- [ ] 18 tests pass\n\nLabels: [m11-hooks]","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T10:45:38.726297+03:00","created_by":"deligoez","updated_at":"2026-01-12T02:28:42.676982+03:00","closed_at":"2026-01-12T02:28:42.676982+03:00","close_reason":"Closed","labels":["m11-hooks"],"dependencies":[{"issue_id":"ch-nn6","depends_on_id":"ch-n6d","type":"blocks","created_at":"2026-01-10T10:45:38.727874+03:00","created_by":"deligoez"}]}
{"id":"ch-nrr","title":"F90: CLI Parser - Command Line Arguments","description":"## What\nParse command line arguments for Chorus CLI.\n\n## Files\n- `src/cli/parser.ts`\n- `src/cli/parser.test.ts`\n\n## CLI Interface\n```bash\n# Basic commands\nnpx chorus                     # Start in default mode (semi-auto)\nnpx chorus --autopilot         # Start in autopilot mode\nnpx chorus --mode semi-auto    # Explicit mode\nnpx chorus --mode autopilot    # Explicit mode\nnpx chorus --help              # Show help\nnpx chorus --version           # Show version\nnpx chorus --config \u003cpath\u003e     # Custom config file path\n\n# Init commands\nnpx chorus init                # Interactive init mode\nnpx chorus init --yes          # Non-interactive init with defaults\nnpx chorus init --yes --max-agents 5      # Custom max agents\nnpx chorus init --yes --prefix \"myapp-\"   # Custom task ID prefix\n\n# Planning commands\nnpx chorus plan                # Force planning mode\n```\n\n## Acceptance Criteria\n\n### Basic Flags\n- [ ] `parse(args: string[])` returns CLIOptions object\n- [ ] `--autopilot` flag sets `mode: 'autopilot'`\n- [ ] `--mode \u003cvalue\u003e` sets mode to specified value\n- [ ] `--mode` validates value is 'semi-auto' or 'autopilot'\n- [ ] `--help` sets `showHelp: true`\n- [ ] `--version` sets `showVersion: true`\n- [ ] `--config \u003cpath\u003e` sets `configPath` to specified path\n- [ ] Default mode is 'semi-auto' when no flags\n\n### Subcommands\n- [ ] `init` subcommand sets `command: 'init'`\n- [ ] `plan` subcommand sets `command: 'plan'`\n- [ ] No subcommand sets `command: 'run'` (default)\n\n### Init Options\n- [ ] `--yes` or `-y` sets `nonInteractive: true`\n- [ ] `--max-agents \u003cn\u003e` sets `maxAgents: number`\n- [ ] `--prefix \u003cstr\u003e` sets `taskIdPrefix: string`\n- [ ] Init options only valid with `init` subcommand\n\n### Error Handling\n- [ ] Invalid arguments return error with usage message\n- [ ] Invalid `--mode` value returns error\n- [ ] `--max-agents` validates positive integer\n\n### Summary\n- [ ] 18 tests pass\n\n## Types\n```typescript\ninterface CLIOptions {\n  command: 'run' | 'init' | 'plan';\n  mode: 'semi-auto' | 'autopilot';\n  showHelp: boolean;\n  showVersion: boolean;\n  configPath?: string;\n  // Init-specific options\n  nonInteractive: boolean;\n  maxAgents?: number;\n  taskIdPrefix?: string;\n}\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:16:54.32133+03:00","created_by":"deligoez","updated_at":"2026-01-12T02:19:05.614063+03:00","closed_at":"2026-01-12T02:19:05.614063+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-nrr","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:14.187833+03:00","created_by":"deligoez"}]}
{"id":"ch-nvfu","title":"BUG: Add tests for PlanReviewConfigStep component","description":"## What\nPlanReviewConfigStep component has no unit tests.\n\n## Current State\n- src/components/PlanReviewConfigStep.tsx exists\n- No corresponding test file\n\n## Why\nConfig wizard step should have test coverage.\n\n## Acceptance Criteria\n- [ ] PlanReviewConfigStep.test.tsx exists\n- [ ] Tests cover rendering config options\n- [ ] Tests cover onChange callback\n- [ ] 4 tests pass\n\n## Files\n- src/components/PlanReviewConfigStep.tsx\n- src/components/PlanReviewConfigStep.test.tsx (create)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T13:29:36.824639+03:00","created_by":"deligoez","updated_at":"2026-01-12T14:07:25.392203+03:00","closed_at":"2026-01-12T14:07:25.392203+03:00","close_reason":"Tests already exist at src/components/init/PlanReviewConfigStep.test.tsx (8 tests passing)","labels":["m0-planning"]}
{"id":"ch-nvo","title":"F57b: FooterBar Component - Bottom status line","description":"## What\nBottom status bar showing task summary stats, merge queue indicator, and help reminder.\n\n## Migration Note\n**This component replaces the bottom portion of existing StatusBar.tsx**\n- Existing: StatusBar only shows top bar (no footer)\n- New: FooterBar shows task stats + merge status + help hint\n- After implementing FooterBar, update Layout.tsx to add FooterBar at bottom\n\n## Context from Master Plan\n```\n├─────────────────────────────────────────────────────────────────────────────┤\n│ Tasks: 1 done, 3 running, 1 pending, 1 blocked | Merge: 1 queued | ? help   │\n└─────────────────────────────────────────────────────────────────────────────┘\n```\n\n## API\n```typescript\n// src/components/FooterBar.tsx\n\ninterface FooterBarProps {\n  taskStats: {\n    done: number;\n    running: number;\n    pending: number;\n    blocked: number;\n  };\n  mergeQueue: {\n    queued: number;\n    merging?: boolean;\n    conflict?: boolean;\n  };\n  showHelp?: boolean;       // default true\n}\n\nfunction FooterBar({ taskStats, mergeQueue, showHelp = true }: FooterBarProps): JSX.Element\n```\n\n## Visual Layout\n```\nTasks: 1 done, 3 running, 1 pending, 1 blocked | Merge: 1 queued | ? help\n[TaskSummaryStats]                              [MergeQueueIndicator] [help]\n```\n\n## Color Specs (Ink)\n- Pipe separator \"|\": color=\"gray\"\n- Help hint \"? help\": dimColor\n- Top border: borderTop, borderColor=\"gray\"\n\n## Files\n- src/components/FooterBar.tsx\n- src/components/FooterBar.test.tsx\n\n## Acceptance Criteria\n- [ ] Renders TaskSummaryStats with taskStats prop\n- [ ] Renders MergeQueueIndicator with mergeQueue prop\n- [ ] Shows \"? help\" hint with dimColor when showHelp=true\n- [ ] Uses gray pipe \"|\" separator between sections\n- [ ] Uses flexbox with horizontal alignment\n- [ ] Hides help hint when showHelp=false\n- [ ] Passes correct props to TaskSummaryStats\n- [ ] Passes correct props to MergeQueueIndicator\n- [ ] Has gray top border line (borderTop, borderColor=\"gray\")\n- [ ] 10 tests pass\n\n## Tests\n1. Renders TaskSummaryStats with correct props\n2. Renders MergeQueueIndicator with correct props\n3. Shows help hint with dimColor by default\n4. Hides help hint when showHelp=false\n5. Uses gray pipe separators\n6. Passes taskStats props correctly\n7. Passes mergeQueue props correctly\n8. Has gray top border\n9. Uses horizontal flexbox layout\n10. Help hint shows \"? help\" text","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:49:25.867317+03:00","created_by":"deligoez","updated_at":"2026-01-11T20:33:44.305989+03:00","closed_at":"2026-01-11T20:33:44.305989+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-nvo","depends_on_id":"ch-8w5","type":"blocks","created_at":"2026-01-10T12:49:25.869621+03:00","created_by":"deligoez"},{"issue_id":"ch-nvo","depends_on_id":"ch-105","type":"blocks","created_at":"2026-01-10T12:49:25.87148+03:00","created_by":"deligoez"}]}
{"id":"ch-o5z","title":"F81: Planning Mode Controller","description":"## What\nPlanning mode state management and transitions.\n\n## Files\n- `src/modes/PlanningMode.tsx`\n- `src/modes/PlanningMode.test.tsx`\n\n## Dependencies\n- F81a (ch-7h5): PlanningLayout\n- F81b (ch-3i0): ChatInput\n\n## Acceptance Criteria\n- [ ] Renders PlanningLayout with ChatInput\n- [ ] Manages conversation state (messages array)\n- [ ] Handles user input via ChatInput onSend\n- [ ] Displays Plan Agent responses in agent window\n- [ ] Supports free-form planning: user describes goal, agent creates breakdown\n- [ ] Supports task list review: user pastes tasks, agent validates and suggests\n- [ ] Supports spec parsing: user provides file path, triggers auto-decomposition\n- [ ] Supports transition to Review mode\n- [ ] Supports transition to Implementation mode\n- [ ] Preserves conversation state on mode switch\n- [ ] 'p' key returns from Implementation to Planning\n- [ ] Shows task list panel when tasks exist\n- [ ] Logs mode events via SessionLogger\n- [ ] 13 tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:06:14.851433+03:00","created_by":"deligoez","updated_at":"2026-01-12T03:45:42.79443+03:00","closed_at":"2026-01-12T03:45:42.79443+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-o5z","depends_on_id":"ch-7h5","type":"blocks","created_at":"2026-01-11T03:06:14.855226+03:00","created_by":"deligoez"},{"issue_id":"ch-o5z","depends_on_id":"ch-3i0","type":"blocks","created_at":"2026-01-11T03:06:14.859205+03:00","created_by":"deligoez"}]}
{"id":"ch-o78b","title":"TS19c: Migrate RalphLoop","description":"## What\nUpdate RalphLoop service to use TaskStore.\n\n## Files\n- `src/services/RalphLoop.ts`\n\n## Acceptance Criteria\n- [ ] RalphLoop uses TaskStore instead of BeadsCLI\n- [ ] All existing tests pass\n- [ ] 0 new tests (existing tests validate)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:22:32.60151+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:22:32.60151+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-o78b","depends_on_id":"ch-pe0e","type":"blocks","created_at":"2026-01-13T00:22:32.603594+03:00","created_by":"deligoez"}]}
{"id":"ch-ofm","title":"F50: Task Rollback - Revert all commits for a task","description":"## What\nRollback all commits associated with a task (Level 2 and Level 3 rollback).\n\n## Context from Master Plan\n```\nLevel 2: SINGLE TASK\n├── What: Undo all commits for one task\n├── How: git revert all commits with [task-id]\n└── State: Task → pending\n\nLevel 3: TASK + DEPENDENTS\n├── What: Undo task and all dependent tasks\n├── How: Identify chain, revert in order\n└── State: All affected → pending\n```\n\n## Dependency Order for L3\n\n**CRITICAL: Rollback order matters for consistency.**\n\nFor `rollbackWithDependents(ch-abc)`:\n```\nch-abc (parent)\n├── ch-def (depends on ch-abc)\n│   └── ch-ghi (depends on ch-def)\n└── ch-xyz (depends on ch-abc)\n```\n\n**Rollback order: leaves first, root last**\n1. ch-ghi (leaf - no dependents)\n2. ch-def (after its dependents done)\n3. ch-xyz (leaf - no dependents)\n4. ch-abc (root - after all dependents done)\n\n**Why this order:**\n- If we rollback ch-abc first, ch-def might have code that depends on ch-abc's work\n- Rollback leaves first ensures we don't leave broken dependencies\n\n**Algorithm:**\n1. Get all dependents: `bd dependents ch-abc --recursive`\n2. Topological sort (reverse dependency order)\n3. Rollback each in order\n4. Set all to pending status\n\n## API\n```typescript\n// src/services/TaskRollback.ts\n\nclass TaskRollback {\n  constructor(private beadsCLI: BeadsCLI) {}\n\n  /**\n   * Level 2: Revert all commits for a single task\n   * Uses git revert for each commit with [task-id] in message\n   */\n  async rollback(taskId: string): Promise\u003cRollbackResult\u003e\n\n  /**\n   * Find all commits for a task\n   * Uses: git log --grep=\"[task-id]\" --format=\"%H\"\n   */\n  async findTaskCommits(taskId: string): Promise\u003cstring[]\u003e\n\n  /**\n   * Level 3: Rollback task and all dependent tasks\n   * 1. Get all dependents recursively via beadsCLI\n   * 2. Topological sort (leaves first, root last)\n   * 3. Rollback each in order\n   */\n  async rollbackWithDependents(taskId: string): Promise\u003cRollbackResult\u003e\n\n  /**\n   * Get tasks in rollback order (leaves first)\n   */\n  async getRollbackOrder(taskId: string): Promise\u003cstring[]\u003e\n}\n```\n\n## Commit Message Convention\nAgents MUST include task ID in commit messages for rollback to work:\n```\nfeat: implement user authentication [ch-abc]\n```\n\nThe `[ch-xxx]` suffix is searched by `git log --grep`.\n\n## Files\n- src/services/TaskRollback.ts\n- src/services/TaskRollback.test.ts\n\n## Acceptance Criteria\n\n### Level 2: rollback() - 4 tests\n- [ ] `rollback()` finds commits using git log --grep=\"[task-id]\"\n- [ ] `rollback()` reverts commits in reverse chronological order\n- [ ] `rollback()` returns task to pending status via beadsCLI\n- [ ] `rollback()` returns RollbackResult with revertedCommits list\n\n### Level 3: rollbackWithDependents() - 4 tests\n- [ ] `rollbackWithDependents()` gets dependent tasks recursively\n- [ ] `rollbackWithDependents()` orders correctly (leaves first, root last)\n- [ ] `rollbackWithDependents()` reverts each task's commits\n- [ ] `rollbackWithDependents()` sets all tasks to pending\n\n### Helper methods - 2 tests\n- [ ] `findTaskCommits()` returns commits or empty array\n- [ ] `getRollbackOrder()` returns topologically sorted task IDs\n\n### Summary\n- [ ] 10 tests pass\n\n## Tests\n1. rollback() finds task commits\n2. rollback() reverts in reverse chronological order\n3. rollback() sets task to pending\n4. rollback() handles no commits found\n5. rollbackWithDependents() gets dependents recursively\n6. rollbackWithDependents() orders leaves first\n7. rollbackWithDependents() reverts all task commits\n8. rollbackWithDependents() sets all tasks to pending\n9. findTaskCommits() returns empty for unknown task\n10. getRollbackOrder() returns correct topological order","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T10:44:48.050857+03:00","created_by":"deligoez","updated_at":"2026-01-11T22:54:03.961513+03:00","closed_at":"2026-01-11T22:54:03.961513+03:00","close_reason":"Closed","labels":["m10-rollback"],"dependencies":[{"issue_id":"ch-ofm","depends_on_id":"ch-2r5","type":"blocks","created_at":"2026-01-10T10:44:48.052322+03:00","created_by":"deligoez"},{"issue_id":"ch-ofm","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-10T12:28:02.465646+03:00","created_by":"deligoez"}]}
{"id":"ch-oifw","title":"F63-quit: Quit Key (q) - Exit application with confirmation","description":"## What\nKeyboard handler for 'q' key to exit the Chorus TUI application.\n\n## Context from Master Plan\n```\nGENERAL\nq    Quit (confirm if agents)\n```\n\n## Shortcut\n- **q** - Exit application\n\n## Behavior\n- If no agents running: Exit immediately\n- If agents running: Show confirmation dialog\n  - \"N agents running. Really quit? (y/N)\"\n  - 'y' confirms exit, kills all agents, cleans up worktrees\n  - 'n' or Escape cancels\n\n## Implementation\n\n```typescript\n// src/hooks/useQuitKey.ts\n\ninterface UseQuitKeyOptions {\n  runningAgents: number;\n  onQuit: () =\u003e void;\n  onShowConfirm: () =\u003e void;\n}\n\nfunction useQuitKey(options: UseQuitKeyOptions) {\n  useInput((input) =\u003e {\n    if (input === 'q') {\n      if (options.runningAgents === 0) {\n        options.onQuit();\n      } else {\n        options.onShowConfirm();\n      }\n    }\n  });\n}\n\n// src/components/QuitConfirmDialog.tsx\ninterface QuitConfirmDialogProps {\n  isOpen: boolean;\n  runningAgents: number;\n  onConfirm: () =\u003e void;\n  onCancel: () =\u003e void;\n}\n```\n\n## Acceptance Criteria\n\n### No Agents Running - 2 tests\n- [ ] 'q' with 0 agents calls onQuit immediately\n- [ ] Application exits cleanly (no zombie processes)\n\n### Agents Running - 4 tests\n- [ ] 'q' with agents running shows confirmation dialog\n- [ ] Dialog shows \"N agents running. Really quit? (y/N)\"\n- [ ] 'y' in dialog calls onConfirm (triggers cleanup + exit)\n- [ ] 'n' in dialog calls onCancel (closes dialog)\n\n### Cleanup - 3 tests\n- [ ] onConfirm stops all running agents (SIGTERM)\n- [ ] onConfirm cleans up agent worktrees\n- [ ] onConfirm waits for graceful shutdown (timeout 5s, then SIGKILL)\n\n### Edge Cases - 2 tests\n- [ ] Escape in dialog cancels (same as 'n')\n- [ ] Dialog not shown if already open\n\n### Summary\n- [ ] 11 tests pass\n\n## Files\n- src/hooks/useQuitKey.ts (NEW)\n- src/hooks/useQuitKey.test.ts (NEW)\n- src/components/QuitConfirmDialog.tsx (NEW)\n- src/components/QuitConfirmDialog.test.tsx (NEW)\n\n## Dependencies\n- F22 (SlotManager) for stopping agents\n- F05 (WorktreeService) for cleanup\n\n## Notes\n- Graceful shutdown is critical to avoid corrupted worktrees\n- SIGTERM first, wait 5s, then SIGKILL if needed\n- Save state before exit (persist any pending changes)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T13:18:08.7784+03:00","created_by":"deligoez","updated_at":"2026-01-11T14:13:37.960329+03:00","closed_at":"2026-01-11T14:13:37.960329+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-oifw","depends_on_id":"ch-i9i","type":"blocks","created_at":"2026-01-11T13:18:34.751016+03:00","created_by":"deligoez"},{"issue_id":"ch-oifw","depends_on_id":"ch-112","type":"blocks","created_at":"2026-01-11T13:18:34.843068+03:00","created_by":"deligoez"}]}
{"id":"ch-ooiw","title":"FR02: Review Region Machine - XState review region as parallel state","description":"## What\nImplement XState review region with idle, reviewingSummary, reviewingTask, feedbackModal states.\n\n## Acceptance Criteria\n- [ ] Machine has `idle`, `reviewingSummary`, `reviewingTask`, `feedbackModal` states\n- [ ] `TASK_COMPLETED` event adds task to `pendingReviews` context (for status bar count)\n- [ ] `START_REVIEW` snapshots current pending into `currentBatch` and transitions to summary\n- [ ] `START_REVIEW` does nothing when no reviews pending (guard: hasPendingReviews)\n- [ ] `START_REVIEW_SINGLE` transitions to reviewingTask with single task in currentBatch\n- [ ] `START_ONE_BY_ONE` transitions from summary to task review\n- [ ] `JUMP_TO_TASK` sets `currentIndex` and transitions to task review\n- [ ] `APPROVE` action removes task from pending AND currentBatch, sends to merge queue\n- [ ] `REDO` transitions to `feedbackModal`\n- [ ] `REJECT` action marks task blocked, removes from pending and currentBatch\n- [ ] `NEXT` / `PREV` actions update `currentIndex` within currentBatch bounds\n- [ ] `BACK` returns to summary from task review\n- [ ] `CANCEL` clears currentBatch and returns to idle\n- [ ] Guard `hasPendingReviews` returns `context.pendingReviews.length \u003e 0`\n- [ ] New tasks added to `pendingReviews` during review NOT added to `currentBatch` (snapshot behavior)\n- [ ] 15 tests pass\n\n## Files\n- src/machines/reviewRegion.ts\n- src/machines/reviewRegion.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:11:47.607529+03:00","created_by":"deligoez","updated_at":"2026-01-12T16:18:29.662481+03:00","closed_at":"2026-01-12T16:18:29.662481+03:00","close_reason":"Closed","labels":["m13-review"],"dependencies":[{"issue_id":"ch-ooiw","depends_on_id":"ch-kjae","type":"blocks","created_at":"2026-01-12T15:11:47.610961+03:00","created_by":"deligoez"}]}
{"id":"ch-oylf","title":"TS11: File Watcher","description":"## What\nImplement external file change detection.\n\n## Files\n- `src/services/TaskStore.ts`\n- `src/services/TaskStore.test.ts`\n\n## Acceptance Criteria\n- [ ] `watch()` starts chokidar watcher on `.chorus/tasks.jsonl`\n- [ ] `stop()` stops watcher and cleans up\n- [ ] External file changes trigger `reload()`\n- [ ] `reload()` re-reads file and emits `change`\n- [ ] Debounce rapid changes (100ms)\n- [ ] 4 tests pass","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-13T00:14:28.662099+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:14:28.662099+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-oylf","depends_on_id":"ch-0qmq","type":"blocks","created_at":"2026-01-13T00:14:28.664315+03:00","created_by":"deligoez"}]}
{"id":"ch-ozc","title":"F51b: Beads Recovery CLI - Recover from corrupted Beads state","description":"## What\nCLI command to recover from corrupted Beads database.\n\n## Context from Master Plan\n```\nRecovery Scenarios:\n│ Beads corrupted    │ bd rebuild from issues.jsonl              │\n```\n\n## CLI Command\n```bash\nchorus recover beads\n\n# Options:\nchorus recover beads --verify      # Check if recovery needed\nchorus recover beads --dry-run     # Show what would be recovered\nchorus recover beads --force       # Skip confirmation\n```\n\n## When to Use\n- `bd` commands fail with parse errors\n- Task data appears corrupted or missing\n- After system crash or incomplete write\n\n## API\n```typescript\n// src/commands/recoverBeads.ts\n\ninterface RecoverBeadsOptions {\n  verify?: boolean;   // Just check if recovery needed\n  dryRun?: boolean;   // Show what would be recovered\n  force?: boolean;    // Skip confirmation\n}\n\ninterface RecoverBeadsResult {\n  needed: boolean;\n  tasksRecovered: number;\n  errors: string[];\n}\n\nasync function recoverBeadsCommand(options: RecoverBeadsOptions): Promise\u003cRecoverBeadsResult\u003e\n```\n\n## Recovery Steps\n1. Check if .beads/issues.jsonl exists (source of truth)\n2. Validate JSONL file is parseable\n3. Run `bd rebuild` to recreate database from JSONL\n4. Verify task count matches\n5. Report results\n\n## Files\n- src/commands/recoverBeads.ts (NEW)\n- src/commands/recoverBeads.test.ts (NEW)\n\n## Acceptance Criteria\n\n### --verify mode - 2 tests\n- [ ] Returns `needed: true` if `bd ready` fails with parse error\n- [ ] Returns `needed: false` if beads is healthy\n\n### Recovery execution - 4 tests\n- [ ] Validates issues.jsonl is parseable before recovery\n- [ ] Runs `bd rebuild` command\n- [ ] Reports number of tasks recovered\n- [ ] Handles missing issues.jsonl gracefully (error message)\n\n### Options - 2 tests\n- [ ] `--dry-run` shows what would be recovered without executing\n- [ ] `--force` skips confirmation prompt\n\n### Summary\n- [ ] 8 tests pass\n\n## Tests\n1. --verify returns needed:true for corrupted beads\n2. --verify returns needed:false for healthy beads\n3. Validates issues.jsonl before recovery\n4. Runs bd rebuild successfully\n5. Reports correct task count\n6. Errors gracefully if issues.jsonl missing\n7. --dry-run shows preview without executing\n8. --force skips confirmation\n\n## CLI Integration\n```typescript\n// In src/cli.ts\nprogram\n  .command('recover beads')\n  .description('Recover from corrupted Beads database')\n  .option('--verify', 'Check if recovery needed')\n  .option('--dry-run', 'Show what would be recovered')\n  .option('-f, --force', 'Skip confirmation')\n  .action(recoverBeadsCommand);\n```\n\n## Notes\n- issues.jsonl is Beads' source of truth (JSONL format)\n- `bd rebuild` is the native Beads recovery command\n- This is a thin wrapper providing Chorus-specific UX","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T12:34:13.491887+03:00","created_by":"deligoez","updated_at":"2026-01-12T06:35:01.533704+03:00","closed_at":"2026-01-12T06:35:01.533704+03:00","close_reason":"Closed","labels":["m10-rollback"],"dependencies":[{"issue_id":"ch-ozc","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:54.026962+03:00","created_by":"deligoez"}]}
{"id":"ch-p065","title":"SP07: Sprint Config - Config file integration for sprint settings","description":"## What\nAdd sprint configuration to ChorusConfig and integrate with config file.\n\n## Acceptance Criteria\n- [ ] Adds `sprint: SprintConfig` to `ChorusConfig` interface\n- [ ] `getDefaultConfig()` includes sprint defaults (maxIterations: 50, taskTimeout: 30)\n- [ ] Config validates sprint schema (rejects invalid values)\n- [ ] 4 tests pass\n\n## Files\n- src/types/config.ts\n- src/services/ConfigService.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T15:11:52.271117+03:00","created_by":"deligoez","updated_at":"2026-01-12T17:32:05.278897+03:00","closed_at":"2026-01-12T17:32:05.278897+03:00","close_reason":"Closed","labels":["m13b-sprint"],"dependencies":[{"issue_id":"ch-p065","depends_on_id":"ch-pdn1","type":"blocks","created_at":"2026-01-12T15:11:52.273959+03:00","created_by":"deligoez"}]}
{"id":"ch-p3c","title":"F63q: Spawn Agent Key (s) - Start new agent for selected task","description":"## What\nKeyboard handler to spawn a new agent for the currently selected task.\n\n## Context from Master Plan\n```\nAGENT CONTROL\ns      Spawn agent for task\n```\n\n## Shortcut\n- **s** - Spawn agent for selected task\n\n## Implementation\n\n```typescript\n// src/hooks/useSpawnKey.ts\n\ninterface UseSpawnKeyOptions {\n  selectedTask: Task | null;\n  slotManager: SlotManager;\n  orchestrator: Orchestrator;\n  onSpawned?: (taskId: string, agentId: string) =\u003e void;\n  onError?: (error: string) =\u003e void;\n}\n\nfunction useSpawnKey(options: UseSpawnKeyOptions) {\n  useInput((input) =\u003e {\n    if (input !== 's') return;\n    \n    const task = options.selectedTask;\n    if (!task) {\n      options.onError?.('No task selected');\n      return;\n    }\n    \n    if (task.status !== 'open') {\n      options.onError?.('Task not available');\n      return;\n    }\n    \n    if (!options.slotManager.hasAvailableSlot()) {\n      options.onError?.('No agent slots available');\n      return;\n    }\n    \n    // Spawn agent via orchestrator\n    const agentId = options.orchestrator.spawnAgent(task.id);\n    options.onSpawned?.(task.id, agentId);\n  });\n}\n```\n\n## Acceptance Criteria\n\n### Spawn Success - 3 tests\n- [ ] 's' key with valid selected task calls `orchestrator.spawnAgent()`\n- [ ] Shows confirmation: \"Agent spawned for ch-xxx\"\n- [ ] Task status changes to in_progress\n\n### Validation - 4 tests\n- [ ] No-op when no task selected, shows \"No task selected\"\n- [ ] No-op when task status is not 'open', shows \"Task not available\"\n- [ ] No-op when task has dependencies (via Beads status check), shows \"Task is blocked\"\n- [ ] No-op when no slots available, shows \"No agent slots available\"\n\n### Slot Check - 2 tests\n- [ ] Calls `slotManager.hasAvailableSlot()` before spawning\n- [ ] Respects maxAgents config limit\n\n### Summary\n- [ ] 9 tests pass\n\n## Files\n- src/hooks/useSpawnKey.ts (NEW)\n- src/hooks/useSpawnKey.test.ts (NEW)\n\n## Dependencies\n- F22 (SlotManager) for slot availability check\n- F12 (Task Claimer) for claiming task\n\n## Notes\n- Only works on 'open' status tasks\n- Blocked tasks detected via Beads dependency API (status check), not label\n- Spawns Claude agent (MVP scope)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T12:43:55.686976+03:00","created_by":"deligoez","updated_at":"2026-01-12T05:29:16.605442+03:00","closed_at":"2026-01-12T05:29:16.605442+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-p3c","depends_on_id":"ch-i9i","type":"blocks","created_at":"2026-01-11T12:43:55.691081+03:00","created_by":"deligoez"},{"issue_id":"ch-p3c","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-11T12:43:55.694267+03:00","created_by":"deligoez"},{"issue_id":"ch-p3c","depends_on_id":"ch-0e7","type":"blocks","created_at":"2026-01-11T14:01:42.669078+03:00","created_by":"deligoez"}]}
{"id":"ch-p5i9","title":"E2E-59: Learning System Integration","description":"## What\nE2E tests for learning extraction, storage, and categorization workflow.\n\n## Acceptance Criteria\n- [ ] LearningExtractor parses [LOCAL], [CROSS-CUTTING], [ARCHITECTURAL] markers\n- [ ] Learnings saved to LearningStore with task context\n- [ ] Learnings persist across sessions (file system)\n- [ ] Learning categorization works correctly\n- [ ] Cross-cutting learnings trigger plan review flag\n- [ ] Learning search/retrieval works\n- [ ] 9 tests pass\n\n## Files\n- src/e2e/learning-system.e2e.test.ts\n\n## Implementation Notes\n- Use temp directory for learnings.json\n- Test with realistic agent output containing markers","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T00:39:14.238493+03:00","created_by":"deligoez","updated_at":"2026-01-12T10:34:24.317058+03:00","closed_at":"2026-01-12T10:34:24.317058+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-p5i9","depends_on_id":"ch-uxk","type":"blocks","created_at":"2026-01-12T00:39:14.240734+03:00","created_by":"deligoez"},{"issue_id":"ch-p5i9","depends_on_id":"ch-1gi","type":"blocks","created_at":"2026-01-12T00:39:14.243276+03:00","created_by":"deligoez"},{"issue_id":"ch-p5i9","depends_on_id":"ch-9yl","type":"blocks","created_at":"2026-01-12T00:39:14.245359+03:00","created_by":"deligoez"},{"issue_id":"ch-p5i9","depends_on_id":"ch-a6h","type":"blocks","created_at":"2026-01-12T00:39:14.247409+03:00","created_by":"deligoez"},{"issue_id":"ch-p5i9","depends_on_id":"ch-sm8","type":"blocks","created_at":"2026-01-12T00:39:14.24943+03:00","created_by":"deligoez"}]}
{"id":"ch-pbv0","title":"SP05: Sprint Stats Storage - Save sprint statistics to JSON files","description":"## What\nSave and load sprint statistics from .chorus/sprints/ directory.\n\n## Acceptance Criteria\n- [ ] `saveSprintStats(stats)` writes to `.chorus/sprints/{id}.json`\n- [ ] Creates `.chorus/sprints/` directory if not exists\n- [ ] `loadSprintStats(sprintId)` returns parsed JSON for existing file\n- [ ] `loadSprintStats(sprintId)` returns `null` for non-existent file\n- [ ] `listSprintStats()` returns all sprints sorted by date (most recent first)\n- [ ] 6 tests pass\n\n## Files\n- src/services/SprintStatsStorage.ts\n- src/services/SprintStatsStorage.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T15:11:51.000721+03:00","created_by":"deligoez","updated_at":"2026-01-12T17:33:52.165424+03:00","closed_at":"2026-01-12T17:33:52.165424+03:00","close_reason":"Closed","labels":["m13b-sprint"],"dependencies":[{"issue_id":"ch-pbv0","depends_on_id":"ch-pdn1","type":"blocks","created_at":"2026-01-12T15:11:51.003535+03:00","created_by":"deligoez"}]}
{"id":"ch-pdn1","title":"SP01: Sprint Types - Types and interfaces for sprint planning","description":"## What\nDefine all TypeScript types and interfaces for sprint planning.\n\n## Acceptance Criteria\n- [ ] `SprintConfig` interface with target, iterationSettings, pauseOnStuck, pauseOnErrors\n- [ ] `SprintTarget` discriminated union (taskCount/duration/untilTime/noReady)\n- [ ] `SprintStats` interface with id, startedAt, endedAt, counts, taskStats, settings\n- [ ] `TaskSprintStat` interface with taskId, startedAt, completedAt, iterations, qualityPassed, reviewDecision\n- [ ] 4 tests pass\n\n## Files\n- src/types/sprint.ts\n- src/types/sprint.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T15:10:59.473099+03:00","created_by":"deligoez","updated_at":"2026-01-12T17:28:56.762769+03:00","closed_at":"2026-01-12T17:28:56.762769+03:00","close_reason":"Closed","labels":["m13b-sprint"]}
{"id":"ch-pe0e","title":"TS19a: Migrate Completion Handlers","description":"## What\nUpdate completion handler services to use TaskStore.\n\n## Files\n- `src/services/CompletionHandler.ts`\n- `src/services/AgentCompletionHandler.ts`\n\n## Acceptance Criteria\n- [ ] CompletionHandler uses TaskStore instead of BeadsCLI\n- [ ] AgentCompletionHandler uses TaskStore\n- [ ] All existing tests pass\n- [ ] 0 new tests (existing tests validate)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:15:50.202991+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:22:23.185492+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-pe0e","depends_on_id":"ch-9004","type":"blocks","created_at":"2026-01-13T00:16:01.874428+03:00","created_by":"deligoez"}]}
{"id":"ch-pjge","title":"SP02: Sprint Machine - XState sprint region","description":"## What\nImplement XState sprint region with planning, running, paused, completed states.\n\n## Acceptance Criteria\n- [ ] Machine has `idle`, `planning`, `running`, `paused`, `completed` states\n- [ ] `START_PLANNING` transitions from idle to planning\n- [ ] `START_SPRINT` transitions from planning to running\n- [ ] `TASK_COMPLETED` updates sprint stats, checks completion target\n- [ ] `TASK_FAILED` updates failed count\n- [ ] `PAUSE` transitions to paused\n- [ ] `RESUME` transitions back to running\n- [ ] `CANCEL` transitions to idle\n- [ ] Completion guard checks target type (taskCount reached, duration elapsed, untilTime passed, noReady)\n- [ ] 10 tests pass\n\n## Files\n- src/machines/sprintRegion.ts\n- src/machines/sprintRegion.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T15:12:33.762416+03:00","created_by":"deligoez","updated_at":"2026-01-12T17:37:25.163518+03:00","closed_at":"2026-01-12T17:37:25.163518+03:00","close_reason":"Closed","labels":["m13b-sprint"],"dependencies":[{"issue_id":"ch-pjge","depends_on_id":"ch-kjae","type":"blocks","created_at":"2026-01-12T15:12:33.765626+03:00","created_by":"deligoez"}]}
{"id":"ch-pl4","title":"F46c-c: Intervention Panel - Redirect Flow","description":"## What\nIntervention Panel redirect flow: select agent, then select/enter target task.\n\n## Mode Flow\n```\nMain mode:\n  [r] → mode = 'redirect-select'\n\nredirect-select mode:\n  Shows: \"Select agent to redirect: [1] claude [2] codex\"\n  [1-9] → selectedAgentId = agentId → mode = 'redirect-task'\n  [ESC] → mode = 'main'\n\nredirect-task mode:\n  Shows: \"Enter task ID: [input field]\"\n  [Enter] → agentRedirector.redirect(selectedAgentId, taskId) → mode = 'main'\n  [ESC] → mode = 'main'\n```\n\n## Acceptance Criteria\n\n### Mode Transitions - 2 tests\n- [ ] Number key in redirect-select sets selectedAgentId and transitions to redirect-task\n- [ ] ESC in redirect-select or redirect-task returns to 'main' mode\n\n### Redirect Select Mode - 1 test\n- [ ] redirect-select mode shows agent selection prompt\n\n### Redirect Task Mode - 2 tests\n- [ ] redirect-task mode shows text input for task ID\n- [ ] Enter key calls agentRedirector.redirect() with selectedAgentId and entered taskId\n\n### Summary\n- [ ] 5 tests pass\n\n## Files\n- src/components/InterventionPanel.tsx (UPDATE)\n- src/components/InterventionPanel.test.tsx (UPDATE)\n\n## Notes\n- Uses ink TextInput component for task ID entry\n- Validates task exists before redirect\n\n## Dependencies\n- F46c-a (ch-di6) - Main mode and base component","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T23:52:28.940448+03:00","created_by":"deligoez","updated_at":"2026-01-11T00:05:43.598635+03:00","closed_at":"2026-01-11T00:05:43.598635+03:00","close_reason":"Closed","labels":["m9-intervention"],"dependencies":[{"issue_id":"ch-pl4","depends_on_id":"ch-di6","type":"blocks","created_at":"2026-01-10T23:52:28.945922+03:00","created_by":"deligoez"}]}
{"id":"ch-ps8z","title":"E2E-62: Mode Initialization Flow","description":"## What\nE2E tests for complete flow from fresh project through init, planning, and implementation.\n\n## Acceptance Criteria\n- [ ] Fresh project starts in INIT mode\n- [ ] Init creates .chorus/ directory structure\n- [ ] Planning mode starts Plan Agent\n- [ ] Tasks created by Plan Agent\n- [ ] Validation finds issues, suggests fixes\n- [ ] Review loop iterates until no issues\n- [ ] Implementation mode starts with chosenMode\n- [ ] Mode resolution hierarchy: CLI \u003e planning-state \u003e state \u003e config\n- [ ] 10 tests pass\n\n## Files\n- src/e2e/mode-initialization.e2e.test.ts\n\n## Implementation Notes\n- Use fresh temp directory\n- Test each mode transition","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T00:39:45.228959+03:00","created_by":"deligoez","updated_at":"2026-01-12T04:44:46.876407+03:00","closed_at":"2026-01-12T04:44:46.876407+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-ps8z","depends_on_id":"ch-m9y","type":"blocks","created_at":"2026-01-12T00:39:45.232425+03:00","created_by":"deligoez"},{"issue_id":"ch-ps8z","depends_on_id":"ch-o5z","type":"blocks","created_at":"2026-01-12T00:39:45.235542+03:00","created_by":"deligoez"},{"issue_id":"ch-ps8z","depends_on_id":"ch-2hw","type":"blocks","created_at":"2026-01-12T00:39:45.237675+03:00","created_by":"deligoez"},{"issue_id":"ch-ps8z","depends_on_id":"ch-a0a","type":"blocks","created_at":"2026-01-12T00:39:45.2398+03:00","created_by":"deligoez"},{"issue_id":"ch-ps8z","depends_on_id":"ch-to7","type":"blocks","created_at":"2026-01-12T00:39:45.242082+03:00","created_by":"deligoez"},{"issue_id":"ch-ps8z","depends_on_id":"ch-eq5","type":"blocks","created_at":"2026-01-12T00:39:45.244121+03:00","created_by":"deligoez"}]}
{"id":"ch-pv39","title":"E2E-16: Quit App (q)","description":"## What\nVerify q key exits with confirmation.\n\n## Tests (3 tests)\n1. Pressing q shows confirmation\n2. Pressing q again exits\n3. ESC cancels quit\n\n## Files\n- src/e2e/quit-app.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T21:18:25.5356+03:00","created_by":"deligoez","updated_at":"2026-01-12T08:41:58.627911+03:00","closed_at":"2026-01-12T08:41:58.627911+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-pv39","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:18:25.536861+03:00","created_by":"deligoez"},{"issue_id":"ch-pv39","depends_on_id":"ch-bny","type":"blocks","created_at":"2026-01-11T21:18:25.538691+03:00","created_by":"deligoez"}]}
{"id":"ch-pwee","title":"E2E-39: Clean Exit","description":"## What\nE2E test for clean application exit.\n\n## Acceptance Criteria\n- [ ] Pressing 'q' prompts for confirmation if agents running\n- [ ] Shows list of running agents in prompt\n- [ ] Force quit option available\n- [ ] Clean exit when no agents running\n- [ ] State saved before exit\n- [ ] 5 tests pass\n\n## Test Cases\n1. `it('prompts confirmation with running agents')`\n2. `it('shows running agents in prompt')`\n3. `it('allows force quit')`\n4. `it('exits cleanly with no agents')`\n5. `it('saves state before exit')`\n\n## Files\n- tests/e2e/clean-exit.test.ts\n\n## Dependencies\n- ch-0e01 (E2E Infrastructure)\n- ch-pv39 (E2E-16: Quit App)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:22:37.376799+03:00","created_by":"deligoez","updated_at":"2026-01-12T09:47:39.476008+03:00","closed_at":"2026-01-12T09:47:39.476008+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-pwee","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:22:37.380022+03:00","created_by":"deligoez"},{"issue_id":"ch-pwee","depends_on_id":"ch-pv39","type":"blocks","created_at":"2026-01-11T21:22:37.383454+03:00","created_by":"deligoez"}]}
{"id":"ch-pyvy","title":"E2E-02: TaskPanel Displays Tasks","description":"## What\nVerify TaskPanel shows tasks with correct indicators.\n\n## Setup\nMock beads data or use test fixtures.\n\n## Tests (5 tests)\n1. Shows task titles in list\n2. Shows → for open tasks\n3. Shows ● for in_progress tasks  \n4. Shows ✓ for closed tasks\n5. Shows priority badges (P0-P4)\n\n## Files\n- src/e2e/task-panel.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T21:17:46.160802+03:00","created_by":"deligoez","updated_at":"2026-01-11T21:41:51.780308+03:00","closed_at":"2026-01-11T21:41:51.780308+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-pyvy","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:17:46.162258+03:00","created_by":"deligoez"}]}
{"id":"ch-pznq","title":"E2E-R06: Review Persistence E2E - State survives restart","description":"## What\nE2E test for review state persistence across restarts.\n\n## Acceptance Criteria\n- [ ] Create 2 tasks in \"reviewing\" status\n- [ ] Open review, navigate to second task\n- [ ] Restart app (kill and relaunch)\n- [ ] Verify review state restored (2 pending, at second task)\n- [ ] 4 tests pass\n\n## Files\n- src/e2e/review-persistence.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:14:15.82391+03:00","created_by":"deligoez","updated_at":"2026-01-12T17:17:49.622516+03:00","closed_at":"2026-01-12T17:17:49.622516+03:00","close_reason":"Closed","labels":["m13-review"],"dependencies":[{"issue_id":"ch-pznq","depends_on_id":"ch-frrs","type":"blocks","created_at":"2026-01-12T15:14:15.826747+03:00","created_by":"deligoez"}]}
{"id":"ch-q1j","title":"F07b: Non-Claude Context Injection","description":"## What\nExtend PromptBuilder to inject context for non-Claude agents (codex, opencode).\n\n**Status:** DEFERRED - Will implement when non-Claude agent support is needed.\n\n## Why\nNon-Claude agents don't natively load `.claude/rules` or project context.\nThis task adds AGENTS.md and learnings injection for codex/opencode.\n\n## Acceptance Criteria\n\n### needsContextInjection() - 2 tests\n- [ ] Returns false for 'claude'\n- [ ] Returns true for 'codex', 'opencode'\n\n### Context Loading - 2 tests\n- [ ] `loadAgentsMd(projectDir)` reads AGENTS.md if exists\n- [ ] `loadLearnings(projectDir)` reads .agent/learnings.md if exists\n\n### build() Extension - 2 tests\n- [ ] Injects AGENTS.md content for non-Claude agents\n- [ ] Injects learnings content for non-Claude agents\n\n### Summary\n- [ ] 6 tests pass\n\n## Files\n- src/services/PromptBuilder.ts (UPDATE)\n- src/services/PromptBuilder.test.ts (UPDATE)\n\n## API Extension\n```typescript\ninterface PromptContext {\n  task: Bead;\n  agentType: AgentType;  // NEW\n  branch: string;\n  taskId: string;\n  config: ChorusConfig;\n  learnings?: string;    // NEW\n}\n\nclass PromptBuilder {\n  // Existing methods...\n  \n  // NEW methods for non-Claude\n  loadAgentsMd(projectDir: string): string | null;\n  loadLearnings(projectDir: string): string | null;\n  needsContextInjection(agentType: AgentType): boolean;\n}\n```\n\n## Tests\n1. needsContextInjection() returns false for claude\n2. needsContextInjection() returns true for codex\n3. loadAgentsMd() reads file when exists\n4. loadAgentsMd() returns null when missing\n5. build() injects AGENTS.md for codex\n6. build() injects learnings for non-claude","status":"deferred","priority":2,"issue_type":"task","created_at":"2026-01-10T22:43:22.437116+03:00","created_by":"deligoez","updated_at":"2026-01-12T12:23:16.2769+03:00","labels":["deferred","m2-agent-prep"],"dependencies":[{"issue_id":"ch-q1j","depends_on_id":"ch-wk8","type":"blocks","created_at":"2026-01-10T22:43:22.442508+03:00","created_by":"deligoez"}]}
{"id":"ch-q4nx","title":"FR10: Task Review Panel - Individual task review modal","description":"## What\nModal panel for reviewing individual task with details.\n\n## Acceptance Criteria\n- [ ] Shows task title, ID, agent, duration (formatted), iterations count\n- [ ] Shows changes summary (files added/modified/deleted with line counts)\n- [ ] Shows quality check result with per-command breakdown (test ✓, typecheck ✓, etc.)\n- [ ] Shows agent signal message\n- [ ] Shows position indicator \"[N/M] ch-xxx\" in header\n- [ ] Shows keyboard hints (A/R/X/N/P/Esc)\n- [ ] Modal covers ~80% of screen\n- [ ] Renders correctly for task without changes (shows \"No changes\")\n- [ ] Renders correctly for task with quality failure (shows failed commands)\n- [ ] 10 tests pass\n\n## Files\n- src/components/TaskReviewPanel.tsx\n- src/components/TaskReviewPanel.test.tsx","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:12:32.307155+03:00","created_by":"deligoez","updated_at":"2026-01-12T16:34:44.122725+03:00","closed_at":"2026-01-12T16:34:44.122725+03:00","close_reason":"Closed","labels":["m13-review"],"dependencies":[{"issue_id":"ch-q4nx","depends_on_id":"ch-ooiw","type":"blocks","created_at":"2026-01-12T15:12:32.3105+03:00","created_by":"deligoez"},{"issue_id":"ch-q4nx","depends_on_id":"ch-sot9","type":"blocks","created_at":"2026-01-12T15:12:32.313591+03:00","created_by":"deligoez"}]}
{"id":"ch-q8mf","title":"E2E-00a: Fresh Project Init","description":"## What\nE2E test for chorus init on a fresh project (no .beads directory).\n\n## Acceptance Criteria\n- [ ] chorus starts in fresh directory (no .beads)\n- [ ] Shows init wizard or empty state\n- [ ] Can create initial task\n- [ ] Task appears in task panel\n- [ ] 4 tests pass\n\n## Test Cases\n1. `it('starts in fresh directory without errors')`\n2. `it('shows empty task state')`\n3. `it('can create first task')`\n4. `it('first task appears in panel')`\n\n## Files\n- tests/e2e/fresh-init.test.ts\n\n## Dependencies\n- ch-0e01 (E2E Infrastructure)\n\n## Notes\nTests the \"zero point\" experience - completely new project.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T21:24:44.392015+03:00","created_by":"deligoez","updated_at":"2026-01-11T21:49:52.608778+03:00","closed_at":"2026-01-11T21:49:52.608778+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-q8mf","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:24:44.395333+03:00","created_by":"deligoez"}]}
{"id":"ch-qeq3","title":"E2E-68: File Watcher Integration","description":"## What\nE2E tests for file system watchers on .chorus/ directory.\n\n## Acceptance Criteria\n- [ ] Beads creates task (appends to .beads/issues.jsonl)\n- [ ] File watcher detects change\n- [ ] Task parser updates task list\n- [ ] TaskPanel re-renders with new task\n- [ ] Multiple tasks load without race conditions\n- [ ] Watcher recovers from file system errors\n- [ ] 7 tests pass\n\n## Files\n- src/e2e/file-watcher.e2e.test.ts\n\n## Implementation Notes\n- Create tasks via bd CLI during test\n- Verify UI updates after file change","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T00:40:48.397115+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:31:53.027591+03:00","closed_at":"2026-01-12T01:31:53.027591+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-qeq3","depends_on_id":"ch-sro","type":"blocks","created_at":"2026-01-12T00:40:48.398867+03:00","created_by":"deligoez"},{"issue_id":"ch-qeq3","depends_on_id":"ch-ah6","type":"blocks","created_at":"2026-01-12T00:40:48.401432+03:00","created_by":"deligoez"}]}
{"id":"ch-qf06","title":"INT-02: Claude file operations (write, append, read)","description":"## What\nIntegration test: Claude performs deterministic file operations.\n\n## Test Scenarios (in temp directory)\n1. \"Create file test.txt with content: HELLO_WORLD\" → verify file exists and content\n2. \"Append 'LINE2' to existing.txt\" → verify file has original + new line\n3. \"Read test.txt and output its content\" → verify output matches file\n\n## Why Deterministic\n- Exact file content verification\n- Known input → known output\n- Temp directory isolation\n\n## Setup\n```typescript\nconst tmpDir = mkdtempSync(join(tmpdir(), 'chorus-int-'));\n// Create initial files if needed\n// Run test\n// Cleanup tmpDir\n```\n\n## Acceptance Criteria\n- [ ] Tests use isolated temp directory\n- [ ] File creation test passes\n- [ ] File append test passes  \n- [ ] File read test passes\n- [ ] Cleanup after each test\n- [ ] 3 tests pass\n\n## Files\n- src/integration/file-operations.integration.test.ts (create)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T14:25:33.13959+03:00","created_by":"deligoez","updated_at":"2026-01-12T14:39:37.165268+03:00","closed_at":"2026-01-12T14:39:37.165268+03:00","close_reason":"Closed","labels":["m2-agent-prep"],"dependencies":[{"issue_id":"ch-qf06","depends_on_id":"ch-9tjq","type":"blocks","created_at":"2026-01-12T14:25:33.142945+03:00","created_by":"deligoez"}]}
{"id":"ch-qwk0","title":"BUG: Add stopped status to AgentStatus in state.ts","description":"## What\nAgentStatus is defined in 2 files with inconsistent values.\n\n## Current State\n- `agent.ts`: \"idle\" | \"running\" | \"paused\" | \"stopped\" | \"error\"\n- `state.ts`: \"idle\" | \"running\" | \"paused\" | \"error\" (missing \"stopped\")\n\n## Problem\n- \"stopped\" status exists in agent.ts but not in state.ts\n- Can cause type errors when using stopped agents\n\n## Solution\n1. Add \"stopped\" to state.ts AgentStatus\n2. Or consolidate to single definition in agent.ts\n\n## Acceptance Criteria\n- [ ] AgentStatus includes \"stopped\" in all definitions\n- [ ] Single source of truth preferred\n- [ ] All tests pass\n- [ ] 2 tests pass\n\n## Files\n- src/types/state.ts\n- src/types/agent.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T13:28:58.681415+03:00","created_by":"deligoez","updated_at":"2026-01-12T13:42:36.529427+03:00","closed_at":"2026-01-12T13:42:36.529427+03:00","close_reason":"Closed","labels":["m1-infrastructure"]}
{"id":"ch-qz9m","title":"FX04: Agent Machine - Child actor with lifecycle states","description":"## What\nImplement AgentMachine as spawnable child actor with full lifecycle management.\n\n## Acceptance Criteria\n- [ ] Machine uses `setup()` for type safety\n- [ ] Input type includes taskId and parentRef\n- [ ] States: idle, preparing, executing, blocked, completed, failed\n- [ ] Executing has nested states: iteration, checkQuality\n- [ ] Entry action sends START_READY to parent when preparing complete\n- [ ] Final states (completed, failed) send events to parent via sendTo\n- [ ] Iteration counter increments on each cycle\n- [ ] Max iterations guard prevents infinite loops\n- [ ] 10 tests pass\n\n## Tests\n1. Machine initializes with input context\n2. START transitions idle → preparing\n3. READY transitions preparing → executing\n4. ITERATION_DONE increments iteration counter\n5. ALL_PASS transitions to completed\n6. RETRY transitions back to iteration\n7. BLOCKED transitions to blocked state\n8. FAIL transitions to failed state\n9. Completed state sends AGENT_COMPLETED to parent\n10. Failed state sends AGENT_FAILED to parent\n\n## Files\n- src/machines/agent.machine.ts\n\n## Dependencies\n- FX02 (XState Types)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-11T15:26:27.235694+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:01:28.399108+03:00","closed_at":"2026-01-11T18:01:28.399108+03:00","close_reason":"Closed","labels":["m-1-xstate"],"dependencies":[{"issue_id":"ch-qz9m","depends_on_id":"ch-j321","type":"blocks","created_at":"2026-01-11T15:26:27.237945+03:00","created_by":"deligoez"}]}
{"id":"ch-r12","title":"F02d: State Persistence - Debounced save and clear","description":"## What\nPersist state to disk with debouncing.\n\n## Acceptance Criteria\n- [ ] `save()` writes state to `.chorus/state.json`\n- [ ] `save()` creates parent directory if missing\n- [ ] `saveDebounced()` coalesces rapid calls within 100ms window\n- [ ] `saveDebounced()` writes only once after debounce period expires\n- [ ] `clear()` removes state file from disk\n- [ ] `clear()` returns silently if file does not exist (idempotent)\n- [ ] 6 tests pass\n\n## Files\n- src/services/StateService.ts (extend)\n- tests/services/StateService.test.ts (extend)\n\n## Implementation\n```typescript\nprivate saveTimeout: NodeJS.Timeout | null = null;\nprivate readonly DEBOUNCE_MS = 100;\n\nsave(): void {\n  const dir = path.dirname(this.statePath);\n  if (!fs.existsSync(dir)) fs.mkdirSync(dir, { recursive: true });\n  fs.writeFileSync(this.statePath, JSON.stringify(this.state, null, 2));\n}\n\nsaveDebounced(): void {\n  if (this.saveTimeout) clearTimeout(this.saveTimeout);\n  this.saveTimeout = setTimeout(() =\u003e this.save(), this.DEBOUNCE_MS);\n}\n\nclear(): void {\n  if (fs.existsSync(this.statePath)) {\n    fs.unlinkSync(this.statePath);\n  }\n  this.state = null;\n}\n```\n\n## Test Cases\n1. `save()` creates state.json file with valid JSON content\n2. `save()` creates .chorus directory if missing\n3. `saveDebounced()` called 3x in 50ms results in only 1 file write\n4. `saveDebounced()` writes file after 100ms debounce period\n5. `clear()` removes existing state file\n6. `clear()` does not throw when file does not exist","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T01:30:51.05887+03:00","created_by":"deligoez","updated_at":"2026-01-11T19:00:34.79173+03:00","closed_at":"2026-01-11T19:00:34.79173+03:00","close_reason":"Closed","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-r12","depends_on_id":"ch-ah6","type":"blocks","created_at":"2026-01-10T01:30:51.060628+03:00","created_by":"deligoez"},{"issue_id":"ch-r12","depends_on_id":"ch-81x","type":"blocks","created_at":"2026-01-10T01:37:14.840129+03:00","created_by":"deligoez"}]}
{"id":"ch-r1p","title":"F83: Auto-Decomposition Controller","description":"## What\nOrchestrate spec parsing and task generation flow.\n\n## Files\n- `src/services/AutoDecomposition.ts`\n- `src/services/AutoDecomposition.test.ts`\n\n## Dependencies\n- F83a (ch-3xt): SpecChunker\n- F83b (ch-8le): TaskGenerator\n- F84 (ch-2hw): TaskValidator\n\n## Acceptance Criteria\n- [ ] `decompose(specPath: string)` returns tasks array\n- [ ] Reads spec file from provided path\n- [ ] Chunks content using SpecChunker\n- [ ] Generates tasks for each chunk via TaskGenerator\n- [ ] Validates generated tasks via TaskValidator\n- [ ] Shows progress (chunk X of Y)\n- [ ] Supports pause/continue via cancel token\n- [ ] Merges all chunk results into single array\n- [ ] Deduplicates similar tasks (same title/description)\n- [ ] 10 tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:08:08.890779+03:00","created_by":"deligoez","updated_at":"2026-01-12T03:30:19.897597+03:00","closed_at":"2026-01-12T03:30:19.897597+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-r1p","depends_on_id":"ch-3xt","type":"blocks","created_at":"2026-01-11T03:08:08.894013+03:00","created_by":"deligoez"},{"issue_id":"ch-r1p","depends_on_id":"ch-8le","type":"blocks","created_at":"2026-01-11T03:08:08.896266+03:00","created_by":"deligoez"},{"issue_id":"ch-r1p","depends_on_id":"ch-2hw","type":"blocks","created_at":"2026-01-11T03:08:08.898029+03:00","created_by":"deligoez"}]}
{"id":"ch-r37z","title":"E2E-06: Task Navigation (j/k)","description":"## What\nVerify j/k keys navigate task list.\n\n## Tests (4 tests)\n1. j moves selection down\n2. k moves selection up\n3. Selection stops at boundaries\n4. Arrow keys also work\n\n## Files\n- src/e2e/task-navigation.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T21:18:00.190428+03:00","created_by":"deligoez","updated_at":"2026-01-11T23:30:25.417086+03:00","closed_at":"2026-01-11T23:30:25.417086+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-r37z","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:18:00.192973+03:00","created_by":"deligoez"},{"issue_id":"ch-r37z","depends_on_id":"ch-b8l","type":"blocks","created_at":"2026-01-11T21:18:00.195276+03:00","created_by":"deligoez"}]}
{"id":"ch-revn","title":"SP04: Sprint Progress Bar - Status bar integration for active sprint","description":"## What\nStatus bar component showing sprint progress.\n\n## Acceptance Criteria\n- [ ] Shows \"SPRINT │ N/M tasks │ X failed │ target │ time left\"\n- [ ] Updates task counts in real-time (completed/total)\n- [ ] Shows elapsed/remaining time based on target type\n- [ ] Hidden when no active sprint (sprint region in idle)\n- [ ] 4 tests pass\n\n## Files\n- src/components/SprintProgressBar.tsx\n- src/components/SprintProgressBar.test.tsx","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T15:13:08.59495+03:00","created_by":"deligoez","updated_at":"2026-01-12T17:40:30.026849+03:00","closed_at":"2026-01-12T17:40:30.026849+03:00","close_reason":"Closed","labels":["m13b-sprint"],"dependencies":[{"issue_id":"ch-revn","depends_on_id":"ch-pjge","type":"blocks","created_at":"2026-01-12T15:13:08.597211+03:00","created_by":"deligoez"}]}
{"id":"ch-rmg","title":"F82a: Plan Agent Prompt Builder","description":"## What\nBuild system prompt for Plan Agent from config and rules.\n\n## Files\n- `src/services/PlanAgentPromptBuilder.ts`\n- `src/services/PlanAgentPromptBuilder.test.ts`\n\n## Dependencies\n- F88 (ch-j40): PatternsManager for PATTERNS.md injection\n\n## Acceptance Criteria\n- [ ] `build(config: ChorusConfig)` returns full system prompt string\n- [ ] Includes core task rules (atomic, testable, right-sized)\n- [ ] Includes configurable limits from task-rules.md\n- [ ] Parses `max_acceptance_criteria` limit from task-rules.md\n- [ ] Parses `max_description_length` limit from task-rules.md\n- [ ] Parses optional rule checkboxes (require_test_file, enforce_naming, forbidden_words)\n- [ ] Template includes rule configuration as agent context\n- [ ] Includes patterns from PATTERNS.md via PatternsManager\n- [ ] Includes quality commands for agent awareness\n- [ ] Includes project type context (Node, PHP, etc.)\n- [ ] Template is readable markdown format\n- [ ] Handles missing PATTERNS.md gracefully (empty section)\n- [ ] Handles missing task-rules.md gracefully (defaults only)\n- [ ] Returns valid markdown prompt\n- [ ] 14 tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:06:29.985893+03:00","created_by":"deligoez","updated_at":"2026-01-12T02:39:41.129336+03:00","closed_at":"2026-01-12T02:39:41.129336+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-rmg","depends_on_id":"ch-j40","type":"blocks","created_at":"2026-01-11T03:06:29.990088+03:00","created_by":"deligoez"}]}
{"id":"ch-rwv5","title":"E2E-15: Pause/Resume (Space)","description":"## What\nVerify Space toggles pause state.\n\n## Tests (3 tests)\n1. Space pauses orchestration\n2. Agents show paused indicator\n3. Space again resumes\n\n## Files\n- src/e2e/pause-resume.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T21:18:25.446326+03:00","created_by":"deligoez","updated_at":"2026-01-12T05:18:21.189203+03:00","closed_at":"2026-01-12T05:18:21.189203+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-rwv5","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:18:25.448488+03:00","created_by":"deligoez"},{"issue_id":"ch-rwv5","depends_on_id":"ch-2gt","type":"blocks","created_at":"2026-01-11T21:18:25.450391+03:00","created_by":"deligoez"}]}
{"id":"ch-rxbf","title":"E2E-58: Full Agent Lifecycle","description":"## What\nE2E tests for complete agent workflow from spawn to task completion.\n\n## Acceptance Criteria\n- [ ] Agent spawns with correct worktree/branch\n- [ ] Agent executes quality commands in order\n- [ ] Quality command failures trigger retry loop\n- [ ] All quality commands pass → task marked complete\n- [ ] Worktree cleanup after completion\n- [ ] Integration with Beads task closure\n- [ ] Agent output captured correctly\n- [ ] 10 tests pass\n\n## Files\n- src/e2e/agent-lifecycle.e2e.test.ts\n\n## Implementation Notes\n- Use createGitRepoWithChorus() helper\n- Create minimal package.json for quality commands\n- Test full spawn → execute → complete cycle","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T00:39:03.651976+03:00","created_by":"deligoez","updated_at":"2026-01-12T00:51:15.298085+03:00","closed_at":"2026-01-12T00:51:15.298085+03:00","close_reason":"Closed","labels":["m4-orchestration"],"dependencies":[{"issue_id":"ch-rxbf","depends_on_id":"ch-qz9m","type":"blocks","created_at":"2026-01-12T00:39:03.654723+03:00","created_by":"deligoez"},{"issue_id":"ch-rxbf","depends_on_id":"ch-glq","type":"blocks","created_at":"2026-01-12T00:39:03.657345+03:00","created_by":"deligoez"},{"issue_id":"ch-rxbf","depends_on_id":"ch-k3d","type":"blocks","created_at":"2026-01-12T00:39:03.659489+03:00","created_by":"deligoez"},{"issue_id":"ch-rxbf","depends_on_id":"ch-uoa","type":"blocks","created_at":"2026-01-12T00:39:03.661596+03:00","created_by":"deligoez"},{"issue_id":"ch-rxbf","depends_on_id":"ch-dzz","type":"blocks","created_at":"2026-01-12T00:39:03.663868+03:00","created_by":"deligoez"}]}
{"id":"ch-s8u","title":"F101a: TUI Learning Review Trigger","description":"## What\nTUI component for manually triggering learning review via keyboard shortcut.\n\n## Acceptance Criteria\n- [ ] `LearningReviewTrigger` React component exists\n- [ ] Displays unreviewed learning count in status bar: \"📚 Learnings: 3 new\"\n- [ ] `Ctrl+L` shortcut triggers learning review (if unreviewed learnings exist)\n- [ ] `Shift+L` shortcut forces review (even if no new learnings)\n- [ ] Shows \"📖 All reviewed\" when no unreviewed learnings\n- [ ] Disables Ctrl+L when no unreviewed learnings (shows tooltip)\n- [ ] Opens LearningReviewDialog when triggered\n- [ ] Dialog shows list of learnings with categories (LOCAL, CROSS-CUTTING, ARCHITECTURAL)\n- [ ] Dialog has [R] Run Review, [S] Skip LOCAL, [C] Cancel buttons\n- [ ] Integrates with F97 Plan Review Integration for actual review\n- [ ] 10 tests pass\n\n## Keyboard Shortcuts\n| Shortcut | Action | Condition |\n|----------|--------|-----------|\n| Ctrl+L | Review learnings | If unreviewed learnings exist |\n| Shift+L | Force review | Always enabled |\n\n## Files\n- src/components/LearningReviewTrigger.tsx\n- src/components/LearningReviewDialog.tsx\n- tests/components/LearningReviewTrigger.test.tsx","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T09:18:01.342808+03:00","created_by":"deligoez","updated_at":"2026-01-12T12:54:09.580143+03:00","closed_at":"2026-01-12T12:54:09.580143+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-s8u","depends_on_id":"ch-c3q","type":"blocks","created_at":"2026-01-11T09:18:01.345509+03:00","created_by":"deligoez"},{"issue_id":"ch-s8u","depends_on_id":"ch-yhq","type":"blocks","created_at":"2026-01-11T14:01:50.78314+03:00","created_by":"deligoez"}]}
{"id":"ch-s95t","title":"BUG: Fix E2E tests using cli-testing-library","description":"## What\n41 E2E tests fail when spawning the actual app via cli-testing-library.\n\n## Investigation Findings\n\n### Root Causes\n1. **Text assertion mismatches** - Tests look for text that doesn't match actual UI:\n   - \"Chorus\" vs \"CHORUS\" (uppercase in header)\n   - \"quit\" vs \"? help\" (footer hint text)\n   - \"0 agents\" vs \"0/4\" (agent slots format)\n   - \"No agents running\" vs \"[empty slot]\" (grid content)\n\n2. **Timing/timeout issues** - Some tests timeout waiting for app to render\n   - Possible race conditions with temp directory setup\n   - App startup time varies based on project state\n\n3. **Infrastructure issues** - cli-testing-library spawns actual Node process:\n   - Requires `npm run build` first\n   - DEP0190 deprecation warnings from shell:true usage\n   - TTY simulation complexity\n\n### Partial Fixes Applied\n- Fixed text assertions in 10 test files\n- Changed \"Chorus\" → \"CHORUS\", \"quit\" → \"help\", \"agents\" → \"empty slot\"\n- 5+ tests now passing that were failing\n\n### Recommendation\n**Use ink-testing-library** for E2E testing instead of cli-testing-library:\n- Faster execution (no process spawn)\n- No TTY simulation issues\n- Better timing control\n- Component-level testing with real hooks\n\nWorking examples in:\n- src/e2e/clean-exit.e2e.test.tsx\n- src/e2e/merge-queue-view.e2e.test.tsx\n- src/e2e/full-workflow.e2e.test.tsx\n- src/e2e/tui-integration.e2e.test.tsx\n\n### Files to Review\n36 tests still fail across these files:\n- mode-initialization.e2e.test.ts (8 tests)\n- task-panel.e2e.test.ts (3 tests)\n- panel-focus.e2e.test.ts (3 tests)\n- initial-load.e2e.test.ts (3 tests)\n- fresh-init.e2e.test.ts (2 tests)\n- And ~17 more\n\n## Acceptance Criteria\n- [x] Investigate why E2E tests fail\n- [x] Fix app render issues in test environment (partial - text assertions fixed)\n- [ ] All 41 E2E tests pass (36 still failing - deferred)\n- [x] Document E2E test requirements\n\n## Files\n- src/e2e/*.e2e.test.ts\n- src/test-utils/e2e-helpers.ts\n\nLabels: [bug]","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T09:15:01.017795+03:00","created_by":"deligoez","updated_at":"2026-01-12T10:07:03.132877+03:00","closed_at":"2026-01-12T10:07:03.132877+03:00","close_reason":"Investigated and partially fixed. 5+ tests pass. 36 remaining need text fixes or ink-testing-library migration. See task body for docs.","labels":["bug"]}
{"id":"ch-sb7","title":"F46: Task Block - Manually block task and stop agent","description":"## What\nManually mark a task as blocked, stopping any agent working on it.\n\n## Design Decision: Blocked = Label (not Status)\n\n**Why label instead of status:**\n- Beads standard statuses: open, in_progress, closed\n- \"blocked\" is a modifier, not a state\n- Task can be \"open + blocked\" (ready to unblock)\n- Consistent with \"deferred\" (also a label)\n- BeadsCLI.getReadyTasks() excludes blocked labels\n\n## Context from Master Plan\n```\n7. BLOCK TASK (b)\n   - Manually mark task as blocked\n   - Agent stops, picks different task\n```\n\n## API\n```typescript\n// src/services/TaskBlocker.ts\n\nclass TaskBlocker {\n  constructor(\n    private agentStopper: AgentStopper,\n    private beadsCLI: BeadsCLI\n  ) {}\n\n  /**\n   * Block a task manually\n   * - If agent running on task, stop it via agentStopper.stopAgentByTask()\n   * - Add \"blocked\" label via beadsCLI.addLabel(taskId, 'blocked')\n   * - Set task status to \"open\" if was in_progress\n   * - Record block reason in task notes\n   */\n  async blockTask(taskId: string, reason: string): Promise\u003cInterventionResult\u003e\n\n  /**\n   * Unblock a task\n   * - Remove \"blocked\" label via beadsCLI.removeLabel(taskId, 'blocked')\n   * - Task remains open, now appears in getReadyTasks()\n   */\n  async unblockTask(taskId: string): Promise\u003cInterventionResult\u003e\n\n  /**\n   * Check if task is manually blocked\n   * - Checks for \"blocked\" label in task.labels\n   */\n  async isBlocked(taskId: string): Promise\u003cboolean\u003e\n}\n```\n\n## Files\n- src/services/TaskBlocker.ts\n- tests/services/TaskBlocker.test.ts\n\n## Acceptance Criteria\n- [ ] `blockTask()` calls agentStopper.stopAgentByTask() if agent running\n- [ ] `blockTask()` adds \"blocked\" label via beadsCLI\n- [ ] `blockTask()` sets status to \"open\" if was in_progress\n- [ ] `blockTask()` records reason in task notes\n- [ ] `blockTask()` returns InterventionResult with stopped agent if any\n- [ ] `unblockTask()` removes \"blocked\" label\n- [ ] `unblockTask()` returns success even if not blocked\n- [ ] `isBlocked()` checks task.labels for \"blocked\"\n- [ ] 8 tests pass\n\n## Tests\n1. blockTask() stops running agent\n2. blockTask() adds blocked label\n3. blockTask() sets status to open\n4. blockTask() records reason\n5. blockTask() returns affectedAgents when agent stopped\n6. unblockTask() removes blocked label\n7. unblockTask() when not blocked is OK\n8. isBlocked() checks labels correctly\n\n## Notes\n- **Blocked = label, not status** (design decision)\n- BeadsCLI.getReadyTasks({ excludeLabels: ['blocked', 'deferred'] })\n- Blocked tasks visible in TUI (grayed out) but not auto-assigned","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T10:44:00.289314+03:00","created_by":"deligoez","updated_at":"2026-01-11T23:04:52.680267+03:00","closed_at":"2026-01-11T23:04:52.680267+03:00","close_reason":"Closed","labels":["m9-intervention"],"dependencies":[{"issue_id":"ch-sb7","depends_on_id":"ch-ahq","type":"blocks","created_at":"2026-01-10T10:44:00.290809+03:00","created_by":"deligoez"},{"issue_id":"ch-sb7","depends_on_id":"ch-cwy","type":"blocks","created_at":"2026-01-10T10:44:00.292179+03:00","created_by":"deligoez"},{"issue_id":"ch-sb7","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-10T12:16:20.871911+03:00","created_by":"deligoez"}]}
{"id":"ch-shmx","title":"CHORE: Fix E2E tests for TUI text wrapping","description":"## What\nFix E2E tests that fail due to TUI text wrapping splitting titles across lines.\n\n## Root Cause\nThe TUI layout causes task titles to wrap across multiple lines (e.g., \"First Test Task\" becomes \"First Test\\nTask\" in the output). Tests that waitForText() or toContain() with full titles fail.\n\n## Solution\n1. Add normalizeOutput() helper to e2e-helpers.ts\n2. Update tests to wait for \"Tasks (N)\" header instead of full titles\n3. Assert using short task IDs (e.g., \"abc1\") instead of full titles\n4. Use status indicators (→, ●, ✓, ⊗) to verify task states\n\n## Files Changed\n- src/test-utils/e2e-helpers.ts (added normalizeOutput helpers)\n- src/e2e/task-panel.e2e.test.ts\n- src/e2e/status-transitions.e2e.test.ts\n- src/e2e/redirect-agent.e2e.test.ts\n- Multiple other E2E test files\n\n## Acceptance Criteria\n- [ ] All 65 E2E test files pass\n- [ ] No test waits for full task titles that may wrap\n- [ ] Tests use reliable identifiers (short IDs, status indicators)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T10:50:04.993346+03:00","created_by":"deligoez","updated_at":"2026-01-12T11:39:29.133746+03:00","closed_at":"2026-01-12T11:39:29.133746+03:00","close_reason":"Covered by earlier E2E test fixes and documentation updates","labels":["m12-tui"]}
{"id":"ch-sj4o","title":"E2E-55: Rollback Services Integration Tests","description":"## What\nE2E tests for IterationRollback and TaskRollback with real git operations.\n\n## Acceptance Criteria\n- [ ] IterationRollback resets last N commits (soft reset)\n- [ ] TaskRollback reverts all commits with task ID tag\n- [ ] Rollback preserves working directory state\n- [ ] Handles no commits to rollback gracefully\n- [ ] Identifies commits by [ch-xxx] tag pattern\n- [ ] 6 tests pass\n\n## Files\n- src/e2e/rollback-services.e2e.test.ts\n\n## Implementation Notes\n- Use createGitRepoWithChorus() helper\n- Create commits with [ch-xxx] tags\n- Verify commit history after rollback\n- Test both soft reset and revert operations","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T00:08:34.901815+03:00","created_by":"deligoez","updated_at":"2026-01-12T02:15:14.694961+03:00","closed_at":"2026-01-12T02:15:14.694961+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-sj4o","depends_on_id":"ch-c8j","type":"blocks","created_at":"2026-01-12T00:08:48.777608+03:00","created_by":"deligoez"},{"issue_id":"ch-sj4o","depends_on_id":"ch-ofm","type":"blocks","created_at":"2026-01-12T00:08:48.871728+03:00","created_by":"deligoez"}]}
{"id":"ch-sl9","title":"F62a: BlockedTaskInfo Component - Show blocker information","description":"## What\nComponent to show blocker information for a blocked task.\n\n## Context from Master Plan\n```\n│ ⊗ ch-005 [P3] Refactor         │\n│   blocked by ch-001            │\n```\n\n## API\n```typescript\n// src/components/BlockedTaskInfo.tsx\n\ninterface BlockedTaskInfoProps {\n  blockers: Array\u003c{\n    id: string;\n    status: 'open' | 'in_progress' | 'closed';\n  }\u003e;\n}\n\nfunction BlockedTaskInfo({ blockers }: BlockedTaskInfoProps): JSX.Element\n```\n\n## Visual Output\n- Single blocker: `└─ Waiting: ch-001 (in_progress)`\n- Multiple blockers: `└─ Waiting: ch-001, ch-002`\n\n## Files\n- src/components/BlockedTaskInfo.tsx\n- src/components/BlockedTaskInfo.test.tsx\n\n## Acceptance Criteria\n- [ ] Shows \"Waiting:\" prefix\n- [ ] Shows blocker ID(s)\n- [ ] Shows blocker status in parentheses for single blocker\n- [ ] Comma-separates multiple blockers (no status shown)\n- [ ] Uses tree branch character (└─)\n- [ ] Uses dim styling (Ink: dimColor prop on Text)\n- [ ] Returns null for empty blockers array\n- [ ] 7 tests pass\n\n## Tests\n1. Shows single blocker with status in parentheses\n2. Shows multiple blockers comma-separated without status\n3. Uses \"Waiting:\" prefix\n4. Uses tree branch character\n5. Uses dim styling\n6. Returns null for empty blockers array\n7. Handles mixed statuses in multiple blockers","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:51:46.480784+03:00","created_by":"deligoez","updated_at":"2026-01-11T21:03:34.169242+03:00","closed_at":"2026-01-11T21:03:34.169242+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-sl9","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:53.728734+03:00","created_by":"deligoez"}]}
{"id":"ch-sm8","title":"F93: Learning Categorizer","description":"## What\nSmart categorization of learnings using heuristics when explicit scope prefix is missing.\n\n## Why\nAgents may not always add explicit `[LOCAL]`, `[CROSS-CUTTING]`, `[ARCHITECTURAL]` prefixes. This service provides intelligent fallback detection to ensure learnings are properly categorized.\n\n## Relationship with F40\n\n**F40 (Learning Extractor):**\n- Parses explicit prefixes: `[LOCAL]`, `[CROSS-CUTTING]`, `[ARCHITECTURAL]`\n- Returns `scope: 'local'` as default when no prefix found\n\n**F93 (Learning Categorizer) - THIS TASK:**\n- Runs AFTER F40 when F40 returns default `scope: 'local'`\n- Uses heuristics to detect if learning should actually be cross-cutting/architectural\n- Only activates when no explicit prefix was found\n\n## Heuristic Rules\n\n| Pattern | Detected Scope | Example |\n|---------|----------------|---------|\n| \"all\", \"every\", \"always\" | cross-cutting | \"All API calls need rate limiting\" |\n| \"architecture\", \"system-wide\" | architectural | \"Architecture should use event sourcing\" |\n| \"global\", \"everywhere\" | cross-cutting | \"Error handling needed everywhere\" |\n| \"design decision\", \"pattern\" | architectural | \"Design decision: use Repository pattern\" |\n| None matched | local (keep default) | \"This function needs memoization\" |\n\n## API\n```typescript\n// src/services/LearningCategorizer.ts\n\ntype LearningScope = 'local' | 'cross-cutting' | 'architectural';\n\ninterface CategorizationResult {\n  scope: LearningScope;\n  confidence: 'explicit' | 'heuristic' | 'default';\n  matchedPattern?: string;  // Which heuristic matched\n}\n\nclass LearningCategorizer {\n  /**\n   * Categorize learning using heuristics.\n   * Only called when F40.detectScope() returned default 'local'.\n   */\n  categorize(text: string): CategorizationResult;\n\n  /**\n   * Check if text contains cross-cutting indicators\n   */\n  hasCrossCuttingIndicators(text: string): boolean;\n\n  /**\n   * Check if text contains architectural indicators\n   */\n  hasArchitecturalIndicators(text: string): boolean;\n\n  /**\n   * Get all matched patterns for debugging/logging\n   */\n  getMatchedPatterns(text: string): string[];\n}\n```\n\n## Integration Point\n\n```typescript\n// In CompletionHandler (F16a):\nconst learnings = extractor.parse(content, taskId, agentType);\n\nfor (const learning of learnings) {\n  if (learning.scope === 'local') {\n    // F40 returned default - try heuristics\n    const result = categorizer.categorize(learning.content);\n    if (result.confidence === 'heuristic') {\n      learning.scope = result.scope;\n    }\n  }\n}\n```\n\n## Files\n- src/services/LearningCategorizer.ts\n- tests/services/LearningCategorizer.test.ts\n\n## Acceptance Criteria\n\n### categorize() - 4 tests\n- [ ] Returns `{ scope: 'cross-cutting', confidence: 'heuristic' }` for \"All endpoints need X\"\n- [ ] Returns `{ scope: 'architectural', confidence: 'heuristic' }` for \"Architecture should Y\"\n- [ ] Returns `{ scope: 'local', confidence: 'default' }` for \"This function needs Z\"\n- [ ] Returns matchedPattern showing which rule triggered\n\n### Indicator Methods - 3 tests\n- [ ] `hasCrossCuttingIndicators()` detects \"all\", \"every\", \"always\", \"global\"\n- [ ] `hasArchitecturalIndicators()` detects \"architecture\", \"design decision\", \"system-wide\"\n- [ ] Both are case-insensitive\n\n### Edge Cases - 2 tests\n- [ ] Handles empty string (returns local/default)\n- [ ] Handles text with multiple indicators (architectural \u003e cross-cutting)\n\n### Summary\n- [ ] 9 tests pass\n\n## Notes\n- This is a FALLBACK layer, not primary categorization\n- Explicit prefixes always win (handled by F40)\n- Heuristics are conservative - prefer false negative over false positive\n- Log heuristic matches for debugging/tuning","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-11T08:43:40.112491+03:00","created_by":"deligoez","updated_at":"2026-01-12T10:30:48.222599+03:00","closed_at":"2026-01-12T10:30:48.222599+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-sm8","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:54.51025+03:00","created_by":"deligoez"}]}
{"id":"ch-sot9","title":"FR05: Completion Result Storage - Save task completion results to JSON","description":"## What\nSave and load task completion results from .chorus/completions/ directory.\n\n## Acceptance Criteria\n- [ ] `saveCompletionResult(taskId, result)` writes to `.chorus/completions/{taskId}.json`\n- [ ] Creates `.chorus/completions/` directory if not exists\n- [ ] `loadCompletionResult(taskId)` returns parsed JSON for existing file\n- [ ] `loadCompletionResult(taskId)` returns `null` for non-existent file\n- [ ] Handles JSON parse errors gracefully (returns `null`, logs error)\n- [ ] 6 tests pass\n\n## Files\n- src/services/CompletionResultStorage.ts\n- src/services/CompletionResultStorage.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:11:21.887949+03:00","created_by":"deligoez","updated_at":"2026-01-12T15:24:31.854886+03:00","closed_at":"2026-01-12T15:24:31.854886+03:00","close_reason":"Closed","labels":["m13-review"],"dependencies":[{"issue_id":"ch-sot9","depends_on_id":"ch-zjlr","type":"blocks","created_at":"2026-01-12T15:11:21.891195+03:00","created_by":"deligoez"}]}
{"id":"ch-sq1n","title":"E2E-09: Full User Flows","description":"## What\nE2E tests for complete user workflows from start to finish.\n\n## Tests (10 tests)\n\n### Basic Workflow\n1. Start app → Select task → Spawn agent → Agent completes → Task done\n2. Start app → Create new task → Assign to agent → Monitor progress\n\n### Semi-Auto Workflow\n3. Semi-auto mode: manual task selection, auto agent spawn\n4. Semi-auto mode: intervention on failure\n\n### Autopilot Workflow\n5. Autopilot mode: auto task selection, auto agent spawn\n6. Autopilot mode: pause, manual intervention, resume\n\n### Error Handling\n7. Agent failure → Retry flow\n8. Agent failure → Rollback flow\n\n### Edge Cases\n9. Empty task list handling\n10. Max agents reached handling\n\n## Files\n- src/e2e/user-flows.e2e.test.ts (NEW)\n\n## Depends On\nAll other E2E test tasks (runs after all features tested)\n\n## Notes\nThese are integration tests that verify complete user journeys.\nEach test simulates a real user session from start to finish.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-11T21:16:38.167548+03:00","created_by":"deligoez","updated_at":"2026-01-11T21:23:25.353492+03:00","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-sq1n","depends_on_id":"ch-kf7a","type":"blocks","created_at":"2026-01-11T21:16:38.170659+03:00","created_by":"deligoez"},{"issue_id":"ch-sq1n","depends_on_id":"ch-7qez","type":"blocks","created_at":"2026-01-11T21:16:38.173353+03:00","created_by":"deligoez"},{"issue_id":"ch-sq1n","depends_on_id":"ch-lu60","type":"blocks","created_at":"2026-01-11T21:16:38.174929+03:00","created_by":"deligoez"},{"issue_id":"ch-sq1n","depends_on_id":"ch-h1n6","type":"blocks","created_at":"2026-01-11T21:16:38.176805+03:00","created_by":"deligoez"},{"issue_id":"ch-sq1n","depends_on_id":"ch-mu56","type":"blocks","created_at":"2026-01-11T21:16:38.178521+03:00","created_by":"deligoez"},{"issue_id":"ch-sq1n","depends_on_id":"ch-lr1k","type":"blocks","created_at":"2026-01-11T21:16:38.181276+03:00","created_by":"deligoez"},{"issue_id":"ch-sq1n","depends_on_id":"ch-2oin","type":"blocks","created_at":"2026-01-11T21:16:38.184049+03:00","created_by":"deligoez"}],"deleted_at":"2026-01-11T21:23:25.353492+03:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"ch-sqko","title":"E2E-34: Focus Management","description":"## What\nE2E test for focus management between panels.\n\n## Acceptance Criteria\n- [ ] Tab cycles through focusable panels\n- [ ] Focus indicator visible on active panel\n- [ ] Keyboard shortcuts work only in focused panel\n- [ ] Modal focus traps keyboard events\n- [ ] 4 tests pass\n\n## Test Cases\n1. `it('Tab cycles through panels')`\n2. `it('shows focus indicator on active panel')`\n3. `it('shortcuts scoped to focused panel')`\n4. `it('modal traps keyboard focus')`\n\n## Files\n- tests/e2e/focus-management.test.ts\n\n## Dependencies\n- ch-0e01 (E2E Infrastructure)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:22:08.432004+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:51:48.454824+03:00","closed_at":"2026-01-12T01:51:48.454824+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-sqko","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:22:08.435202+03:00","created_by":"deligoez"}]}
{"id":"ch-sro","title":"F01b: Config Load - Read config from .chorus/config.json","description":"## What\nLoad configuration from .chorus/config.json file.\n\n## Acceptance Criteria\n- [ ] load() reads and parses JSON file\n- [ ] Returns default config if file doesn't exist\n- [ ] Throws on invalid JSON\n- [ ] Caches loaded config\n- [ ] get() returns cached config (calls load if not cached)\n- [ ] exists() checks if config file exists\n- [ ] load() reads qualityCommands array from config\n- [ ] load() reads project.taskIdPrefix from config\n- [ ] load() migrates legacy testCommand to qualityCommands array (backwards compat)\n- [ ] 9 tests pass\n\n## Files\n- src/services/ConfigService.ts (NEW - partial)\n- tests/services/ConfigService.test.ts (NEW)\n\n## Implementation\n```typescript\nexport class ConfigService {\n  private configPath: string;\n  private config: ChorusConfig | null = null;\n  \n  constructor(projectDir: string) {\n    this.configPath = path.join(projectDir, '.chorus', 'config.json');\n  }\n  \n  load(): ChorusConfig {\n    if (!fs.existsSync(this.configPath)) {\n      this.config = getDefaultConfig();\n      return this.config;\n    }\n    const raw = JSON.parse(fs.readFileSync(this.configPath, 'utf-8'));\n    // Migrate legacy testCommand to qualityCommands\n    if (raw.project?.testCommand \u0026\u0026 !raw.qualityCommands) {\n      raw.qualityCommands = [{\n        name: 'test',\n        command: raw.project.testCommand,\n        required: true,\n        order: 0\n      }];\n      delete raw.project.testCommand;\n    }\n    this.config = raw;\n    return this.config;\n  }\n  \n  get(): ChorusConfig {\n    if (!this.config) return this.load();\n    return this.config;\n  }\n  \n  exists(): boolean {\n    return fs.existsSync(this.configPath);\n  }\n}\n```\n\n## Test Cases\n1. load() returns defaults when file missing\n2. load() parses existing config file\n3. load() throws on malformed JSON\n4. get() returns cached config\n5. get() calls load() if not cached\n6. exists() returns false when no file\n7. load() reads qualityCommands array from config\n8. load() reads project.taskIdPrefix from config\n9. load() migrates legacy testCommand to qualityCommands array","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T01:30:22.3151+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:49:55.127548+03:00","closed_at":"2026-01-11T18:49:55.127548+03:00","close_reason":"Closed","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-sro","depends_on_id":"ch-2n6","type":"blocks","created_at":"2026-01-10T01:30:22.316939+03:00","created_by":"deligoez"}]}
{"id":"ch-suuw","title":"TS05a: List with Filters","description":"## What\nImplement list() method with filtering capabilities.\n\n## Files\n- `src/services/TaskStore.ts`\n- `src/services/TaskStore.test.ts`\n\n## Acceptance Criteria\n- [ ] `list(filters?)` returns tasks matching filters\n- [ ] Filter by status (single or array)\n- [ ] Filter by type (single or array)\n- [ ] Filter by tags (match ANY)\n- [ ] Filter by excludeTags (exclude if ANY)\n- [ ] Excludes deleted tasks by default\n- [ ] 6 tests pass","status":"in_progress","priority":0,"issue_type":"task","created_at":"2026-01-13T00:12:58.51661+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:38:31.937678+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-suuw","depends_on_id":"ch-3oot","type":"blocks","created_at":"2026-01-13T00:12:58.519037+03:00","created_by":"deligoez"}]}
{"id":"ch-swsi","title":"FR04: Auto-Approve Engine - Evaluate tasks for auto-approval","description":"## What\nEvaluate tasks for auto-approval based on config and labels.\n\n## Acceptance Criteria\n- [ ] `canAutoApprove(result, config)` returns `true` when quality passed, iterations ≤ max, signal DONE\n- [ ] Returns `false` when quality failed\n- [ ] Returns `false` when iterations \u003e config.maxIterations\n- [ ] Returns `false` when signal not DONE\n- [ ] Returns `false` when task has `review:per-task` label (force review)\n- [ ] Returns `true` when task has `review:skip` label (regardless of quality)\n- [ ] Returns `false` when `config.enabled = false`\n- [ ] 8 tests pass\n\n## Files\n- src/services/AutoApproveEngine.ts\n- src/services/AutoApproveEngine.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:11:20.585698+03:00","created_by":"deligoez","updated_at":"2026-01-12T15:36:49.870754+03:00","closed_at":"2026-01-12T15:36:49.870754+03:00","close_reason":"Closed","labels":["m13-review"],"dependencies":[{"issue_id":"ch-swsi","depends_on_id":"ch-zjlr","type":"blocks","created_at":"2026-01-12T15:11:20.588447+03:00","created_by":"deligoez"}]}
{"id":"ch-szqm","title":"E2E-R00: Task List Navigation E2E - Navigate task list with j/k keys","description":"## What\nE2E test for j/k task list navigation.\n\n## Acceptance Criteria\n- [ ] Create project with 3 tasks\n- [ ] Press j, verify selection moves to second task\n- [ ] Press j again, verify selection moves to third task\n- [ ] Press k, verify selection moves back to second task\n- [ ] Verify TaskPanel shows `►` on selected task\n- [ ] 5 tests pass\n\n## Files\n- src/e2e/task-navigation.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:13:49.602076+03:00","created_by":"deligoez","updated_at":"2026-01-12T16:14:56.732942+03:00","closed_at":"2026-01-12T16:14:56.732942+03:00","close_reason":"Closed","labels":["m13-review"],"dependencies":[{"issue_id":"ch-szqm","depends_on_id":"ch-cq1q","type":"blocks","created_at":"2026-01-12T15:13:49.604858+03:00","created_by":"deligoez"}]}
{"id":"ch-t31","title":"F27: Auto-Resolver","description":"## What\nAutomatically resolve SIMPLE conflicts per master plan classification.\n\n## SIMPLE Conflict Files (per Master Plan)\n\nEach file type has a concrete, testable strategy:\n\n### 1. `.beads/issues.jsonl` - \"beads-merge\"\n**Strategy:** Accept both versions (JSONL is append-only)\n```typescript\n// Input: conflicting JSONL\n\u003c\u003c\u003c\u003c\u003c\u003c\u003c HEAD\n{\"id\": \"ch-abc\", \"title\": \"Task A\"}\n=======\n{\"id\": \"ch-xyz\", \"title\": \"Task B\"}\n\u003e\u003e\u003e\u003e\u003e\u003e\u003e feature\n\n// Output: both lines preserved\n{\"id\": \"ch-abc\", \"title\": \"Task A\"}\n{\"id\": \"ch-xyz\", \"title\": \"Task B\"}\n```\n**Test:** Parse both sides, concatenate, dedupe by id\n\n### 2. `package-lock.json` - \"regenerate\"\n**Strategy:** Delete conflicted file, run `npm install`\n```typescript\n// Mock: FileService.delete() + ProcessRunner.exec('npm install')\n// Verify: delete called, npm install called, returns success\n```\n**Test:** Verify correct commands called via mocks\n\n### 3. `.agent/learnings.md` - \"append-dedup\"\n**Strategy:** Parse markdown sections, merge, deduplicate by heading\n```typescript\n// Input: conflicting learnings\n\u003c\u003c\u003c\u003c\u003c\u003c\u003c HEAD\n## Pattern: Config Loading\nLoad config from file...\n=======\n## Pattern: Error Handling\nHandle errors gracefully...\n\u003e\u003e\u003e\u003e\u003e\u003e\u003e feature\n\n// Output: both sections preserved\n## Pattern: Config Loading\nLoad config from file...\n\n## Pattern: Error Handling\nHandle errors gracefully...\n```\n**Test:** Extract headings, concatenate sections, dedupe by heading text\n\n### 4. Auto-generated files - \"regenerate-command\"\n**Strategy:** Run configured command to regenerate\n```typescript\nconst AUTO_GENERATED: Record\u003cstring, string\u003e = {\n  'src/generated/types.ts': 'npm run generate:types',\n  'docs/api.md': 'npm run docs:generate',\n};\n```\n**Test:** Verify configured command executed via ProcessRunner mock\n\n## Mocking Strategy\n\n```typescript\ninterface FileService {\n  read(path: string): Promise\u003cstring\u003e;\n  write(path: string, content: string): Promise\u003cvoid\u003e;\n  delete(path: string): Promise\u003cvoid\u003e;\n}\n\ninterface ProcessRunner {\n  exec(command: string): Promise\u003c{ stdout: string; exitCode: number }\u003e;\n}\n\nclass AutoResolver {\n  constructor(\n    private files: FileService = new RealFileService(),\n    private process: ProcessRunner = new RealProcessRunner()\n  ) {}\n}\n```\n\n## Acceptance Criteria\n\n### resolveSpecialFile() - 4 tests\n- [ ] `.beads/issues.jsonl`: Concatenates both JSONL versions, dedupes by id\n- [ ] `package-lock.json`: Calls `files.delete()` then `process.exec('npm install')`\n- [ ] `.agent/learnings.md`: Parses markdown, merges sections, dedupes by heading\n- [ ] Auto-generated file: Calls `process.exec()` with configured command\n\n### canResolve() - 2 tests\n- [ ] Returns `true` for SIMPLE conflict types\n- [ ] Returns `true` when `filepath` matches key in `SIMPLE_FILES`\n\n### resolve() - 4 tests\n- [ ] Returns `{ success: true }` when SIMPLE file resolved\n- [ ] Returns `{ success: false }` for non-SIMPLE conflicts\n- [ ] Returns `{ success: false, error: message }` when FileService throws\n- [ ] Returns `{ success: false, error: message }` when ProcessRunner throws\n\n### Summary\n- [ ] 10 tests pass\n\n## Files\n- src/services/AutoResolver.ts\n- src/services/FileService.ts (interface + RealFileService)\n- src/services/ProcessRunner.ts (interface + RealProcessRunner)\n- tests/services/AutoResolver.test.ts\n- tests/mocks/MockFileService.ts\n- tests/mocks/MockProcessRunner.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T03:16:42.288688+03:00","created_by":"deligoez","updated_at":"2026-01-11T19:27:29.734765+03:00","closed_at":"2026-01-11T19:27:29.734765+03:00","close_reason":"Closed","labels":["m5-merge"],"dependencies":[{"issue_id":"ch-t31","depends_on_id":"ch-7pb","type":"blocks","created_at":"2026-01-10T03:16:42.291207+03:00","created_by":"deligoez"}]}
{"id":"ch-t9c2","title":"BUG: Add tests for AgentSpawner service","description":"## What\nAgentSpawner service has no unit tests.\n\n## Current State\n- src/services/AgentSpawner.ts exists\n- No corresponding test file\n\n## Why\nAgent spawning is critical functionality that should be tested.\n\n## Acceptance Criteria\n- [ ] AgentSpawner.test.ts exists\n- [ ] Tests cover spawn() method\n- [ ] Tests cover error handling\n- [ ] Tests mock ProcessRunner appropriately\n- [ ] 6 tests pass\n\n## Files\n- src/services/AgentSpawner.ts\n- src/services/AgentSpawner.test.ts (create)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T13:29:14.51281+03:00","created_by":"deligoez","updated_at":"2026-01-12T14:01:04.583405+03:00","closed_at":"2026-01-12T14:01:04.583405+03:00","close_reason":"Closed","labels":["m1-infrastructure"]}
{"id":"ch-tdt","title":"F63k: Agent Paused Status Indicator","description":"## What\nAdd `paused` status to AgentStatus type and agent display indicators.\n\n## Why\nMaster plan specifies:\n- `○ idle` (waiting for task)\n- `⏸ paused` (user paused)\n\nCurrent implementation has `stopped` but no `paused` distinction.\n\n## Acceptance Criteria\n- [ ] `AgentStatus` type includes `'paused'`\n- [ ] MainContent shows `○` for idle agents (gray)\n- [ ] MainContent shows `⏸` for paused agents (yellow)\n- [ ] Idle vs paused are visually distinct\n- [ ] 4 tests pass\n\n## Tests (src/components/MainContent.test.tsx)\n1. `shows ○ for idle agent`\n2. `shows ⏸ for paused agent`\n3. `idle indicator is gray colored`\n4. `paused indicator is yellow colored`\n\n## Files\n- src/types/agent.ts (add 'paused' to AgentStatus)\n- src/components/MainContent.tsx (update indicators)\n- src/components/MainContent.test.tsx (add tests)\n\n## Notes\n- `stopped` = agent terminated (exit)\n- `paused` = agent suspended by user (can resume)\n- `idle` = agent waiting for task assignment","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T22:17:42.137574+03:00","created_by":"deligoez","updated_at":"2026-01-11T21:07:12.264272+03:00","closed_at":"2026-01-11T21:07:12.264272+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-tdt","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:54.21499+03:00","created_by":"deligoez"}]}
{"id":"ch-to7","title":"F86: Planning State Persistence","description":"## What\nSave/load planning progress for session recovery.\n\n## Files\n- `src/services/PlanningState.ts`\n- `src/services/PlanningState.test.ts`\n\n## Acceptance Criteria\n\n### Core Operations\n- [ ] `save(state: PlanningStateData)` writes to `.chorus/planning-state.json`\n- [ ] `load()` reads and parses from file\n- [ ] `load()` returns null if file doesn't exist\n- [ ] Creates file and parent directory if not exists\n\n### State Structure\n- [ ] State includes `status` field (planning, reviewing, ready, implementation)\n- [ ] State includes `chosenMode` field ('semi-auto' | 'autopilot') when status='ready' or 'implementation'\n- [ ] State includes `planSummary` field (goal, estimated task count)\n- [ ] State includes `tasks` array\n- [ ] State includes `reviewIterations` history array\n\n### Validation\n- [ ] Validates chosenMode is present when status='ready' or 'implementation'\n\n### Tests\n- [ ] 10 tests pass (9 original + 1 validation test)\n\n## Types\n```typescript\ninterface PlanningStateData {\n  status: 'planning' | 'reviewing' | 'ready' | 'implementation';\n  chosenMode?: 'semi-auto' | 'autopilot';  // Required when status='ready' or 'implementation'\n  planSummary: {\n    userGoal: string;\n    estimatedTasks: number;\n  };\n  tasks: Task[];\n  reviewIterations: ReviewIteration[];\n}\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:08:17.470699+03:00","created_by":"deligoez","updated_at":"2026-01-11T22:40:31.76609+03:00","closed_at":"2026-01-11T22:40:31.76609+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-to7","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:14.281347+03:00","created_by":"deligoez"}]}
{"id":"ch-tpj","title":"F02e: State Merge Queue - Manage merge queue operations","description":"## What\nManage merge queue in state for tracking branches ready to merge.\n\n## Acceptance Criteria\n- [ ] `enqueueMerge(item)` adds item to mergeQueue array\n- [ ] `enqueueMerge(item)` maintains priority sort (highest first)\n- [ ] `enqueueMerge(item)` derives priority from task priority (via Beads) when enqueueing\n- [ ] `dequeueMerge()` returns and removes highest priority item\n- [ ] `dequeueMerge()` returns `undefined` when queue is empty\n- [ ] `updateMergeItem(taskId, partial)` modifies existing item by taskId\n- [ ] `updateMergeItem(taskId, partial)` does nothing if taskId not found (no throw)\n- [ ] `incrementStat(key)` increments specified SessionStats field by 1\n- [ ] `update(partial)` merges partial state into current state\n- [ ] 9 tests pass\n\n## Priority Source Note\nWhen enqueueing a merge, the priority is derived from the task's priority in Beads (P1=highest, P4=lowest). The caller is responsible for providing the priority based on the task being enqueued.\n\n## Files\n- src/services/StateService.ts (extend)\n- tests/services/StateService.test.ts (extend)\n\n## Implementation\n\\`\\`\\`typescript\nenqueueMerge(item: MergeQueueItem): void {\n  this.state.mergeQueue.push(item);\n  this.state.mergeQueue.sort((a, b) =\u003e b.priority - a.priority);\n  this.saveDebounced();\n}\n\ndequeueMerge(): MergeQueueItem | undefined {\n  const item = this.state.mergeQueue.shift();\n  if (item) this.saveDebounced();\n  return item;\n}\n\nupdateMergeItem(taskId: string, partial: Partial\u003cMergeQueueItem\u003e): void {\n  const item = this.state.mergeQueue.find(i =\u003e i.taskId === taskId);\n  if (item) Object.assign(item, partial);\n  this.saveDebounced();\n}\n\nincrementStat(key: keyof SessionStats): void {\n  (this.state.stats[key] as number)++;\n  this.saveDebounced();\n}\n\nupdate(partial: Partial\u003cChorusState\u003e): void {\n  Object.assign(this.state, partial);\n  this.saveDebounced();\n}\n\\`\\`\\`\n\n## Test Cases\n1. `enqueueMerge()` adds item to mergeQueue\n2. `enqueueMerge()` sorts by priority descending (P1 before P3)\n3. `enqueueMerge()` correctly uses task-derived priority\n4. `dequeueMerge()` returns highest priority item\n5. `dequeueMerge()` removes returned item from queue\n6. `dequeueMerge()` returns `undefined` when queue is empty\n7. `updateMergeItem()` modifies item matching taskId\n8. `updateMergeItem()` does not throw when taskId not found\n9. `incrementStat('tasksCompleted')` increases counter from 0 to 1","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T02:26:18.79708+03:00","created_by":"deligoez","updated_at":"2026-01-11T19:01:57.116883+03:00","closed_at":"2026-01-11T19:01:57.116883+03:00","close_reason":"Closed","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-tpj","depends_on_id":"ch-81x","type":"blocks","created_at":"2026-01-10T02:26:18.802044+03:00","created_by":"deligoez"},{"issue_id":"ch-tpj","depends_on_id":"ch-ah6","type":"blocks","created_at":"2026-01-10T02:26:40.031341+03:00","created_by":"deligoez"}]}
{"id":"ch-tr4","title":"F100b: Spec Archiver","description":"## What\nArchives completed specs to archive folder when all tasks are closed.\n\n## Acceptance Criteria\n- [ ] `SpecArchiver` class exists\n- [ ] `shouldArchive(specPath)` returns true if all sections tasked AND all tasks closed\n- [ ] `archive(specPath)` moves spec to .chorus/specs/archive/\n- [ ] `archive()` updates spec-progress.json with archived status\n- [ ] `archive()` preserves original filename in archive folder\n- [ ] `getArchivedSpecs()` lists all specs in archive folder\n- [ ] `unarchive(specPath)` moves spec back from archive (for recovery)\n- [ ] Creates archive folder if it doesn't exist\n- [ ] Archived specs are not included in agent context by default\n- [ ] Checks Beads for task closure status\n- [ ] 10 tests pass\n\n## Archive Behavior\n- Triggered automatically when last task of spec is closed\n- Can be triggered manually via TUI\n- Archived specs never loaded into context unless --include-archived flag\n\n## Files\n- src/services/SpecArchiver.ts\n- tests/services/SpecArchiver.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T09:17:33.671193+03:00","created_by":"deligoez","updated_at":"2026-01-12T07:06:22.256623+03:00","closed_at":"2026-01-12T07:06:22.256623+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-tr4","depends_on_id":"ch-2yp","type":"blocks","created_at":"2026-01-11T09:17:33.674803+03:00","created_by":"deligoez"}]}
{"id":"ch-ttgs","title":"E2E-51: XState Persistence Integration Tests","description":"## What\nE2E tests for XState snapshot persistence and event sourcing fallback.\n\n## Acceptance Criteria\n- [ ] Saves XState snapshot to .chorus/state.xstate.json\n- [ ] Restores actor hierarchy from snapshot\n- [ ] Falls back to event sourcing when snapshot invalid\n- [ ] Events append to .chorus/events.jsonl\n- [ ] Replays events to restore state\n- [ ] Handles corrupted snapshot gracefully\n- [ ] 8 tests pass\n\n## Files\n- src/e2e/xstate-persistence.e2e.test.ts\n\n## Implementation Notes\n- Use createGitRepoWithChorus() helper\n- Test crash recovery scenario (save, corrupt, restore)\n- Verify actor hierarchy is restored correctly\n- This is CRITICAL for crash recovery feature","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T00:08:03.28235+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:13:05.267051+03:00","closed_at":"2026-01-12T01:13:05.267051+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-ttgs","depends_on_id":"ch-134l","type":"blocks","created_at":"2026-01-12T00:08:48.304267+03:00","created_by":"deligoez"},{"issue_id":"ch-ttgs","depends_on_id":"ch-5gxg","type":"blocks","created_at":"2026-01-12T00:08:48.399086+03:00","created_by":"deligoez"}]}
{"id":"ch-tw4j","title":"SP03: Sprint Planning Panel - Task selection and iteration settings form","description":"## What\nPanel for configuring and starting a sprint.\n\n## Acceptance Criteria\n- [ ] Sprint target radio group (complete N tasks/run for N hours/run until HH:MM/run until no ready)\n- [ ] Iteration settings inputs (max iterations, timeout in minutes, pause toggles)\n- [ ] Task selection checkboxes with select all/none buttons\n- [ ] Shows estimated time based on selection (tasks × avg time)\n- [ ] Checkpoint option checkbox (create git tag before start)\n- [ ] Enter starts sprint, Esc cancels\n- [ ] Validates at least one task selected\n- [ ] Shows ready task count from Beads\n- [ ] Updates selection count reactively\n- [ ] 10 tests pass\n\n## Files\n- src/components/SprintPlanningPanel.tsx\n- src/components/SprintPlanningPanel.test.tsx","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T15:13:07.606293+03:00","created_by":"deligoez","updated_at":"2026-01-12T17:47:15.02275+03:00","closed_at":"2026-01-12T17:47:15.02275+03:00","close_reason":"Closed","labels":["m13b-sprint"],"dependencies":[{"issue_id":"ch-tw4j","depends_on_id":"ch-pjge","type":"blocks","created_at":"2026-01-12T15:13:07.609023+03:00","created_by":"deligoez"}]}
{"id":"ch-tyf5","title":"E2E-07: Panel Focus (Tab)","description":"## What\nVerify Tab switches focus between panels.\n\n## Tests (3 tests)\n1. Tab switches from TaskPanel to AgentGrid\n2. Tab switches from AgentGrid to TaskPanel\n3. Focused panel has visual indicator\n\n## Files\n- src/e2e/panel-focus.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T21:18:00.274702+03:00","created_by":"deligoez","updated_at":"2026-01-11T23:27:41.322215+03:00","closed_at":"2026-01-11T23:27:41.322215+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-tyf5","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:18:00.277302+03:00","created_by":"deligoez"},{"issue_id":"ch-tyf5","depends_on_id":"ch-akb","type":"blocks","created_at":"2026-01-11T21:18:00.280973+03:00","created_by":"deligoez"},{"issue_id":"ch-tyf5","depends_on_id":"ch-73t","type":"blocks","created_at":"2026-01-11T21:25:08.837103+03:00","created_by":"deligoez"}]}
{"id":"ch-tz05","title":"INT04: Real Agent Auto-Approve Integration Test","description":"## What\nIntegration test using real Claude agent to verify auto-approve flow with real quality checks.\n\n## Acceptance Criteria\n- [ ] Agent completes task successfully\n- [ ] Quality checks (typecheck, lint, tests) run on real changes\n- [ ] Auto-approve engine evaluates real results\n- [ ] Task automatically sent to merge queue on pass\n- [ ] Task requires manual review on failure\n- [ ] Budget limit enforced (max 3 API calls per test)\n- [ ] Test suite skipped in CI (manual run only)\n- [ ] 3 tests pass\n\n## Notes\n- These tests use real API calls (costly and slow)\n- Run manually: `npm run test:integration -- --grep \"Auto-Approve\"`\n- Not included in `npm run test` or CI\n- Verifies end-to-end quality pipeline\n\n## Files\n- src/integration/real-agent-autoapprove.integration.test.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T16:19:32.85529+03:00","created_by":"deligoez","updated_at":"2026-01-12T18:13:19.637934+03:00","closed_at":"2026-01-12T18:13:19.637934+03:00","close_reason":"Closed","labels":["m14-integration"],"dependencies":[{"issue_id":"ch-tz05","depends_on_id":"ch-nf8x","type":"blocks","created_at":"2026-01-12T16:19:32.859236+03:00","created_by":"deligoez"}]}
{"id":"ch-u5j","title":"F63v: View Learnings Key (L) - Show learnings panel","description":"## What\nKeyboard handler to show the learnings panel.\n\n## Context from Master Plan\n```\nVIEW\nL    View learnings\n```\n\n## Shortcut\n- **L** (Shift+l) - Open learnings panel\n\n## Important Clarification\n- **L** = view learnings (read-only display of existing learnings)\n- **Ctrl+L** = interactive review (covered by F101a: TUI Learning Review Trigger)\n\n## Implementation\n\n```typescript\n// src/hooks/useLearningsKey.ts\n\ninterface UseLearningsKeyOptions {\n  onOpen: () =\u003e void;\n  isDisabled?: boolean;\n}\n\nfunction useLearningsKey(options: UseLearningsKeyOptions) {\n  useInput((input) =\u003e {\n    if (input === 'L' \u0026\u0026 !options.isDisabled) {\n      options.onOpen();\n    }\n  });\n}\n\n// Usage in App.tsx\nconst [learningsVisible, setLearningsVisible] = useState(false);\n\nuseLearningsKey({\n  onOpen: () =\u003e setLearningsVisible(true)\n});\n\n{learningsVisible \u0026\u0026 \u003cLearningsPanel onClose={() =\u003e setLearningsVisible(false)} /\u003e}\n```\n\n## Acceptance Criteria\n\n### Open Panel - 2 tests\n- [ ] 'L' (uppercase) key opens learnings panel\n- [ ] 'l' (lowercase) does NOT open (that's View Logs - F63h)\n\n### Panel Content - 3 tests\n- [ ] Shows learnings from LearningStore\n- [ ] Groups by scope: LOCAL, CROSS-CUTTING, ARCHITECTURAL\n- [ ] Shows unreviewed count badge\n\n### Close - 2 tests\n- [ ] ESC closes the panel\n- [ ] Clicking outside closes (if supported)\n\n### Summary\n- [ ] 7 tests pass\n\n## Files\n- src/hooks/useLearningsKey.ts (NEW)\n- src/hooks/useLearningsKey.test.ts (NEW)\n\n## Dependencies\n- F42b (Learnings Panel) for the panel component\n\n## Notes\n- 'L' = View learnings (read-only)\n- Ctrl+L = Review learnings (interactive, F101a)\n- Case matters: 'l' = logs, 'L' = learnings","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T12:44:39.500847+03:00","created_by":"deligoez","updated_at":"2026-01-12T06:02:26.46143+03:00","closed_at":"2026-01-12T06:02:26.46143+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-u5j","depends_on_id":"ch-g2h","type":"blocks","created_at":"2026-01-11T12:44:39.505109+03:00","created_by":"deligoez"}]}
{"id":"ch-ua17","title":"TS01: Task Type Definitions","description":"## What\nCreate core type definitions for the task system.\n\n## Files\n- `src/types/task.ts`\n\n## Acceptance Criteria\n- [ ] `TaskStatus` type with 7 values: `todo`, `doing`, `done`, `stuck`, `later`, `failed`, `review`\n- [ ] `TaskType` type with 4 values: `task`, `bug`, `feature`, `chore`\n- [ ] `Task` interface with all fields (id, title, status, type, tags, dependencies, etc.)\n- [ ] `TaskExecution` interface (timing, iterations, worktree, results)\n- [ ] `TaskJSONL` interface for storage format (snake_case)\n- [ ] Export all types\n- [ ] 0 tests (type-only file, validated by typecheck)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-13T00:12:14.566096+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:27:18.385932+03:00","closed_at":"2026-01-13T00:27:18.385932+03:00","close_reason":"Closed","labels":["m1-infrastructure"]}
{"id":"ch-ue3z","title":"CHORE: Evaluate hook test coverage vs E2E","description":"## What\n23 hooks have no unit tests. Evaluate if unit tests needed or if E2E coverage sufficient.\n\n## Current State\nHooks without tests:\n- useAgentManager, useApproveMergeKey, useAssignKey, useAutopilotKey\n- useCheckpointKey, useChorusMachine, useFullscreenKey, useGridSettingsKey\n- useHelpKey, useInterventionKey, useKeyboard, useKeyboardRouter\n- useLearningsKey, useModeToggle, useNavigationKeys, useNewTaskKey\n- useOrchestration, usePauseKey, useRecoveryKeys, useSpawnKey\n- useTaskSelection, useTerminalSize, useUndoKey\n\n14 E2E tests use PTY for keyboard testing.\n\n## Task\n1. Check which hooks are covered by E2E tests\n2. Identify critical hooks that need unit tests\n3. Create separate tasks for hooks needing tests\n4. Document hooks adequately covered by E2E\n\n## Acceptance Criteria\n- [ ] Audit complete\n- [ ] Critical hooks identified\n- [ ] New tasks created if needed\n- [ ] Documentation updated\n- [ ] 0 tests (audit task)\n\n## Files\n- src/hooks/*.ts (audit)\n- src/e2e/*.test.ts (check coverage)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T13:29:48.818522+03:00","created_by":"deligoez","updated_at":"2026-01-12T13:53:27.79566+03:00","closed_at":"2026-01-12T13:53:27.79566+03:00","close_reason":"Closed","labels":["m12-tui"]}
{"id":"ch-ukl","title":"F63r: Assign Task Key (Enter) - Assign selected task to idle agent","description":"## What\nKeyboard handler to assign the selected task to an idle agent slot.\n\n## Context from Master Plan\n```\nAGENT CONTROL\nEnter  Assign task to agent\n```\n\n## Shortcut\n- **Enter** - Assign selected task to available agent\n\n## Difference from 's' (Spawn)\n- **s** = Spawn NEW agent for task (creates process)\n- **Enter** = Assign task to EXISTING idle agent (reuses slot)\n\nIn practice, for MVP with Claude-only agents, these may behave similarly.\nThe distinction matters when agents can be pooled/reused.\n\n## Implementation\n\n```typescript\n// src/hooks/useAssignKey.ts\n\ninterface UseAssignKeyOptions {\n  selectedTask: Task | null;\n  slotManager: SlotManager;\n  orchestrator: Orchestrator;\n  onAssigned?: (taskId: string, slotId: string) =\u003e void;\n  onError?: (error: string) =\u003e void;\n}\n\nfunction useAssignKey(options: UseAssignKeyOptions) {\n  useInput((input, key) =\u003e {\n    if (!key.return) return;\n    \n    const task = options.selectedTask;\n    if (!task) {\n      options.onError?.('No task selected');\n      return;\n    }\n    \n    // Similar validation to spawn...\n    const slotId = options.slotManager.assignTask(task.id);\n    options.onAssigned?.(task.id, slotId);\n  });\n}\n```\n\n## Acceptance Criteria\n\n### Assign Success - 3 tests\n- [ ] Enter key with valid task calls `slotManager.assignTask()`\n- [ ] Shows confirmation: \"Task ch-xxx assigned to slot N\"\n- [ ] Task status changes to in_progress\n\n### Validation - 3 tests\n- [ ] No-op when no task selected\n- [ ] No-op when task is not 'open' status\n- [ ] No-op when no idle slots available\n\n### Key Detection - 2 tests\n- [ ] Responds to `key.return` (Enter key)\n- [ ] Does not respond to other keys\n\n### Summary\n- [ ] 8 tests pass\n\n## Files\n- src/hooks/useAssignKey.ts (NEW)\n- src/hooks/useAssignKey.test.ts (NEW)\n\n## Dependencies\n- F22 (SlotManager) for slot assignment\n- F12 (Task Claimer) for task claiming\n\n## Notes\n- MVP: May behave same as 's' (spawn)\n- Future: Agent pooling would make distinction meaningful","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T12:43:56.923251+03:00","created_by":"deligoez","updated_at":"2026-01-12T05:31:02.27823+03:00","closed_at":"2026-01-12T05:31:02.27823+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-ukl","depends_on_id":"ch-i9i","type":"blocks","created_at":"2026-01-11T12:43:56.925866+03:00","created_by":"deligoez"},{"issue_id":"ch-ukl","depends_on_id":"ch-zqi","type":"blocks","created_at":"2026-01-11T12:43:56.928094+03:00","created_by":"deligoez"},{"issue_id":"ch-ukl","depends_on_id":"ch-0e7","type":"blocks","created_at":"2026-01-11T14:01:43.438261+03:00","created_by":"deligoez"}]}
{"id":"ch-uli5","title":"E2E-68: Plan Review with In-Progress Task","description":"## What\nEnd-to-end test verifying Plan Review correctly handles in_progress tasks.\n\n## Scenario\n1. Agent starts working on task A\n2. Another task completes with CROSS_CUTTING learning\n3. Plan Review triggers and wants to update task A\n4. Update is queued (not applied immediately)\n5. Agent's next iteration gets updated context\n\n## Acceptance Criteria\n- [ ] Test setup: Create task A (open), task B (open)\n- [ ] Agent claims task A → status becomes in_progress\n- [ ] Complete task B with CROSS_CUTTING learning in scratchpad\n- [ ] Plan Review triggers automatically\n- [ ] Plan Review proposes update to task A\n- [ ] Update is queued to pending-task-updates.json\n- [ ] Task A in Beads is NOT modified yet\n- [ ] Agent iteration completes, next iteration starts\n- [ ] Queued update is applied at iteration start\n- [ ] Agent's new prompt reflects updated acceptance criteria\n- [ ] 6 E2E tests pass\n\n## Test Cases\n1. In_progress task update is queued (not immediate)\n2. Queue file contains correct update structure\n3. Open task update is applied immediately\n4. Queued update applied at next iteration\n5. Queue cleared after successful application\n6. Multiple queued updates applied in order\n\n## Files\n- tests/e2e/plan-review-in-progress.e2e.test.ts\n\n## Test Pattern (AAA)\n```typescript\nit('queues update for in_progress task', async () =\u003e {\n  // Arrange\n  const taskA = await beadsCLI.createTask('Task A');\n  await beadsCLI.claimTask(taskA, 'agent-1');\n  \n  // Act\n  await completePlanReviewWithUpdate(taskA, 'add_criteria');\n  \n  // Assert\n  const queue = await readQueueFile();\n  expect(queue).toContainEqual({ taskId: taskA, ... });\n  const task = await beadsCLI.getTask(taskA);\n  expect(task.custom?.acceptance_criteria).not.toContain('new criteria');\n});\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T09:08:50.127135+03:00","created_by":"deligoez","updated_at":"2026-01-12T12:40:28.199184+03:00","closed_at":"2026-01-12T12:40:28.199184+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-uli5","depends_on_id":"ch-c3q","type":"blocks","created_at":"2026-01-12T09:08:50.131082+03:00","created_by":"deligoez"}]}
{"id":"ch-uoa","title":"F11: Completion Checker - Detect task completion (signal + tests)","description":"## What\nCheck if agent has completed task using signal detection AND test verification.\n\n## Acceptance Criteria\n- [ ] `check()` returns `complete: false` if no signal\n- [ ] `check()` returns `complete: true` if signal + tests pass\n- [ ] `check()` returns `complete: false` if signal + tests fail\n- [ ] `check()` respects `requireTests` config option (false = skip tests)\n- [ ] `check()` runs tests in worktree path\n- [ ] `hasCompletionSignal()` quick check without running tests\n- [ ] `isBlocked()` detects BLOCKED signal and extracts reason\n- [ ] `needsHelp()` detects NEEDS_HELP signal and extracts question\n- [ ] CompletionResult includes: complete, hasSignal, testsPassed, reason, testOutput\n- [ ] 9 tests pass\n\n## Files\n- src/services/CompletionChecker.ts (NEW)\n- tests/services/CompletionChecker.test.ts (NEW)\n\n## Notes\n- AND logic: signal + tests = complete\n- requireTests: true (default) = tests must pass\n- requireTests: false = skip test check, signal alone is enough\n- isBlocked/needsHelp are helpers for Orchestrator (F15)\n\n## Completion Matrix\n| Signal | Tests | requireTests | Result |\n|--------|-------|--------------|--------|\n| ✓ | ✓ | true | COMPLETE |\n| ✓ | ✗ | true | Continue |\n| ✗ | ✓ | true | Continue |\n| ✗ | ✗ | true | Continue |\n| ✓ | - | false | COMPLETE |\n| ✗ | - | false | Continue |","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T01:38:59.126542+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:56:09.781324+03:00","closed_at":"2026-01-11T18:56:09.781324+03:00","close_reason":"Closed","labels":["m3-task-mgmt"],"dependencies":[{"issue_id":"ch-uoa","depends_on_id":"ch-mpl","type":"blocks","created_at":"2026-01-10T01:38:59.129353+03:00","created_by":"deligoez"},{"issue_id":"ch-uoa","depends_on_id":"ch-k3d","type":"blocks","created_at":"2026-01-10T01:38:59.130889+03:00","created_by":"deligoez"}]}
{"id":"ch-utf9","title":"TS14: Audit Log Writer","description":"## What\nImplement audit log writing.\n\n## Files\n- `src/services/TaskStore.ts`\n- `src/services/TaskStore.test.ts`\n\n## Acceptance Criteria\n- [ ] `audit(taskId, entry)` appends to `.chorus/audit/{id}.jsonl`\n- [ ] Creates audit directory if not exists\n- [ ] Audit entry includes event type, timestamp, details\n- [ ] Lifecycle methods auto-audit (claim, complete, fail, etc.)\n- [ ] 4 tests pass","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:15:03.052047+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:15:03.052047+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-utf9","depends_on_id":"ch-kakj","type":"blocks","created_at":"2026-01-13T00:15:03.055207+03:00","created_by":"deligoez"}]}
{"id":"ch-uwx","title":"F80d: Plan Review Config Wizard","description":"## What\nAdd Step 5/5 to Init Flow for configuring Plan Review settings.\n\n## Why\nUsers should be able to configure adaptive task refinement during project initialization.\n\n## Acceptance Criteria\n- [ ] Renders Step 5/5 UI after Task Validation Rules step\n- [ ] Shows current settings: enabled, maxIterations, triggerOn, autoApply\n- [ ] Allows toggling enabled (Yes/No)\n- [ ] Allows changing maxIterations (1-10, default 5)\n- [ ] Allows selecting triggerOn categories (checkboxes)\n- [ ] Allows selecting autoApply level (none/minor/all)\n- [ ] Shows explanation box of how feature works\n- [ ] Saves to config.json planReview section\n- [ ] Respects \"done\" to proceed to next step\n- [ ] 8 tests pass\n\n## UI\n```\n┌─────────────────────────────────────────────────────────────────┐\n│ CHORUS INIT                                            Step 5/5 │\n├─────────────────────────────────────────────────────────────────┤\n│  Adaptive Plan Review                                            │\n│                                                                  │\n│  Enable plan review:        [Yes]                                │\n│  Max review iterations:     [5]                                  │\n│  Trigger on:                [cross_cutting, architectural]       │\n│  Auto-apply changes:        [minor]                              │\n│                                                                  │\n│  Type values to change, or \"done\" to finish                     │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n## Files\n- src/components/init/PlanReviewConfigStep.tsx\n- tests/components/init/PlanReviewConfigStep.test.tsx","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T08:44:54.572777+03:00","created_by":"deligoez","updated_at":"2026-01-12T02:47:02.294453+03:00","closed_at":"2026-01-12T02:47:02.294453+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-uwx","depends_on_id":"ch-h0s","type":"blocks","created_at":"2026-01-11T08:44:54.576906+03:00","created_by":"deligoez"}]}
{"id":"ch-uxk","title":"F39a: Learning Types - Learning and Scratchpad interfaces","description":"## What\nDefine TypeScript interfaces for the memory/learning system.\n\n## API\n```typescript\n// src/types/learning.ts\n\n/**\n * Scope determines workflow behavior:\n * - local: Only affects this task (no triggers)\n * - cross-cutting: Affects multiple features (triggers Plan Review)\n * - architectural: Fundamental design decision (triggers Plan Review + Alert)\n */\ntype LearningScope = 'local' | 'cross-cutting' | 'architectural';\n\ninterface Learning {\n  id: string;\n  content: string;                    // The actual learning text (without scope prefix)\n  scope: LearningScope;               // PRIMARY: affects workflow\n  category: string;                   // SECONDARY: for organization (from headings)\n  source: {\n    taskId: string;\n    agentType: AgentType;\n    timestamp: Date;\n  };\n  suggestPattern: boolean;            // Should this become a pattern in PATTERNS.md?\n}\n\ninterface Scratchpad {\n  path: string;           // Absolute path to scratchpad file\n  content: string;        // Full file content\n  modifiedAt: Date;       // File modification time\n}\n\ninterface LearningsFile {\n  path: string;           // '.agent/learnings.md'\n  learnings: Learning[];  // All learnings\n}\n\ninterface LearningsMeta {\n  path: string;           // '.agent/learnings-meta.json'\n  hashes: string[];       // SHA256 hashes for deduplication\n  reviewed: {             // Review status tracking\n    [learningId: string]: {\n      reviewedAt: Date;\n      reviewedBy: 'plan-review' | 'human';\n    };\n  };\n  lastUpdated: Date;\n}\n```\n\n## Learning Scope vs Category\n\n**Scope (PRIMARY):** Determines workflow actions\n| Scope | Prefix | Triggers |\n|-------|--------|----------|\n| `local` | `[LOCAL]` | None |\n| `cross-cutting` | `[CROSS-CUTTING]` | Plan Review |\n| `architectural` | `[ARCHITECTURAL]` | Plan Review + Alert |\n\n**Category (SECONDARY):** For organization only\n- Determined by `### Heading` in scratchpad\n- Examples: \"performance\", \"testing\", \"debugging\", \"patterns\", \"general\"\n- Used for grouping in learnings.md and Learnings Panel\n\n## Files\n- src/types/learning.ts\n\n## Acceptance Criteria\n- [ ] `LearningScope` type has local, cross-cutting, architectural\n- [ ] `Learning` interface has id, content, scope, category, source, suggestPattern\n- [ ] `Scratchpad` interface has path, content, modifiedAt\n- [ ] `LearningsFile` interface has path and learnings array\n- [ ] `LearningsMeta` interface has path, hashes, reviewed, lastUpdated\n- [ ] Source includes taskId, agentType, timestamp\n- [ ] 7 tests pass\n\n## Tests\n1. LearningScope union type accepts valid values\n2. Learning interface has all required fields\n3. Scratchpad interface has required fields\n4. LearningsFile interface has required fields\n5. LearningsMeta interface has required fields\n6. Source type is correct\n7. suggestPattern is boolean\n\n## Notes\n- scope is PRIMARY classification (affects Plan Review, alerts)\n- category is SECONDARY classification (for human organization)\n- suggestPattern enables auto-promotion to PATTERNS.md\n- LearningsMeta enables deduplication and review tracking","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T10:42:22.318154+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:21:36.36474+03:00","closed_at":"2026-01-11T18:21:36.36474+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-uxk","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:52.093571+03:00","created_by":"deligoez"}]}
{"id":"ch-v31l","title":"F51c: Disk Space Monitor","description":"## What\nMonitor disk space and detect ENOSPC errors during agent operations.\n\n## Why\nPrevents data loss and corruption when disk runs out of space during git operations, file writes, or agent output.\n\n## Acceptance Criteria\n- [ ] `DiskSpaceMonitor.check()` returns available space in bytes\n- [ ] `DiskSpaceMonitor.isLow()` returns true when below threshold (default 100MB)\n- [ ] `DiskSpaceMonitor.onEnospc(callback)` registers error handler\n- [ ] Detects ENOSPC from child process stderr\n- [ ] Emits 'diskLow' event when threshold crossed\n- [ ] Emits 'diskFull' event on ENOSPC detection\n- [ ] Pauses RalphLoop on disk full (if running)\n- [ ] Shows TUI alert with disk usage info\n- [ ] Configurable threshold via config.json\n- [ ] 10 tests pass\n\n## API\n```typescript\ninterface DiskSpaceMonitor {\n  check(): Promise\u003c{ available: number; total: number; percent: number }\u003e;\n  isLow(threshold?: number): Promise\u003cboolean\u003e;\n  onEnospc(callback: () =\u003e void): void;\n  startMonitoring(intervalMs?: number): void;\n  stopMonitoring(): void;\n}\n```\n\n## Files\n- src/services/DiskSpaceMonitor.ts\n- tests/services/DiskSpaceMonitor.test.ts\n\n## Dependencies\n- F47 (ch-2r5): Rollback Types (for recovery action types)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T14:25:19.28014+03:00","created_by":"deligoez","updated_at":"2026-01-12T07:01:39.331867+03:00","closed_at":"2026-01-12T07:01:39.331867+03:00","close_reason":"Closed","labels":["m10-rollback"],"dependencies":[{"issue_id":"ch-v31l","depends_on_id":"ch-2r5","type":"blocks","created_at":"2026-01-11T14:25:22.766105+03:00","created_by":"deligoez"}]}
{"id":"ch-v65d","title":"E2E-23: View Learnings (L key)","description":"## What\nE2E test for viewing learnings panel with 'L' key (Shift+l).\n\n## Acceptance Criteria\n- [ ] Pressing 'L' (Shift+l) opens learnings panel\n- [ ] Panel displays categorized learnings\n- [ ] Can scroll through learnings with j/k\n- [ ] Pressing 'L' again closes panel\n- [ ] Pressing Escape closes panel\n- [ ] 5 tests pass\n\n## Test Cases\n1. `it('opens learnings panel when L is pressed')`\n2. `it('displays learnings by category')`\n3. `it('scrolls through learnings with j/k')`\n4. `it('closes panel when L pressed again')`\n5. `it('closes panel with Escape')`\n\n## Files\n- tests/e2e/view-learnings.test.ts\n\n## Dependencies\n- ch-0e01 (E2E Infrastructure)\n- ch-u5j (F63v View Learnings Key)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:20:45.101018+03:00","created_by":"deligoez","updated_at":"2026-01-12T06:04:23.383078+03:00","closed_at":"2026-01-12T06:04:23.383078+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-v65d","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:20:45.102281+03:00","created_by":"deligoez"},{"issue_id":"ch-v65d","depends_on_id":"ch-u5j","type":"blocks","created_at":"2026-01-11T21:20:45.105795+03:00","created_by":"deligoez"}]}
{"id":"ch-vemi","title":"TS21: Update Documentation","description":"## What\nUpdate CLAUDE.md and rules files.\n\n## Files\n- `CLAUDE.md`\n- `.claude/rules/beads-task-tracking.md` → Rename to `task-tracking.md`\n\n## Acceptance Criteria\n- [ ] CLAUDE.md references TaskStore instead of Beads\n- [ ] `bd` commands replaced with TaskStore API\n- [ ] Rules file renamed and updated\n- [ ] 0 tests (documentation task)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-13T00:16:29.487526+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:16:29.487526+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-vemi","depends_on_id":"ch-72yh","type":"blocks","created_at":"2026-01-13T00:16:35.725203+03:00","created_by":"deligoez"}]}
{"id":"ch-view","title":"INT-10: Parallel agents share learnings in real-time","description":"## What\nIntegration test: Agent A and B run in parallel, A's learning available to C.\n\n## Test Scenario\n1. Agent A starts on Task A (long running)\n2. Agent B starts on Task B (long running)\n3. Agent A outputs learning, completes\n4. Agent C starts on Task C\n5. Agent C's prompt includes Agent A's learning\n\n## Why Atomic\nTests only learning availability timing, not parallel execution correctness.\n\n## Key Verification\n- Learning from A is stored BEFORE C starts\n- C receives A's learning in prompt\n- B's execution doesn't block learning propagation\n\n## Acceptance Criteria\n- [ ] A outputs learning during execution\n- [ ] Learning stored immediately (not on completion)\n- [ ] C receives learning when spawned\n- [ ] 1 test pass\n\n## Files\n- src/integration/parallel-learning.integration.test.ts (create)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T14:27:33.469736+03:00","created_by":"deligoez","updated_at":"2026-01-12T15:03:02.403746+03:00","closed_at":"2026-01-12T15:03:02.403746+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-view","depends_on_id":"ch-cpyi","type":"blocks","created_at":"2026-01-12T14:27:33.473127+03:00","created_by":"deligoez"}]}
{"id":"ch-vlwf","title":"E2E-52: ScratchpadManager Integration Tests","description":"## What\nE2E tests for ScratchpadManager creating scratchpads in worktrees.\n\n## Acceptance Criteria\n- [ ] Copies template from .chorus/templates/scratchpad.md\n- [ ] Substitutes {task_id} placeholder correctly\n- [ ] Creates .agent/ directory in worktree\n- [ ] Uses default template if project template missing\n- [ ] Handles missing worktree gracefully\n- [ ] 6 tests pass\n\n## Files\n- src/e2e/scratchpad-manager.e2e.test.ts\n\n## Implementation Notes\n- Use createGitRepoWithChorus() helper\n- Create worktree using WorktreeService\n- Verify scratchpad content has task ID substituted","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T00:08:11.28451+03:00","created_by":"deligoez","updated_at":"2026-01-12T02:05:29.972889+03:00","closed_at":"2026-01-12T02:05:29.972889+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-vlwf","depends_on_id":"ch-1gi","type":"blocks","created_at":"2026-01-12T00:08:48.49452+03:00","created_by":"deligoez"}]}
{"id":"ch-vskx","title":"FX07: React Integration - useChorusMachine hook for Ink","description":"## What\nCreate React hook for using ChorusMachine in Ink components with selectors for performance.\n\n## Acceptance Criteria\n- [ ] `useChorusMachine()` hook wraps useMachine\n- [ ] Exposes snapshot, send, actorRef\n- [ ] Derived selectors: agents, mode, mergeQueue, isRunning, isPaused\n- [ ] Action helpers: spawnAgent, stopAgent, pause, resume, setMode\n- [ ] Uses useSelector for performance (avoid re-renders)\n- [ ] 6 tests pass\n\n## Tests\n1. useChorusMachine returns snapshot\n2. useChorusMachine returns send function\n3. agents selector returns spawned agent refs\n4. mode selector returns current mode\n5. spawnAgent calls send with SPAWN_AGENT event\n6. pause/resume calls send with PAUSE/RESUME events\n\n## Files\n- src/hooks/useChorusMachine.ts\n- src/hooks/index.ts\n\n## Dependencies\n- FX05 (Persistence Layer)\n- FX06 (Event Sourcing)","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-11T15:26:57.892535+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:15:57.271974+03:00","closed_at":"2026-01-11T18:15:57.271974+03:00","close_reason":"Closed","labels":["m-1-xstate"],"dependencies":[{"issue_id":"ch-vskx","depends_on_id":"ch-134l","type":"blocks","created_at":"2026-01-11T15:26:57.89588+03:00","created_by":"deligoez"},{"issue_id":"ch-vskx","depends_on_id":"ch-5gxg","type":"blocks","created_at":"2026-01-11T15:26:57.898561+03:00","created_by":"deligoez"},{"issue_id":"ch-vskx","depends_on_id":"ch-g3of","type":"blocks","created_at":"2026-01-11T15:57:02.430344+03:00","created_by":"deligoez"}]}
{"id":"ch-vsxe","title":"TS15: Audit Log Reader","description":"## What\nImplement audit log reading.\n\n## Files\n- `src/services/AuditLog.ts`\n- `src/services/AuditLog.test.ts`\n\n## Acceptance Criteria\n- [ ] `readAuditLog(taskId)` returns array of AuditEntry\n- [ ] Returns empty array if file doesn't exist\n- [ ] Parses JSONL correctly\n- [ ] Reads compressed `.jsonl.gz` files\n- [ ] 4 tests pass","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:15:12.77703+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:15:12.77703+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-vsxe","depends_on_id":"ch-utf9","type":"blocks","created_at":"2026-01-13T00:15:12.779293+03:00","created_by":"deligoez"}]}
{"id":"ch-wc53","title":"F96b: Queued Update Applier - Apply pending updates at agent iteration start","description":"## What\nApply queued task updates at the start of each agent iteration.\n\n## Why\nWhen Plan Review updates a task while an agent is working on it, the update is queued. This component applies queued updates before building the next prompt.\n\n## Acceptance Criteria\n- [ ] `checkQueuedUpdates(taskId)` returns pending updates for task\n- [ ] `applyAndClearUpdates(taskId)` applies updates and removes from queue\n- [ ] Handles empty queue gracefully (no-op)\n- [ ] Handles missing queue file gracefully\n- [ ] Queue file atomically updated after successful application\n- [ ] 6 tests pass\n\n## Interface\n```typescript\nclass QueuedUpdateApplier {\n  constructor(private queuePath: string = '.chorus/pending-task-updates.json') {}\n\n  async checkQueuedUpdates(taskId: string): Promise\u003cPendingTaskUpdate[]\u003e;\n  async applyAndClearUpdates(taskId: string): Promise\u003cTaskUpdate[]\u003e;\n}\n```\n\n## Integration\nCalled at agent iteration start, before buildPrompt().\n\n## Files\n- src/services/QueuedUpdateApplier.ts\n- tests/services/QueuedUpdateApplier.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T08:59:00.1336+03:00","created_by":"deligoez","updated_at":"2026-01-12T12:30:31.378141+03:00","closed_at":"2026-01-12T12:30:31.378141+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-wc53","depends_on_id":"ch-dka","type":"blocks","created_at":"2026-01-12T08:59:00.137201+03:00","created_by":"deligoez"}]}
{"id":"ch-wg8b","title":"INT03: Real Agent Feedback Loop Integration Test","description":"## What\nIntegration test using real Claude agent to test the full feedback/redo cycle.\n\n## Acceptance Criteria\n- [ ] Agent completes task with intentional quality issue\n- [ ] Review rejects with specific feedback message\n- [ ] Feedback injected into redo prompt correctly\n- [ ] Agent receives and addresses feedback\n- [ ] Second iteration succeeds (or fails gracefully)\n- [ ] Iteration count tracked correctly\n- [ ] Budget limit enforced (max 4 API calls per test)\n- [ ] Test suite skipped in CI (manual run only)\n- [ ] 3 tests pass\n\n## Notes\n- These tests use real API calls (costly and slow)\n- Run manually: `npm run test:integration -- --grep \"Feedback Loop\"`\n- Not included in `npm run test` or CI\n- Most complex integration test due to multi-turn interaction\n\n## Files\n- src/integration/real-agent-feedback.integration.test.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-12T16:19:25.459192+03:00","created_by":"deligoez","updated_at":"2026-01-12T18:07:03.980162+03:00","closed_at":"2026-01-12T18:07:03.980162+03:00","close_reason":"Closed","labels":["m14-integration"],"dependencies":[{"issue_id":"ch-wg8b","depends_on_id":"ch-nf8x","type":"blocks","created_at":"2026-01-12T16:19:25.461721+03:00","created_by":"deligoez"}]}
{"id":"ch-wk8","title":"F07: Prompt Builder - Build task prompts with context","description":"## What\nBuild agent prompts with task context, acceptance criteria, quality commands, commit rules, patterns injection, learnings format, and Chorus signal protocol.\n\n**Note:** This task covers Claude agent only. Non-Claude context injection is in F07b (deferred).\n\n## Acceptance Criteria\n\n### build() - Main Entry (5 tests)\n- [ ] `build()` returns string containing task title from `context.task.title`\n- [ ] `build()` returns string containing `context.branch` value\n- [ ] `build()` output contains sections in order: task → quality commands → patterns → commit rules → learnings format → completion protocol\n- [ ] `build()` handles task without body (returns prompt with title only)\n- [ ] `build()` includes quality commands as numbered list\n\n### buildTaskSection() - 2 tests\n- [ ] `buildTaskSection(task)` returns string containing `task.title`\n- [ ] `buildTaskSection(task)` returns string containing `task.body` (acceptance criteria markdown)\n\n### buildQualityCommandsSection() - 3 tests (NEW)\n- [ ] `buildQualityCommandsSection(config)` returns numbered list of quality commands\n- [ ] `buildQualityCommandsSection(config)` marks required vs optional commands\n- [ ] `buildQualityCommandsSection(config)` returns empty string if no quality commands configured\n\n### buildCommitRulesSection() - 2 tests\n- [ ] `buildCommitRulesSection(\"ch-abc\")` returns string containing `[ch-abc]`\n- [ ] `buildCommitRulesSection(taskId)` returns string containing \"Commit Message Rules\"\n\n### buildLearningsFormatSection() - 2 tests (NEW)\n- [ ] `buildLearningsFormatSection()` returns string explaining [LOCAL], [CROSS-CUTTING], [ARCHITECTURAL] prefixes\n- [ ] `buildLearningsFormatSection()` includes when to use each scope\n\n### buildCompletionSection() - 3 tests\n- [ ] `buildCompletionSection(config)` returns string containing `\u003cchorus\u003e`\n- [ ] `buildCompletionSection(config)` returns string containing signal format instructions\n- [ ] `buildCompletionSection(config)` includes \"quality commands must pass\" when qualityCommands configured\n\n### loadPatterns() - 3 tests\n- [ ] `loadPatterns()` reads and returns content from `.chorus/PATTERNS.md`\n- [ ] `loadPatterns()` returns empty string if PATTERNS.md doesn't exist\n- [ ] `build()` includes patterns section when PATTERNS.md has content\n\n### Summary\n- [ ] 20 tests pass\n\n## Files\n- src/services/PromptBuilder.ts (NEW)\n- src/services/PromptBuilder.test.ts (NEW)\n\n## API\n```typescript\ninterface PromptContext {\n  task: Bead;\n  branch: string;\n  taskId: string;\n  config: ChorusConfig;\n  projectDir: string;\n}\n\nclass PromptBuilder {\n  build(context: PromptContext): string;\n  buildTaskSection(task: Bead): string;\n  buildQualityCommandsSection(config: ChorusConfig): string;\n  buildCommitRulesSection(taskId: string): string;\n  buildLearningsFormatSection(): string;\n  buildCompletionSection(config: ChorusConfig): string;\n  loadPatterns(projectDir: string): string;\n}\n```\n\n## Prompt Structure (from Master Plan)\n```markdown\n# Task: {task_id}\n\n## Description\n{task_description}\n\n## Acceptance Criteria\n{acceptance_criteria or \"All tests pass\"}\n\n## Quality Commands (must pass before completion)\nRun these commands in order before signaling COMPLETE:\n1. `npm run typecheck` (required)\n2. `npm run lint` (optional)\n3. `npm test` (required)\n\n## Patterns (from PATTERNS.md)\n{patterns content if exists}\n\n## Commit Message Rules\n**IMPORTANT:** Include task ID in every commit message for rollback support.\n\nFormat: `\u003ctype\u003e: \u003cdescription\u003e [\u003ctask-id\u003e]`\n\nExample: `feat: implement auth [ch-abc]`\n\n## Learnings Format\nWhen you discover something useful, add it to your scratchpad's ## Learnings section with a scope prefix:\n\n- **[LOCAL]** - Only affects this task (not shared with other tasks)\n- **[CROSS-CUTTING]** - Affects multiple features (triggers plan review)\n- **[ARCHITECTURAL]** - Fundamental design decision (triggers plan review + alert)\n\nExample:\n```\n## Learnings\n- [LOCAL] This function needs memoization for performance\n- [CROSS-CUTTING] All API endpoints require rate limiting middleware\n- [ARCHITECTURAL] Use dependency injection for service instantiation\n```\n\n## Completion Protocol\nWhen ALL criteria are met AND all required quality commands pass:\n1. Run each quality command and verify it passes\n2. Output exactly: \u003cchorus\u003eCOMPLETE\u003c/chorus\u003e\n\nIf blocked by external issue, output: \u003cchorus\u003eBLOCKED: reason\u003c/chorus\u003e\nIf you need clarification, output: \u003cchorus\u003eNEEDS_HELP: what you need\u003c/chorus\u003e\n\n## Context\n- Read AGENTS.md for project conventions\n- Read .chorus/PATTERNS.md for learned patterns\n- Current branch: agent/{agent}/{task_id}\n- Log discoveries to .agent/scratchpad.md\n- Commit frequently with task ID in message\n```\n\n## Quality Commands Section Template\n```markdown\n## Quality Commands (must pass before completion)\nRun these commands in order before signaling COMPLETE:\n{numbered_list}\n\nExample format:\n1. `npm run typecheck` (required)\n2. `npm run lint` (optional)\n3. `npm test` (required)\n```\n\n## Learnings Format Section Template\n```markdown\n## Learnings Format\nWhen you discover something useful, add it to your scratchpad's ## Learnings section with a scope prefix:\n\n- **[LOCAL]** - Only affects this task (not shared)\n- **[CROSS-CUTTING]** - Affects multiple features (triggers plan review)\n- **[ARCHITECTURAL]** - Fundamental design decision (triggers plan review + alert)\n\nExample:\n```\n## Learnings\n- [LOCAL] This function needs memoization\n- [CROSS-CUTTING] All API endpoints require rate limiting\n- [ARCHITECTURAL] Use dependency injection for services\n```\n```\n\n## Tests (20 total)\n1. `build()` returns string containing task title\n2. `build()` returns string containing branch name\n3. `build()` output has sections in correct order\n4. `build()` handles task without body (title only)\n5. `build()` includes quality commands as numbered list\n6. `buildTaskSection()` returns string containing task.title\n7. `buildTaskSection()` returns string containing task.body\n8. `buildQualityCommandsSection()` returns numbered list\n9. `buildQualityCommandsSection()` marks required vs optional\n10. `buildQualityCommandsSection()` returns empty for no commands\n11. `buildCommitRulesSection(\"ch-abc\")` returns string containing \"[ch-abc]\"\n12. `buildCommitRulesSection()` returns string containing \"Commit Message Rules\"\n13. `buildLearningsFormatSection()` explains scope prefixes\n14. `buildLearningsFormatSection()` includes when to use each scope\n15. `buildCompletionSection()` returns string containing \"\u003cchorus\u003e\"\n16. `buildCompletionSection()` returns string containing signal format\n17. `buildCompletionSection()` includes \"quality commands must pass\" when configured\n18. `loadPatterns()` reads PATTERNS.md content\n19. `loadPatterns()` returns empty string if file missing\n20. `build()` includes patterns section when PATTERNS.md has content\n\n## Notes\n- Claude agent loads its own context via .claude/rules\n- Non-Claude context injection (AGENTS.md, learnings) → F07b (deferred)\n- PATTERNS.md is optional but enhances agent context when present\n- Quality commands format is numbered list with (required)/(optional) suffix\n- Learnings format section teaches agent about scope prefixes","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T01:38:04.926365+03:00","created_by":"deligoez","updated_at":"2026-01-11T19:14:52.75932+03:00","closed_at":"2026-01-11T19:14:52.75932+03:00","close_reason":"Closed","labels":["m2-agent-prep"],"dependencies":[{"issue_id":"ch-wk8","depends_on_id":"ch-2n6","type":"blocks","created_at":"2026-01-10T11:00:15.753799+03:00","created_by":"deligoez"}]}
{"id":"ch-wllj","title":"E2E-33: Output Scrolling","description":"## What\nE2E test for agent output scrolling behavior.\n\n## Acceptance Criteria\n- [ ] Output auto-scrolls to latest line\n- [ ] Shows only last N lines (maxOutputLines)\n- [ ] Scroll indicator shows when truncated\n- [ ] Manual scroll with j/k in log view\n- [ ] 4 tests pass\n\n## Test Cases\n1. `it('auto-scrolls to latest output')`\n2. `it('truncates to maxOutputLines')`\n3. `it('shows scroll indicator when truncated')`\n4. `it('manual scroll works in log view')`\n\n## Files\n- tests/e2e/output-scrolling.test.ts\n\n## Dependencies\n- ch-0e01 (E2E Infrastructure)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:22:07.069417+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:49:50.696619+03:00","closed_at":"2026-01-12T01:49:50.696619+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-wllj","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:22:07.077955+03:00","created_by":"deligoez"}]}
{"id":"ch-wqn","title":"F99: Planning Horizon Manager","description":"## What\nManages planning horizon state and stop conditions for incremental planning.\n\n## Acceptance Criteria\n- [ ] `PlanningHorizonManager` class exists\n- [ ] `getCurrentHorizon()` returns current horizon number (1-based)\n- [ ] `getStopConditions()` returns configured stop conditions array\n- [ ] `shouldStopPlanning(reason)` returns true if reason matches any stop condition\n- [ ] `advanceHorizon()` increments horizon and persists to planning-state.json\n- [ ] `getHorizonSummary()` returns { horizon, sectionsPlanned, sectionsPending }\n- [ ] Integrates with F86 Planning State for persistence\n- [ ] Loads horizon config from config.json (initialTaskCount, minReadyTasks, stopConditions)\n- [ ] 10 tests pass\n\n## Stop Conditions\n- `unknownDependency` - Need to see implementation first\n- `decisionPoint` - Choice depends on benchmarks/reality\n- `taskCountReached` - Initial task limit hit\n- `specComplete` - All spec sections have tasks\n\n## Files\n- src/services/PlanningHorizonManager.ts\n- tests/services/PlanningHorizonManager.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T09:16:56.465242+03:00","created_by":"deligoez","updated_at":"2026-01-12T07:12:22.86927+03:00","closed_at":"2026-01-12T07:12:22.86927+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-wqn","depends_on_id":"ch-to7","type":"blocks","created_at":"2026-01-11T09:16:56.469461+03:00","created_by":"deligoez"},{"issue_id":"ch-wqn","depends_on_id":"ch-sro","type":"blocks","created_at":"2026-01-11T09:16:56.471978+03:00","created_by":"deligoez"}]}
{"id":"ch-x0i9","title":"E2E-31: Blocked Tasks","description":"## What\nE2E test for blocked task display.\n\n## Acceptance Criteria\n- [ ] Blocked tasks show ⊗ indicator\n- [ ] BlockedTaskInfo shows blocker IDs\n- [ ] Multiple blockers shown as comma-separated list\n- [ ] Single blocker shows ID and status\n- [ ] 4 tests pass\n\n## Test Cases\n1. `it('shows blocked indicator for blocked tasks')`\n2. `it('displays single blocker with status')`\n3. `it('displays multiple blockers as list')`\n4. `it('updates when blockers resolve')`\n\n## Files\n- tests/e2e/blocked-tasks.test.ts\n\n## Dependencies\n- ch-0e01 (E2E Infrastructure)\n- ch-sl9 (F62a BlockedTaskInfo)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:21:50.196878+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:45:37.807622+03:00","closed_at":"2026-01-12T01:45:37.807622+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-x0i9","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:21:50.199509+03:00","created_by":"deligoez"},{"issue_id":"ch-x0i9","depends_on_id":"ch-sl9","type":"blocks","created_at":"2026-01-11T21:21:50.201798+03:00","created_by":"deligoez"}]}
{"id":"ch-x0tz","title":"E2E-R01: Single Task Review E2E - Review single pending task from selection","description":"## What\nE2E test for reviewing a single selected task.\n\n## Acceptance Criteria\n- [ ] Create project with 3 tasks, one in \"reviewing\" status\n- [ ] Navigate with j/k to select the \"reviewing\" task\n- [ ] Press R, verify task review panel opens directly (not summary)\n- [ ] Press A, verify task approved and status changed to closed\n- [ ] 4 tests pass\n\n## Files\n- src/e2e/single-review.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:13:50.657086+03:00","created_by":"deligoez","updated_at":"2026-01-12T17:01:15.821061+03:00","closed_at":"2026-01-12T17:01:15.821061+03:00","close_reason":"Closed","labels":["m13-review"],"dependencies":[{"issue_id":"ch-x0tz","depends_on_id":"ch-q4nx","type":"blocks","created_at":"2026-01-12T15:13:50.659937+03:00","created_by":"deligoez"},{"issue_id":"ch-x0tz","depends_on_id":"ch-cq1q","type":"blocks","created_at":"2026-01-12T15:13:50.662336+03:00","created_by":"deligoez"},{"issue_id":"ch-x0tz","depends_on_id":"ch-8aka","type":"blocks","created_at":"2026-01-12T15:13:50.663878+03:00","created_by":"deligoez"}]}
{"id":"ch-x2p1","title":"FR00: Agent Completion Handler - Orchestrate task completion flow","description":"## What\nOrchestrate the task completion flow when an agent signals DONE.\n\n## Acceptance Criteria\n- [ ] Receives agent completion signal from orchestrator\n- [ ] Runs quality commands via `QualityCommandsManager.runAll()`\n- [ ] Collects git changes via `git diff --stat` for changed files\n- [ ] Builds `TaskCompletionResult` with all data (taskId, agentId, iterations, duration, signal, quality, changes)\n- [ ] Saves completion result via CompletionResultStorage\n- [ ] Calls auto-approve engine to evaluate\n- [ ] If auto-approvable: transitions task to `closed`, sends to merge queue (existing MergeService)\n- [ ] If not auto-approvable: transitions task to `reviewing` status\n- [ ] Sends `TASK_COMPLETED` event to review region (for status bar update)\n- [ ] 10 tests pass\n\n## Files\n- src/services/AgentCompletionHandler.ts\n- src/services/AgentCompletionHandler.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:12:28.117534+03:00","created_by":"deligoez","updated_at":"2026-01-12T16:24:30.227675+03:00","closed_at":"2026-01-12T16:24:30.227675+03:00","close_reason":"Closed","labels":["m13-review"],"dependencies":[{"issue_id":"ch-x2p1","depends_on_id":"ch-zjlr","type":"blocks","created_at":"2026-01-12T15:12:28.118836+03:00","created_by":"deligoez"},{"issue_id":"ch-x2p1","depends_on_id":"ch-swsi","type":"blocks","created_at":"2026-01-12T15:12:28.12052+03:00","created_by":"deligoez"},{"issue_id":"ch-x2p1","depends_on_id":"ch-sot9","type":"blocks","created_at":"2026-01-12T15:12:28.122047+03:00","created_by":"deligoez"}]}
{"id":"ch-x5un","title":"FR09: Review Summary Panel - Batch review overview panel","description":"## What\nPanel showing batch review overview with task list.\n\n## Acceptance Criteria\n- [ ] Shows task count in header (\"REVIEW SUMMARY ... 5 tasks\")\n- [ ] Shows \"Quality passed: X  Quality failed: Y\" summary\n- [ ] Lists tasks with ID, title (truncated to 30 chars), quality indicator (✓/✗), mode\n- [ ] Highlights selected task with cursor (►)\n- [ ] Shows keyboard hints at bottom ([Enter] Review one by one, [1-9] Jump, [Esc] Cancel)\n- [ ] Supports scrolling for long lists (\u003e 10 tasks)\n- [ ] Number keys (1-9) select specific task\n- [ ] 8 tests pass\n\n## Files\n- src/components/ReviewSummaryPanel.tsx\n- src/components/ReviewSummaryPanel.test.tsx","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:12:31.075473+03:00","created_by":"deligoez","updated_at":"2026-01-12T16:30:48.108408+03:00","closed_at":"2026-01-12T16:30:48.108408+03:00","close_reason":"Closed","labels":["m13-review"],"dependencies":[{"issue_id":"ch-x5un","depends_on_id":"ch-ooiw","type":"blocks","created_at":"2026-01-12T15:12:31.078832+03:00","created_by":"deligoez"},{"issue_id":"ch-x5un","depends_on_id":"ch-sot9","type":"blocks","created_at":"2026-01-12T15:12:31.081249+03:00","created_by":"deligoez"}]}
{"id":"ch-xe8","title":"F46b: Task Editor - Handle restart after task edit","description":"## What\nHandle the \"Edit Task\" intervention - when a task is edited while an agent is working on it, restart the agent with the updated prompt.\n\n## Context from Master Plan\n```\n4. EDIT TASK (e)\n   - Modify task description/criteria\n   - If agent running: signal restart\n```\n\n## Design Decision: No `bd edit` Integration\nThe `bd edit` command opens an interactive editor - this is a CLI concern, not a service concern.\nTaskEditor only handles the **notification** that a task was edited externally.\nThe TUI (InterventionPanel) handles opening `bd edit` as a subprocess.\n\n## API\n```typescript\n// src/services/TaskEditor.ts\n\nclass TaskEditor {\n  constructor(\n    private agentStopper: AgentStopper,\n    private orchestrator: Orchestrator\n  ) {}\n\n  /**\n   * Notify that a task was edited externally\n   * - Check if agent running via agentStopper.getAgentForTask()\n   * - If agent running, stop and restart with new prompt\n   * - If no agent, just return success\n   */\n  async notifyTaskEdited(taskId: string): Promise\u003cInterventionResult\u003e\n\n  /**\n   * Check if an agent is working on a task\n   */\n  hasAgentForTask(taskId: string): boolean\n\n  /**\n   * Get the agent ID working on a task (or null)\n   */\n  getAgentIdForTask(taskId: string): string | null\n}\n```\n\n## Files\n- src/services/TaskEditor.ts\n- tests/services/TaskEditor.test.ts\n\n## Acceptance Criteria\n- [ ] `notifyTaskEdited()` checks for agent via agentStopper.getAgentForTask()\n- [ ] `notifyTaskEdited()` returns success with action='none' if no agent running\n- [ ] `notifyTaskEdited()` stops agent via agentStopper.stopAgent() when running\n- [ ] `notifyTaskEdited()` restarts agent via orchestrator.spawnAgentForTask()\n- [ ] `notifyTaskEdited()` returns InterventionResult with affectedAgents array\n- [ ] `hasAgentForTask()` returns true when agent is working on task\n- [ ] `hasAgentForTask()` returns false when no agent on task\n- [ ] `getAgentIdForTask()` returns agent ID when running, null otherwise\n- [ ] 8 tests pass\n\n## Tests\n1. notifyTaskEdited() with no agent returns success with action='none'\n2. notifyTaskEdited() with agent stops it via agentStopper.stopAgent()\n3. notifyTaskEdited() restarts agent via orchestrator.spawnAgentForTask()\n4. notifyTaskEdited() returns affected agent ID in result\n5. notifyTaskEdited() returns empty affectedAgents when no agent\n6. hasAgentForTask() returns true when agent exists\n7. hasAgentForTask() returns false when no agent\n8. getAgentIdForTask() returns agentId or null appropriately\n\n## Note\n`bd edit` subprocess handling is done in InterventionPanel (F46c), not here.\nThis service only handles the post-edit notification and agent restart logic.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T12:07:26.106866+03:00","created_by":"deligoez","updated_at":"2026-01-11T23:09:38.576151+03:00","closed_at":"2026-01-11T23:09:38.576151+03:00","close_reason":"Closed","labels":["m9-intervention"],"dependencies":[{"issue_id":"ch-xe8","depends_on_id":"ch-cwy","type":"blocks","created_at":"2026-01-10T12:07:26.108815+03:00","created_by":"deligoez"},{"issue_id":"ch-xe8","depends_on_id":"ch-0e7","type":"blocks","created_at":"2026-01-10T12:08:33.027038+03:00","created_by":"deligoez"},{"issue_id":"ch-xe8","depends_on_id":"ch-999","type":"blocks","created_at":"2026-01-10T23:51:05.883664+03:00","created_by":"deligoez"}]}
{"id":"ch-xhsx","title":"E2E-04: FooterBar Shows Stats","description":"## What\nVerify FooterBar shows task stats and merge queue.\n\n## Tests (3 tests)\n1. Shows task count by status\n2. Shows merge queue indicator\n3. Shows help hint text\n\n## Files\n- src/e2e/footer-bar.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T21:17:46.336578+03:00","created_by":"deligoez","updated_at":"2026-01-11T22:14:34.708512+03:00","closed_at":"2026-01-11T22:14:34.708512+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-xhsx","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:17:46.339284+03:00","created_by":"deligoez"},{"issue_id":"ch-xhsx","depends_on_id":"ch-nvo","type":"blocks","created_at":"2026-01-11T21:25:08.700827+03:00","created_by":"deligoez"},{"issue_id":"ch-xhsx","depends_on_id":"ch-d6yv","type":"blocks","created_at":"2026-01-11T21:44:10.596055+03:00","created_by":"deligoez"},{"issue_id":"ch-xhsx","depends_on_id":"ch-lqp6","type":"blocks","created_at":"2026-01-11T22:07:21.547619+03:00","created_by":"deligoez"}]}
{"id":"ch-xijj","title":"E2E-28: Grid Settings (g key)","description":"## What\nE2E test for grid layout settings with 'g' key.\n\n## Acceptance Criteria\n- [ ] Pressing 'g' opens grid settings menu\n- [ ] Can change grid columns (2x2, 3x2, etc.)\n- [ ] Grid reflows agents after change\n- [ ] Settings persist across sessions\n- [ ] Pressing Escape closes menu\n- [ ] 5 tests pass\n\n## Test Cases\n1. `it('opens grid settings menu when g is pressed')`\n2. `it('changes grid columns on selection')`\n3. `it('reflows agents after column change')`\n4. `it('persists settings')`\n5. `it('closes menu with Escape')`\n\n## Files\n- tests/e2e/grid-settings.test.ts\n\n## Dependencies\n- ch-0e01 (E2E Infrastructure)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:21:22.42249+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:40:02.476879+03:00","closed_at":"2026-01-12T01:40:02.476879+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-xijj","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:21:22.425318+03:00","created_by":"deligoez"}]}
{"id":"ch-xn6","title":"F28: Rebase-Retry","description":"## What\nResolves simple conflicts by rebasing feature branch onto latest main.\n\n## Conflict Detection Strategy\nRebase conflicts are detected by:\n1. Running `git rebase main` and checking exit code\n2. Exit code 0 = clean rebase (no conflicts)\n3. Non-zero exit + presence of `.git/rebase-merge/` or `.git/rebase-apply/` = conflicts\n4. Check `git status` for \"rebase in progress\" state\n\n## Dependency Injection Pattern\n```typescript\ninterface RebaseRetryDeps {\n  exec: (cmd: string) =\u003e Promise\u003c{ exitCode: number; stdout: string; stderr: string }\u003e;\n  fileExists: (path: string) =\u003e Promise\u003cboolean\u003e;\n}\n\nclass RebaseRetry {\n  constructor(private deps: RebaseRetryDeps) {}\n}\n```\n\n## Acceptance Criteria\n\n### rebase() - 3 tests\n- [ ] Returns `{ success: true, rebased: true }` when `git rebase main` exits 0\n- [ ] Returns `{ success: false, hadConflicts: true }` when exit code != 0 AND `.git/rebase-merge/` exists\n- [ ] Returns `{ success: false, hadConflicts: false, error: string }` on other git errors\n\n### rebaseAndRetry() - 2 tests\n- [ ] Calls `rebase()`, if success returns `{ ready: true }` for merge retry\n- [ ] Calls `rebase()`, if conflicts calls `abortRebase()` and returns `{ ready: false, aborted: true }`\n\n### abortRebase() - 1 test\n- [ ] Runs `git rebase --abort` via `deps.exec()` and returns success\n\n## Test Setup Pattern\n```typescript\nconst mockDeps: RebaseRetryDeps = {\n  exec: vi.fn(),\n  fileExists: vi.fn(),\n};\n\n// Clean rebase\nmockDeps.exec.mockResolvedValueOnce({ exitCode: 0, stdout: '', stderr: '' });\n\n// Conflict scenario\nmockDeps.exec.mockResolvedValueOnce({ exitCode: 1, stdout: '', stderr: 'CONFLICT' });\nmockDeps.fileExists.mockResolvedValueOnce(true); // .git/rebase-merge/ exists\n```\n\n## Files\n- src/services/RebaseRetry.ts\n- tests/services/RebaseRetry.test.ts\n\n## Plan\nSee: thoughts/shared/plans/features/F28-rebase-retry.md\n\n**Total: 6 tests**","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T03:16:43.477781+03:00","created_by":"deligoez","updated_at":"2026-01-11T19:28:45.88905+03:00","closed_at":"2026-01-11T19:28:45.88905+03:00","close_reason":"Closed","labels":["m5-merge"],"dependencies":[{"issue_id":"ch-xn6","depends_on_id":"ch-7pb","type":"blocks","created_at":"2026-01-10T03:16:43.479618+03:00","created_by":"deligoez"}]}
{"id":"ch-y43","title":"F01c: Config Save - Write config to file with validation","description":"## What\nSave configuration to .chorus/config.json with validation.\n\n## Acceptance Criteria\n\n### save() - 2 tests\n- [ ] save() creates .chorus/ directory and writes config as 2-space indent JSON\n- [ ] save() overwrites existing config file\n\n### update() - 1 test\n- [ ] update() merges partial config with current and calls save()\n\n### validate() - 7 tests\n- [ ] validate() returns true for valid ChorusConfig (all required fields present)\n- [ ] validate() returns false for null, undefined, or non-object input\n- [ ] validate() returns false when mode is invalid (not 'semi-auto' or 'autopilot')\n- [ ] validate() returns false when required fields missing (version, agents.default, project.taskIdPrefix)\n- [ ] validate() returns false when qualityCommands is not an array\n- [ ] validate() returns false when qualityCommand missing name or command\n- [ ] validate() returns true for valid qualityCommands array\n\n### Summary\n- [ ] 10 tests pass\n\n## Files\n- src/services/ConfigService.ts (extend)\n- tests/services/ConfigService.test.ts (extend)\n\n## Implementation\n```typescript\nsave(config: ChorusConfig): void {\n  const dir = path.dirname(this.configPath);\n  if (!fs.existsSync(dir)) {\n    fs.mkdirSync(dir, { recursive: true });\n  }\n  fs.writeFileSync(this.configPath, JSON.stringify(config, null, 2));\n  this.config = config;\n}\n\nupdate(partial: Partial\u003cChorusConfig\u003e): void {\n  const current = this.get();\n  const merged = { ...current, ...partial };\n  this.save(merged);\n}\n\nvalidate(config: unknown): config is ChorusConfig {\n  if (!config || typeof config !== 'object') return false;\n  const c = config as Record\u003cstring, unknown\u003e;\n  if (!c.version || typeof c.version !== 'string') return false;\n  if (c.mode !== 'semi-auto' \u0026\u0026 c.mode !== 'autopilot') return false;\n  if (!c.agents || typeof c.agents !== 'object') return false;\n  const agents = c.agents as Record\u003cstring, unknown\u003e;\n  if (!['claude', 'codex', 'opencode'].includes(agents.default as string)) return false;\n  if (!c.project || !(c.project as Record\u003cstring, unknown\u003e).taskIdPrefix) return false;\n  // Validate qualityCommands\n  if (!Array.isArray(c.qualityCommands)) return false;\n  for (const cmd of c.qualityCommands as unknown[]) {\n    if (!cmd || typeof cmd !== 'object') return false;\n    const qc = cmd as Record\u003cstring, unknown\u003e;\n    if (!qc.name || !qc.command) return false;\n  }\n  return true;\n}\n```\n\n## Test Cases\n1. save() creates directory and writes formatted JSON\n2. save() overwrites existing file\n3. update() merges partial and saves\n4. validate() accepts valid ChorusConfig\n5. validate() rejects null, undefined, and non-objects\n6. validate() rejects invalid mode values\n7. validate() rejects missing required fields (including taskIdPrefix)\n8. validate() rejects non-array qualityCommands\n9. validate() rejects invalid qualityCommand objects\n10. validate() accepts valid qualityCommands array\n\n## Notes\n- Validation is strict: missing any required field returns false\n- Partial update uses shallow merge (nested objects replaced, not merged)\n- qualityCommands replaces legacy testCommand","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T01:30:30.340211+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:52:05.263805+03:00","closed_at":"2026-01-11T18:52:05.263805+03:00","close_reason":"Closed","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-y43","depends_on_id":"ch-sro","type":"blocks","created_at":"2026-01-10T01:30:30.342251+03:00","created_by":"deligoez"}]}
{"id":"ch-yf1m","title":"FR14: Label Rules Engine - Determine review mode from task labels","description":"## What\nDetermine review mode from task labels and config rules.\n\n## Acceptance Criteria\n- [ ] `getReviewMode(taskLabels, config)` returns `'per-task'` when `review:per-task` label present\n- [ ] Returns `'batch'` when `review:batch` label present\n- [ ] Returns `'auto-approve'` when `review:auto` label present\n- [ ] Returns `'skip'` when `review:skip` label present\n- [ ] Returns `config.defaultMode` when no review label\n- [ ] Applies `config.labelRules` overrides (e.g., `security` label → `per-task` mode)\n- [ ] 6 tests pass\n\n## Files\n- src/services/LabelRulesEngine.ts\n- src/services/LabelRulesEngine.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:11:49.084137+03:00","created_by":"deligoez","updated_at":"2026-01-12T15:39:31.214595+03:00","closed_at":"2026-01-12T15:39:31.214595+03:00","close_reason":"Closed","labels":["m13-review"],"dependencies":[{"issue_id":"ch-yf1m","depends_on_id":"ch-zjlr","type":"blocks","created_at":"2026-01-12T15:11:49.087137+03:00","created_by":"deligoez"},{"issue_id":"ch-yf1m","depends_on_id":"ch-swsi","type":"blocks","created_at":"2026-01-12T15:11:49.090146+03:00","created_by":"deligoez"}]}
{"id":"ch-yhq","title":"F98: Incremental Planning Trigger","description":"## What\nTriggers incremental planning when ready task count drops below threshold.\n\n## Acceptance Criteria\n- [ ] `IncrementalPlanningTrigger` class exists\n- [ ] `checkTriggerCondition()` returns true if ready count \u003c minReadyTasks\n- [ ] `getReadyTaskCount()` queries Beads for ready task count\n- [ ] `triggerPlanning()` initiates Plan Agent for next spec section\n- [ ] Uses PlanningHorizonManager to track horizon state\n- [ ] Uses SpecEvolutionTracker to get next draft section\n- [ ] `onTaskComplete(taskId)` hook checks if planning needed\n- [ ] Respects stopConditions from PlanningHorizonManager\n- [ ] Emits 'planning:triggered' event when planning starts\n- [ ] Emits 'planning:complete' event when planning finishes\n- [ ] Integrates with post-task-complete hook\n- [ ] 12 tests pass\n\n## Trigger Flow\n1. Task completes\n2. Check ready task count\n3. If below threshold AND draft sections exist → trigger planning\n4. Plan Agent creates tasks for next section\n5. Spec section marked as tasked (collapsed)\n6. Continue until threshold reached or stop condition hit\n\n## Files\n- src/services/IncrementalPlanningTrigger.ts\n- tests/services/IncrementalPlanningTrigger.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T09:17:47.626272+03:00","created_by":"deligoez","updated_at":"2026-01-12T10:20:22.130098+03:00","closed_at":"2026-01-12T10:20:22.130098+03:00","close_reason":"Closed","labels":["m8-memory"],"dependencies":[{"issue_id":"ch-yhq","depends_on_id":"ch-wqn","type":"blocks","created_at":"2026-01-11T09:17:47.629576+03:00","created_by":"deligoez"},{"issue_id":"ch-yhq","depends_on_id":"ch-2yp","type":"blocks","created_at":"2026-01-11T09:17:47.631859+03:00","created_by":"deligoez"},{"issue_id":"ch-yhq","depends_on_id":"ch-z8g","type":"blocks","created_at":"2026-01-11T09:17:47.633723+03:00","created_by":"deligoez"},{"issue_id":"ch-yhq","depends_on_id":"ch-sro","type":"blocks","created_at":"2026-01-11T14:01:49.422136+03:00","created_by":"deligoez"}]}
{"id":"ch-yn74","title":"E2E-R04: Auto-Approve E2E - Tasks auto-approved when quality passes","description":"## What\nE2E test for auto-approve functionality.\n\n## Acceptance Criteria\n- [ ] Create task with `review:auto` label\n- [ ] Complete task with quality passed\n- [ ] Verify task auto-approved (never appears in review queue)\n- [ ] Create task with `review:auto` label, quality failed\n- [ ] Verify task IS in review queue\n- [ ] 4 tests pass\n\n## Files\n- src/e2e/auto-approve.e2e.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:13:54.886565+03:00","created_by":"deligoez","updated_at":"2026-01-12T17:11:43.302803+03:00","closed_at":"2026-01-12T17:11:43.302803+03:00","close_reason":"Closed","labels":["m13-review"],"dependencies":[{"issue_id":"ch-yn74","depends_on_id":"ch-swsi","type":"blocks","created_at":"2026-01-12T15:13:54.890528+03:00","created_by":"deligoez"}]}
{"id":"ch-ywec","title":"E2E-49: SessionLogger Integration Tests","description":"## What\nE2E tests for SessionLogger append-only JSONL logging.\n\n## Acceptance Criteria\n- [ ] Creates session-log.jsonl if missing\n- [ ] Appends events correctly (one JSON per line)\n- [ ] Events have correct timestamp format\n- [ ] File survives process restart\n- [ ] Multiple events append in order\n- [ ] 6 tests pass\n\n## Files\n- src/e2e/session-logger.e2e.test.ts\n\n## Implementation Notes\n- Use createGitRepoWithChorus() helper\n- Test JSONL format (newline-delimited JSON)\n- Verify file contents are valid JSON lines","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T00:07:46.095175+03:00","created_by":"deligoez","updated_at":"2026-01-12T02:00:55.960777+03:00","closed_at":"2026-01-12T02:00:55.960777+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-ywec","depends_on_id":"ch-73s","type":"blocks","created_at":"2026-01-12T00:08:48.114498+03:00","created_by":"deligoez"}]}
{"id":"ch-z8g","title":"F82: Plan Agent Controller","description":"## What\nOrchestrate Plan Agent behavior (spawn, communicate, parse tasks) with XState event emission.\n\n## Architecture Change (XState v5)\n\nPlan Agent emits events to ChorusMachine for state coordination:\n\n```typescript\n// Event types emitted to machine\ntype PlanAgentEvent =\n  | { type: 'PLAN_AGENT_STARTED'; agentId: string }\n  | { type: 'PLAN_AGENT_RESPONSE'; agentId: string; content: string }\n  | { type: 'PLAN_AGENT_ERROR'; agentId: string; error: string }\n  | { type: 'PLAN_AGENT_STOPPED'; agentId: string }\n  | { type: 'TASKS_EXTRACTED'; tasks: Task[]; count: number };\n```\n\n## Implementation\n\n```typescript\ninterface PlanAgentOptions {\n  promptBuilder: PlanAgentPromptBuilder;\n  conversationManager: ConversationManager;\n  sessionLogger: SessionLogger;\n  onEvent: (event: PlanAgentEvent) =\u003e void; // Send to machine\n}\n\nexport class PlanAgent {\n  constructor(private options: PlanAgentOptions) {}\n\n  async start(): Promise\u003cvoid\u003e {\n    const prompt = this.options.promptBuilder.build();\n    await this.options.conversationManager.start(prompt);\n    \n    // Emit event to machine\n    this.options.onEvent({\n      type: 'PLAN_AGENT_STARTED',\n      agentId: this.id,\n    });\n  }\n\n  async send(message: string): Promise\u003cvoid\u003e {\n    try {\n      const response = await this.options.conversationManager.send(message);\n      \n      // Emit response event\n      this.options.onEvent({\n        type: 'PLAN_AGENT_RESPONSE',\n        agentId: this.id,\n        content: response,\n      });\n      \n      // Log interaction\n      this.options.sessionLogger.log({\n        type: 'agent_response',\n        agentId: this.id,\n        content: response,\n      });\n    } catch (error) {\n      this.options.onEvent({\n        type: 'PLAN_AGENT_ERROR',\n        agentId: this.id,\n        error: error.message,\n      });\n      throw error;\n    }\n  }\n\n  extractTasks(): Task[] {\n    const tasks = this.parseTasksFromLastResponse();\n    \n    // Emit extraction event\n    this.options.onEvent({\n      type: 'TASKS_EXTRACTED',\n      tasks,\n      count: tasks.length,\n    });\n    \n    return tasks;\n  }\n}\n```\n\n## XState Testing Pattern\n\n```typescript\nimport { describe, it, expect, vi } from 'vitest';\n\ndescribe('PlanAgent - XState Event Emission', () =\u003e {\n  it('should emit PLAN_AGENT_STARTED on start()', async () =\u003e {\n    // Arrange\n    const onEvent = vi.fn();\n    const agent = new PlanAgent({\n      promptBuilder: mockPromptBuilder,\n      conversationManager: mockConversationManager,\n      sessionLogger: mockLogger,\n      onEvent,\n    });\n\n    // Act\n    await agent.start();\n\n    // Assert\n    expect(onEvent).toHaveBeenCalledWith({\n      type: 'PLAN_AGENT_STARTED',\n      agentId: expect.any(String),\n    });\n  });\n\n  it('should emit PLAN_AGENT_RESPONSE on send()', async () =\u003e {\n    // Arrange\n    const onEvent = vi.fn();\n    mockConversationManager.send.mockResolvedValue('Here are the tasks...');\n    const agent = new PlanAgent({ ...mockOptions, onEvent });\n    await agent.start();\n\n    // Act\n    await agent.send('Create a login feature');\n\n    // Assert\n    expect(onEvent).toHaveBeenCalledWith({\n      type: 'PLAN_AGENT_RESPONSE',\n      agentId: expect.any(String),\n      content: 'Here are the tasks...',\n    });\n  });\n\n  it('should emit PLAN_AGENT_ERROR on failure', async () =\u003e {\n    // Arrange\n    const onEvent = vi.fn();\n    mockConversationManager.send.mockRejectedValue(new Error('API error'));\n    const agent = new PlanAgent({ ...mockOptions, onEvent });\n    await agent.start();\n\n    // Act \u0026 Assert\n    await expect(agent.send('test')).rejects.toThrow();\n    expect(onEvent).toHaveBeenCalledWith({\n      type: 'PLAN_AGENT_ERROR',\n      agentId: expect.any(String),\n      error: 'API error',\n    });\n  });\n\n  it('should emit TASKS_EXTRACTED on extractTasks()', async () =\u003e {\n    // Arrange\n    const onEvent = vi.fn();\n    const agent = new PlanAgent({ ...mockOptions, onEvent });\n    await agent.start();\n    await agent.send('Create login and signup features');\n\n    // Act\n    const tasks = agent.extractTasks();\n\n    // Assert\n    expect(onEvent).toHaveBeenCalledWith({\n      type: 'TASKS_EXTRACTED',\n      tasks: expect.any(Array),\n      count: expect.any(Number),\n    });\n    expect(tasks.length).toBeGreaterThan(0);\n  });\n\n  it('should emit PLAN_AGENT_STOPPED on stop()', async () =\u003e {\n    // Arrange\n    const onEvent = vi.fn();\n    const agent = new PlanAgent({ ...mockOptions, onEvent });\n    await agent.start();\n\n    // Act\n    await agent.stop();\n\n    // Assert\n    expect(onEvent).toHaveBeenCalledWith({\n      type: 'PLAN_AGENT_STOPPED',\n      agentId: expect.any(String),\n    });\n  });\n});\n```\n\n## Acceptance Criteria\n\n### Lifecycle - 4 tests\n- [ ] `start()` spawns Claude with plan agent system prompt\n- [ ] `start()` emits PLAN_AGENT_STARTED event\n- [ ] `stop()` terminates agent process\n- [ ] `stop()` emits PLAN_AGENT_STOPPED event\n\n### Communication - 3 tests\n- [ ] `send(message)` sends user message to agent\n- [ ] `send()` emits PLAN_AGENT_RESPONSE event with content\n- [ ] Error in `send()` emits PLAN_AGENT_ERROR event\n\n### Task Extraction - 3 tests\n- [ ] `extractTasks()` parses task list from last response\n- [ ] `extractTasks()` emits TASKS_EXTRACTED event\n- [ ] `extractTasks()` validates against basic schema\n\n### State \u0026 Logging - 2 tests\n- [ ] `getState()` returns lifecycle state (idle, running, stopped, error)\n- [ ] All interactions logged via SessionLogger\n\n### Summary\n- [ ] 12 tests pass\n\n## Files\n- `src/services/PlanAgent.ts`\n- `tests/services/PlanAgent.test.ts`\n\n## Dependencies\n- F82a (ch-rmg): PlanAgentPromptBuilder\n- F82b (ch-0el): ConversationManager\n\n## Implementation Notes\n- `onEvent` callback is passed from calling code (Planning Mode Controller)\n- Events are sent to machine via: `actor.send(event)`\n- PlanAgent doesn't hold reference to machine - decoupled design\n- SessionLogger (F87) captures all agent interactions","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T03:06:47.536312+03:00","created_by":"deligoez","updated_at":"2026-01-12T03:02:26.440243+03:00","closed_at":"2026-01-12T03:02:26.440243+03:00","close_reason":"Closed","labels":["m0-planning"],"dependencies":[{"issue_id":"ch-z8g","depends_on_id":"ch-rmg","type":"blocks","created_at":"2026-01-11T03:06:47.539707+03:00","created_by":"deligoez"},{"issue_id":"ch-z8g","depends_on_id":"ch-0el","type":"blocks","created_at":"2026-01-11T03:06:47.541876+03:00","created_by":"deligoez"}]}
{"id":"ch-zdzg","title":"BUG: Consolidate duplicate AgentType definitions","description":"## What\nAgentType is defined in 3 different files with inconsistent values.\n\n## Current State\n- `agent.ts`: \"claude\" | \"aider\" | \"codex\"\n- `learning.ts`: \"claude\" | \"codex\" | \"opencode\"\n- `config.ts`: \"claude\" | \"codex\" | \"opencode\"\n\n## Problem\n- `aider` vs `opencode` inconsistency\n- Multiple sources of truth\n\n## Solution\n1. Keep single definition in `agent.ts`\n2. Export and re-use in other files\n3. Use \"claude\" | \"codex\" | \"opencode\" (opencode preferred per deferred tasks)\n4. Remove duplicate definitions\n\n## Acceptance Criteria\n- [ ] Single AgentType definition in src/types/agent.ts\n- [ ] All files import from agent.ts\n- [ ] No duplicate type definitions\n- [ ] All tests pass\n- [ ] 3 tests pass (verify imports work)\n\n## Files\n- src/types/agent.ts (source)\n- src/types/learning.ts (update import)\n- src/types/config.ts (update import)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T13:28:51.052395+03:00","created_by":"deligoez","updated_at":"2026-01-12T13:45:43.843367+03:00","closed_at":"2026-01-12T13:45:43.843367+03:00","close_reason":"Closed","labels":["m1-infrastructure"]}
{"id":"ch-zi33","title":"F42c: TUI Pattern Review Dialog","description":"## What\nTUI dialog component for reviewing and approving pattern suggestions to PATTERNS.md.\n\n## Why\nWhen agents discover reusable patterns, they should be reviewed before adding to PATTERNS.md. This dialog provides the approve/edit/reject/later workflow.\n\n## Acceptance Criteria\n- [ ] `PatternReviewDialog` component renders pattern suggestion\n- [ ] Shows pattern category, source task, and suggested content\n- [ ] 'a' key approves and adds to PATTERNS.md\n- [ ] 'e' key opens inline editor for modifications\n- [ ] 'r' key rejects and discards pattern\n- [ ] 'l' key defers to pending queue\n- [ ] Pending patterns stored in `.chorus/pending-patterns.json`\n- [ ] Shows pending count badge in status bar\n- [ ] `Shift+P` opens pending patterns list\n- [ ] Pending patterns auto-expire after 7 days\n- [ ] `usePatternReview()` hook manages dialog state\n- [ ] 12 tests pass\n\n## API\n```typescript\ninterface PatternSuggestion {\n  id: string;\n  category: string;\n  sourceTask: string;\n  sourceAgent: string;\n  content: string;\n  createdAt: Date;\n  expiresAt: Date;\n}\n\ninterface PatternReviewDialogProps {\n  suggestion: PatternSuggestion;\n  onApprove: (pattern: PatternSuggestion) =\u003e void;\n  onEdit: (pattern: PatternSuggestion, edited: string) =\u003e void;\n  onReject: (pattern: PatternSuggestion) =\u003e void;\n  onLater: (pattern: PatternSuggestion) =\u003e void;\n}\n```\n\n## Visual\n```\n┌─────────────────────────────────────────────────────────────────┐\n│ NEW PATTERN SUGGESTION                                           │\n├─────────────────────────────────────────────────────────────────┤\n│  Category: API Design                                            │\n│  Source: ch-005 (claude) - \"Implement user auth\"                │\n│                                                                  │\n│  Suggested pattern:                                              │\n│  \u003e Always use dependency injection for external services...      │\n│                                                                  │\n│  [A] Approve  [E] Edit  [R] Reject  [L] Later                   │\n└─────────────────────────────────────────────────────────────────┘\n```\n\n## Files\n- src/components/PatternReviewDialog.tsx\n- src/hooks/usePatternReview.ts\n- src/services/PendingPatternStore.ts\n- tests/components/PatternReviewDialog.test.tsx\n\n## Dependencies\n- F88 (ch-j40): PATTERNS.md Manager (for writing approved patterns)\n- F41 (ch-a6h): Learning Store (source of pattern suggestions)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T14:25:25.047842+03:00","created_by":"deligoez","updated_at":"2026-01-12T10:28:16.086457+03:00","closed_at":"2026-01-12T10:28:16.086457+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-zi33","depends_on_id":"ch-j40","type":"blocks","created_at":"2026-01-11T14:25:28.987513+03:00","created_by":"deligoez"},{"issue_id":"ch-zi33","depends_on_id":"ch-a6h","type":"blocks","created_at":"2026-01-11T14:25:29.051405+03:00","created_by":"deligoez"}]}
{"id":"ch-zins","title":"E2E-40: Full Workflow","description":"## What\nE2E integration test for complete workflow.\n\n## Acceptance Criteria\n- [ ] Start app → see task list\n- [ ] Select task → spawn agent\n- [ ] Agent runs → output updates\n- [ ] Agent completes → task marked done\n- [ ] Exit app cleanly\n- [ ] 5 tests pass\n\n## Test Cases\n1. `it('shows task list on start')`\n2. `it('spawns agent for selected task')`\n3. `it('updates output during agent work')`\n4. `it('marks task complete on agent success')`\n5. `it('exits cleanly after workflow')`\n\n## Files\n- tests/e2e/full-workflow.test.ts\n\n## Dependencies\n- ch-0e01 (E2E Infrastructure)\n- ch-44vh (E2E-01: App Renders)\n- ch-pyvy (E2E-02: TaskPanel)\n- ch-a1l6 (E2E-03: AgentGrid)\n- ch-fjdz (E2E-09: Spawn Agent)\n- ch-080n (E2E-10: Assign Task)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T21:22:38.513649+03:00","created_by":"deligoez","updated_at":"2026-01-12T09:52:58.5738+03:00","closed_at":"2026-01-12T09:52:58.5738+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-zins","depends_on_id":"ch-0e01","type":"blocks","created_at":"2026-01-11T21:22:38.516859+03:00","created_by":"deligoez"},{"issue_id":"ch-zins","depends_on_id":"ch-44vh","type":"blocks","created_at":"2026-01-11T21:22:38.521045+03:00","created_by":"deligoez"},{"issue_id":"ch-zins","depends_on_id":"ch-pyvy","type":"blocks","created_at":"2026-01-11T21:22:38.523033+03:00","created_by":"deligoez"},{"issue_id":"ch-zins","depends_on_id":"ch-a1l6","type":"blocks","created_at":"2026-01-11T21:22:38.524869+03:00","created_by":"deligoez"},{"issue_id":"ch-zins","depends_on_id":"ch-fjdz","type":"blocks","created_at":"2026-01-11T21:22:38.526669+03:00","created_by":"deligoez"},{"issue_id":"ch-zins","depends_on_id":"ch-080n","type":"blocks","created_at":"2026-01-11T21:22:38.528731+03:00","created_by":"deligoez"}]}
{"id":"ch-zjlr","title":"FR01: Review Types - Types and interfaces for review system","description":"## What\nDefine all TypeScript types and interfaces for the review system.\n\n## Acceptance Criteria\n- [ ] `ReviewConfig` interface with defaultMode, autoApprove settings, labelRules\n- [ ] `TaskCompletionResult` interface with taskId, agentId, iterations, duration, signal, quality, changes\n- [ ] `QualityRunResult` interface with name, passed, duration\n- [ ] `FileChange` interface with path, type (added/modified/deleted), linesAdded, linesRemoved\n- [ ] `ReviewMode` type union: 'per-task' | 'batch' | 'auto-approve' | 'skip'\n- [ ] 6 tests pass\n\n## Files\n- src/types/review.ts\n- src/types/review.test.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-12T15:10:40.889852+03:00","created_by":"deligoez","updated_at":"2026-01-12T15:18:29.186233+03:00","closed_at":"2026-01-12T15:18:29.186233+03:00","close_reason":"Closed","labels":["m13-review"]}
{"id":"ch-zqi","title":"F12: Task Claimer - Claim tasks via bd CLI","description":"## What\nBeads CLI wrapper for task operations: claim, release, query, create, and **filtered retrieval**.\n\n**IMPORTANT:** All Chorus components MUST use BeadsCLI to access Beads. Direct `bd` calls are prohibited.\n\n## Acceptance Criteria\n\n### claimTask() - 2 tests\n- [ ] `claimTask(id, assignee)` runs `bd update \u003cid\u003e --status=in_progress --assignee=\u003cagent\u003e`\n- [ ] `claimTask()` throws on bd error\n\n### releaseTask() - 2 tests\n- [ ] `releaseTask(id)` runs `bd update \u003cid\u003e --status=open --assignee=`\n- [ ] `releaseTask()` throws on bd error\n\n### getTask() - 3 tests\n- [ ] `getTask(id)` returns parsed task for valid ID\n- [ ] `getTask(id)` returns null for invalid ID\n- [ ] `getTask(id)` includes custom fields (model, agent, acceptance_criteria)\n\n### getReadyTasks() - 6 tests\n- [ ] `getReadyTasks()` returns array of ready tasks\n- [ ] `getReadyTasks({ excludeLabels: ['deferred'] })` filters out tasks with deferred label\n- [ ] `getReadyTasks({ includeLabels: ['m1-infrastructure'] })` returns only tasks with that label\n- [ ] `getReadyTasks({ includeLabels: ['m1'], excludeLabels: ['deferred'] })` excludes first, then includes (see precedence)\n- [ ] `getReadyTasks()` returns empty array on error\n- [ ] `getReadyTasks()` with empty options returns all ready tasks\n\n### Filter Precedence Rules\n**CRITICAL: Exclude always wins over include.**\n\n```\nFilter Algorithm:\n1. Start with all ready tasks from bd\n2. Apply excludeLabels: remove any task where task.labels includes ANY excludeLabel\n3. Apply includeLabels: keep only tasks where task.labels includes ANY includeLabel\n4. Return filtered list\n```\n\n**Example with precedence:**\n```\nTasks:\n  - A: labels=['m1', 'deferred']\n  - B: labels=['m1']\n  - C: labels=['m2']\n\ngetReadyTasks({ includeLabels: ['m1'], excludeLabels: ['deferred'] })\n  Step 1: [A, B, C]\n  Step 2 (exclude 'deferred'): [B, C]  // A removed\n  Step 3 (include 'm1'): [B]           // C removed\n  Result: [B]\n```\n\n**Edge case: same label in both arrays**\n```\ngetReadyTasks({ includeLabels: ['m1'], excludeLabels: ['m1'] })\n  → Returns [] (exclude wins, all m1 tasks removed before include filter)\n```\n\n### createTask() - 3 tests\n- [ ] `createTask(title, options)` runs `bd create` with priority, labels, depends\n- [ ] `createTask()` supports custom fields via `--custom model=X`\n- [ ] `createTask()` returns created task ID\n\n### Utility - 2 tests\n- [ ] `isAvailable()` returns true if bd installed\n- [ ] `isInitialized()` returns true if .beads/ exists\n\n### Summary\n- [ ] 18 tests pass\n\n## Types\n```typescript\ninterface GetReadyOptions {\n  excludeLabels?: string[];  // e.g., ['deferred', 'v2'] - applied FIRST\n  includeLabels?: string[];  // e.g., ['m1-infrastructure'] - applied SECOND\n}\n\ninterface TaskOptions {\n  priority?: 1 | 2 | 3 | 4;\n  labels?: string[];\n  depends?: string[];\n  model?: string;\n  agent?: AgentType;\n  acceptanceCriteria?: string[];\n}\n\ninterface Task {\n  id: string;\n  title: string;\n  description?: string;\n  priority: number;\n  status: string;\n  labels: string[];\n  dependencies: string[];\n  custom?: {\n    model?: string;\n    agent?: string;\n    acceptance_criteria?: string[];\n  };\n}\n```\n\n## Files\n- src/services/BeadsCLI.ts (NEW)\n- src/services/BeadsCLI.test.ts (NEW)\n\n## Notes\n- Use execa for CLI calls\n- Parse JSON output (bd show --json, bd ready --json)\n- projectDir is cwd for all bd commands\n- **Label filtering happens in-memory after bd ready --json returns**\n- Default excludeLabels in production: ['deferred']","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T01:39:31.364679+03:00","created_by":"deligoez","updated_at":"2026-01-11T18:37:27.210561+03:00","closed_at":"2026-01-11T18:37:27.210561+03:00","close_reason":"Closed","labels":["m3-task-mgmt"],"dependencies":[{"issue_id":"ch-zqi","depends_on_id":"ch-mzi3","type":"blocks","created_at":"2026-01-11T15:28:35.108904+03:00","created_by":"deligoez"}]}
{"id":"ch-zr8u","title":"E2E-48: Checkpointer Integration Tests","description":"## What\nE2E tests for Checkpointer creating real git tags.\n\n## Acceptance Criteria\n- [ ] Creates git tag with correct naming (chorus-checkpoint-{timestamp})\n- [ ] Creates pre-merge tag with task ID\n- [ ] Lists existing checkpoint tags correctly\n- [ ] Restores to checkpoint (git reset to tag)\n- [ ] Handles missing tag gracefully\n- [ ] 6 tests pass\n\n## Files\n- src/e2e/checkpointer.e2e.test.ts\n\n## Implementation Notes\n- Use createGitRepoWithChorus() helper\n- Test real git tag operations\n- Verify tags exist with git tag --list","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T00:07:38.515122+03:00","created_by":"deligoez","updated_at":"2026-01-12T01:58:32.084785+03:00","closed_at":"2026-01-12T01:58:32.084785+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-zr8u","depends_on_id":"ch-k9y","type":"blocks","created_at":"2026-01-12T00:08:48.01928+03:00","created_by":"deligoez"}]}
{"id":"ch-zsn","title":"F63x: Undo Key (u) - Undo last action","description":"## What\nKeyboard handler to undo the last user action.\n\n## Context from Master Plan\n```\nRECOVERY\nu      Undo last action\n```\n\n## Shortcut\n- **u** - Undo last action\n\n## Scope\nUndo applies to USER actions, not agent actions:\n- Undo task block → unblock task\n- Undo task spawn → stop agent, return task to pending\n- Undo mode change → revert to previous mode\n\nAgent commits are handled by 'R' (rollback), not 'u' (undo).\n\n## Implementation\n\n```typescript\n// src/hooks/useUndoKey.ts\n// Action history is stored in XState machine context\n\ninterface UndoableAction {\n  type: 'block' | 'spawn' | 'mode_change' | 'pause';\n  payload: unknown;\n  timestamp: number;\n}\n\ninterface UseUndoKeyOptions {\n  send: (event: { type: 'UNDO' }) =\u003e void;\n  actionHistory: UndoableAction[];  // From machine context\n  onEmpty?: () =\u003e void;\n}\n\nfunction useUndoKey(options: UseUndoKeyOptions) {\n  useInput(async (input) =\u003e {\n    if (input !== 'u') return;\n    \n    if (options.actionHistory.length === 0) {\n      options.onEmpty?.();\n      return;\n    }\n    \n    // Send UNDO event to machine - machine handles the logic\n    options.send({ type: 'UNDO' });\n  });\n}\n```\n\n## Acceptance Criteria\n\n### Undo Actions - 4 tests\n- [ ] Undo block → removes 'blocked' label from task\n- [ ] Undo spawn → stops agent, returns task to pending\n- [ ] Undo mode change → reverts to previous mode\n- [ ] Undo pause → resumes orchestration\n\n### Empty History - 2 tests\n- [ ] Shows \"Nothing to undo\" when history empty\n- [ ] No crash on empty history\n\n### History Management - 2 tests\n- [ ] Actions added to machine context when performed\n- [ ] Undo removes action from history (no redo)\n\n### Summary\n- [ ] 8 tests pass\n\n## Files\n- src/hooks/useUndoKey.ts (NEW)\n- src/hooks/useUndoKey.test.ts (NEW)\n\n## XState Integration\nAction history is stored in ChorusMachine context:\n```typescript\ninterface ChorusMachineContext {\n  // ... other fields\n  actionHistory: UndoableAction[];\n}\n```\n\nUNDO event triggers machine action that:\n1. Pops last action from history\n2. Executes reverse operation based on action type\n3. Updates context\n\n## Dependencies\n- F49 (IterationRollback) for spawn undo\n- FX07 (useChorusMachine) for machine access\n\n## Notes\n- No redo support (keep simple)\n- History limited to last 10 actions\n- Agent commits require 'R' rollback, not 'u'","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-11T12:45:19.396762+03:00","created_by":"deligoez","updated_at":"2026-01-12T05:25:09.867756+03:00","closed_at":"2026-01-12T05:25:09.867756+03:00","close_reason":"Closed","labels":["m12-tui"],"dependencies":[{"issue_id":"ch-zsn","depends_on_id":"ch-c8j","type":"blocks","created_at":"2026-01-11T12:45:19.400023+03:00","created_by":"deligoez"},{"issue_id":"ch-zsn","depends_on_id":"ch-fna","type":"blocks","created_at":"2026-01-11T14:01:44.276384+03:00","created_by":"deligoez"},{"issue_id":"ch-zsn","depends_on_id":"ch-vskx","type":"blocks","created_at":"2026-01-11T15:27:38.519169+03:00","created_by":"deligoez"}]}
{"id":"ch-zvha","title":"TS05-E2E: Query E2E Tests","description":"## What\nE2E tests for query methods.\n\n## Files\n- `src/e2e/taskstore-queries.e2e.test.ts`\n\n## Acceptance Criteria\n- [ ] Filters work correctly with persisted data\n- [ ] `ready()` excludes stuck tasks\n- [ ] `getStats()` returns accurate counts\n- [ ] 3 tests pass","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-13T00:13:12.92703+03:00","created_by":"deligoez","updated_at":"2026-01-13T00:13:12.92703+03:00","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-zvha","depends_on_id":"ch-suuw","type":"blocks","created_at":"2026-01-13T00:13:12.929019+03:00","created_by":"deligoez"},{"issue_id":"ch-zvha","depends_on_id":"ch-3l5i","type":"blocks","created_at":"2026-01-13T00:22:06.507038+03:00","created_by":"deligoez"}]}
{"id":"ch-zxsn","title":"E2E-56: Config Persistence Workflow","description":"## What\nE2E tests for complete config lifecycle - loading, saving, validation, and recovery.\n\n## Acceptance Criteria\n- [ ] Fresh project creates default config\n- [ ] Config migration (legacy testCommand → qualityCommands)\n- [ ] Config validation catches schema errors\n- [ ] Corrupted config falls back to defaults\n- [ ] Config loads/saves from correct path\n- [ ] 6 tests pass\n\n## Files\n- src/e2e/config-service.e2e.test.ts\n\n## Implementation Notes\n- Use temp directory with fresh .chorus/ structure\n- Test both valid and invalid config scenarios","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-12T00:38:43.565289+03:00","created_by":"deligoez","updated_at":"2026-01-12T00:44:47.196893+03:00","closed_at":"2026-01-12T00:44:47.196893+03:00","close_reason":"Closed","labels":["m1-infrastructure"],"dependencies":[{"issue_id":"ch-zxsn","depends_on_id":"ch-2n6","type":"blocks","created_at":"2026-01-12T00:38:43.578093+03:00","created_by":"deligoez"}]}
